import{r as k,u as B,b as L,a as F,d as O,j as e,m as i,c as x,A as V,C as S,M as _,U as W,e as T,q as l,h as z}from"./index-CzK-Wtpj.js";import{u as G}from"./useQuery-B1e_qTp-.js";import{u as R}from"./useMutation-BXgiM4Zs.js";import{S as u}from"./animated-ifqYnJC-.js";import{A as X,a as Y,b as J}from"./avatar-CPrQWbpQ.js";import{g as E,T as P}from"./schema-CbH_BfFp.js";import{A as Z}from"./arrow-left-eQXjCarb.js";import{I as ee}from"./inbox-DejM70i8.js";import{C as te}from"./calendar-CAGmnp_J.js";import{D as se}from"./dollar-sign-EFTHd7iI.js";import{C as D}from"./circle-x-D3T454mR.js";import{C as M}from"./circle-check-big-BUMRiSQy.js";import{f as ae,a as ie,e as re}from"./ar-C0KQNq9O.js";import"./utils-km2FGkQ4.js";const ne={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.08,delayChildren:.1}}},$={hidden:{opacity:0,y:16},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}}},Ne=k.memo(function(){const[,p]=B(),{user:h}=L(),{t:le,i18n:H}=F(),{toast:o}=O(),[r,g]=k.useState("pending"),s=H.language==="ar",{data:n,isLoading:I}=G({queryKey:["/api/direct-requests"],enabled:!!h&&h.role==="tasker"}),d=R({mutationFn:async t=>(await T("POST",`/api/direct-requests/${t}/accept`)).json(),onSuccess:t=>{var a;l.invalidateQueries({queryKey:["/api/direct-requests"]}),l.invalidateQueries({queryKey:["/api/tasks"]}),l.invalidateQueries({queryKey:["/api/notifications"]}),o({title:s?"تم قبول الطلب":"Request Accepted",description:s?"تم إنشاء المهمة بنجاح. يمكنك الآن بدء العمل.":"Task created successfully. You can start working now."}),(a=t.task)!=null&&a.id&&p(`/task/${t.task.id}`)},onError:()=>{o({title:s?"خطأ":"Error",description:s?"حدث خطأ أثناء قبول الطلب":"An error occurred while accepting the request",variant:"destructive"})}}),m=R({mutationFn:async t=>(await T("POST",`/api/direct-requests/${t}/reject`)).json(),onSuccess:()=>{l.invalidateQueries({queryKey:["/api/direct-requests"]}),l.invalidateQueries({queryKey:["/api/notifications"]}),o({title:s?"تم رفض الطلب":"Request Rejected",description:s?"تم رفض طلب الخدمة المباشرة":"Direct service request rejected"})},onError:()=>{o({title:s?"خطأ":"Error",description:s?"حدث خطأ أثناء رفض الطلب":"An error occurred while rejecting the request",variant:"destructive"})}}),f=(n==null?void 0:n.filter(t=>t.status==="pending"))||[],y=(n==null?void 0:n.filter(t=>t.status!=="pending"))||[],j=r==="pending"?f:y,K=t=>{const a=E(t);if(!a)return t;const c=P[a.mainCategory];return a.subcategory?s?a.subcategory.nameAr:a.subcategory.nameEn:s?c.nameAr:c.nameEn},b=t=>{const a=E(t);return a?P[a.mainCategory].colorHex:"#6B7280"},Q=t=>{const a=new Date(t);return ae(a,"EEEE, d MMMM yyyy",{locale:s?ie:re})},U=t=>{switch(t){case"accepted":return{text:s?"تم القبول":"Accepted",color:"bg-success/15 text-success",icon:M};case"rejected":return{text:s?"تم الرفض":"Rejected",color:"bg-destructive/15 text-destructive",icon:D};case"cancelled":return{text:s?"ملغى":"Cancelled",color:"bg-muted text-muted-foreground",icon:z};default:return{text:s?"قيد الانتظار":"Pending",color:"bg-warning/15 text-warning",icon:S}}};return I?e.jsxs("div",{className:"min-h-screen gradient-mesh pt-safe px-5 py-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(u,{className:"w-11 h-11 rounded-2xl"}),e.jsx(u,{className:"h-8 w-40 rounded-lg"}),e.jsx("div",{className:"w-11"})]}),[1,2,3].map(t=>e.jsx(u,{className:"h-52 mb-4 rounded-3xl"},t))]}):e.jsxs("div",{className:"min-h-screen gradient-mesh pt-safe pb-32",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:e.jsx(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:.4,scale:1},transition:{duration:1},className:"absolute top-20 -right-24 w-72 h-72 bg-gradient-to-br from-accent/25 to-accent/5 rounded-full blur-3xl rtl:-left-24 rtl:right-auto"})}),e.jsxs(i.div,{variants:ne,initial:"hidden",animate:"visible",className:"relative z-10 px-5 py-5",children:[e.jsxs(i.div,{variants:$,className:"flex items-center justify-between mb-6",children:[e.jsx(i.button,{whileHover:{scale:1.05},whileTap:{scale:.92},onClick:()=>window.history.back(),className:"w-11 h-11 flex items-center justify-center rounded-2xl glass","data-testid":"button-back",children:e.jsx(Z,{className:"w-5 h-5 text-foreground/80 rtl:rotate-180"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground",children:s?"طلبات الخدمة المباشرة":"Direct Service Requests"}),e.jsx("div",{className:"w-11"})]}),e.jsxs(i.div,{variants:$,className:"flex gap-2 mb-6",children:[e.jsxs(i.button,{whileTap:{scale:.96},onClick:()=>g("pending"),className:x("flex-1 h-12 rounded-2xl font-semibold text-sm transition-all duration-200",r==="pending"?"gradient-primary text-white shadow-lg shadow-primary/25":"glass text-muted-foreground"),"data-testid":"tab-pending",children:[s?"قيد الانتظار":"Pending"," (",f.length,")"]}),e.jsxs(i.button,{whileTap:{scale:.96},onClick:()=>g("history"),className:x("flex-1 h-12 rounded-2xl font-semibold text-sm transition-all duration-200",r==="history"?"gradient-primary text-white shadow-lg shadow-primary/25":"glass text-muted-foreground"),"data-testid":"tab-history",children:[s?"السجل":"History"," (",y.length,")"]})]}),e.jsx(V,{mode:"wait",children:j.length===0?e.jsxs(i.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"glass rounded-3xl p-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-muted/30 flex items-center justify-center",children:e.jsx(ee,{className:"w-10 h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-bold text-foreground mb-2",children:r==="pending"?s?"لا توجد طلبات جديدة":"No Pending Requests":s?"لا توجد سجلات":"No History"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:r==="pending"?s?"عندما يطلب العملاء خدماتك مباشرة، ستظهر هنا":"When clients request your services directly, they'll appear here":s?"الطلبات المقبولة والمرفوضة ستظهر هنا":"Accepted and rejected requests will appear here"})]},"empty"):e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:j.map((t,a)=>{var v,w,N,C,A;const c=U(t.status),q=c.icon;return e.jsx(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},className:"glass rounded-3xl overflow-hidden","data-testid":`direct-request-card-${t.id}`,children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{className:"w-12 h-12 border-2 border-white/20",children:[e.jsx(Y,{src:((v=t.client)==null?void 0:v.avatar)||void 0}),e.jsx(J,{className:"gradient-primary text-white font-bold",children:((N=(w=t.client)==null?void 0:w.name)==null?void 0:N[0])||"U"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-foreground",children:((C=t.client)==null?void 0:C.name)||"Client"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",(A=t.client)==null?void 0:A.username]})]})]}),e.jsxs("div",{className:x("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold",c.color),children:[e.jsx(q,{className:"w-3.5 h-3.5"}),c.text]})]}),e.jsx("div",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold mb-4",style:{backgroundColor:`${b(t.category)}20`,color:b(t.category)},children:K(t.category)}),e.jsx("p",{className:"text-foreground mb-4 text-sm leading-relaxed",children:t.description}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 text-sm",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(te,{className:"w-4 h-4 text-primary"})}),e.jsx("span",{className:"text-foreground",children:Q(t.scheduledDate)})]}),e.jsxs("div",{className:"flex items-center gap-2.5 text-sm",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(S,{className:"w-4 h-4 text-primary"})}),e.jsx("span",{className:"text-foreground",children:t.scheduledTime})]}),e.jsxs("div",{className:"flex items-center gap-2.5 text-sm",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(_,{className:"w-4 h-4 text-primary"})}),e.jsx("span",{className:"text-foreground",children:t.location})]}),e.jsxs("div",{className:"flex items-center gap-2.5 text-sm",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-success/10 flex items-center justify-center",children:e.jsx(se,{className:"w-4 h-4 text-success"})}),e.jsxs("span",{className:"text-foreground font-semibold",children:[t.budget," ",s?"ر.س":"SAR"]})]})]}),t.status==="pending"&&e.jsxs("div",{className:"flex gap-3 mt-5 pt-5 border-t border-border/30",children:[e.jsxs(i.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>m.mutate(t.id),disabled:m.isPending||d.isPending,className:"flex-1 h-12 rounded-2xl font-semibold flex items-center justify-center gap-2 bg-destructive/10 text-destructive disabled:opacity-50","data-testid":`button-reject-${t.id}`,children:[e.jsx(D,{className:"w-5 h-5"}),s?"رفض":"Reject"]}),e.jsxs(i.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>d.mutate(t.id),disabled:m.isPending||d.isPending,className:"flex-1 h-12 rounded-2xl font-semibold flex items-center justify-center gap-2 gradient-primary text-white shadow-lg shadow-primary/25 disabled:opacity-50","data-testid":`button-accept-${t.id}`,children:[e.jsx(M,{className:"w-5 h-5"}),s?"قبول":"Accept"]})]}),t.status!=="pending"&&e.jsx("div",{className:"flex gap-3 mt-5 pt-5 border-t border-border/30",children:e.jsxs(i.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>p(`/profile/${t.clientId}`),className:"flex-1 h-11 rounded-xl font-semibold text-sm flex items-center justify-center gap-2 glass text-foreground","data-testid":`button-view-client-${t.id}`,children:[e.jsx(W,{className:"w-4 h-4"}),s?"عرض الملف الشخصي":"View Profile"]})})]})},t.id)})},r)})]})]})});export{Ne as default};
