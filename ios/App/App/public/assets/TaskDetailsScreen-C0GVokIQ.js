import{r,j as e,c as T,m as n,C as he,X as fe,a as J,A as ge,M as be,k as Le,u as Ae,b as Re,d as Pe,h as Q,q as y,g as Z,e as M}from"./index-CzK-Wtpj.js";import{f as je}from"./currency-BA8TA7a2.js";import{A as _,a as U,b as W}from"./avatar-CPrQWbpQ.js";import{S as H}from"./star-CdLY6qwL.js";import{B as Ee}from"./briefcase-CG3vAR-K.js";import{D as Y}from"./dollar-sign-EFTHd7iI.js";import{C as Oe}from"./check-BpdMCCzI.js";import{M as V}from"./Modal-DGwTDYVd.js";import{u as G}from"./useQuery-B1e_qTp-.js";import{u as F}from"./useMutation-BXgiM4Zs.js";import{S as v}from"./animated-ifqYnJC-.js";import{c as we,g as ye}from"./mapConfig-8OlPnSkx.js";import{N as qe,P as Be,T as pe}from"./trash-2-Ce2Bgf6u.js";import{g as De,T as P}from"./schema-CbH_BfFp.js";import{A as Ie}from"./arrow-left-eQXjCarb.js";import{H as $e}from"./heart-BRsyov3V.js";import{C as Ke}from"./calendar-CAGmnp_J.js";import{M as ze}from"./message-circle-BzmAey6U.js";import{S as Qe}from"./sparkles-CAG2jcvH.js";import{L as E}from"./loader-circle-AYqjcifH.js";import{C as Ze}from"./circle-check-big-BUMRiSQy.js";import{S as Ve}from"./send-9v2j9KhO.js";import"./utils-km2FGkQ4.js";const Ge=r.memo(function({offer:a,onAccept:u,onReject:l,showActions:g=!0}){var b,c,o,f;const p=r.useCallback(N=>N.split(" ").map(j=>j[0]).join("").toUpperCase().slice(0,2),[]),m=r.useCallback(N=>{const x={pending:{bg:"bg-warning/15 text-warning border-warning/20",icon:he,label:"Pending"},accepted:{bg:"bg-success/15 text-success border-success/20",icon:Oe,label:"Accepted"},rejected:{bg:"bg-destructive/15 text-destructive border-destructive/20",icon:fe,label:"Rejected"}}[N];if(!x)return null;const L=x.icon;return e.jsxs("span",{className:T("text-[10px] font-bold uppercase tracking-wider px-2.5 py-1 rounded-full flex items-center gap-1 border",x.bg),children:[e.jsx(L,{className:"w-3 h-3"}),x.label]})},[]),d=((b=a.tasker)==null?void 0:b.name)||"Unknown Tasker",w=(c=a.tasker)!=null&&c.rating?parseFloat(String(a.tasker.rating)):0,t=((o=a.tasker)==null?void 0:o.completedTasks)||0;return e.jsx(n.div,{whileTap:{scale:.98},className:"glass rounded-3xl p-5 transition-all hover:shadow-lg","data-testid":`offer-card-${a.id}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(_,{className:"w-14 h-14 border-2 border-white/20 shadow-lg",children:[e.jsx(U,{src:((f=a.tasker)==null?void 0:f.avatar)||void 0,alt:d}),e.jsx(W,{className:"gradient-primary text-white font-bold",children:p(d)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx("h4",{className:"font-bold text-foreground text-lg truncate",children:d}),m(a.status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(H,{className:"w-4 h-4 fill-warning text-warning"}),e.jsx("span",{className:"font-bold",children:w.toFixed(1)})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsxs("span",{children:[t," jobs"]})]})]}),a.message&&e.jsx("div",{className:"bg-white/30 dark:bg-white/5 rounded-xl p-3 mb-4",children:e.jsxs("p",{className:"text-sm text-muted-foreground italic",children:['"',a.message,'"']})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-4 py-2 rounded-xl",children:[e.jsx(Y,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-xl font-extrabold text-primary",children:je(a.amount,{locale:"en"})})]}),g&&a.status==="pending"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>l==null?void 0:l(a.id),className:"px-5 py-2.5 rounded-xl glass-button font-bold text-sm","data-testid":`button-reject-offer-${a.id}`,children:"Decline"}),e.jsx(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>u==null?void 0:u(a.id),className:"px-5 py-2.5 rounded-xl gradient-primary text-white font-bold text-sm shadow-lg shadow-primary/25","data-testid":`button-accept-offer-${a.id}`,children:"Accept"})]})]})]})]})})});function _e({isOpen:S,onClose:a,latitude:u,longitude:l,location:g}){const p=r.useRef(null),m=r.useRef(null),{t:d,i18n:w}=J(),t=w.language==="ar";return r.useEffect(()=>{if(!S||!p.current||!window.L)return;document.documentElement.classList.contains("dark");const b=ye(),c=we(b),o=window.L.map(p.current,{zoomControl:!1,attributionControl:!0,dragging:!0,touchZoom:!0,scrollWheelZoom:!0,doubleClickZoom:!0,boxZoom:!0,keyboard:!0}).setView([u,l],15);return window.L.tileLayer(c.url,c.options).addTo(o),window.L.control.zoom({position:"bottomright"}).addTo(o),window.L.circle([u,l],{radius:100,color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.2,weight:2}).addTo(o),m.current=o,setTimeout(()=>{o.invalidateSize()},100),()=>{m.current&&(m.current.remove(),m.current=null)}},[S,u,l]),e.jsx(ge,{children:S&&e.jsxs(e.Fragment,{children:[e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/80 z-50",onClick:a}),e.jsxs(n.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"fixed inset-0 z-50 flex flex-col",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"relative h-16 flex items-center justify-between px-4 bg-black/50 backdrop-blur-sm",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-white text-sm font-medium truncate",children:g||`${u.toFixed(4)}, ${l.toFixed(4)}`})}),e.jsx(n.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:a,className:T("w-10 h-10 flex items-center justify-center rounded-xl bg-white/10 hover:bg-white/20 transition-colors",t&&"order-first"),"aria-label":d("common.close"),children:e.jsx(fe,{className:"w-5 h-5 text-white"})})]}),e.jsx("div",{ref:p,className:"flex-1 w-full",style:{minHeight:0}})]})]})})}const Ue=r.memo(function({latitude:a,longitude:u,location:l,className:g}){const p=r.useRef(null),m=r.useRef(null),[d,w]=r.useState(!1),{t,i18n:b}=J(),c=a?parseFloat(String(a)):null,o=u?parseFloat(String(u)):null,f=c!==null&&o!==null&&!isNaN(c)&&!isNaN(o);return r.useEffect(()=>{if(!p.current||!window.L||!f)return;m.current&&(m.current.remove(),m.current=null),document.documentElement.classList.contains("dark");const N=ye(),j=we(N),x=window.L.map(p.current,{zoomControl:!1,attributionControl:!1,dragging:!1,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1}).setView([c,o],15);return window.L.tileLayer(j.url,j.options).addTo(x),window.L.circle([c,o],{radius:100,color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.2,weight:2}).addTo(x),m.current=x,()=>{m.current&&(m.current.remove(),m.current=null)}},[c,o,f]),f?e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:T("glass rounded-3xl overflow-hidden relative group",g),"data-testid":"task-location-map",children:[e.jsx("div",{ref:p,className:"h-48 w-full",style:{minHeight:"192px"}}),e.jsx("div",{className:"absolute inset-0 pointer-events-none rounded-3xl ring-1 ring-inset ring-white/10"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent p-4 pt-8",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white/20 backdrop-blur-sm flex items-center justify-center",children:e.jsx(qe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-bold truncate",children:l||`${c==null?void 0:c.toFixed(4)}, ${o==null?void 0:o.toFixed(4)}`}),e.jsx("p",{className:"text-white/70 text-xs",children:t("map.tapToViewMap")})]})]})}),e.jsx("button",{onClick:()=>w(!0),className:"absolute inset-0 cursor-pointer","aria-label":t("map.openMap")}),f&&c!==null&&o!==null&&e.jsx(_e,{isOpen:d,onClose:()=>w(!1),latitude:c,longitude:o,location:l})]}):e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:T("glass rounded-3xl overflow-hidden",g),children:e.jsx("div",{className:"h-48 bg-gradient-to-br from-primary/5 to-primary/10 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center mx-auto mb-3",children:e.jsx(be,{className:"w-6 h-6 text-primary"})}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:t("map.locationNotAvailable")})]})})})}),We={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.06,delayChildren:.1}}},C={hidden:{opacity:0,y:16},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}}},wt=r.memo(function(){var oe,ce;const{id:a}=Le(),[,u]=Ae(),{user:l,userRole:g,savedTaskIds:p,toggleSavedTask:m}=Re(),{toast:d}=Pe(),{i18n:w}=J(),t=w.language==="ar",[b,c]=r.useState(!1),[o,f]=r.useState(!1),[N,j]=r.useState(!1),[x,L]=r.useState(0),[X,ee]=r.useState(""),[O,te]=r.useState(""),[se,ae]=r.useState(""),ve=r.useCallback(i=>{te(i.target.value)},[]),Ne=r.useCallback(i=>{ae(i.target.value)},[]),ke=r.useCallback(()=>{c(!1)},[]),ie=r.useCallback(()=>{f(!1)},[]),{data:s,isLoading:ne,error:q}=G({queryKey:["/api/tasks",a],enabled:!!a,retry:(i,h)=>h instanceof Error&&(h.message.includes("404")||h.message.includes("not found")||h.message.includes("401")||h.message.includes("Authentication"))?!1:i<2,retryDelay:i=>Math.min(1e3*2**i,3e3)}),{data:A}=G({queryKey:["/api/tasks",a,"bids"],enabled:!!a}),B=F({mutationFn:async()=>M("POST",`/api/tasks/${a}/bids`,{amount:parseFloat(O),message:se}),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/tasks",a,"bids"]}),c(!1),te(""),ae(""),d({title:"Offer sent!",description:"The client will review your offer"})},onError:i=>{d({title:"Failed to send offer",description:i.message,variant:"destructive"})}}),Ce=F({mutationFn:async i=>M("POST",`/api/bids/${i}/accept`),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/tasks",a]}),y.invalidateQueries({queryKey:["/api/tasks",a,"bids"]}),d({title:"Offer accepted!",description:"The tasker has been assigned"})},onError:i=>{d({title:"Failed to accept offer",description:i.message,variant:"destructive"})}}),D=F({mutationFn:async()=>M("DELETE",`/api/tasks/${a}`),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/tasks"]}),y.invalidateQueries({queryKey:["/api/tasks/my"]}),f(!1),d({title:t?"تم حذف المهمة":"Task deleted",description:t?"تم حذف المهمة بنجاح":"The task has been removed successfully"}),u("/my-tasks")},onError:i=>{d({title:t?"فشل الحذف":"Failed to delete",description:i.message,variant:"destructive"})}}),I=F({mutationFn:async()=>M("POST",`/api/tasks/${a}/request-completion`),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/tasks",a]}),d({title:t?"تم إرسال الطلب":"Request sent",description:t?"تم إرسال طلب إتمام المهمة للعميل":"Completion request sent to client"})},onError:i=>{d({title:t?"فشل الإرسال":"Request failed",description:i.message,variant:"destructive"})}}),{data:$}=G({queryKey:["/api/tasks",a,"review"],enabled:!!a}),K=F({mutationFn:async()=>M("POST","/api/reviews",{taskId:a,rating:x,comment:X||null}),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/tasks",a,"review"]}),j(!1),L(0),ee(""),d({title:t?"شكراً لتقييمك":"Thank you for rating!",description:t?"تم إرسال تقييمك بنجاح":"Your review has been submitted"})},onError:i=>{d({title:t?"فشل الإرسال":"Failed to submit",description:i.message,variant:"destructive"})}}),Te=r.useMemo(()=>a?p.includes(a):!1,[a,p]),re=g==="client",R=g==="tasker",Se=r.useMemo(()=>s&&l&&s.clientId===l.id,[s,l]),le=r.useCallback(i=>je(i,{locale:t?"ar":"en",minimumFractionDigits:0,maximumFractionDigits:0}),[t]),Me=r.useCallback(i=>{switch(i){case"open":return{bg:"bg-success/15",text:"text-success",label:"Open"};case"assigned":return{bg:"bg-warning/15",text:"text-warning",label:"Assigned"};case"in_progress":return{bg:"bg-primary/15",text:"text-primary",label:"In Progress"};case"completed":return{bg:"bg-muted",text:"text-muted-foreground",label:"Completed"};case"cancelled":return{bg:"bg-destructive/15",text:"text-destructive",label:"Cancelled"};default:return{bg:"bg-muted",text:"text-muted-foreground",label:i}}},[]),Fe=r.useCallback(()=>{window.history.back()},[]),He=r.useCallback(()=>{a&&m(a)},[a,m]);if(ne)return e.jsxs("div",{className:"min-h-screen gradient-mesh pt-safe px-5 py-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(v,{className:"h-11 w-11 rounded-2xl"}),e.jsx(v,{className:"h-6 w-24 rounded-lg"})]}),e.jsx(v,{className:"h-8 w-3/4 mb-4 rounded-lg"}),e.jsx(v,{className:"h-20 w-full rounded-2xl mb-5"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-5",children:[e.jsx(v,{className:"h-24 rounded-2xl"}),e.jsx(v,{className:"h-24 rounded-2xl"})]}),e.jsx(v,{className:"h-32 rounded-2xl mb-5"}),e.jsx(v,{className:"h-24 rounded-2xl"})]});if(q)return e.jsx("div",{className:"min-h-screen gradient-mesh pt-safe flex items-center justify-center px-5",children:e.jsxs(n.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center glass-premium rounded-3xl p-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-destructive/15 flex items-center justify-center mx-auto mb-5",children:e.jsx(Q,{className:"w-8 h-8 text-destructive"})}),e.jsx("h3",{className:"text-xl font-bold text-foreground mb-2",children:t?"خطأ في جلب البيانات":"Error loading task"}),e.jsx("p",{className:"text-muted-foreground mb-6 text-sm",children:t?"حدث خطأ أثناء جلب معلومات المهمة":"An error occurred while loading task information"}),q instanceof Error&&e.jsx("p",{className:"text-xs text-muted-foreground/70 mb-4 font-mono break-words",children:q.message}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n.button,{whileHover:{scale:1.03},whileTap:{scale:.97},onClick:()=>window.history.back(),className:"flex-1 glass px-6 py-3 rounded-2xl font-bold",children:t?"رجوع":"Go back"}),e.jsx(n.button,{whileHover:{scale:1.03},whileTap:{scale:.97},onClick:()=>y.invalidateQueries({queryKey:["/api/tasks",a]}),className:"flex-1 gradient-primary text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-primary/25",children:t?"إعادة المحاولة":"Retry"})]})]})});if(!s&&!ne)return e.jsx("div",{className:"min-h-screen gradient-mesh pt-safe flex items-center justify-center px-5",children:e.jsxs(n.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center glass-premium rounded-3xl p-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-destructive/15 flex items-center justify-center mx-auto mb-5",children:e.jsx(Q,{className:"w-8 h-8 text-destructive"})}),e.jsx("h3",{className:"text-xl font-bold text-foreground mb-2",children:t?"المهمة غير موجودة":"Task not found"}),e.jsx("p",{className:"text-muted-foreground mb-6 text-sm",children:t?"قد تكون هذه المهمة قد تم حذفها":"This task may have been removed"}),e.jsx(Z,{href:"/home",children:e.jsx(n.button,{whileHover:{scale:1.03},whileTap:{scale:.97},className:"gradient-primary text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-primary/25",children:t?"العودة للرئيسية":"Go back home"})})]})});const z=Me(s.status);return e.jsxs("div",{className:"min-h-screen gradient-mesh pt-safe pb-32",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx(n.div,{initial:{opacity:0,scale:.8},animate:{opacity:.4,scale:1},transition:{duration:1},className:"absolute top-20 -right-24 w-72 h-72 bg-gradient-to-br from-primary/20 to-primary/5 rounded-full blur-3xl"}),e.jsx(n.div,{initial:{opacity:0},animate:{opacity:.25},transition:{delay:.3},className:"absolute bottom-40 -left-16 w-48 h-48 bg-gradient-to-tr from-accent/20 to-transparent rounded-full blur-3xl"})]}),e.jsxs(n.div,{variants:We,initial:"hidden",animate:"visible",className:"relative z-10 px-5 py-5",children:[e.jsxs(n.div,{variants:C,className:"flex items-center justify-between mb-6",children:[e.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.92},onClick:Fe,className:"w-11 h-11 flex items-center justify-center rounded-2xl glass","data-testid":"button-back",children:e.jsx(Ie,{className:"w-5 h-5 text-foreground/80"})}),e.jsxs("div",{className:"flex items-center gap-2.5",children:[R&&e.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.92},onClick:He,className:"w-11 h-11 flex items-center justify-center rounded-2xl glass","data-testid":"button-save-task",children:e.jsx($e,{className:T("w-5 h-5 transition-all",Te?"fill-destructive text-destructive":"text-foreground/80")})}),re&&s.status==="open"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{href:`/task/${a}/edit`,children:e.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.92},className:"w-11 h-11 flex items-center justify-center rounded-2xl glass","data-testid":"button-edit-task",children:e.jsx(Be,{className:"w-5 h-5 text-foreground/80"})})}),e.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.92},onClick:()=>f(!0),className:"w-11 h-11 flex items-center justify-center rounded-2xl glass","data-testid":"button-delete-task",children:e.jsx(pe,{className:"w-5 h-5 text-destructive"})})]})]})]}),e.jsxs(n.div,{variants:C,children:[(()=>{var de,me,xe,ue;const i=De(s.category);let h,k;return i!=null&&i.subcategory?(h=t?i.subcategory.nameAr:i.subcategory.nameEn,k=((de=P[i.mainCategory])==null?void 0:de.colorHex)||"#6B7280"):i?(h=t?((me=P[i.mainCategory])==null?void 0:me.nameAr)||s.category:((xe=P[i.mainCategory])==null?void 0:xe.nameEn)||s.category,k=((ue=P[i.mainCategory])==null?void 0:ue.colorHex)||"#6B7280"):(h=s.category,k="#6B7280"),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"px-3 py-1.5 rounded-xl text-[10px] font-bold uppercase tracking-wider",style:{backgroundColor:`${k}20`,color:k},children:h}),e.jsx("span",{className:T("px-3 py-1.5 rounded-xl text-[10px] font-bold uppercase tracking-wider",z.bg,z.text),children:z.label})]})})(),e.jsx("h1",{className:"text-2xl font-extrabold text-foreground mb-3 leading-tight tracking-tight",children:s.title&&s.title.trim()?s.title:t?"بدون عنوان":"No title"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed mb-6",children:s.description&&s.description.trim()?s.description:t?"لا يوجد وصف متاح":"No description available"})]}),e.jsxs(n.div,{variants:C,className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"glass rounded-[20px] p-4",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-gradient-to-br from-primary/15 to-primary/5 flex items-center justify-center mb-2.5",children:e.jsx(be,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-[10px] text-muted-foreground font-semibold uppercase tracking-wider mb-0.5",children:t?"الموقع":"Location"}),e.jsx("p",{className:"font-bold text-foreground text-sm truncate",children:s.location&&s.location.trim()?s.location:t?"غير متاح":"Not available"})]}),e.jsxs("div",{className:"glass rounded-[20px] p-4",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-gradient-to-br from-accent/15 to-accent/5 flex items-center justify-center mb-2.5",children:e.jsx(Ke,{className:"w-4 h-4 text-accent"})}),e.jsx("p",{className:"text-[10px] text-muted-foreground font-semibold uppercase tracking-wider mb-0.5",children:t?"متى":"When"}),e.jsx("p",{className:"font-bold text-foreground text-sm",children:s.date&&s.date.trim()?s.date:t?"غير محدد":"Not set"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:s.time&&s.time.trim()?s.time:t?"غير محدد":"Not set"})]})]}),e.jsx(n.div,{variants:C,className:"mb-5",children:e.jsx(Ue,{latitude:s.latitude,longitude:s.longitude,location:s.location})}),e.jsxs(n.div,{variants:C,className:"relative overflow-hidden rounded-[24px] mb-5",children:[e.jsx("div",{className:"absolute inset-0 glass-premium"}),e.jsx("div",{className:"absolute inset-0 gradient-border"}),e.jsx("div",{className:"relative p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground font-semibold uppercase tracking-wider mb-1",children:t?"الميزانية":"Budget"}),e.jsx("p",{className:"text-3xl font-extrabold gradient-text-primary",children:le(s.budget)})]}),e.jsx(n.div,{whileHover:{rotate:5},className:"w-14 h-14 rounded-2xl gradient-primary flex items-center justify-center shadow-lg shadow-primary/30",children:e.jsx(Y,{className:"w-7 h-7 text-white"})})]})})]}),s.client&&e.jsxs(n.div,{variants:C,className:"glass rounded-[24px] p-5 mb-5",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-3",children:"Posted by"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(_,{className:"w-12 h-12 border-2 border-white/30 shadow-lg",children:[e.jsx(U,{src:s.client.avatar||void 0}),e.jsx(W,{className:"gradient-primary text-white font-bold",children:((oe=s.client.name)==null?void 0:oe.charAt(0))||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground truncate",children:s.client.name}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(H,{className:"w-3.5 h-3.5 fill-warning text-warning"}),e.jsx("span",{className:"font-medium",children:parseFloat(String(s.client.rating||0)).toFixed(1)})]})]}),e.jsx(Z,{href:`/chat/${s.id}`,children:e.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.92},className:"w-11 h-11 flex items-center justify-center rounded-xl gradient-primary text-white shadow-md shadow-primary/25","data-testid":"button-chat",children:e.jsx(ze,{className:"w-5 h-5"})})})]})]}),Se&&A&&A.length>0&&e.jsxs(n.div,{variants:C,className:"mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:"Offers"}),e.jsx("span",{className:"px-2.5 py-1 rounded-lg bg-primary/10 text-primary text-xs font-bold",children:A.length})]}),e.jsx("div",{className:"space-y-3",children:A.map((i,h)=>e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1+h*.05},children:e.jsx(Ge,{offer:i,onAccept:k=>Ce.mutate(k),showActions:s.status==="open"})},i.id))})]})]}),e.jsxs(ge,{children:[R&&s.status==="open"&&e.jsx(n.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe",children:e.jsxs(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>c(!0),className:"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-base shadow-xl shadow-primary/30 flex items-center justify-center gap-2.5","data-testid":"button-make-offer",children:[e.jsx(Qe,{className:"w-5 h-5"}),"Make an Offer"]})}),R&&s.status==="assigned"&&s.taskerId===(l==null?void 0:l.id)&&e.jsx(n.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe",children:e.jsx(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>I.mutate(),disabled:I.isPending,className:"w-full h-14 bg-gradient-to-r from-success to-success/80 text-white rounded-2xl font-bold text-base shadow-xl shadow-success/30 flex items-center justify-center gap-2.5 disabled:opacity-50","data-testid":"button-request-completion",children:I.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),t?"جاري الإرسال...":"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-5 h-5"}),t?"تم إنجاز المهمة":"Task Completed"]})})}),R&&s.status==="in_progress"&&s.taskerId===(l==null?void 0:l.id)&&e.jsx(n.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-warning/15 flex items-center justify-center mx-auto mb-3",children:e.jsx(he,{className:"w-6 h-6 text-warning"})}),e.jsx("p",{className:"font-bold text-foreground mb-1","data-testid":"text-waiting-payment",children:t?"في انتظار الدفع":"Awaiting Payment"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t?"العميل سيقوم بالدفع لإتمام المهمة":"Client will complete payment to finish the task"})]})}),re&&s.status==="completed"&&s.clientId===(l==null?void 0:l.id)&&!($!=null&&$.hasReview)&&e.jsx(n.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe",children:e.jsxs(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>j(!0),className:"w-full h-14 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-2xl font-bold text-base shadow-xl shadow-amber-500/30 flex items-center justify-center gap-2.5","data-testid":"button-rate-tasker",children:[e.jsx(H,{className:"w-5 h-5"}),t?"قيّم المنفذ":"Rate Tasker"]})})]}),e.jsx(V,{isOpen:b,onClose:ke,title:"Make an Offer",action:e.jsx(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>B.mutate(),disabled:!O||B.isPending,className:"w-full h-14 gradient-primary text-white rounded-2xl font-bold shadow-xl shadow-primary/30 disabled:opacity-50 flex items-center justify-center gap-2.5","data-testid":"button-submit-offer",children:B.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-5 h-5"}),"Send Offer"]})}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground",children:e.jsx(Y,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",inputMode:"decimal",value:O,onChange:ve,placeholder:"Your offer amount",autoComplete:"off",autoCorrect:"off",className:"w-full h-13 pl-12 pr-5 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none text-base","data-testid":"input-bid-amount"})]}),e.jsx("textarea",{value:se,onChange:Ne,placeholder:"Tell them why you're a great fit... (optional)",rows:3,autoComplete:"off",autoCorrect:"off",className:"w-full p-4 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none resize-none text-base","data-testid":"input-bid-message"}),e.jsx("div",{className:"text-center py-2",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Client's budget: ",e.jsx("span",{className:"font-bold text-primary",children:le(s.budget)})]})})]})}),e.jsx(V,{isOpen:o,onClose:ie,title:t?"حذف المهمة":"Delete Task",action:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:ie,className:"flex-1 h-14 rounded-2xl font-bold glass","data-testid":"button-cancel-delete",children:t?"إلغاء":"Cancel"}),e.jsx(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>D.mutate(),disabled:D.isPending,className:"flex-1 h-14 bg-destructive text-white rounded-2xl font-bold shadow-xl shadow-destructive/30 disabled:opacity-50 flex items-center justify-center gap-2","data-testid":"button-confirm-delete",children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),t?"جاري الحذف...":"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-5 h-5"}),t?"حذف":"Delete"]})})]}),children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-destructive/15 flex items-center justify-center mx-auto mb-5",children:e.jsx(Q,{className:"w-8 h-8 text-destructive"})}),e.jsx("p",{className:"text-muted-foreground mb-2","data-testid":"text-delete-confirmation",children:t?"هل أنت متأكد من حذف هذه المهمة؟ لا يمكن التراجع عن هذا الإجراء.":"Are you sure you want to delete this task? This action cannot be undone."}),e.jsx("p",{className:"font-bold text-foreground","data-testid":"text-delete-task-title",children:s.title})]})}),e.jsx(V,{isOpen:N,onClose:()=>j(!1),title:t?"قيّم المنفذ":"Rate Tasker",action:e.jsx(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>K.mutate(),disabled:x===0||K.isPending,className:"w-full h-14 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-2xl font-bold shadow-xl shadow-amber-500/30 disabled:opacity-50 flex items-center justify-center gap-2.5","data-testid":"button-submit-rating",children:K.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),t?"جاري الإرسال...":"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-5 h-5"}),t?"إرسال التقييم":"Submit Rating"]})}),children:e.jsxs("div",{className:"space-y-6",children:[s.tasker&&e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-2xl bg-muted/50",children:[e.jsxs(_,{className:"w-12 h-12",children:[e.jsx(U,{src:s.tasker.avatar||void 0}),e.jsx(W,{className:"bg-primary/15 text-primary font-bold",children:(ce=s.tasker.name)==null?void 0:ce.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:s.tasker.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",s.tasker.username]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:t?"كيف كانت تجربتك؟":"How was your experience?"}),e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(i=>e.jsx(n.button,{whileHover:{scale:1.15},whileTap:{scale:.95},onClick:()=>L(i),className:"p-1","data-testid":`button-star-${i}`,children:e.jsx(H,{className:T("w-10 h-10 transition-colors",x>=i?"fill-amber-500 text-amber-500":"text-muted-foreground")})},i))}),x>0&&e.jsx(n.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"text-sm font-medium text-amber-500 mt-2",children:x===5?t?"ممتاز!":"Excellent!":x===4?t?"جيد جداً":"Very Good":x===3?t?"جيد":"Good":x===2?t?"مقبول":"Fair":t?"ضعيف":"Poor"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-muted-foreground mb-2 block",children:t?"تعليق (اختياري)":"Comment (optional)"}),e.jsx("textarea",{value:X,onChange:i=>ee(i.target.value),placeholder:t?"شارك تجربتك مع هذا المنفذ...":"Share your experience with this tasker...",className:"w-full h-24 p-4 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none resize-none text-base","data-testid":"input-rating-comment"})]})]})})]})});export{wt as default};
