import{r as c,u as b,j as e,m as a,A as N,g as v,c as x}from"./index-CzK-Wtpj.js";import{u as k}from"./useQuery-B1e_qTp-.js";import{E as u,S as n}from"./animated-ifqYnJC-.js";import{A as S,a as C,b as A}from"./avatar-CPrQWbpQ.js";import{M as h}from"./message-square--SMsGGZh.js";import{A as U}from"./arrow-left-eQXjCarb.js";import"./utils-km2FGkQ4.js";const P=c.memo(function(){const[,p]=b(),f=!!localStorage.getItem("userId"),{data:o,isLoading:g,error:y}=k({queryKey:["/api/conversations"],enabled:f}),j=c.useCallback(t=>t.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2),[]),w=c.useCallback(t=>{const s=typeof t=="string"?new Date(t):t,r=new Date().getTime()-s.getTime(),i=Math.floor(r/(1e3*60*60*24));return i===0?s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):i===1?"Yesterday":i<7?s.toLocaleDateString("en-US",{weekday:"short"}):s.toLocaleDateString("en-US",{month:"short",day:"numeric"})},[]);return y?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-primary/5 pt-safe pb-24 flex items-center justify-center",children:e.jsx(u,{icon:e.jsx(h,{className:"w-8 h-8"}),title:"Something went wrong",description:"We couldn't load your messages. Please try again.",action:e.jsx(a.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>window.location.reload(),className:"px-6 py-3 gradient-primary text-white rounded-xl font-bold",children:"Retry"})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-24",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:e.jsx(a.div,{initial:{opacity:0},animate:{opacity:.3},className:"absolute top-40 -left-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl"})}),e.jsxs("div",{className:"relative z-10 px-6 py-6",children:[e.jsxs(a.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center gap-4 mb-8",children:[e.jsx(a.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>p("/home"),className:"w-11 h-11 flex items-center justify-center rounded-2xl glass","data-testid":"button-back",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-extrabold text-foreground",children:"Messages"})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(N,{mode:"wait",children:g?e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-2",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"flex items-center gap-4 p-4 glass rounded-2xl",children:[e.jsx(n,{className:"w-14 h-14 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(n,{className:"h-4 w-32"}),e.jsx(n,{className:"h-3 w-12"})]}),e.jsx(n,{className:"h-3 w-full"})]})]},t))},"loading"):o&&o.length>0?e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-2",children:o.map((t,s)=>{var l,r,i,d,m;return e.jsx(a.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},children:e.jsx(v,{href:`/chat/${t.taskId}`,children:e.jsxs(a.div,{whileTap:{scale:.98},className:x("flex items-center gap-4 p-4 rounded-2xl cursor-pointer transition-all",t.unreadCount>0?"glass-premium gradient-border":"glass"),"data-testid":`conversation-${t.taskId}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs(S,{className:"w-14 h-14 border-2 border-white/20 shadow-lg",children:[e.jsx(C,{src:((l=t.otherUser)==null?void 0:l.avatar)||void 0}),e.jsx(A,{className:"gradient-primary text-white font-bold",children:(r=t.otherUser)!=null&&r.name?j(t.otherUser.name):"U"})]}),t.unreadCount>0&&e.jsx(a.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 w-6 h-6 gradient-primary text-white rounded-full flex items-center justify-center text-xs font-bold shadow-lg shadow-primary/30",children:t.unreadCount>9?"9+":t.unreadCount})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-bold text-foreground truncate",children:(i=t.otherUser)==null?void 0:i.name}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:((d=t.lastMessage)==null?void 0:d.createdAt)&&w(t.lastMessage.createdAt)})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate mb-1",children:t.taskTitle}),e.jsx("p",{className:x("text-sm truncate",t.unreadCount>0?"font-bold text-foreground":"text-muted-foreground"),children:((m=t.lastMessage)==null?void 0:m.content)||"No messages yet"})]})]})})},t.taskId)})},"conversations"):e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(u,{icon:e.jsx(h,{className:"w-8 h-8"}),title:"No conversations yet",description:"Start chatting with clients or taskers about tasks"})},"empty")})})]})]})});export{P as default};
