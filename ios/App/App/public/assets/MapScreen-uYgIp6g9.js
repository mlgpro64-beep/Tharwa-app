import{r,u as h,j as e,m as n,S as g,g as u,t as w,M as x,A as j,X as y,C as N}from"./index-CzK-Wtpj.js";import{u as b}from"./useQuery-B1e_qTp-.js";import{f as v}from"./currency-BA8TA7a2.js";import{L}from"./animated-ifqYnJC-.js";import{c as k,a as S,g as M}from"./mapConfig-8OlPnSkx.js";import{A as T}from"./arrow-left-eQXjCarb.js";import{D as C}from"./dollar-sign-EFTHd7iI.js";import"./utils-km2FGkQ4.js";const q=r.memo(function(){h();const l=r.useRef(null),s=r.useRef(null),[a,d]=r.useState(null),{data:o,isLoading:m,error:f}=b({queryKey:["/api/tasks/available"]});return r.useEffect(()=>{if(!l.current||!window.L)return;const t=[40.7128,-74.006];document.documentElement.classList.contains("dark");const c=M(),i=k(c);return s.current||(s.current=window.L.map(l.current,{zoomControl:!1}).setView(t,15),window.L.tileLayer(i.url,i.options).addTo(s.current),window.L.control.zoom({position:"bottomright"}).addTo(s.current)),()=>{s.current&&(s.current.remove(),s.current=null)}},[]),r.useEffect(()=>{!s.current||!o||!window.L||(s.current.eachLayer(t=>{t instanceof window.L.Marker&&s.current.removeLayer(t)}),o.forEach(t=>{const c=t.latitude?parseFloat(String(t.latitude)):40.7128+(Math.random()-.5)*.05,i=t.longitude?parseFloat(String(t.longitude)):-74.006+(Math.random()-.5)*.05,p=S(window.L,{size:24,iconSize:[24,24],iconAnchor:[12,12],className:"custom-marker"},!1,"primary");window.L.marker([c,i],{icon:p}).addTo(s.current).on("click",()=>{d(t)})}))},[o]),e.jsxs("div",{className:"min-h-screen relative bg-background",children:[e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"absolute top-0 left-0 right-0 z-20 p-4 pt-safe flex items-center gap-4",children:[e.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>window.history.back(),className:"w-11 h-11 flex items-center justify-center rounded-2xl glass shadow-lg","data-testid":"button-back",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx("input",{type:"search",placeholder:"Search location...",className:"w-full h-11 pl-12 pr-4 rounded-2xl glass text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all shadow-lg","data-testid":"input-search-location"})]})}),e.jsx(u,{href:"/tasks-feed",children:e.jsx(n.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-11 h-11 flex items-center justify-center rounded-2xl glass shadow-lg","data-testid":"button-list-view",children:e.jsx(w,{className:"w-5 h-5"})})})]}),m||f?e.jsx("div",{className:"h-screen flex items-center justify-center bg-gradient-to-b from-background to-primary/5",children:e.jsx("div",{className:"text-center",children:m?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"lg",className:"mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"Loading map..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 rounded-3xl gradient-primary flex items-center justify-center mb-4 mx-auto shadow-lg",children:e.jsx(x,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"font-bold text-foreground mb-2",children:"Map unavailable"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Please try again later"})]})})}):e.jsx("div",{ref:l,className:"h-screen w-full"}),e.jsx(j,{children:a&&e.jsx(n.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{type:"spring",stiffness:300,damping:30},className:"absolute bottom-0 left-0 right-0 z-20 p-4 pb-safe",children:e.jsx(u,{href:`/task/${a.id}`,children:e.jsxs(n.div,{whileTap:{scale:.98},className:"glass-premium p-5 rounded-3xl shadow-2xl cursor-pointer","data-testid":`task-preview-${a.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest",children:a.category}),e.jsx("h3",{className:"text-lg font-bold text-foreground",children:a.title})]}),e.jsx(n.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t=>{t.preventDefault(),t.stopPropagation(),d(null)},className:"w-8 h-8 flex items-center justify-center rounded-full glass-button",children:e.jsx(y,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-4",children:a.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs font-bold text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(x,{className:"w-4 h-4 text-primary"}),a.distance||a.location]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(N,{className:"w-4 h-4 text-primary"}),a.time]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-primary/15 px-3 py-1.5 rounded-xl",children:[e.jsx(C,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-extrabold text-lg text-primary",children:v(a.budget,{locale:"en"})})]})]})]})})})})]})});export{q as default};
