import{r as T,u as I,a as R,d as $,j as e,m as a,g as l,M as D,X as E,e as M,q as j,C as L,i as F}from"./index-CzK-Wtpj.js";import{u as K}from"./useQuery-B1e_qTp-.js";import{u as P}from"./useMutation-BXgiM4Zs.js";import{A as _,a as B,b as H}from"./avatar-CPrQWbpQ.js";import{B as d}from"./button-D95I_TH1.js";import{g as O,T as Q}from"./schema-CbH_BfFp.js";import{C as V}from"./chevron-left-CHJaYFut.js";import{D as U}from"./dollar-sign-EFTHd7iI.js";import{C as X}from"./calendar-CAGmnp_J.js";import{S as v}from"./send-9v2j9KhO.js";import{C as y}from"./circle-x-D3T454mR.js";import"./utils-km2FGkQ4.js";const Y={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.08,delayChildren:.1}}},m={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:24}}},le=T.memo(function(){const[,N]=I(),{t:G,i18n:C}=R(),{toast:x}=$(),t=C.language==="ar",w=!!localStorage.getItem("userId"),{data:c,isLoading:k}=K({queryKey:["/api/direct-requests"],enabled:w}),u=P({mutationFn:async s=>M("POST",`/api/direct-requests/${s}/cancel`),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/direct-requests"]}),j.invalidateQueries({queryKey:["/api/notifications"]}),x({title:t?"تم إلغاء الطلب":"Request Cancelled",description:t?"تم إلغاء طلب الخدمة بنجاح":"Your service request has been cancelled"})},onError:s=>{x({title:t?"فشل الإلغاء":"Failed to cancel",description:s.message,variant:"destructive"})}}),p={pending:{icon:L,color:"text-warning",bgColor:"bg-warning/10",borderColor:"border-warning/30",label:t?"قيد الانتظار":"Pending"},accepted:{icon:F,color:"text-success",bgColor:"bg-success/10",borderColor:"border-success/30",label:t?"مقبول":"Accepted"},rejected:{icon:y,color:"text-destructive",bgColor:"bg-destructive/10",borderColor:"border-destructive/30",label:t?"مرفوض":"Rejected"},cancelled:{icon:y,color:"text-muted-foreground",bgColor:"bg-muted/10",borderColor:"border-muted/30",label:t?"ملغي":"Cancelled"}},S=s=>new Date(s).toLocaleDateString(t?"ar-SA":"en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"min-h-screen gradient-mesh pt-safe pb-32",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:e.jsx(a.div,{initial:{opacity:0,scale:.8},animate:{opacity:.5,scale:1},transition:{duration:1,ease:"easeOut"},className:"absolute -top-32 -right-32 w-80 h-80 bg-gradient-to-br from-primary/20 to-primary/5 rounded-full blur-3xl rtl:-left-32 rtl:right-auto"})}),e.jsxs("div",{className:"relative z-10 px-5 py-5",children:[e.jsxs(a.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-4 mb-6",children:[e.jsx(a.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>N("/"),className:"w-10 h-10 flex items-center justify-center rounded-xl glass","data-testid":"button-back",children:e.jsx(V,{className:"w-5 h-5 text-foreground rtl:rotate-180"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:t?"طلباتي المباشرة":"My Direct Requests"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t?"الطلبات المرسلة للمنفذين":"Requests sent to taskers"})]})]}),e.jsx(a.div,{variants:Y,initial:"hidden",animate:"visible",className:"space-y-4",children:k?Array.from({length:3}).map((s,n)=>e.jsx(a.div,{variants:m,className:"glass rounded-[20px] p-4 animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-muted/30"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-5 bg-muted/30 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-muted/30 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-muted/30 rounded w-1/3"})]})]})},n)):c&&c.length>0?c.map((s,n)=>{var h,g,f,b;const i=p[s.status]||p.pending,A=i.icon,r=O(s.category),o=r?Q[r.mainCategory]:null;return e.jsxs(a.div,{variants:m,custom:n,className:`glass rounded-[20px] p-4 border ${i.borderColor}`,"data-testid":`card-my-request-${s.id}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(l,{href:`/profile/${s.taskerId}`,children:e.jsxs(_,{className:"w-14 h-14 border-2 border-white/10 cursor-pointer",children:[e.jsx(B,{src:((h=s.tasker)==null?void 0:h.avatar)||void 0}),e.jsx(H,{className:"bg-primary/10 text-primary font-bold text-lg",children:((f=(g=s.tasker)==null?void 0:g.name)==null?void 0:f.charAt(0))||"T"})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx(l,{href:`/profile/${s.taskerId}`,children:e.jsx("p",{className:"font-bold text-foreground hover:text-primary transition-colors cursor-pointer",children:((b=s.tasker)==null?void 0:b.name)||(t?"منفذ":"Tasker")})}),e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold ${i.bgColor} ${i.color}`,children:[e.jsx(A,{className:"w-3.5 h-3.5"}),i.label]})]}),e.jsx("p",{className:"font-semibold text-foreground mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[o&&r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:o.colorHex}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.subcategory?t?r.subcategory.nameAr:r.subcategory.nameEn:t?o.nameAr:o.nameEn})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-semibold text-primary",children:[s.budget," ",t?"ر.س":"SAR"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsxs("span",{children:[S(s.scheduledDate)," - ",s.scheduledTime]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:s.location})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="accepted"&&s.linkedTaskId&&e.jsx(l,{href:`/task/${s.linkedTaskId}`,className:"flex-1",children:e.jsxs(d,{className:"w-full gradient-primary text-white rounded-xl","data-testid":`button-view-task-${s.id}`,children:[e.jsx(v,{className:"w-4 h-4 me-2"}),t?"عرض المهمة":"View Task"]})}),s.status==="pending"&&e.jsxs(d,{variant:"outline",className:"flex-1 rounded-xl border-destructive/30 text-destructive hover:bg-destructive/10",onClick:()=>u.mutate(s.id),disabled:u.isPending,"data-testid":`button-cancel-request-${s.id}`,children:[e.jsx(E,{className:"w-4 h-4 me-2"}),t?"إلغاء الطلب":"Cancel Request"]})]})]},s.id)}):e.jsxs(a.div,{variants:m,className:"glass rounded-[24px] p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/20 flex items-center justify-center",children:e.jsx(v,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"font-bold text-lg text-foreground mb-2",children:t?"لا توجد طلبات":"No Requests"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:t?"يمكنك طلب خدمة مباشرة من صفحة أي منفذ":"You can request a service directly from any tasker profile"}),e.jsx(l,{href:"/search-taskers",children:e.jsx(d,{className:"gradient-primary text-white rounded-xl","data-testid":"button-find-taskers",children:t?"البحث عن منفذين":"Find Taskers"})})]})})]})]})});export{le as default};
