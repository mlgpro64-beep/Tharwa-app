import{r as c,a as B,j as e,m as o,c as p,A as P,k as V,u as Y,d as Z,h as L,i as ee,M as te,e as se,q as ae}from"./index-CzK-Wtpj.js";import{F as U}from"./FloatingInput-Q9Q65xjP.js";import{T as K}from"./schema-CbH_BfFp.js";import{C as ie}from"./chevron-down-DDOviN73.js";import{C as R}from"./check-BpdMCCzI.js";import{H as W}from"./heart-BRsyov3V.js";import{S as oe}from"./sparkles-CAG2jcvH.js";import{G as re,P as ne,H as le,C as ce}from"./palette-Da5ZzNJ9.js";import{S as de}from"./star-CdLY6qwL.js";import{E as pe}from"./ellipsis-CWjK1vf2.js";import{D as G}from"./DateTimePicker-CTkTbxoK.js";import{u as ue}from"./useQuery-B1e_qTp-.js";import{u as me}from"./useMutation-BXgiM4Zs.js";import{A as xe}from"./arrow-left-eQXjCarb.js";import{L as z}from"./loader-circle-AYqjcifH.js";import"./Modal-DGwTDYVd.js";import"./utils-km2FGkQ4.js";const he={pampering:W,beauty_fashion:oe,teaching_education:re,art:ne,construction:le,special:de,car_care:ce,other:pe},ge=v=>{if(!v)return null;if(v==="other"||v==="pampering")return v;for(const[h,a]of Object.entries(K))if(a.subcategories.some(g=>g.id===v))return h;return null},fe=c.memo(function({categoryId:h,category:a,isExpanded:g,selectedValue:t,onToggleExpand:S,onSelectCategory:x}){if(!a)return null;const{i18n:u}=B(),k=u.language==="ar",n=he[h];if(!n)return null;const d=k?a.nameAr:a.nameEn,i=a.subcategories.length>0,T=c.useMemo(()=>ge(t),[t])===h,r=h==="pampering",O=c.useCallback(()=>{i?S():x(h)},[i,S,x,h]);return e.jsxs(o.div,{layout:!0,className:p("overflow-visible",r&&"mb-1"),initial:r?{scale:.95,opacity:0}:!1,animate:r?{scale:1,opacity:1}:{},transition:r?{duration:.4,ease:[.4,0,.2,1]}:{},children:[e.jsxs(o.button,{onClick:O,className:p("relative w-full overflow-hidden transition-all duration-300","backdrop-blur-2xl border",r?"rounded-[28px] border-2":"rounded-[24px] border border-white/10",g?"bg-gradient-to-br from-white/15 to-white/5 shadow-2xl":r?"bg-gradient-to-br from-pink-500/30 via-pink-400/20 to-purple-500/15 hover:from-pink-500/35 hover:via-pink-400/25 hover:to-purple-500/20":"bg-gradient-to-br from-white/10 to-white/5 hover:from-white/15 hover:to-white/8",r&&!g&&"border-pink-400/50 shadow-2xl",T&&!g&&!r&&"ring-2 ring-primary shadow-lg shadow-primary/20"),style:{boxShadow:g?`0 20px 40px -15px ${a.colorHex}30`:r?`0 20px 50px -10px ${a.colorHex}50, 0 0 40px -10px ${a.colorHex}30, inset 0 1px 0 0 rgba(255,255,255,0.2)`:void 0},whileHover:r?{scale:1.02,y:-2}:{},whileTap:{scale:.98},"data-testid":`button-category-${h}`,children:[r&&e.jsxs(e.Fragment,{children:[e.jsx(o.div,{className:"absolute inset-0 opacity-30",style:{background:`radial-gradient(circle at 30% 50%, ${a.colorHex}60 0%, transparent 70%)`},animate:{opacity:[.3,.4,.3]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),e.jsx(o.div,{className:"absolute inset-0 opacity-20",style:{background:`linear-gradient(135deg, ${a.colorHex}80 0%, transparent 60%)`}})]}),!r&&e.jsx("div",{className:"absolute inset-0 opacity-20",style:{background:`linear-gradient(135deg, ${a.colorHex}40 0%, transparent 60%)`}}),e.jsx("div",{className:p("relative",r?"p-6":"p-5"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o.div,{className:p("rounded-2xl flex items-center justify-center shrink-0",r?"w-16 h-16":"w-14 h-14"),style:{background:r?`linear-gradient(135deg, ${a.colorHex}40 0%, ${a.colorHex}20 100%)`:`linear-gradient(135deg, ${a.colorHex}30 0%, ${a.colorHex}10 100%)`,boxShadow:r?`0 12px 32px -8px ${a.colorHex}60, inset 0 1px 0 0 rgba(255,255,255,0.3)`:`0 8px 24px -8px ${a.colorHex}40`},whileHover:r?{scale:1.1,rotate:5}:{},transition:{duration:.2},children:e.jsx(n,{className:p(r?"w-8 h-8":"w-7 h-7"),style:{color:a.colorHex}})}),e.jsxs("div",{className:"flex-1 text-start",children:[e.jsx("h3",{className:p("font-bold text-foreground mb-0.5",r?"text-xl":"text-lg"),children:d}),h==="pampering"&&e.jsx("p",{className:p("font-medium",r?"text-sm text-foreground/90":"text-xs text-muted-foreground"),children:k?"اطلب اللي في خاطرك":"Request what's on your mind"}),i&&h!=="pampering"&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.subcategories.length," ",k?"تصنيفات":"subcategories"]})]}),i?e.jsx(o.div,{animate:{rotate:g?180:0},transition:{duration:.3},className:"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-muted-foreground"})}):T?e.jsx(o.div,{className:p("rounded-xl flex items-center justify-center",r?"w-12 h-12":"w-10 h-10"),style:{backgroundColor:`${a.colorHex}30`},initial:!1,animate:{scale:[1,1.1,1]},transition:{duration:.3},children:e.jsx(R,{className:p(r?"w-6 h-6":"w-5 h-5"),style:{color:a.colorHex}})}):r?e.jsx(o.div,{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{background:`linear-gradient(135deg, ${a.colorHex}20 0%, ${a.colorHex}10 100%)`,boxShadow:`0 4px 16px -4px ${a.colorHex}40`},animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(W,{className:"w-6 h-6",style:{color:a.colorHex}})}):null]})})]}),e.jsx(P,{children:g&&i&&e.jsx(o.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{height:{duration:.3,ease:[.4,0,.2,1]},opacity:{duration:.2}},className:"overflow-hidden",children:e.jsx("div",{className:"pt-3 px-1",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.subcategories.map((j,m)=>{const f=t===j.id,b=k?j.nameAr:j.nameEn;return e.jsxs(o.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:m*.05},onClick:()=>x(j.id),className:p("relative p-4 rounded-2xl text-start transition-all","backdrop-blur-xl border",f?"border-white/20 bg-white/15":"border-white/5 bg-white/5 hover:bg-white/10"),style:{boxShadow:f?`0 8px 20px -8px ${a.colorHex}40, inset 0 0 0 1px ${a.colorHex}30`:void 0},whileTap:{scale:.97},"data-testid":`button-subcategory-${j.id}`,children:[f&&e.jsx(o.div,{layoutId:"subcategory-selected",className:"absolute inset-0 rounded-2xl",style:{background:`linear-gradient(135deg, ${a.colorHex}20 0%, transparent 50%)`}}),e.jsxs("div",{className:"relative flex items-center gap-3",children:[e.jsx("div",{className:p("w-8 h-8 rounded-xl flex items-center justify-center transition-all",f?"scale-100":"scale-90 opacity-70"),style:{backgroundColor:f?`${a.colorHex}30`:`${a.colorHex}15`},children:f?e.jsx(R,{className:"w-4 h-4",style:{color:a.colorHex}}):e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:a.colorHex}})}),e.jsx("span",{className:p("font-semibold text-sm flex-1",f?"text-foreground":"text-foreground/80"),children:b})]})]},j.id)})})})})})]})}),be=c.memo(function({selected:h,onSelect:a}){const[g,t]=c.useState(null),S=c.useCallback(n=>{t(d=>d===n?null:n)},[]),x=c.useCallback(n=>{a(n),setTimeout(()=>t(null),200)},[a]),u=Object.entries(K),k=c.useMemo(()=>{const n=u.findIndex(([N])=>N==="pampering");if(n===-1)return u;const d=u[n],i=u.filter((N,T)=>T!==n);return[d,...i]},[u]);return e.jsx(o.div,{className:"space-y-3",layout:!0,children:k.map(([n,d])=>e.jsx(fe,{categoryId:n,category:d,isExpanded:g===n,selectedValue:h,onToggleExpand:()=>S(n),onSelectCategory:x},n))})}),Oe=c.memo(function(){const{step:h}=V(),[,a]=Y(),{toast:g}=Z(),{t,i18n:S}=B(),x=parseInt(h||"1"),u=window.location.pathname.includes("/edit"),k=u?window.location.pathname.split("/")[2]:null,n=new URLSearchParams(window.location.search).get("category"),{data:d}=ue({queryKey:["/api/tasks",k],enabled:!!k&&u}),[i,N]=c.useState({title:"",description:"",category:"",budget:"",location:"",latitude:null,longitude:null,date:"",time:""}),[T,r]=c.useState(!1),[O,j]=c.useState(!1),[m,f]=c.useState({}),[b,E]=c.useState("idle"),[I,F]=c.useState("");c.useEffect(()=>{d&&u&&(N({title:d.title,description:d.description,category:d.category,budget:String(d.budget),location:d.location,latitude:d.latitude?parseFloat(String(d.latitude)):null,longitude:d.longitude?parseFloat(String(d.longitude)):null,date:d.date,time:d.time}),d.location&&E("success"))},[d,u]),c.useEffect(()=>{n&&!u&&!i.category&&N(s=>({...s,category:n}))},[n,u,i.category]);const M=c.useCallback(async(s,l)=>{var y;try{const H=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${l}&zoom=16&addressdetails=1`,{headers:{"Accept-Language":S.language==="ar"?"ar":"en"}});if(!H.ok)throw new Error("Geocoding failed");const $=await H.json(),w=$.address,D=w.neighbourhood||w.suburb||w.district||w.quarter||"",q=w.city||w.town||w.municipality||w.county||"";return D&&q?`${D}, ${q}`:q||D||(w.state?w.state:((y=$.display_name)==null?void 0:y.split(",").slice(0,2).join(",").trim())||t("tasks.location"))}catch(H){return console.error("Reverse geocoding error:",H),t("tasks.location")}},[t,S]),Q=c.useCallback(()=>{if(!navigator.geolocation){F(t("tasks.postTaskSteps.geolocationNotSupported")),E("error");return}E("loading"),F(""),navigator.geolocation.getCurrentPosition(async s=>{const{latitude:l,longitude:y}=s.coords,H=await M(l,y);N($=>({...$,location:H,latitude:l,longitude:y})),E("success"),m.location&&f($=>({...$,location:""}))},s=>{let l=t("tasks.postTaskSteps.unableToGetLocation");switch(s.code){case s.PERMISSION_DENIED:l=t("tasks.postTaskSteps.locationPermissionDenied");break;case s.POSITION_UNAVAILABLE:l=t("tasks.postTaskSteps.locationUnavailable");break;case s.TIMEOUT:l=t("tasks.postTaskSteps.locationTimeout");break}F(l),E("error")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},[m.location,M,t]),A=me({mutationFn:async s=>{const l=u?`/api/tasks/${k}`:"/api/tasks";return se(u?"PATCH":"POST",l,{title:s.title,description:s.description,category:s.category,budget:parseFloat(s.budget),location:s.location,latitude:s.latitude,longitude:s.longitude,date:s.date,time:s.time})},onSuccess:()=>{ae.invalidateQueries({queryKey:["/api/tasks"]}),g({title:t(u?"tasks.taskUpdated":"tasks.taskPosted"),description:t(u?"tasks.taskUpdated":"tasks.taskPosted")}),a("/my-tasks")},onError:s=>{g({title:t("errors.somethingWentWrong"),description:s.message,variant:"destructive"})}}),_=c.useCallback(s=>{const l={};return s===1?i.category||(l.category=t("errors.required")):s===2?(i.title.trim()||(l.title=t("errors.required")),i.description.trim()||(l.description=t("errors.required"))):s===3&&(i.budget||(l.budget=t("errors.required")),i.location.trim()||(l.location=t("errors.required")),i.date||(l.date=t("errors.required")),i.time||(l.time=t("errors.required"))),f(l),Object.keys(l).length===0},[i,t]),X=c.useCallback(()=>{if(_(x))if(x<3){const s=n?`?category=${n}`:"";a(`/post-task/${x+1}${s}`)}else A.mutate(i)},[_,x,a,A,i,n]),J=c.useCallback(()=>{if(x>1){const s=n?`?category=${n}`:"";a(`/post-task/${x-1}${s}`)}else a("/home")},[x,a,n]),C=c.useCallback((s,l)=>{N(y=>({...y,[s]:l})),m[s]&&f(y=>({...y,[s]:""}))},[m]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-primary/5 pt-safe pb-8",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx(o.div,{initial:{opacity:0},animate:{opacity:.4},className:"absolute -top-20 -left-20 w-96 h-96 bg-primary/20 rounded-full blur-3xl"}),e.jsx(o.div,{initial:{opacity:0},animate:{opacity:.2},transition:{delay:.3},className:"absolute top-1/2 -right-20 w-80 h-80 bg-primary/15 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10 px-6 flex flex-col min-h-screen",children:[e.jsxs(o.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-center justify-between py-5",children:[e.jsx(o.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:J,className:"w-12 h-12 flex items-center justify-center rounded-2xl glass shadow-sm hover:shadow-md transition-all duration-300 hover:bg-primary/10","data-testid":"button-back",children:e.jsx(xe,{className:"w-5 h-5 text-foreground"})}),e.jsx("div",{className:"flex gap-2.5 items-center",children:[1,2,3].map(s=>e.jsx(o.div,{initial:{scaleX:0},animate:{scaleX:1},transition:{delay:s*.1,duration:.3},className:p("h-2 rounded-full transition-all duration-300",s<=x?"bg-primary w-12 shadow-lg shadow-primary/30":"bg-muted/50 w-8")},s))}),e.jsx("div",{className:"w-12"})]}),e.jsxs("div",{className:"flex-1 flex flex-col py-8",children:[e.jsxs(P,{mode:"wait",children:[x===1&&e.jsxs(o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"flex-1 flex flex-col",children:[e.jsx("h1",{className:"text-3xl font-extrabold text-foreground tracking-tight mb-3 bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text",children:t("tasks.postTaskSteps.step1Title")}),e.jsx("p",{className:"text-muted-foreground text-lg mb-8 leading-relaxed",children:t("tasks.postTaskSteps.step1Description")}),e.jsx(be,{selected:i.category,onSelect:s=>C("category",s)}),e.jsx(P,{children:m.category&&e.jsxs(o.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"text-destructive text-sm font-bold mt-4 flex items-center gap-1.5",children:[e.jsx(L,{className:"w-4 h-4"}),m.category]})})]},"step1"),x===2&&e.jsxs(o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"flex-1 flex flex-col",children:[e.jsx("h1",{className:"text-3xl font-extrabold text-foreground tracking-tight mb-3 bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text",children:t("tasks.postTaskSteps.step2Title")}),e.jsx("p",{className:"text-muted-foreground text-lg mb-8 leading-relaxed",children:t("tasks.postTaskSteps.step2Description")}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{label:t("tasks.postTaskSteps.taskTitle"),value:i.title,onChange:s=>C("title",s.target.value),error:m.title,placeholder:t("tasks.postTaskSteps.taskTitlePlaceholder")}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:i.description,onChange:s=>C("description",s.target.value),placeholder:t("tasks.postTaskSteps.taskDescriptionPlaceholder"),className:p("w-full h-44 p-5 rounded-2xl glass-input transition-all duration-300 placeholder:text-muted-foreground/60 font-medium text-foreground resize-none focus:outline-none focus:ring-2 focus:ring-primary/40 focus:shadow-lg focus:shadow-primary/10",m.description&&"ring-2 ring-destructive/50 border-destructive/50"),"data-testid":"textarea-description"}),e.jsx(P,{children:m.description&&e.jsxs(o.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"text-destructive text-sm font-bold mt-2 flex items-center gap-1.5",children:[e.jsx(L,{className:"w-4 h-4"}),m.description]})})]})]})]},"step2"),x===3&&e.jsxs(o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"flex-1 flex flex-col",children:[e.jsx("h1",{className:"text-3xl font-extrabold text-foreground tracking-tight mb-3 bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text",children:t("tasks.postTaskSteps.step3Title")}),e.jsx("p",{className:"text-muted-foreground text-lg mb-8 leading-relaxed",children:t("tasks.postTaskSteps.step3Description")}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{label:t("tasks.postTaskSteps.budget"),type:"number",value:i.budget,onChange:s=>C("budget",s.target.value),error:m.budget,placeholder:t("tasks.postTaskSteps.budgetPlaceholder")}),e.jsxs(o.button,{whileTap:{scale:.98},whileHover:{scale:1.01},onClick:Q,disabled:b==="loading",className:p("w-full h-18 px-5 rounded-2xl glass text-left transition-all duration-300 flex items-center gap-4 shadow-sm hover:shadow-md",b==="success"&&"ring-2 ring-green-500/40 shadow-green-500/10",m.location&&"ring-2 ring-destructive/50 shadow-destructive/10",b==="loading"&&"opacity-75"),"data-testid":"button-get-location",children:[e.jsx("div",{className:p("w-12 h-12 rounded-xl flex items-center justify-center transition-all duration-300",b==="success"?"bg-green-500/20 shadow-lg shadow-green-500/20":"bg-primary/15"),children:b==="loading"?e.jsx(z,{className:"w-5 h-5 text-primary animate-spin"}):b==="success"?e.jsx(ee,{className:"w-5 h-5 text-green-500"}):e.jsx(te,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest block mb-0.5",children:t("tasks.postTaskSteps.location")}),e.jsx("span",{className:p("font-medium block truncate text-sm",b==="success"?"text-foreground":"text-muted-foreground"),children:b==="loading"?t("tasks.postTaskSteps.gettingLocation"):b==="success"?i.location:t("tasks.postTaskSteps.tapToUseLocation")})]})]}),e.jsx(P,{children:(m.location||I)&&e.jsxs(o.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"text-destructive text-sm font-bold flex items-center gap-1.5",children:[e.jsx(L,{className:"w-4 h-4"}),I||m.location]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(o.button,{whileTap:{scale:.98},whileHover:{scale:1.01},onClick:()=>r(!0),className:p("h-18 px-4 rounded-2xl glass text-left transition-all duration-300 shadow-sm hover:shadow-md",i.date&&"ring-2 ring-primary/40 shadow-primary/10",m.date&&"ring-2 ring-destructive/50 shadow-destructive/10"),"data-testid":"button-select-date",children:[e.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest block mb-0.5",children:t("tasks.postTaskSteps.date")}),e.jsx("span",{className:p("font-medium text-sm",i.date?"text-foreground":"text-muted-foreground"),children:i.date||t("tasks.postTaskSteps.selectDate")})]}),e.jsxs(o.button,{whileTap:{scale:.98},whileHover:{scale:1.01},onClick:()=>j(!0),className:p("h-18 px-4 rounded-2xl glass text-left transition-all duration-300 shadow-sm hover:shadow-md",i.time&&"ring-2 ring-primary/40 shadow-primary/10",m.time&&"ring-2 ring-destructive/50 shadow-destructive/10"),"data-testid":"button-select-time",children:[e.jsx("span",{className:"text-[10px] font-bold text-primary uppercase tracking-widest block mb-0.5",children:t("tasks.postTaskSteps.time")}),e.jsx("span",{className:p("font-medium text-sm",i.time?"text-foreground":"text-muted-foreground"),children:i.time||t("tasks.postTaskSteps.selectTime")})]})]}),e.jsx(P,{children:(m.date||m.time)&&e.jsxs(o.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"text-destructive text-sm font-bold flex items-center gap-1.5",children:[e.jsx(L,{className:"w-4 h-4"}),t("tasks.postTaskSteps.selectDateAndTime")]})})]})]},"step3")]}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-auto pt-6",children:e.jsx(o.button,{whileHover:{scale:1.01},whileTap:{scale:.98},onClick:X,disabled:A.isPending,className:"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/30 transition-all duration-300 disabled:opacity-60 flex items-center justify-center gap-2 hover:shadow-2xl hover:shadow-primary/40","data-testid":"button-next",children:A.isPending?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-5 h-5 animate-spin"}),t(u?"tasks.postTaskSteps.saving":"tasks.postTaskSteps.posting")]}):t(x===3?u?"tasks.postTaskSteps.saveChanges":"tasks.postTaskSteps.postTask":"tasks.postTaskSteps.continue")})})]})]}),e.jsx(G,{isOpen:T,onClose:()=>r(!1),onSelect:s=>C("date",s),mode:"date",title:t("tasks.postTaskSteps.selectDateTitle")}),e.jsx(G,{isOpen:O,onClose:()=>j(!1),onSelect:s=>C("time",s),mode:"time",title:t("tasks.postTaskSteps.selectTimeTitle")})]})});export{Oe as default};
