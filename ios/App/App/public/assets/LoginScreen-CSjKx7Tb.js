import{r,u as C,b as P,d as T,a as O,j as t,m as i,c as h,A as M,g as E,e as A}from"./index-CzK-Wtpj.js";import{u as F}from"./useMutation-BXgiM4Zs.js";import{L}from"./log-in-KhGTY87V.js";import{P as X}from"./phone-BU10rKK_.js";import{L as I}from"./loader-circle-AYqjcifH.js";import"./utils-km2FGkQ4.js";const G=r.memo(function(){C(),P();const{toast:p}=T(),{t:c,i18n:f}=O(),N=f.language==="ar",o=f.language==="ar",[l,S]=r.useState({phone:""}),[d,x]=r.useState({}),[s,y]=r.useState(null),[u,v]=r.useState(null),m=F({mutationFn:async e=>{console.log("Sending OTP for phone:",e);const n=await A("POST","/api/auth/send-phone-otp",{phone:e,type:"login"}),a=await n.json();if(console.log("OTP response:",a),!n.ok||a.success===!1){const g=o?a.error||"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚":a.errorEn||a.error||"Failed to send verification code";throw new Error(g)}return{...a,phone:e}},onSuccess:e=>{const n=e.phone||l.phone;if(console.log("âœ… [OTP] OTP sent successfully!"),console.log("âœ… [OTP] Phone number:",n),console.log("âœ… [OTP] Response data:",e),e.devCode&&(console.warn("âš ï¸ [OTP] Development mode: OTP code:",e.devCode),p({title:o?"Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ (ÙˆØ¶Ø¹ Ø§Ù„ØªØ·ÙˆÙŠØ±)":"Verification Code (Dev Mode)",description:o?`Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚: ${e.devCode} (SMS ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„)`:`Verification Code: ${e.devCode} (SMS not enabled)`,variant:"default"})),!n){console.error("âŒ [OTP] No phone number found for navigation!"),p({title:o?"Ø®Ø·Ø£":"Error",description:o?"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²":"An error occurred while sending the code",variant:"destructive"});return}e.devCode||p({title:o?"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²":"Code Sent",description:o?"ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø³Ø§Ø¦Ù„Ùƒ SMS":"Check your SMS for the verification code"}),console.log("ðŸ”µ [OTP] Setting navigation flag for phone:",n),v({phone:n})},onError:e=>{let n=e.message;e.message.includes("No account found")?n=o?"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…":"No account found with this phone number":(e.message.includes("SMS service not configured")||e.message.includes("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„"))&&(n=o?"Ø®Ø¯Ù…Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù….":"SMS service is currently unavailable. Please try again later or contact support."),p({title:o?"Ø®Ø·Ø£":"Error",description:n,variant:"destructive"})}}),b=r.useCallback(()=>{const e={};if(!l.phone.trim())e.phone=c("errors.required");else{const n=l.phone.replace(/[\s\-\(\)\.]/g,"");[/^05\d{8}$/,/^5\d{8}$/,/^9665\d{8}$/,/^\+9665\d{8}$/].some(g=>g.test(n))||(e.phone=o?"Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­":"Invalid Saudi phone number")}return x(e),Object.keys(e).length===0},[l,c,o]),j=r.useCallback(()=>{if(!b())return;const e=l.phone.trim();console.log("Submitting phone:",e),m.mutate(e)},[b,m,l.phone]),k=r.useCallback(e=>n=>{S(a=>({...a,[e]:n.target.value})),d[e]&&x(a=>({...a,[e]:""}))},[d]);r.useEffect(()=>{if(u&&u.phone){const e=`/verify-otp?phone=${encodeURIComponent(u.phone)}`;console.log("ðŸ”µ [NAVIGATION] Starting navigation to:",e),console.log("âœ… [NAVIGATION] Using window.location.href for reliable navigation"),window.location.href=e,v(null)}},[u]);const w=m.isPending;return t.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-background to-primary/5 pt-safe",children:[t.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:t.jsx(i.div,{initial:{opacity:0},animate:{opacity:.4},className:h("absolute top-40 w-80 h-80 bg-primary/15 rounded-full blur-3xl",N?"-left-32":"-right-32")})}),t.jsxs("div",{className:"flex-1 flex flex-col px-6 py-8 relative z-10",children:[t.jsx(i.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:20},className:"w-20 h-20 rounded-[1.5rem] gradient-primary flex items-center justify-center mb-8 mx-auto shadow-xl shadow-primary/25",children:t.jsx(L,{className:"w-10 h-10 text-white"})}),t.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-center mb-8",children:[t.jsx("h1",{className:"text-3xl font-extrabold text-foreground tracking-tight mb-2",children:c("auth.login")}),t.jsx("p",{className:"text-muted-foreground text-lg",children:o?"Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„":"Sign in with your phone number"})]}),t.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"space-y-5 flex-1",children:[t.jsxs("div",{className:"relative group",children:[t.jsx(i.div,{className:h("absolute inset-0 rounded-2xl opacity-0 blur-xl transition-opacity duration-500",s==="phone"&&"opacity-100","bg-gradient-to-r from-primary/20 via-primary/30 to-primary/20"),animate:{opacity:s==="phone"?.6:0,scale:s==="phone"?1.05:1},transition:{duration:.3}}),t.jsx(i.div,{className:h("absolute start-5 top-1/2 -translate-y-1/2 z-10 transition-all duration-300",s==="phone"?"text-primary scale-110":"text-muted-foreground"),animate:{scale:s==="phone"?1.1:1,rotate:s==="phone"?[0,-5,5,-5,0]:0},transition:{duration:.3},children:t.jsx(X,{className:"w-5 h-5"})}),t.jsx(i.input,{type:"tel",value:l.phone,onChange:k("phone"),onFocus:()=>y("phone"),onBlur:()=>y(null),placeholder:"05XXXXXXXX",autoComplete:"tel",dir:"ltr",className:h("relative w-full h-16 ps-14 pe-5 rounded-2xl","bg-gradient-to-br from-white/95 via-white/90 to-white/85","dark:from-white/10 dark:via-white/8 dark:to-white/5","backdrop-blur-2xl","border-2 transition-all duration-300","text-black dark:text-black placeholder:text-gray-400/70 dark:placeholder:text-gray-500/70","focus:outline-none","shadow-lg","font-medium",d.phone?"border-destructive/50 shadow-destructive/20":s==="phone"?"border-primary/60 shadow-primary/30 shadow-xl":"border-white/20 dark:border-white/10","focus:scale-[1.01] focus:shadow-2xl","hover:border-primary/30 hover:shadow-primary/10"),animate:{scale:s==="phone"?1.01:1},transition:{duration:.2},"data-testid":"input-phone"}),s==="phone"&&t.jsx(i.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{background:"linear-gradient(135deg, hsl(231 98% 61% / 0.3), hsl(171 76% 47% / 0.3))",padding:"2px",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude"}}),t.jsx(M,{children:d.phone&&t.jsx(i.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"mt-2 text-xs text-destructive font-medium",children:d.phone})})]}),t.jsx("p",{className:"text-xs text-muted-foreground text-center",children:o?"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05)":"Enter Saudi mobile number (starts with 05)"})]}),t.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-6 pb-safe",children:[t.jsx(i.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:j,disabled:w,className:"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/25 transition-all disabled:opacity-60 flex items-center justify-center gap-2","data-testid":"button-sign-in",children:w?t.jsxs(t.Fragment,{children:[t.jsx(I,{className:"w-5 h-5 animate-spin"}),c("common.loading")]}):o?"Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚":"Send Code"}),t.jsxs("p",{className:"text-center text-muted-foreground mt-6",children:[c("auth.noAccount")," ",t.jsx(E,{href:"/role",className:"text-primary font-bold hover:underline",children:c("auth.register")})]})]})]})]})});export{G as default};
