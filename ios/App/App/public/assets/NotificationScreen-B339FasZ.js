import{r as n,B as v,i as k,j as e,m as s,c as h,u as C,A as g,e as j,q as N}from"./index-CzK-Wtpj.js";import{I as S,T,C as M,B as A}from"./tag-DcG1YM2n.js";import{M as q}from"./message-circle-BzmAey6U.js";import{u as I}from"./useQuery-B1e_qTp-.js";import{u as b}from"./useMutation-BXgiM4Zs.js";import{S as d,E as $}from"./animated-ifqYnJC-.js";import{A as B}from"./arrow-left-eQXjCarb.js";import"./utils-km2FGkQ4.js";const E=n.memo(function({notification:a,onMarkRead:t}){const m=n.useCallback(r=>{const o=typeof r=="string"?new Date(r):r,x=new Date().getTime()-o.getTime(),p=Math.floor(x/6e4),f=Math.floor(x/36e5),y=Math.floor(x/864e5);return p<1?"Just now":p<60?`${p}m ago`:f<24?`${f}h ago`:y<7?`${y}d ago`:o.toLocaleDateString("en-US",{month:"short",day:"numeric"})},[]),u=n.useCallback(r=>{switch(r){case"offer":return T;case"chat":return q;case"task_update":return k;case"system":return S;default:return v}},[]),c=n.useCallback(r=>{switch(r){case"offer":return"bg-primary/15 text-primary";case"chat":return"bg-success/15 text-success";case"task_update":return"bg-warning/15 text-warning";case"system":return"bg-muted text-muted-foreground";default:return"bg-muted text-muted-foreground"}},[]),l=u(a.type),i=n.useCallback(()=>{!a.read&&t&&t(a.id)},[a.read,a.id,t]);return e.jsxs(s.div,{whileTap:{scale:.98},className:h("flex items-start gap-4 p-4 rounded-2xl transition-all duration-300 cursor-pointer",a.read?"glass":"glass-premium gradient-border"),onClick:i,"data-testid":`notification-card-${a.id}`,children:[e.jsx("div",{className:h("w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0",c(a.type)),children:e.jsx(l,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:h("font-bold",a.read?"text-foreground":"text-primary"),children:a.title}),!a.read&&e.jsx(s.div,{initial:{scale:0},animate:{scale:1},className:"w-2.5 h-2.5 rounded-full gradient-primary flex-shrink-0 mt-1.5 shadow-lg shadow-primary/30"})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mt-1",children:a.message}),e.jsx("span",{className:"text-xs text-muted-foreground mt-2 block font-medium",children:m(a.createdAt)})]})]})}),_=n.memo(function(){C();const a=!!localStorage.getItem("userId"),{data:t,isLoading:m}=I({queryKey:["/api/notifications"],enabled:a}),u=b({mutationFn:async i=>j("PATCH",`/api/notifications/${i}/read`),onSuccess:()=>{N.invalidateQueries({queryKey:["/api/notifications"]})}}),c=b({mutationFn:async()=>j("POST","/api/notifications/read-all"),onSuccess:()=>{N.invalidateQueries({queryKey:["/api/notifications"]})}}),l=n.useMemo(()=>(t==null?void 0:t.filter(i=>!i.read).length)||0,[t]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-24",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:e.jsx(s.div,{initial:{opacity:0},animate:{opacity:.3},className:"absolute top-40 -left-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl"})}),e.jsxs("div",{className:"relative z-10 px-6 py-6",children:[e.jsxs(s.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(s.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>window.history.back(),className:"w-11 h-11 flex items-center justify-center rounded-2xl glass","data-testid":"button-back",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-extrabold text-foreground",children:"Notifications"}),l>0&&e.jsxs(s.p,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-muted-foreground",children:[l," unread"]})]})]}),e.jsx(g,{children:l>0&&e.jsxs(s.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>c.mutate(),disabled:c.isPending,className:"h-10 px-4 rounded-xl glass text-sm font-bold text-primary flex items-center gap-2","data-testid":"button-mark-all-read",children:[e.jsx(M,{className:"w-4 h-4"}),"Mark all read"]})})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(g,{mode:"wait",children:m?e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-2",children:[1,2,3,4].map(i=>e.jsxs("div",{className:"flex items-start gap-4 p-4 glass rounded-2xl",children:[e.jsx(d,{className:"w-12 h-12 rounded-2xl flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(d,{className:"h-4 w-40 mb-2"}),e.jsx(d,{className:"h-3 w-full mb-1"}),e.jsx(d,{className:"h-3 w-2/3"})]})]},i))},"loading"):t&&t.length>0?e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-2",children:t.map((i,r)=>e.jsx(s.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:r*.05},children:e.jsx(E,{notification:i,onMarkRead:o=>u.mutate(o)})},i.id))},"notifications"):e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx($,{icon:e.jsx(A,{className:"w-8 h-8"}),title:"No notifications",description:"You're all caught up!"})},"empty")})})]})]})});export{_ as default};
