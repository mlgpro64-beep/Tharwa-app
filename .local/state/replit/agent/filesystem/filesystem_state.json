{"file_contents":{"attached_assets/App_1764551013653.tsx":{"content":"\nimport React, { useEffect, Suspense, lazy, useState } from 'react';\nimport { HashRouter, Routes, Route, Navigate, useLocation } from 'react-router-dom';\nimport { BottomNav } from './components/BottomNav';\nimport { ToastProvider } from './components/Toast';\nimport { AppProvider } from './context/AppContext';\nimport { ErrorBoundary } from './components/ErrorBoundary';\nimport { SplashScreen } from './components/SplashScreen';\n\n// Explicit Lazy Load Screens to avoid module resolution issues\nconst WelcomeScreen = lazy(() => import('./screens/AuthScreens').then(m => ({ default: m.WelcomeScreen })));\nconst SelectRoleScreen = lazy(() => import('./screens/AuthScreens').then(m => ({ default: m.SelectRoleScreen })));\nconst CreateAccountScreen = lazy(() => import('./screens/AuthScreens').then(m => ({ default: m.CreateAccountScreen })));\n\nconst HomeScreen = lazy(() => import('./screens/HomeScreen').then(m => ({ default: m.HomeScreen })));\nconst TasksFeedScreen = lazy(() => import('./screens/HomeScreen').then(m => ({ default: m.TasksFeedScreen })));\n\nconst MapScreen = lazy(() => import('./screens/MapScreen').then(m => ({ default: m.MapScreen })));\n\nconst PostTaskScreen = lazy(() => import('./screens/TaskScreens').then(m => ({ default: m.PostTaskScreen })));\nconst TaskDetailsScreen = lazy(() => import('./screens/TaskScreens').then(m => ({ default: m.TaskDetailsScreen })));\nconst TaskInProgressScreen = lazy(() => import('./screens/TaskScreens').then(m => ({ default: m.TaskInProgressScreen })));\nconst TaskCompletedScreen = lazy(() => import('./screens/TaskScreens').then(m => ({ default: m.TaskCompletedScreen })));\n\nconst MyTasksScreen = lazy(() => import('./screens/UserScreens').then(m => ({ default: m.MyTasksScreen })));\nconst WalletScreen = lazy(() => import('./screens/UserScreens').then(m => ({ default: m.WalletScreen })));\nconst WithdrawScreen = lazy(() => import('./screens/UserScreens').then(m => ({ default: m.WithdrawScreen })));\nconst AddCardScreen = lazy(() => import('./screens/UserScreens').then(m => ({ default: m.AddCardScreen })));\nconst TransactionDetailsScreen = lazy(() => import('./screens/UserScreens').then(m => ({ default: m.TransactionDetailsScreen })));\nconst ProfileScreen = lazy(() => import('./screens/UserScreens').then(m => ({ default: m.ProfileScreen })));\nconst EditProfileScreen = lazy(() => import('./screens/UserScreens').then(m => ({ default: m.EditProfileScreen })));\nconst SettingsScreen = lazy(() => import('./screens/UserScreens').then(m => ({ default: m.SettingsScreen })));\n\nconst ChatScreen = lazy(() => import('./screens/ChatScreen').then(m => ({ default: m.ChatScreen })));\nconst NotificationScreen = lazy(() => import('./screens/NotificationScreen').then(m => ({ default: m.NotificationScreen })));\n\nconst HelpCenterScreen = lazy(() => import('./screens/SupportScreens').then(m => ({ default: m.HelpCenterScreen })));\nconst TermsScreen = lazy(() => import('./screens/SupportScreens').then(m => ({ default: m.TermsScreen })));\nconst PrivacyScreen = lazy(() => import('./screens/SupportScreens').then(m => ({ default: m.PrivacyScreen })));\n\nconst ScrollToTop = () => {\n  const { pathname } = useLocation();\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [pathname]);\n  return null;\n};\n\nconst AppContent: React.FC = () => {\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    // Simulate initialization (Auth check, Asset loading)\n    const timer = setTimeout(() => {\n      setIsLoading(false);\n    }, 2500);\n    return () => clearTimeout(timer);\n  }, []);\n\n  if (isLoading) {\n    return <SplashScreen />;\n  }\n\n  return (\n    <HashRouter>\n      <ScrollToTop />\n      <div className=\"antialiased text-text-primary dark:text-text-primary-dark transition-colors duration-300\">\n        <Suspense fallback={<div className=\"min-h-screen bg-background-light dark:bg-background-dark\"></div>}>\n          <Routes>\n            <Route path=\"/\" element={<WelcomeScreen />} />\n            <Route path=\"/role\" element={<SelectRoleScreen />} />\n            <Route path=\"/register\" element={<CreateAccountScreen />} />\n            <Route path=\"/home\" element={<HomeScreen />} />\n            <Route path=\"/tasks-feed\" element={<TasksFeedScreen />} />\n            <Route path=\"/map\" element={<MapScreen />} />\n            <Route path=\"/post-task/:step\" element={<PostTaskScreen />} />\n            <Route path=\"/task/:id\" element={<TaskDetailsScreen />} />\n            <Route path=\"/task/:id/edit\" element={<PostTaskScreen isEditMode={true} />} />\n            <Route path=\"/task/:id/progress\" element={<TaskInProgressScreen />} />\n            <Route path=\"/task/:id/rate\" element={<TaskCompletedScreen />} />\n            <Route path=\"/my-tasks\" element={<MyTasksScreen />} />\n            <Route path=\"/wallet\" element={<WalletScreen />} />\n            <Route path=\"/wallet/withdraw\" element={<WithdrawScreen />} />\n            <Route path=\"/wallet/add-card\" element={<AddCardScreen />} />\n            <Route path=\"/wallet/transaction/:id\" element={<TransactionDetailsScreen />} />\n            <Route path=\"/profile\" element={<ProfileScreen />} />\n            <Route path=\"/profile/edit\" element={<EditProfileScreen />} />\n            <Route path=\"/profile/:userId\" element={<ProfileScreen />} />\n            <Route path=\"/settings\" element={<SettingsScreen />} />\n            <Route path=\"/chat/:taskId\" element={<ChatScreen />} />\n            <Route path=\"/notifications\" element={<NotificationScreen />} />\n            <Route path=\"/help\" element={<HelpCenterScreen />} />\n            <Route path=\"/terms\" element={<TermsScreen />} />\n            <Route path=\"/privacy\" element={<PrivacyScreen />} />\n            <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\n          </Routes>\n        </Suspense>\n        <BottomNav />\n      </div>\n    </HashRouter>\n  );\n};\n\nconst App: React.FC = () => {\n  return (\n    <ErrorBoundary>\n      <ToastProvider>\n        <AppProvider>\n          <AppContent />\n        </AppProvider>\n      </ToastProvider>\n    </ErrorBoundary>\n  );\n};\n\nexport default App;\n","path":null,"size_bytes":6068,"size_tokens":null},"replit.md":{"content":"# THARWA (ذروة)\n\n## Overview\n\nTHARWA (ذروة) is a mobile-first community marketplace that connects clients needing help with local taskers. It operates with a dual-role system, allowing users to post tasks as clients or complete them as taskers. The platform enforces a 5% fee on completed tasks and is currently available only in Riyadh, Saudi Arabia, with plans for expansion. Key features include a daily task limit for clients, identity verification for taskers, and a strong emphasis on a native iOS-inspired mobile experience.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\nThe frontend is built with React 19 and TypeScript, using Vite for development and bundling. Wouter handles client-side routing, and TanStack Query manages server state with optimistic updates. UI design adheres to an iOS-inspired glassmorphism aesthetic, utilizing Tailwind CSS, Shadcn UI, and Radix UI primitives for a mobile-first, responsive, and touch-optimized experience. State management combines TanStack Query for server data, React Context API for global client state, and LocalStorage for persistence.\n\n### Backend Architecture\n\nThe backend utilizes Express.js with TypeScript to provide a RESTful API. It includes a WebSocket server for real-time chat. Authentication is session-based using `express-session`, with `bcrypt` for password hashing. The API follows RESTful principles with consistent error handling and robust request validation. The project uses a monorepo structure, separating client, server, and shared schema definitions.\n\n### Data Storage Solutions\n\nPostgreSQL, accessed via Neon serverless driver, serves as the primary database. Drizzle ORM provides type-safe queries and schema management. The schema includes tables for Users (with dual roles, balance, ratings), Tasks (lifecycle, geolocation, budget), Bids, Messages, Transactions, Notifications, and Saved Tasks, all interconnected with Drizzle relations. Drizzle Kit is used for schema migrations.\n\n### Authentication & Authorization\n\nAuthentication supports multiple methods:\n-   **Password-based**: Traditional username/password with `bcrypt` hashing\n-   **Email OTP**: Passwordless login via email verification codes (Resend integration)\n-   **Phone OTP**: Passwordless login via SMS codes (Authentica integration for Saudi numbers 05XXXXXXXX)\n\n**Token-based authentication** using JWT is used for iOS WKWebView compatibility. Tokens are stored in localStorage and sent via Authorization header.\n\nAuthorization is role-based (client/tasker/admin), with dynamic role switching and middleware for access control. Security measures include strong password hashing, OTP rate limiting, environment variable-configured session secrets, and secure cookie settings.\n\n**Tasker Approval Flow**:\n-   **ALL taskers** (general and specialized) require admin approval before accessing the app\n-   Users who register as taskers see a \"Pending Approval\" screen until approved\n-   Clients can apply to become taskers via Settings; they can continue using client features while pending\n-   Role switch button only appears when `verificationStatus='approved'`\n-   Admin approves taskers via `/api/admin/users/:id/approve` endpoint\n\n### UI/UX Decisions\n\nThe application prioritizes an iOS-native feel with a premium glassmorphism aesthetic. This includes backdrop blur, subtle gradients, Plus Jakarta Sans typography, 24px rounded corners, and touch-optimized interactions powered by Framer Motion. Mobile actions often use bottom sheet modals, and input fields feature floating labels with smooth transitions. Lucide React provides consistent iconography. Dark mode is supported with system preference detection.\n\n### Feature Specifications\n\n-   **Professional Roles & Badges**: Taskers can have professional roles across various categories with distinct badges.\n-   **Tasker Availability Calendar**: An Airbnb-style calendar allows taskers to manage their availability, visible to clients in read-only mode.\n-   **Portfolio Gallery**: Taskers can upload and manage a portfolio of photos with captions and reordering capabilities.\n-   **Enhanced Profile Screen**: Integrates professional badges, portfolio, and availability calendar.\n-   **Help & Support System**: Provides FAQs and contact options.\n-   **Legal Pages**: Includes privacy policy and terms & conditions.\n-   **Profile Picture Upload**: Users can upload profile pictures (base64 encoded).\n-   **Search Taskers Screen**: Clients can search for taskers using category filters and a \"verified only\" toggle.\n-   **Enhanced Notification System**: Provides real-time notifications for new tasks, bids, task completion, and payments, with category-based and actionable alerts.\n-   **Task Deletion**: Clients can soft-delete their open tasks.\n-   **Direct Service Request Feature**: Clients can directly request services from tasker profiles, initiating a workflow of pending, accepted, or rejected requests, which can lead to auto-assigned tasks.\n-   **iOS PWA Setup**: Optimized for iOS devices with manifest.json, service worker for offline caching, branded icons, splash screens, and iOS-specific CSS.\n-   **Capacitor iOS Integration**: Configured for App Store deployment with all required app icons (20px-1024px), splash screens, and native plugins (SplashScreen, StatusBar, Keyboard, Haptics).\n-   **Push Notifications**: Web push via VAPID keys and native push via Capacitor plugin. Subscriptions stored in `push_subscriptions` table.\n-   **Tasker Level System**: Experience points and level progression (bronze → silver → gold → platinum → diamond) with reduced commission rates for higher levels.\n-   **Enhanced Rating System**: Detailed ratings for quality, speed, and communication in addition to overall rating.\n-   **Biometric Authentication**: Face ID / Touch ID support via Capacitor for iOS native app.\n-   **GPS Geolocation**: Automatic location detection with Riyadh boundary validation.\n\n## External Dependencies\n\n### Third-party Services\n\n-   **Mapping & Geolocation**: Leaflet.js for interactive maps with CartoDB tile layers and client-side geolocation API.\n-   **Payment Processing**: Stripe integration via `stripe-replit-sync` for real payments, including a wallet system and 5% platform fee application.\n\n### Database & Hosting\n\n-   **Neon Serverless PostgreSQL**: Managed PostgreSQL database, connected via `@neondatabase/serverless` driver.\n\n### Development Tools\n\n-   **Replit Integration**: Utilizes `@replit/vite-plugin-runtime-error-modal`, `@replit/vite-plugin-cartographer`, and `@replit/vite-plugin-dev-banner` for development enhancements.\n\n### UI Component Libraries\n\n-   **Radix UI Primitives**: Comprehensive suite for accessible UI components (Dialog, Dropdown, Select, Checkbox, etc.).\n-   **Supporting Libraries**: `react-hook-form` with `zod` for form validation, `date-fns` for date manipulation, `clsx` and `tailwind-merge` for CSS utility, and `class-variance-authority` for component variants.","path":null,"size_bytes":7050,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\nimport { buildApiUrl } from \"./config\";\n\n// Auth token storage for Capacitor iOS\nconst AUTH_TOKEN_KEY = 'tharwa_auth_token';\n\nexport function getAuthToken(): string | null {\n  return localStorage.getItem(AUTH_TOKEN_KEY);\n}\n\nexport function setAuthToken(token: string): void {\n  localStorage.setItem(AUTH_TOKEN_KEY, token);\n}\n\nexport function removeAuthToken(): void {\n  localStorage.removeItem(AUTH_TOKEN_KEY);\n}\n\nfunction getAuthHeaders(): Record<string, string> {\n  const token = getAuthToken();\n  if (token) {\n    return { 'Authorization': `Bearer ${token}` };\n  }\n  return {};\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const fullUrl = buildApiUrl(url);\n  const headers: Record<string, string> = {\n    ...getAuthHeaders(),\n  };\n  \n  if (data) {\n    headers['Content-Type'] = 'application/json';\n  }\n  \n  const res = await fetch(fullUrl, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const url = buildApiUrl(queryKey.join(\"/\") as string);\n    const res = await fetch(url, {\n      credentials: \"include\",\n      headers: getAuthHeaders(),\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"returnNull\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":2174,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"attached_assets/index_1764551013653.tsx":{"content":"import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\n\nconst rootElement = document.getElementById('root');\nif (!rootElement) {\n  throw new Error(\"Could not find root element to mount to\");\n}\n\nconst root = ReactDOM.createRoot(rootElement);\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);","path":null,"size_bytes":349,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport { \n  users, tasks, bids, transactions, messages, notifications, savedTasks,\n  professionalRoles, userProfessionalRoles, taskerAvailability, userPhotos,\n  directServiceRequests, otpCodes, reviews, pushSubscriptions,\n  insertUserSchema, insertTaskSchema, insertBidSchema, insertTransactionSchema,\n  insertMessageSchema, insertNotificationSchema\n} from \"@shared/schema\";\nimport { eq, and, or, desc, like, sql, asc, lt, gt, avg, count } from \"drizzle-orm\";\nimport type { \n  User, Task, Bid, Transaction, Message, Notification, SavedTask,\n  ProfessionalRole, UserProfessionalRole, TaskerAvailability, UserPhoto,\n  DirectServiceRequest, InsertDirectServiceRequest, OtpCode, InsertOtpCode,\n  Review, InsertReview, PushSubscription, InsertPushSubscription,\n  InsertUser, InsertTask, InsertBid, InsertTransaction, InsertMessage, InsertNotification,\n  InsertProfessionalRole, InsertUserProfessionalRole, InsertTaskerAvailability, InsertUserPhoto\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByPhone(phone: string): Promise<User | undefined>;\n  createUser(data: InsertUser): Promise<User>;\n  updateUser(id: string, data: Partial<InsertUser> & { balance?: string; completedTasks?: number; rating?: string }): Promise<User>;\n  searchTaskers(filters?: { category?: string; verified?: boolean; search?: string }): Promise<User[]>;\n  getTaskersByCategory(category: string): Promise<User[]>;\n  \n  // Tasks\n  getTask(id: string): Promise<Task | undefined>;\n  getTasks(filters?: { clientId?: string; status?: string; category?: string }): Promise<Task[]>;\n  getTasksCreatedToday(userId: string): Promise<number>;\n  createTask(data: InsertTask): Promise<Task>;\n  updateTask(id: string, data: Partial<Task>): Promise<Task>;\n  deleteTask(id: string): Promise<void>;\n  \n  // Bids\n  getBid(id: string): Promise<Bid | undefined>;\n  getBidsForTask(taskId: string): Promise<Bid[]>;\n  getAcceptedBidForTask(taskId: string): Promise<Bid | undefined>;\n  createBid(data: InsertBid): Promise<Bid>;\n  updateBid(id: string, data: Partial<Bid>): Promise<Bid>;\n  \n  // Messages\n  getMessage(id: string): Promise<Message | undefined>;\n  getMessagesForTask(taskId: string): Promise<Message[]>;\n  createMessage(data: InsertMessage): Promise<Message>;\n  markMessageAsRead(id: string): Promise<Message>;\n  \n  // Transactions\n  getTransaction(id: string): Promise<Transaction | undefined>;\n  getTransactionsForUser(userId: string): Promise<Transaction[]>;\n  createTransaction(data: InsertTransaction): Promise<Transaction>;\n  \n  // Notifications\n  getNotification(id: string): Promise<Notification | undefined>;\n  getNotificationsForUser(userId: string): Promise<Notification[]>;\n  createNotification(data: InsertNotification): Promise<Notification>;\n  markNotificationAsRead(id: string): Promise<Notification>;\n  \n  // Saved Tasks\n  getSavedTasksForUser(userId: string): Promise<SavedTask[]>;\n  saveTask(userId: string, taskId: string): Promise<SavedTask>;\n  unsaveTask(userId: string, taskId: string): Promise<void>;\n  \n  // Professional Roles\n  getProfessionalRoles(): Promise<ProfessionalRole[]>;\n  getProfessionalRole(id: string): Promise<ProfessionalRole | undefined>;\n  getProfessionalRoleBySlug(slug: string): Promise<ProfessionalRole | undefined>;\n  \n  // User Professional Roles\n  getUserProfessionalRoles(userId: string): Promise<(UserProfessionalRole & { role: ProfessionalRole })[]>;\n  assignProfessionalRole(data: InsertUserProfessionalRole): Promise<UserProfessionalRole>;\n  removeProfessionalRole(userId: string, roleId: string): Promise<void>;\n  \n  // Tasker Availability\n  getTaskerAvailability(userId: string, startDate?: string, endDate?: string): Promise<TaskerAvailability[]>;\n  getTaskerAvailabilityById(id: string): Promise<TaskerAvailability | undefined>;\n  setTaskerAvailability(data: InsertTaskerAvailability): Promise<TaskerAvailability>;\n  updateTaskerAvailability(id: string, data: Partial<InsertTaskerAvailability>): Promise<TaskerAvailability>;\n  deleteTaskerAvailability(id: string): Promise<void>;\n  \n  // User Photos (Portfolio)\n  getUserPhotos(userId: string): Promise<UserPhoto[]>;\n  getUserPhotoById(id: string): Promise<UserPhoto | undefined>;\n  addUserPhoto(data: InsertUserPhoto): Promise<UserPhoto>;\n  updateUserPhoto(id: string, data: Partial<InsertUserPhoto>): Promise<UserPhoto>;\n  deleteUserPhoto(id: string): Promise<void>;\n  reorderUserPhotos(userId: string, photoIds: string[]): Promise<void>;\n  \n  // Direct Service Requests\n  getDirectServiceRequest(id: string): Promise<DirectServiceRequest | undefined>;\n  getDirectServiceRequestsForClient(clientId: string): Promise<DirectServiceRequest[]>;\n  getDirectServiceRequestsForTasker(taskerId: string): Promise<DirectServiceRequest[]>;\n  createDirectServiceRequest(data: InsertDirectServiceRequest): Promise<DirectServiceRequest>;\n  updateDirectServiceRequest(id: string, data: Partial<DirectServiceRequest>): Promise<DirectServiceRequest>;\n  \n  // OTP Codes\n  createOtpCode(data: InsertOtpCode): Promise<OtpCode>;\n  getValidOtpCode(email: string, code: string, type: string): Promise<OtpCode | undefined>;\n  getPendingOtpByEmail(email: string, type: string): Promise<OtpCode | undefined>;\n  markOtpAsVerified(id: string): Promise<OtpCode>;\n  incrementOtpAttempts(id: string): Promise<OtpCode>;\n  deleteExpiredOtpCodes(): Promise<void>;\n  \n  // Admin operations\n  getAllUsers(): Promise<User[]>;\n  getPendingVerifications(): Promise<User[]>;\n  \n  // Reviews\n  createReview(data: InsertReview): Promise<Review>;\n  getReviewsForUser(userId: string): Promise<Review[]>;\n  getReviewForTask(taskId: string): Promise<Review | undefined>;\n  calculateUserRating(userId: string): Promise<{ rating: string; count: number }>;\n  \n  // Push Subscriptions\n  savePushSubscription(data: InsertPushSubscription): Promise<PushSubscription>;\n  deletePushSubscription(userId: string): Promise<void>;\n  getPushSubscription(userId: string): Promise<PushSubscription | undefined>;\n}\n\nexport const storage: IStorage = {\n  // Users\n  async getUser(id: string) {\n    const result = await db.select().from(users).where(eq(users.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async getUserByUsername(username: string) {\n    const result = await db.select().from(users).where(eq(users.username, username)).limit(1);\n    return result[0];\n  },\n  \n  async getUserByEmail(email: string) {\n    const result = await db.select().from(users).where(eq(users.email, email)).limit(1);\n    return result[0];\n  },\n  \n  async getUserByPhone(phone: string) {\n    // Normalize phone number for lookup\n    const normalizedPhone = phone.replace(/[\\s\\-\\(\\)\\.]/g, '');\n    // Try multiple formats: with/without country code, with/without leading zero\n    const phoneVariants = [\n      normalizedPhone,\n      normalizedPhone.replace(/^\\+/, ''),\n      normalizedPhone.replace(/^966/, '0'),\n      normalizedPhone.replace(/^\\+966/, '0'),\n      `+${normalizedPhone}`,\n      `+966${normalizedPhone.replace(/^0/, '')}`,\n    ];\n    \n    for (const variant of phoneVariants) {\n      const result = await db.select().from(users).where(eq(users.phone, variant)).limit(1);\n      if (result[0]) return result[0];\n    }\n    return undefined;\n  },\n  \n  async createUser(data: InsertUser) {\n    const result = await db.insert(users).values(data).returning();\n    return result[0];\n  },\n  \n  async updateUser(id: string, data: Partial<InsertUser> & { balance?: string; completedTasks?: number; rating?: string }) {\n    const result = await db.update(users).set(data).where(eq(users.id, id)).returning();\n    return result[0];\n  },\n\n  async searchTaskers(filters?: { category?: string; verified?: boolean; search?: string }) {\n    const conditions = [eq(users.role, 'tasker')];\n    \n    if (filters?.verified) {\n      conditions.push(eq(users.verificationStatus, 'approved'));\n    }\n    \n    if (filters?.search) {\n      conditions.push(\n        or(\n          like(users.name, `%${filters.search}%`),\n          like(users.bio, `%${filters.search}%`)\n        ) as any\n      );\n    }\n    \n    let query = db.select().from(users).where(and(...conditions));\n    \n    if (filters?.category) {\n      const taskersWithRole = await db\n        .select({ userId: userProfessionalRoles.userId })\n        .from(userProfessionalRoles)\n        .innerJoin(professionalRoles, eq(userProfessionalRoles.roleId, professionalRoles.id))\n        .where(eq(professionalRoles.slug, filters.category));\n      \n      const userIds = taskersWithRole.map(t => t.userId);\n      if (userIds.length > 0) {\n        return db.select().from(users)\n          .where(and(...conditions, sql`${users.id} IN (${sql.join(userIds.map(id => sql`${id}`), sql`, `)})`))\n          .orderBy(desc(users.rating), desc(users.completedTasks));\n      }\n      return [];\n    }\n    \n    return db.select().from(users).where(and(...conditions)).orderBy(desc(users.rating), desc(users.completedTasks));\n  },\n\n  async getTaskersByCategory(category: string) {\n    const taskersWithRole = await db\n      .select({ userId: userProfessionalRoles.userId })\n      .from(userProfessionalRoles)\n      .innerJoin(professionalRoles, eq(userProfessionalRoles.roleId, professionalRoles.id))\n      .where(eq(professionalRoles.slug, category));\n    \n    const userIds = taskersWithRole.map(t => t.userId);\n    \n    if (userIds.length === 0) {\n      return db.select().from(users)\n        .where(and(eq(users.role, 'tasker'), eq(users.verificationStatus, 'approved')))\n        .orderBy(desc(users.rating));\n    }\n    \n    return db.select().from(users)\n      .where(sql`${users.id} IN (${sql.join(userIds.map(id => sql`${id}`), sql`, `)})`)\n      .orderBy(desc(users.rating));\n  },\n  \n  // Tasks\n  async getTask(id: string) {\n    const result = await db.select().from(tasks).where(eq(tasks.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async getTasks(filters?: { clientId?: string; status?: string; category?: string }) {\n    const conditions = [];\n    if (filters?.clientId) {\n      conditions.push(eq(tasks.clientId, filters.clientId));\n    }\n    if (filters?.status) {\n      conditions.push(eq(tasks.status, filters.status as any));\n    }\n    if (filters?.category) {\n      conditions.push(eq(tasks.category, filters.category));\n    }\n    \n    if (conditions.length > 0) {\n      return db.select().from(tasks).where(and(...conditions)).orderBy(desc(tasks.createdAt));\n    }\n    return db.select().from(tasks).orderBy(desc(tasks.createdAt));\n  },\n\n  async getTasksCreatedToday(userId: string): Promise<number> {\n    const todayStart = new Date();\n    todayStart.setHours(0, 0, 0, 0);\n    \n    const result = await db.select({ count: sql<number>`count(*)` })\n      .from(tasks)\n      .where(\n        and(\n          eq(tasks.clientId, userId),\n          sql`${tasks.createdAt} >= ${todayStart.toISOString()}`\n        )\n      );\n    return Number(result[0]?.count || 0);\n  },\n  \n  async createTask(data: InsertTask) {\n    const result = await db.insert(tasks).values(data).returning();\n    return result[0];\n  },\n  \n  async updateTask(id: string, data: Partial<Task>) {\n    const result = await db.update(tasks).set(data as any).where(eq(tasks.id, id)).returning();\n    return result[0];\n  },\n\n  async deleteTask(id: string) {\n    await db.update(tasks).set({ status: 'cancelled' }).where(eq(tasks.id, id));\n  },\n  \n  // Bids\n  async getBid(id: string) {\n    const result = await db.select().from(bids).where(eq(bids.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async getBidsForTask(taskId: string) {\n    const result = await db.select().from(bids).where(eq(bids.taskId, taskId)).orderBy(desc(bids.createdAt));\n    return result;\n  },\n  \n  async getAcceptedBidForTask(taskId: string) {\n    const result = await db.select().from(bids).where(\n      and(eq(bids.taskId, taskId), eq(bids.status, \"accepted\"))\n    ).limit(1);\n    return result[0];\n  },\n  \n  async createBid(data: InsertBid) {\n    const result = await db.insert(bids).values(data).returning();\n    return result[0];\n  },\n  \n  async updateBid(id: string, data: Partial<Bid>) {\n    const result = await db.update(bids).set(data as any).where(eq(bids.id, id)).returning();\n    return result[0];\n  },\n  \n  // Messages\n  async getMessage(id: string) {\n    const result = await db.select().from(messages).where(eq(messages.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async getMessagesForTask(taskId: string) {\n    const result = await db.select().from(messages).where(eq(messages.taskId, taskId)).orderBy(desc(messages.createdAt));\n    return result;\n  },\n  \n  async createMessage(data: InsertMessage) {\n    const result = await db.insert(messages).values(data).returning();\n    return result[0];\n  },\n  \n  async markMessageAsRead(id: string) {\n    const result = await db.update(messages).set({ read: true }).where(eq(messages.id, id)).returning();\n    return result[0];\n  },\n  \n  // Transactions\n  async getTransaction(id: string) {\n    const result = await db.select().from(transactions).where(eq(transactions.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async getTransactionsForUser(userId: string) {\n    const result = await db.select().from(transactions).where(eq(transactions.userId, userId)).orderBy(desc(transactions.createdAt));\n    return result;\n  },\n  \n  async createTransaction(data: InsertTransaction) {\n    const result = await db.insert(transactions).values(data).returning();\n    return result[0];\n  },\n  \n  // Notifications\n  async getNotification(id: string) {\n    const result = await db.select().from(notifications).where(eq(notifications.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async getNotificationsForUser(userId: string) {\n    const result = await db.select().from(notifications).where(eq(notifications.userId, userId)).orderBy(desc(notifications.createdAt));\n    return result;\n  },\n  \n  async createNotification(data: InsertNotification) {\n    const result = await db.insert(notifications).values(data).returning();\n    return result[0];\n  },\n  \n  async markNotificationAsRead(id: string) {\n    const result = await db.update(notifications).set({ read: true }).where(eq(notifications.id, id)).returning();\n    return result[0];\n  },\n  \n  // Saved Tasks\n  async getSavedTasksForUser(userId: string) {\n    const result = await db.select().from(savedTasks).where(eq(savedTasks.userId, userId)).orderBy(desc(savedTasks.createdAt));\n    return result;\n  },\n  \n  async saveTask(userId: string, taskId: string) {\n    const result = await db.insert(savedTasks).values({ userId, taskId }).returning();\n    return result[0];\n  },\n  \n  async unsaveTask(userId: string, taskId: string) {\n    await db.delete(savedTasks).where(and(eq(savedTasks.userId, userId), eq(savedTasks.taskId, taskId)));\n  },\n  \n  // Professional Roles\n  async getProfessionalRoles() {\n    return db.select().from(professionalRoles).orderBy(professionalRoles.category, professionalRoles.nameEn);\n  },\n  \n  async getProfessionalRole(id: string) {\n    const result = await db.select().from(professionalRoles).where(eq(professionalRoles.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async getProfessionalRoleBySlug(slug: string) {\n    const result = await db.select().from(professionalRoles).where(eq(professionalRoles.slug, slug)).limit(1);\n    return result[0];\n  },\n  \n  // User Professional Roles\n  async getUserProfessionalRoles(userId: string) {\n    const result = await db\n      .select()\n      .from(userProfessionalRoles)\n      .innerJoin(professionalRoles, eq(userProfessionalRoles.roleId, professionalRoles.id))\n      .where(eq(userProfessionalRoles.userId, userId))\n      .orderBy(professionalRoles.category);\n    \n    return result.map(r => ({\n      ...r.user_professional_roles,\n      role: r.professional_roles,\n    }));\n  },\n  \n  async assignProfessionalRole(data: InsertUserProfessionalRole) {\n    const result = await db.insert(userProfessionalRoles).values(data).returning();\n    return result[0];\n  },\n  \n  async removeProfessionalRole(userId: string, roleId: string) {\n    await db.delete(userProfessionalRoles).where(\n      and(eq(userProfessionalRoles.userId, userId), eq(userProfessionalRoles.roleId, roleId))\n    );\n  },\n  \n  // Tasker Availability\n  async getTaskerAvailability(userId: string, startDate?: string, endDate?: string) {\n    const conditions = [eq(taskerAvailability.userId, userId)];\n    \n    if (startDate) {\n      conditions.push(sql`${taskerAvailability.date} >= ${startDate}`);\n    }\n    if (endDate) {\n      conditions.push(sql`${taskerAvailability.date} <= ${endDate}`);\n    }\n    \n    return db.select().from(taskerAvailability).where(and(...conditions)).orderBy(taskerAvailability.date);\n  },\n  \n  async getTaskerAvailabilityById(id: string) {\n    const result = await db.select().from(taskerAvailability).where(eq(taskerAvailability.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async setTaskerAvailability(data: InsertTaskerAvailability) {\n    const existing = await db\n      .select()\n      .from(taskerAvailability)\n      .where(and(eq(taskerAvailability.userId, data.userId), eq(taskerAvailability.date, data.date)))\n      .limit(1);\n    \n    if (existing[0]) {\n      const result = await db\n        .update(taskerAvailability)\n        .set({ status: data.status, note: data.note })\n        .where(eq(taskerAvailability.id, existing[0].id))\n        .returning();\n      return result[0];\n    }\n    \n    const result = await db.insert(taskerAvailability).values(data).returning();\n    return result[0];\n  },\n  \n  async updateTaskerAvailability(id: string, data: Partial<InsertTaskerAvailability>) {\n    const result = await db.update(taskerAvailability).set(data).where(eq(taskerAvailability.id, id)).returning();\n    return result[0];\n  },\n  \n  async deleteTaskerAvailability(id: string) {\n    await db.delete(taskerAvailability).where(eq(taskerAvailability.id, id));\n  },\n  \n  // User Photos (Portfolio)\n  async getUserPhotos(userId: string) {\n    return db.select().from(userPhotos).where(eq(userPhotos.userId, userId)).orderBy(asc(userPhotos.displayOrder));\n  },\n  \n  async getUserPhotoById(id: string) {\n    const result = await db.select().from(userPhotos).where(eq(userPhotos.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async addUserPhoto(data: InsertUserPhoto) {\n    const existingPhotos = await db\n      .select({ maxOrder: sql<number>`COALESCE(MAX(${userPhotos.displayOrder}), -1)` })\n      .from(userPhotos)\n      .where(eq(userPhotos.userId, data.userId));\n    \n    const nextOrder = (existingPhotos[0]?.maxOrder ?? -1) + 1;\n    \n    const result = await db.insert(userPhotos).values({ ...data, displayOrder: nextOrder }).returning();\n    return result[0];\n  },\n  \n  async updateUserPhoto(id: string, data: Partial<InsertUserPhoto>) {\n    const result = await db.update(userPhotos).set(data).where(eq(userPhotos.id, id)).returning();\n    return result[0];\n  },\n  \n  async deleteUserPhoto(id: string) {\n    await db.delete(userPhotos).where(eq(userPhotos.id, id));\n  },\n  \n  async reorderUserPhotos(userId: string, photoIds: string[]) {\n    for (let i = 0; i < photoIds.length; i++) {\n      await db\n        .update(userPhotos)\n        .set({ displayOrder: i })\n        .where(and(eq(userPhotos.id, photoIds[i]), eq(userPhotos.userId, userId)));\n    }\n  },\n  \n  // Direct Service Requests\n  async getDirectServiceRequest(id: string) {\n    const result = await db.select().from(directServiceRequests).where(eq(directServiceRequests.id, id)).limit(1);\n    return result[0];\n  },\n  \n  async getDirectServiceRequestsForClient(clientId: string) {\n    return db\n      .select()\n      .from(directServiceRequests)\n      .where(eq(directServiceRequests.clientId, clientId))\n      .orderBy(desc(directServiceRequests.createdAt));\n  },\n  \n  async getDirectServiceRequestsForTasker(taskerId: string) {\n    return db\n      .select()\n      .from(directServiceRequests)\n      .where(eq(directServiceRequests.taskerId, taskerId))\n      .orderBy(desc(directServiceRequests.createdAt));\n  },\n  \n  async createDirectServiceRequest(data: InsertDirectServiceRequest) {\n    const result = await db.insert(directServiceRequests).values(data).returning();\n    return result[0];\n  },\n  \n  async updateDirectServiceRequest(id: string, data: Partial<DirectServiceRequest>) {\n    const result = await db.update(directServiceRequests).set(data).where(eq(directServiceRequests.id, id)).returning();\n    return result[0];\n  },\n  \n  // OTP Codes\n  async createOtpCode(data: InsertOtpCode) {\n    // Delete any existing OTP codes for this email and type\n    await db.delete(otpCodes).where(\n      and(eq(otpCodes.email, data.email), sql`${otpCodes.type} = ${data.type}`)\n    );\n    const result = await db.insert(otpCodes).values(data).returning();\n    return result[0];\n  },\n  \n  async getValidOtpCode(email: string, code: string, type: string) {\n    const now = new Date();\n    const result = await db.select().from(otpCodes).where(\n      and(\n        eq(otpCodes.email, email),\n        eq(otpCodes.code, code),\n        sql`${otpCodes.type} = ${type}`,\n        eq(otpCodes.verified, false),\n        gt(otpCodes.expiresAt, now),\n        lt(otpCodes.attempts, 5) // Max 5 attempts\n      )\n    ).limit(1);\n    return result[0];\n  },\n  \n  async getPendingOtpByEmail(email: string, type: string) {\n    const now = new Date();\n    const result = await db.select().from(otpCodes).where(\n      and(\n        eq(otpCodes.email, email),\n        sql`${otpCodes.type} = ${type}`,\n        eq(otpCodes.verified, false),\n        gt(otpCodes.expiresAt, now),\n        lt(otpCodes.attempts, 5)\n      )\n    ).limit(1);\n    return result[0];\n  },\n  \n  async markOtpAsVerified(id: string) {\n    const result = await db.update(otpCodes).set({ verified: true }).where(eq(otpCodes.id, id)).returning();\n    return result[0];\n  },\n  \n  async incrementOtpAttempts(id: string) {\n    const result = await db.update(otpCodes).set({ \n      attempts: sql`${otpCodes.attempts} + 1` \n    }).where(eq(otpCodes.id, id)).returning();\n    return result[0];\n  },\n  \n  async deleteExpiredOtpCodes() {\n    const now = new Date();\n    await db.delete(otpCodes).where(lt(otpCodes.expiresAt, now));\n  },\n  \n  // Admin operations\n  async getAllUsers() {\n    return db.select().from(users).orderBy(desc(users.createdAt));\n  },\n  \n  async getPendingVerifications() {\n    return db.select().from(users).where(\n      and(\n        eq(users.role, 'tasker'),\n        eq(users.taskerType, 'specialized'),\n        eq(users.verificationStatus, 'pending')\n      )\n    ).orderBy(desc(users.createdAt));\n  },\n  \n  // Reviews\n  async createReview(data: InsertReview) {\n    const result = await db.insert(reviews).values(data).returning();\n    return result[0];\n  },\n  \n  async getReviewsForUser(userId: string) {\n    return db.select().from(reviews)\n      .where(eq(reviews.revieweeId, userId))\n      .orderBy(desc(reviews.createdAt));\n  },\n  \n  async getReviewForTask(taskId: string) {\n    const result = await db.select().from(reviews)\n      .where(eq(reviews.taskId, taskId))\n      .limit(1);\n    return result[0];\n  },\n  \n  async calculateUserRating(userId: string) {\n    const result = await db.select({\n      avgRating: sql<string>`COALESCE(AVG(${reviews.rating})::numeric(3,2), 0)`,\n      totalCount: sql<number>`COUNT(*)::int`\n    })\n      .from(reviews)\n      .where(eq(reviews.revieweeId, userId));\n    \n    return {\n      rating: result[0]?.avgRating || \"0.00\",\n      count: result[0]?.totalCount || 0\n    };\n  },\n  \n  // Push Subscriptions\n  async savePushSubscription(data: InsertPushSubscription) {\n    // Upsert: delete existing subscription for this user and create new one\n    await db.delete(pushSubscriptions).where(eq(pushSubscriptions.userId, data.userId));\n    const result = await db.insert(pushSubscriptions).values(data).returning();\n    return result[0];\n  },\n  \n  async deletePushSubscription(userId: string) {\n    await db.delete(pushSubscriptions).where(eq(pushSubscriptions.userId, userId));\n  },\n  \n  async getPushSubscription(userId: string) {\n    const result = await db.select().from(pushSubscriptions)\n      .where(eq(pushSubscriptions.userId, userId))\n      .limit(1);\n    return result[0];\n  },\n};\n","path":null,"size_bytes":24260,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, decimal, timestamp, boolean, pgEnum } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums\nexport const userRoleEnum = pgEnum(\"user_role\", [\"client\", \"tasker\"]);\nexport const taskStatusEnum = pgEnum(\"task_status\", [\"open\", \"assigned\", \"in_progress\", \"completed\", \"cancelled\"]);\nexport const bidStatusEnum = pgEnum(\"bid_status\", [\"pending\", \"accepted\", \"rejected\"]);\nexport const transactionTypeEnum = pgEnum(\"transaction_type\", [\"credit\", \"debit\"]);\nexport const transactionStatusEnum = pgEnum(\"transaction_status\", [\"completed\", \"pending\"]);\nexport const notificationTypeEnum = pgEnum(\"notification_type\", [\"offer\", \"system\", \"chat\", \"task_update\", \"new_task\", \"bid_received\", \"task_completed\", \"payment_request\", \"direct_request\", \"direct_request_accepted\", \"direct_request_rejected\", \"review\"]);\nexport const directRequestStatusEnum = pgEnum(\"direct_request_status\", [\"pending\", \"accepted\", \"rejected\", \"cancelled\"]);\nexport const professionalCategoryEnum = pgEnum(\"professional_category\", [\n  \"beauty_fashion\", \n  \"teaching_education\", \n  \"art\", \n  \"construction\", \n  \"special\"\n]);\nexport const availabilityStatusEnum = pgEnum(\"availability_status\", [\"available\", \"busy\"]);\nexport const taskerTypeEnum = pgEnum(\"tasker_type\", [\"general\", \"specialized\"]);\nexport const taskerVerificationStatusEnum = pgEnum(\"tasker_verification_status\", [\"pending\", \"approved\", \"rejected\"]);\n\n// Tasker level enum for level system\nexport const taskerLevelEnum = pgEnum(\"tasker_level\", [\"bronze\", \"silver\", \"gold\", \"platinum\", \"diamond\"]);\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull().unique(),\n  emailVerified: boolean(\"email_verified\").notNull().default(false),\n  phone: text(\"phone\"),\n  avatar: text(\"avatar\"),\n  role: userRoleEnum(\"role\").notNull().default(\"client\"),\n  balance: decimal(\"balance\", { precision: 10, scale: 2 }).notNull().default(\"0.00\"),\n  rating: decimal(\"rating\", { precision: 3, scale: 2 }).notNull().default(\"0.00\"),\n  completedTasks: integer(\"completed_tasks\").notNull().default(0),\n  bio: text(\"bio\"),\n  location: text(\"location\"),\n  taskerType: taskerTypeEnum(\"tasker_type\"),\n  verificationStatus: taskerVerificationStatusEnum(\"verification_status\"),\n  certificateUrl: text(\"certificate_url\"),\n  specializationCategory: text(\"specialization_category\"),\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  // Level system fields\n  taskerLevel: taskerLevelEnum(\"tasker_level\").default(\"bronze\"),\n  experiencePoints: integer(\"experience_points\").notNull().default(0),\n  // Biometric auth preference\n  biometricEnabled: boolean(\"biometric_enabled\").notNull().default(false),\n  // Push notification token\n  pushToken: text(\"push_token\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Tasks table\nexport const tasks = pgTable(\"tasks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  category: text(\"category\").notNull(),\n  budget: decimal(\"budget\", { precision: 10, scale: 2 }).notNull(),\n  location: text(\"location\").notNull(),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 7 }),\n  longitude: decimal(\"longitude\", { precision: 10, scale: 7 }),\n  date: text(\"date\").notNull(),\n  time: text(\"time\").notNull(),\n  // Task scheduling fields\n  isScheduled: boolean(\"is_scheduled\").notNull().default(false),\n  scheduledDateTime: timestamp(\"scheduled_date_time\"),\n  reminderSent: boolean(\"reminder_sent\").notNull().default(false),\n  status: taskStatusEnum(\"status\").notNull().default(\"open\"),\n  clientId: varchar(\"client_id\").notNull().references(() => users.id),\n  taskerId: varchar(\"tasker_id\").references(() => users.id),\n  images: text(\"images\").array(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Bids/Offers table\nexport const bids = pgTable(\"bids\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  taskId: varchar(\"task_id\").notNull().references(() => tasks.id),\n  taskerId: varchar(\"tasker_id\").notNull().references(() => users.id),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  message: text(\"message\"),\n  status: bidStatusEnum(\"status\").notNull().default(\"pending\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Transactions table\nexport const transactions = pgTable(\"transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  taskId: varchar(\"task_id\").references(() => tasks.id),\n  title: text(\"title\").notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  type: transactionTypeEnum(\"type\").notNull(),\n  status: transactionStatusEnum(\"status\").notNull().default(\"completed\"),\n  icon: text(\"icon\").notNull().default(\"account_balance_wallet\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Messages table for chat\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  taskId: varchar(\"task_id\").notNull().references(() => tasks.id),\n  senderId: varchar(\"sender_id\").notNull().references(() => users.id),\n  receiverId: varchar(\"receiver_id\").notNull().references(() => users.id),\n  content: text(\"content\").notNull(),\n  read: boolean(\"read\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Notifications table\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  type: notificationTypeEnum(\"type\").notNull(),\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  icon: text(\"icon\").notNull(),\n  color: text(\"color\").notNull().default(\"primary\"),\n  read: boolean(\"read\").notNull().default(false),\n  actionUrl: text(\"action_url\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Saved tasks (favorites)\nexport const savedTasks = pgTable(\"saved_tasks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  taskId: varchar(\"task_id\").notNull().references(() => tasks.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Professional roles lookup table\nexport const professionalRoles = pgTable(\"professional_roles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  category: professionalCategoryEnum(\"category\").notNull(),\n  slug: text(\"slug\").notNull().unique(),\n  nameEn: text(\"name_en\").notNull(),\n  nameAr: text(\"name_ar\").notNull(),\n  colorHex: text(\"color_hex\").notNull(),\n  icon: text(\"icon\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// User professional roles (join table - verified professionals)\nexport const userProfessionalRoles = pgTable(\"user_professional_roles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  roleId: varchar(\"role_id\").notNull().references(() => professionalRoles.id),\n  verifiedBy: varchar(\"verified_by\").references(() => users.id),\n  verifiedAt: timestamp(\"verified_at\").notNull().defaultNow(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Tasker availability calendar\nexport const taskerAvailability = pgTable(\"tasker_availability\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  date: text(\"date\").notNull(),\n  status: availabilityStatusEnum(\"status\").notNull().default(\"busy\"),\n  note: text(\"note\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Media type enum for portfolio\nexport const mediaTypeEnum = pgEnum(\"media_type\", [\"image\", \"video\"]);\n\n// User portfolio media (photos and videos)\nexport const userPhotos = pgTable(\"user_photos\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  url: text(\"url\").notNull(),\n  thumbnailUrl: text(\"thumbnail_url\"), // Video thumbnail\n  mediaType: mediaTypeEnum(\"media_type\").notNull().default(\"image\"),\n  caption: text(\"caption\"),\n  displayOrder: integer(\"display_order\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Direct service requests (client requests service directly from specific tasker)\nexport const directServiceRequests = pgTable(\"direct_service_requests\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  clientId: varchar(\"client_id\").notNull().references(() => users.id),\n  taskerId: varchar(\"tasker_id\").notNull().references(() => users.id),\n  category: text(\"category\").notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  scheduledDate: text(\"scheduled_date\").notNull(),\n  scheduledTime: text(\"scheduled_time\").notNull(),\n  location: text(\"location\").notNull(),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 7 }),\n  longitude: decimal(\"longitude\", { precision: 10, scale: 7 }),\n  budget: decimal(\"budget\", { precision: 10, scale: 2 }).notNull(),\n  status: directRequestStatusEnum(\"status\").notNull().default(\"pending\"),\n  linkedTaskId: varchar(\"linked_task_id\").references(() => tasks.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  postedTasks: many(tasks, { relationName: \"clientTasks\" }),\n  assignedTasks: many(tasks, { relationName: \"taskerTasks\" }),\n  bids: many(bids),\n  transactions: many(transactions),\n  sentMessages: many(messages, { relationName: \"sentMessages\" }),\n  receivedMessages: many(messages, { relationName: \"receivedMessages\" }),\n  notifications: many(notifications),\n  savedTasks: many(savedTasks),\n  professionalRoles: many(userProfessionalRoles),\n  availability: many(taskerAvailability),\n  photos: many(userPhotos),\n}));\n\nexport const tasksRelations = relations(tasks, ({ one, many }) => ({\n  client: one(users, {\n    fields: [tasks.clientId],\n    references: [users.id],\n    relationName: \"clientTasks\",\n  }),\n  tasker: one(users, {\n    fields: [tasks.taskerId],\n    references: [users.id],\n    relationName: \"taskerTasks\",\n  }),\n  bids: many(bids),\n  messages: many(messages),\n  transactions: many(transactions),\n}));\n\nexport const bidsRelations = relations(bids, ({ one }) => ({\n  task: one(tasks, {\n    fields: [bids.taskId],\n    references: [tasks.id],\n  }),\n  tasker: one(users, {\n    fields: [bids.taskerId],\n    references: [users.id],\n  }),\n}));\n\nexport const transactionsRelations = relations(transactions, ({ one }) => ({\n  user: one(users, {\n    fields: [transactions.userId],\n    references: [users.id],\n  }),\n  task: one(tasks, {\n    fields: [transactions.taskId],\n    references: [tasks.id],\n  }),\n}));\n\nexport const messagesRelations = relations(messages, ({ one }) => ({\n  task: one(tasks, {\n    fields: [messages.taskId],\n    references: [tasks.id],\n  }),\n  sender: one(users, {\n    fields: [messages.senderId],\n    references: [users.id],\n    relationName: \"sentMessages\",\n  }),\n  receiver: one(users, {\n    fields: [messages.receiverId],\n    references: [users.id],\n    relationName: \"receivedMessages\",\n  }),\n}));\n\nexport const notificationsRelations = relations(notifications, ({ one }) => ({\n  user: one(users, {\n    fields: [notifications.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const savedTasksRelations = relations(savedTasks, ({ one }) => ({\n  user: one(users, {\n    fields: [savedTasks.userId],\n    references: [users.id],\n  }),\n  task: one(tasks, {\n    fields: [savedTasks.taskId],\n    references: [tasks.id],\n  }),\n}));\n\nexport const professionalRolesRelations = relations(professionalRoles, ({ many }) => ({\n  users: many(userProfessionalRoles),\n}));\n\nexport const userProfessionalRolesRelations = relations(userProfessionalRoles, ({ one }) => ({\n  user: one(users, {\n    fields: [userProfessionalRoles.userId],\n    references: [users.id],\n  }),\n  role: one(professionalRoles, {\n    fields: [userProfessionalRoles.roleId],\n    references: [professionalRoles.id],\n  }),\n  verifier: one(users, {\n    fields: [userProfessionalRoles.verifiedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const taskerAvailabilityRelations = relations(taskerAvailability, ({ one }) => ({\n  user: one(users, {\n    fields: [taskerAvailability.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const userPhotosRelations = relations(userPhotos, ({ one }) => ({\n  user: one(users, {\n    fields: [userPhotos.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const directServiceRequestsRelations = relations(directServiceRequests, ({ one }) => ({\n  client: one(users, {\n    fields: [directServiceRequests.clientId],\n    references: [users.id],\n  }),\n  tasker: one(users, {\n    fields: [directServiceRequests.taskerId],\n    references: [users.id],\n  }),\n  linkedTask: one(tasks, {\n    fields: [directServiceRequests.linkedTaskId],\n    references: [tasks.id],\n  }),\n}));\n\n// Push notification subscriptions\nexport const pushSubscriptions = pgTable(\"push_subscriptions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  endpoint: text(\"endpoint\").notNull(),\n  p256dh: text(\"p256dh\").notNull(),\n  auth: text(\"auth\").notNull(),\n  deviceType: text(\"device_type\"), // ios, android, web\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const pushSubscriptionsRelations = relations(pushSubscriptions, ({ one }) => ({\n  user: one(users, {\n    fields: [pushSubscriptions.userId],\n    references: [users.id],\n  }),\n}));\n\n// OTP verification table\nexport const otpCodes = pgTable(\"otp_codes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull(),\n  code: text(\"code\").notNull(),\n  type: text(\"type\").notNull().default(\"registration\"), // registration, password_reset, email_change\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  verified: boolean(\"verified\").notNull().default(false),\n  attempts: integer(\"attempts\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const otpCodesRelations = relations(otpCodes, ({ }) => ({}));\n\n// Reviews table for task ratings with detailed ratings\nexport const reviews = pgTable(\"reviews\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  taskId: varchar(\"task_id\").notNull().references(() => tasks.id),\n  reviewerId: varchar(\"reviewer_id\").notNull().references(() => users.id), // Client who leaves review\n  revieweeId: varchar(\"reviewee_id\").notNull().references(() => users.id), // Tasker receiving review\n  rating: integer(\"rating\").notNull(), // 1-5 stars overall\n  // Detailed ratings (1-5 each)\n  qualityRating: integer(\"quality_rating\"), // جودة العمل\n  speedRating: integer(\"speed_rating\"), // سرعة الإنجاز\n  communicationRating: integer(\"communication_rating\"), // التواصل\n  comment: text(\"comment\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const reviewsRelations = relations(reviews, ({ one }) => ({\n  task: one(tasks, {\n    fields: [reviews.taskId],\n    references: [tasks.id],\n  }),\n  reviewer: one(users, {\n    fields: [reviews.reviewerId],\n    references: [users.id],\n  }),\n  reviewee: one(users, {\n    fields: [reviews.revieweeId],\n    references: [users.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  balance: true,\n  rating: true,\n  completedTasks: true,\n});\n\nexport const insertTaskSchema = createInsertSchema(tasks).omit({\n  id: true,\n  createdAt: true,\n  status: true,\n  taskerId: true,\n});\n\nexport const insertBidSchema = createInsertSchema(bids).omit({\n  id: true,\n  createdAt: true,\n  status: true,\n});\n\nexport const insertTransactionSchema = createInsertSchema(transactions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n  read: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n  read: true,\n});\n\nexport const insertSavedTaskSchema = createInsertSchema(savedTasks).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertProfessionalRoleSchema = createInsertSchema(professionalRoles).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserProfessionalRoleSchema = createInsertSchema(userProfessionalRoles).omit({\n  id: true,\n  createdAt: true,\n  verifiedAt: true,\n});\n\nexport const insertTaskerAvailabilitySchema = createInsertSchema(taskerAvailability).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserPhotoSchema = createInsertSchema(userPhotos).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertDirectServiceRequestSchema = createInsertSchema(directServiceRequests).omit({\n  id: true,\n  createdAt: true,\n  status: true,\n  linkedTaskId: true,\n});\n\nexport const insertOtpCodeSchema = createInsertSchema(otpCodes).omit({\n  id: true,\n  createdAt: true,\n  verified: true,\n  attempts: true,\n});\n\nexport const insertReviewSchema = createInsertSchema(reviews).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertTask = z.infer<typeof insertTaskSchema>;\nexport type Task = typeof tasks.$inferSelect;\n\nexport type InsertBid = z.infer<typeof insertBidSchema>;\nexport type Bid = typeof bids.$inferSelect;\n\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\nexport type Transaction = typeof transactions.$inferSelect;\n\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type Message = typeof messages.$inferSelect;\n\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type Notification = typeof notifications.$inferSelect;\n\nexport type InsertSavedTask = z.infer<typeof insertSavedTaskSchema>;\nexport type SavedTask = typeof savedTasks.$inferSelect;\n\nexport type InsertProfessionalRole = z.infer<typeof insertProfessionalRoleSchema>;\nexport type ProfessionalRole = typeof professionalRoles.$inferSelect;\n\nexport type InsertUserProfessionalRole = z.infer<typeof insertUserProfessionalRoleSchema>;\nexport type UserProfessionalRole = typeof userProfessionalRoles.$inferSelect;\n\nexport type InsertTaskerAvailability = z.infer<typeof insertTaskerAvailabilitySchema>;\nexport type TaskerAvailability = typeof taskerAvailability.$inferSelect;\n\nexport type InsertUserPhoto = z.infer<typeof insertUserPhotoSchema>;\nexport type UserPhoto = typeof userPhotos.$inferSelect;\n\nexport type InsertDirectServiceRequest = z.infer<typeof insertDirectServiceRequestSchema>;\nexport type DirectServiceRequest = typeof directServiceRequests.$inferSelect;\n\nexport type InsertOtpCode = z.infer<typeof insertOtpCodeSchema>;\nexport type OtpCode = typeof otpCodes.$inferSelect;\n\nexport type InsertReview = z.infer<typeof insertReviewSchema>;\nexport type Review = typeof reviews.$inferSelect;\n\nexport const insertPushSubscriptionSchema = createInsertSchema(pushSubscriptions).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertPushSubscription = z.infer<typeof insertPushSubscriptionSchema>;\nexport type PushSubscription = typeof pushSubscriptions.$inferSelect;\n\n// Extended types for frontend\nexport type TaskWithDetails = Task & {\n  client?: User;\n  tasker?: User;\n  bids?: Bid[];\n  distance?: string;\n};\n\nexport type BidWithTasker = Bid & {\n  tasker?: User;\n};\n\nexport type MessageWithUsers = Message & {\n  sender?: User;\n  receiver?: User;\n};\n\nexport type ConversationPreview = {\n  taskId: string;\n  taskTitle: string;\n  otherUser?: User;\n  lastMessage?: Message;\n  unreadCount: number;\n};\n\n// Task categories with subcategories for task posting\nexport const TASK_CATEGORIES_WITH_SUBS = {\n  beauty_fashion: {\n    id: \"beauty_fashion\",\n    nameEn: \"Beauty & Fashion\",\n    nameAr: \"الجمال والموضة\",\n    colorHex: \"#EC4899\",\n    icon: \"sparkles\",\n    subcategories: [\n      { id: \"model\", nameEn: \"Model\", nameAr: \"مودل\" },\n      { id: \"makeup_artist\", nameEn: \"Makeup Artist\", nameAr: \"ميكب ارتست\" },\n      { id: \"hair_stylist\", nameEn: \"Hair Stylist\", nameAr: \"مصففة الشعر\" },\n      { id: \"clothing_designer\", nameEn: \"Clothing Designer\", nameAr: \"تصميم الملابس\" },\n    ],\n  },\n  teaching_education: {\n    id: \"teaching_education\",\n    nameEn: \"Teaching & Education\",\n    nameAr: \"التدريس والتعليم\",\n    colorHex: \"#22C55E\",\n    icon: \"graduation-cap\",\n    subcategories: [\n      { id: \"private_tutor\", nameEn: \"Private Tutor\", nameAr: \"مدرس خصوصي\" },\n      { id: \"translator\", nameEn: \"Language Translator\", nameAr: \"ترجمة لغات\" },\n      { id: \"sign_language\", nameEn: \"Sign Language\", nameAr: \"لغة الإشارة\" },\n    ],\n  },\n  art: {\n    id: \"art\",\n    nameEn: \"Art\",\n    nameAr: \"الفن\",\n    colorHex: \"#3B82F6\",\n    icon: \"palette\",\n    subcategories: [\n      { id: \"drawing\", nameEn: \"Drawing\", nameAr: \"الرسم\" },\n      { id: \"painting\", nameEn: \"Painting\", nameAr: \"الطلاء\" },\n      { id: \"photography\", nameEn: \"Photography\", nameAr: \"التصوير\" },\n      { id: \"digital_art\", nameEn: \"Digital Art\", nameAr: \"الفن الرقمي\" },\n    ],\n  },\n  construction: {\n    id: \"construction\",\n    nameEn: \"Construction\",\n    nameAr: \"عمال المقاولات\",\n    colorHex: \"#EF4444\",\n    icon: \"hard-hat\",\n    subcategories: [\n      { id: \"carpenter\", nameEn: \"Carpenter\", nameAr: \"النجار\" },\n      { id: \"blacksmith\", nameEn: \"Blacksmith\", nameAr: \"الحداد\" },\n      { id: \"electrician\", nameEn: \"Electrician\", nameAr: \"الكهربائي\" },\n      { id: \"plumber\", nameEn: \"Plumber\", nameAr: \"السباك\" },\n    ],\n  },\n  special: {\n    id: \"special\",\n    nameEn: \"Special Services\",\n    nameAr: \"فئة خاصة\",\n    colorHex: \"#EAB308\",\n    icon: \"star\",\n    subcategories: [\n      { id: \"package_delivery\", nameEn: \"Package Delivery\", nameAr: \"توصيل الطرود واستلامها\" },\n      { id: \"furniture_moving\", nameEn: \"Furniture Moving\", nameAr: \"نقل العفش\" },\n      { id: \"car_washing\", nameEn: \"Car Washing\", nameAr: \"غسيل السيارات\" },\n      { id: \"home_barber\", nameEn: \"Home Barber\", nameAr: \"حلاق منزلي\" },\n    ],\n  },\n  other: {\n    id: \"other\",\n    nameEn: \"Other\",\n    nameAr: \"أخرى\",\n    colorHex: \"#6B7280\",\n    icon: \"more-horizontal\",\n    subcategories: [],\n  },\n} as const;\n\nexport type TaskCategoryId = keyof typeof TASK_CATEGORIES_WITH_SUBS;\n\n// All valid task categories (subcategory IDs + \"other\")\nexport const TASK_CATEGORIES = [\n  \"model\",\n  \"makeup_artist\",\n  \"hair_stylist\",\n  \"clothing_designer\",\n  \"private_tutor\",\n  \"translator\",\n  \"sign_language\",\n  \"drawing\",\n  \"painting\",\n  \"photography\",\n  \"digital_art\",\n  \"carpenter\",\n  \"blacksmith\",\n  \"electrician\",\n  \"plumber\",\n  \"package_delivery\",\n  \"furniture_moving\",\n  \"car_washing\",\n  \"home_barber\",\n  \"other\",\n] as const;\n\nexport type TaskCategory = typeof TASK_CATEGORIES[number];\n\nexport const getCategoryInfo = (categoryId: string): { mainCategory: TaskCategoryId; subcategory?: typeof TASK_CATEGORIES_WITH_SUBS[TaskCategoryId]['subcategories'][number] } | null => {\n  if (categoryId === 'other') {\n    return { mainCategory: 'other' };\n  }\n  \n  for (const [mainId, cat] of Object.entries(TASK_CATEGORIES_WITH_SUBS)) {\n    const sub = cat.subcategories.find(s => s.id === categoryId);\n    if (sub) {\n      return { mainCategory: mainId as TaskCategoryId, subcategory: sub };\n    }\n  }\n  \n  return null;\n};\n\n// Professional categories with colors (for professional badges)\nexport const PROFESSIONAL_CATEGORIES = {\n  beauty_fashion: {\n    id: \"beauty_fashion\",\n    nameEn: \"Beauty & Fashion\",\n    nameAr: \"الجمال والموضة\",\n    colorHex: \"#EC4899\",\n    roles: [\n      { slug: \"model\", nameEn: \"Model\", nameAr: \"مودل\" },\n      { slug: \"makeup_artist\", nameEn: \"Makeup Artist\", nameAr: \"ميكب ارتست\" },\n      { slug: \"hair_stylist\", nameEn: \"Hair Stylist\", nameAr: \"مصففة الشعر\" },\n      { slug: \"clothing_designer\", nameEn: \"Clothing Designer\", nameAr: \"تصميم الملابس\" },\n    ],\n  },\n  teaching_education: {\n    id: \"teaching_education\",\n    nameEn: \"Teaching & Education\",\n    nameAr: \"التدريس والتعليم\",\n    colorHex: \"#22C55E\",\n    roles: [\n      { slug: \"private_tutor\", nameEn: \"Private Tutor\", nameAr: \"مدرس خصوصي\" },\n      { slug: \"translator\", nameEn: \"Language Translator\", nameAr: \"ترجمة لغات\" },\n      { slug: \"sign_language\", nameEn: \"Sign Language\", nameAr: \"لغة الإشارة\" },\n    ],\n  },\n  art: {\n    id: \"art\",\n    nameEn: \"Art\",\n    nameAr: \"الفن\",\n    colorHex: \"#3B82F6\",\n    roles: [\n      { slug: \"drawing\", nameEn: \"Drawing\", nameAr: \"الرسم\" },\n      { slug: \"painting\", nameEn: \"Painting\", nameAr: \"الطلاء\" },\n      { slug: \"photography\", nameEn: \"Photography\", nameAr: \"التصوير\" },\n      { slug: \"digital_art\", nameEn: \"Digital Art\", nameAr: \"الفن الرقمي\" },\n    ],\n  },\n  construction: {\n    id: \"construction\",\n    nameEn: \"Construction\",\n    nameAr: \"عمال المقاولات\",\n    colorHex: \"#EF4444\",\n    roles: [\n      { slug: \"carpenter\", nameEn: \"Carpenter\", nameAr: \"النجار\" },\n      { slug: \"blacksmith\", nameEn: \"Blacksmith\", nameAr: \"الحداد\" },\n      { slug: \"electrician\", nameEn: \"Electrician\", nameAr: \"الكهربائي\" },\n      { slug: \"plumber\", nameEn: \"Plumber\", nameAr: \"السباك\" },\n    ],\n  },\n  special: {\n    id: \"special\",\n    nameEn: \"Special Services\",\n    nameAr: \"فئة خاصة\",\n    colorHex: \"#EAB308\",\n    roles: [\n      { slug: \"package_delivery\", nameEn: \"Package Delivery\", nameAr: \"توصيل الطرود واستلامها\" },\n      { slug: \"furniture_moving\", nameEn: \"Furniture Moving\", nameAr: \"نقل العفش\" },\n      { slug: \"car_washing\", nameEn: \"Car Washing\", nameAr: \"غسيل السيارات\" },\n      { slug: \"home_barber\", nameEn: \"Home Barber\", nameAr: \"حلاق منزلي\" },\n    ],\n  },\n} as const;\n\nexport type ProfessionalCategoryId = keyof typeof PROFESSIONAL_CATEGORIES;\n\n// Extended types for user with professional roles\nexport type UserWithProfessionalRoles = User & {\n  professionalRoles?: (UserProfessionalRole & { role: ProfessionalRole })[];\n  availability?: TaskerAvailability[];\n  photos?: UserPhoto[];\n};\n","path":null,"size_bytes":27000,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        sm: \".375rem\",\n        md: \".5rem\",\n        lg: \".75rem\",\n        xl: \"1rem\",\n        \"2xl\": \"1.25rem\",\n        \"3xl\": \"1.5rem\",\n        \"4xl\": \"2rem\",\n      },\n      colors: {\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          dark: \"hsl(var(--primary-dark) / <alpha-value>)\",\n          light: \"hsl(var(--primary-light) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        success: {\n          DEFAULT: \"hsl(var(--success) / <alpha-value>)\",\n          foreground: \"hsl(var(--success-foreground) / <alpha-value>)\",\n        },\n        warning: {\n          DEFAULT: \"hsl(var(--warning) / <alpha-value>)\",\n          foreground: \"hsl(var(--warning-foreground) / <alpha-value>)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n        surface: {\n          DEFAULT: \"hsl(var(--surface) / <alpha-value>)\",\n          foreground: \"hsl(var(--surface-foreground) / <alpha-value>)\",\n        },\n        separator: \"hsl(var(--separator) / <alpha-value>)\",\n      },\n      fontFamily: {\n        sans: [\"Plus Jakarta Sans\", \"-apple-system\", \"BlinkMacSystemFont\", \"Segoe UI\", \"sans-serif\"],\n        display: [\"Plus Jakarta Sans\", \"-apple-system\", \"BlinkMacSystemFont\", \"sans-serif\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"SF Mono\", \"var(--font-mono)\"],\n      },\n      fontSize: {\n        '2xs': ['0.625rem', { lineHeight: '0.875rem' }],\n        'xs': ['0.75rem', { lineHeight: '1rem' }],\n        'sm': ['0.875rem', { lineHeight: '1.25rem' }],\n        'base': ['1rem', { lineHeight: '1.5rem' }],\n        'lg': ['1.125rem', { lineHeight: '1.625rem' }],\n        'xl': ['1.25rem', { lineHeight: '1.75rem' }],\n        '2xl': ['1.5rem', { lineHeight: '2rem' }],\n        '3xl': ['1.875rem', { lineHeight: '2.25rem' }],\n        '4xl': ['2.25rem', { lineHeight: '2.5rem' }],\n        '5xl': ['3rem', { lineHeight: '3.25rem' }],\n      },\n      boxShadow: {\n        'sm': '0 2px 8px -2px rgba(0,0,0,0.06)',\n        DEFAULT: '0 4px 16px -4px rgba(0,0,0,0.08)',\n        'md': '0 8px 24px -6px rgba(0,0,0,0.10)',\n        'lg': '0 16px 40px -8px rgba(0,0,0,0.12)',\n        'xl': '0 24px 56px -12px rgba(0,0,0,0.14)',\n        '2xl': '0 32px 72px -16px rgba(0,0,0,0.18)',\n        'glow': '0 0 32px rgba(59, 91, 255, 0.25)',\n        'glow-lg': '0 0 48px rgba(59, 91, 255, 0.35)',\n        'inner-glow': 'inset 0 1px 0 rgba(255,255,255,0.1)',\n      },\n      backdropBlur: {\n        'xs': '2px',\n        '2xl': '24px',\n        '3xl': '40px',\n        '4xl': '64px',\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n        \"slide-up\": {\n          from: { transform: \"translateY(100%)\", opacity: \"0\" },\n          to: { transform: \"translateY(0)\", opacity: \"1\" },\n        },\n        \"slide-down\": {\n          from: { transform: \"translateY(-20px)\", opacity: \"0\" },\n          to: { transform: \"translateY(0)\", opacity: \"1\" },\n        },\n        \"slide-in-right\": {\n          from: { transform: \"translateX(100%)\", opacity: \"0\" },\n          to: { transform: \"translateX(0)\", opacity: \"1\" },\n        },\n        \"slide-in-left\": {\n          from: { transform: \"translateX(-100%)\", opacity: \"0\" },\n          to: { transform: \"translateX(0)\", opacity: \"1\" },\n        },\n        \"fade-in\": {\n          from: { opacity: \"0\" },\n          to: { opacity: \"1\" },\n        },\n        \"fade-out\": {\n          from: { opacity: \"1\" },\n          to: { opacity: \"0\" },\n        },\n        \"scale-in\": {\n          from: { transform: \"scale(0.95)\", opacity: \"0\" },\n          to: { transform: \"scale(1)\", opacity: \"1\" },\n        },\n        \"scale-out\": {\n          from: { transform: \"scale(1)\", opacity: \"1\" },\n          to: { transform: \"scale(0.95)\", opacity: \"0\" },\n        },\n        \"pulse-slow\": {\n          \"0%, 100%\": { opacity: \"1\" },\n          \"50%\": { opacity: \"0.7\" },\n        },\n        \"bounce-soft\": {\n          \"0%, 100%\": { transform: \"translateY(0)\" },\n          \"50%\": { transform: \"translateY(-4px)\" },\n        },\n        \"float\": {\n          \"0%, 100%\": { transform: \"translateY(0)\" },\n          \"50%\": { transform: \"translateY(-8px)\" },\n        },\n        \"glow-pulse\": {\n          \"0%, 100%\": { boxShadow: \"0 0 24px rgba(59, 91, 255, 0.3)\" },\n          \"50%\": { boxShadow: \"0 0 48px rgba(59, 91, 255, 0.5)\" },\n        },\n        spin: {\n          from: { transform: \"rotate(0deg)\" },\n          to: { transform: \"rotate(360deg)\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"slide-up\": \"slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1)\",\n        \"slide-down\": \"slide-down 0.4s cubic-bezier(0.16, 1, 0.3, 1)\",\n        \"slide-in-right\": \"slide-in-right 0.4s cubic-bezier(0.16, 1, 0.3, 1)\",\n        \"slide-in-left\": \"slide-in-left 0.4s cubic-bezier(0.16, 1, 0.3, 1)\",\n        \"fade-in\": \"fade-in 0.3s ease-out forwards\",\n        \"fade-out\": \"fade-out 0.3s ease-out forwards\",\n        \"scale-in\": \"scale-in 0.25s cubic-bezier(0.16, 1, 0.3, 1)\",\n        \"scale-out\": \"scale-out 0.2s ease-in\",\n        \"pulse-slow\": \"pulse-slow 2s ease-in-out infinite\",\n        \"bounce-soft\": \"bounce-soft 1.5s ease-in-out infinite\",\n        \"float\": \"float 3s ease-in-out infinite\",\n        \"glow-pulse\": \"glow-pulse 2s ease-in-out infinite\",\n        spin: \"spin 1s linear infinite\",\n      },\n      spacing: {\n        'safe-top': 'env(safe-area-inset-top)',\n        'safe-bottom': 'env(safe-area-inset-bottom)',\n        'safe-left': 'env(safe-area-inset-left)',\n        'safe-right': 'env(safe-area-inset-right)',\n        '18': '4.5rem',\n        '22': '5.5rem',\n      },\n      transitionTimingFunction: {\n        'spring': 'cubic-bezier(0.16, 1, 0.3, 1)',\n        'bounce': 'cubic-bezier(0.34, 1.56, 0.64, 1)',\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":9128,"size_tokens":null},"attached_assets/README_1764551013653.md":{"content":"<div align=\"center\">\n<img width=\"1200\" height=\"475\" alt=\"GHBanner\" src=\"https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6\" />\n</div>\n\n# Run and deploy your AI Studio app\n\nThis contains everything you need to run your app locally.\n\nView your app in AI Studio: https://ai.studio/apps/drive/187WPEsnjiS8YbUtISI8kLPtbAEC3TP0E\n\n## Run Locally\n\n**Prerequisites:**  Node.js\n\n\n1. Install dependencies:\n   `npm install`\n2. Set the `GEMINI_API_KEY` in [.env.local](.env.local) to your Gemini API key\n3. Run the app:\n   `npm run dev`\n","path":null,"size_bytes":553,"size_tokens":null},"client/src/App.tsx":{"content":"import { Suspense, lazy, memo, useState, useEffect } from \"react\";\nimport { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AppProvider, useApp } from \"@/context/AppContext\";\nimport { BottomNav } from \"@/components/layout/BottomNav\";\nimport { AnimatePresence, motion } from \"framer-motion\";\nimport { useTranslation } from \"react-i18next\";\nimport { useLocation as useLocationHook } from \"@/hooks/useLocation\";\nimport ComingSoon from \"@/components/ComingSoon\";\n\nconst WelcomeScreen = lazy(() => import(\"@/pages/WelcomeScreen\"));\nconst SelectRoleScreen = lazy(() => import(\"@/pages/SelectRoleScreen\"));\nconst TaskerTypeScreen = lazy(() => import(\"@/pages/TaskerTypeScreen\"));\nconst RegisterScreen = lazy(() => import(\"@/pages/RegisterScreen\"));\nconst LoginScreen = lazy(() => import(\"@/pages/LoginScreen\"));\nconst HomeScreen = lazy(() => import(\"@/pages/HomeScreen\"));\nconst TasksFeedScreen = lazy(() => import(\"@/pages/TasksFeedScreen\"));\nconst MyTasksScreen = lazy(() => import(\"@/pages/MyTasksScreen\"));\nconst TaskDetailsScreen = lazy(() => import(\"@/pages/TaskDetailsScreen\"));\nconst PostTaskScreen = lazy(() => import(\"@/pages/PostTaskScreen\"));\nconst WalletScreen = lazy(() => import(\"@/pages/WalletScreen\"));\nconst SearchTaskersScreen = lazy(() => import(\"@/pages/SearchTaskersScreen\"));\nconst ProfileScreen = lazy(() => import(\"@/pages/ProfileScreen\"));\nconst ChatScreen = lazy(() => import(\"@/pages/ChatScreen\"));\nconst ConversationsScreen = lazy(() => import(\"@/pages/ConversationsScreen\"));\nconst NotificationScreen = lazy(() => import(\"@/pages/NotificationScreen\"));\nconst SettingsScreen = lazy(() => import(\"@/pages/SettingsScreen\"));\nconst MapScreen = lazy(() => import(\"@/pages/MapScreen\"));\nconst EditProfileScreen = lazy(() => import(\"@/pages/EditProfileScreen\"));\nconst SavedTasksScreen = lazy(() => import(\"@/pages/SavedTasksScreen\"));\nconst HelpScreen = lazy(() => import(\"@/pages/HelpScreen\"));\nconst PrivacyPolicyScreen = lazy(() => import(\"@/pages/PrivacyPolicyScreen\"));\nconst TermsScreen = lazy(() => import(\"@/pages/TermsScreen\"));\nconst VerifyIdentityScreen = lazy(() => import(\"@/pages/VerifyIdentityScreen\"));\nconst PaymentScreen = lazy(() => import(\"@/pages/PaymentScreen\"));\nconst DirectRequestsScreen = lazy(() => import(\"@/pages/DirectRequestsScreen\"));\nconst MyDirectRequestsScreen = lazy(() => import(\"@/pages/MyDirectRequestsScreen\"));\nconst CategoryBrowserScreen = lazy(() => import(\"@/pages/CategoryBrowserScreen\"));\nconst AdminDashboard = lazy(() => import(\"@/pages/AdminDashboard\"));\nconst PendingApprovalScreen = lazy(() => import(\"@/pages/PendingApprovalScreen\"));\nconst NotFound = lazy(() => import(\"@/pages/not-found\"));\n\nconst PageLoader = memo(function PageLoader() {\n  const { t } = useTranslation();\n  \n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"min-h-screen flex items-center justify-center bg-background\"\n    >\n      <div className=\"flex flex-col items-center gap-4\">\n        <motion.div\n          animate={{ rotate: 360 }}\n          transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n          className=\"w-10 h-10 border-3 border-primary border-t-transparent rounded-full\"\n        />\n        <motion.p\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n          className=\"text-muted-foreground text-sm\"\n        >\n          {t('common.loading')}\n        </motion.p>\n      </div>\n    </motion.div>\n  );\n});\n\nconst UnauthenticatedRoutes = memo(function UnauthenticatedRoutes() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={LoginScreen} />\n      <Route path=\"/role\" component={SelectRoleScreen} />\n      <Route path=\"/tasker-type\" component={TaskerTypeScreen} />\n      <Route path=\"/register\" component={RegisterScreen} />\n      <Route path=\"/login\" component={LoginScreen} />\n      <Route component={LoginScreen} />\n    </Switch>\n  );\n});\n\nconst AuthenticatedRoutes = memo(function AuthenticatedRoutes() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={HomeScreen} />\n      <Route path=\"/home\" component={HomeScreen} />\n      <Route path=\"/tasks-feed\" component={TasksFeedScreen} />\n      <Route path=\"/my-tasks\" component={MyTasksScreen} />\n      <Route path=\"/task/:id\" component={TaskDetailsScreen} />\n      <Route path=\"/task/:id/payment\" component={PaymentScreen} />\n      <Route path=\"/post-task/:step\" component={PostTaskScreen} />\n      <Route path=\"/task/:id/edit\" component={PostTaskScreen} />\n      <Route path=\"/wallet\" component={WalletScreen} />\n      <Route path=\"/search-taskers\" component={SearchTaskersScreen} />\n      <Route path=\"/profile\" component={ProfileScreen} />\n      <Route path=\"/profile/:userId\" component={ProfileScreen} />\n      <Route path=\"/profile/edit\" component={EditProfileScreen} />\n      <Route path=\"/chat/:taskId\" component={ChatScreen} />\n      <Route path=\"/messages\" component={ConversationsScreen} />\n      <Route path=\"/notifications\" component={NotificationScreen} />\n      <Route path=\"/settings\" component={SettingsScreen} />\n      <Route path=\"/map\" component={MapScreen} />\n      <Route path=\"/saved\" component={SavedTasksScreen} />\n      <Route path=\"/help\" component={HelpScreen} />\n      <Route path=\"/privacy\" component={PrivacyPolicyScreen} />\n      <Route path=\"/terms\" component={TermsScreen} />\n      <Route path=\"/verify\" component={VerifyIdentityScreen} />\n      <Route path=\"/direct-requests\" component={DirectRequestsScreen} />\n      <Route path=\"/my-direct-requests\" component={MyDirectRequestsScreen} />\n      <Route path=\"/categories\" component={CategoryBrowserScreen} />\n      <Route path=\"/admin\" component={AdminDashboard} />\n      <Route path=\"/tasker-type\" component={TaskerTypeScreen} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n});\n\nconst AppContent = memo(function AppContent() {\n  const { isAuthenticated, isLoading, user } = useApp();\n  const { isInRiyadh, isLoading: locationLoading, checkLocation } = useLocationHook();\n  const [hasCheckedLocation, setHasCheckedLocation] = useState(() => {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('isInRiyadh') !== null;\n    }\n    return false;\n  });\n\n  useEffect(() => {\n    if (!hasCheckedLocation && isAuthenticated && !locationLoading) {\n      checkLocation();\n      setHasCheckedLocation(true);\n    }\n  }, [hasCheckedLocation, isAuthenticated, locationLoading, checkLocation]);\n\n  if (isLoading) {\n    return <PageLoader />;\n  }\n\n  if (isAuthenticated && hasCheckedLocation && isInRiyadh === false) {\n    return <ComingSoon onNotifyMe={() => {\n      localStorage.setItem('notifyWhenAvailable', 'true');\n    }} />;\n  }\n\n  const isPendingTasker = isAuthenticated && \n    user?.role === 'tasker' && \n    user?.verificationStatus === 'pending';\n\n  return (\n    <div className=\"min-h-screen bg-background text-foreground overflow-x-hidden\">\n      <Suspense fallback={<PageLoader />}>\n        <AnimatePresence mode=\"wait\">\n          {isAuthenticated ? (\n            isPendingTasker ? <PendingApprovalScreen /> : <AuthenticatedRoutes />\n          ) : (\n            <UnauthenticatedRoutes />\n          )}\n        </AnimatePresence>\n      </Suspense>\n      {isAuthenticated && !isPendingTasker && <BottomNav />}\n      <Toaster />\n    </div>\n  );\n});\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <AppProvider>\n          <AppContent />\n        </AppProvider>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":7815,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/MapScreen.tsx":{"content":"import { useEffect, useRef, useState, memo, useCallback } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useQuery } from '@tanstack/react-query';\nimport { cn } from '@/lib/utils';\nimport { LoadingSpinner } from '@/components/ui/animated';\nimport { ArrowLeft, Search, List, MapPin, Clock, X, DollarSign } from 'lucide-react';\nimport type { TaskWithDetails } from '@shared/schema';\n\ndeclare global {\n  interface Window {\n    L: any;\n  }\n}\n\nconst MapScreen = memo(function MapScreen() {\n  const [, setLocation] = useLocation();\n  const mapRef = useRef<HTMLDivElement>(null);\n  const mapInstanceRef = useRef<any>(null);\n  const [selectedTask, setSelectedTask] = useState<TaskWithDetails | null>(null);\n\n  const { data: tasks, isLoading, error } = useQuery<TaskWithDetails[]>({\n    queryKey: ['/api/tasks/available'],\n  });\n\n  useEffect(() => {\n    if (!mapRef.current || !window.L) return;\n\n    const defaultCenter: [number, number] = [40.7128, -74.0060];\n    \n    if (!mapInstanceRef.current) {\n      mapInstanceRef.current = window.L.map(mapRef.current, {\n        zoomControl: false,\n      }).setView(defaultCenter, 13);\n\n      window.L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {\n        attribution: '',\n        maxZoom: 19,\n      }).addTo(mapInstanceRef.current);\n\n      window.L.control.zoom({\n        position: 'bottomright'\n      }).addTo(mapInstanceRef.current);\n    }\n\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove();\n        mapInstanceRef.current = null;\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!mapInstanceRef.current || !tasks || !window.L) return;\n\n    mapInstanceRef.current.eachLayer((layer: any) => {\n      if (layer instanceof window.L.Marker) {\n        mapInstanceRef.current.removeLayer(layer);\n      }\n    });\n\n    tasks.forEach((task) => {\n      const lat = task.latitude ? parseFloat(String(task.latitude)) : 40.7128 + (Math.random() - 0.5) * 0.05;\n      const lng = task.longitude ? parseFloat(String(task.longitude)) : -74.0060 + (Math.random() - 0.5) * 0.05;\n      \n      const customIcon = window.L.divIcon({\n        className: 'custom-marker',\n        html: `<div class=\"custom-marker-pin\"></div>`,\n        iconSize: [20, 20],\n        iconAnchor: [10, 10],\n      });\n\n      const marker = window.L.marker([lat, lng], { icon: customIcon })\n        .addTo(mapInstanceRef.current);\n\n      marker.on('click', () => {\n        setSelectedTask(task);\n      });\n    });\n  }, [tasks]);\n\n  const formatCurrency = useCallback((amount: number | string) => {\n    const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(num);\n  }, []);\n\n  return (\n    <div className=\"min-h-screen relative bg-background\">\n      <motion.div \n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"absolute top-0 left-0 right-0 z-20 p-4 pt-safe flex items-center gap-4\"\n      >\n        <motion.button \n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={() => window.history.back()}\n          className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass shadow-lg\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-5 h-5\" />\n        </motion.button>\n        \n        <div className=\"flex-1\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground\" />\n            <input\n              type=\"search\"\n              placeholder=\"Search location...\"\n              className=\"w-full h-11 pl-12 pr-4 rounded-2xl glass text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all shadow-lg\"\n              data-testid=\"input-search-location\"\n            />\n          </div>\n        </div>\n        \n        <Link href=\"/tasks-feed\">\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass shadow-lg\"\n            data-testid=\"button-list-view\"\n          >\n            <List className=\"w-5 h-5\" />\n          </motion.button>\n        </Link>\n      </motion.div>\n\n      {isLoading || error ? (\n        <div className=\"h-screen flex items-center justify-center bg-gradient-to-b from-background to-primary/5\">\n          <div className=\"text-center\">\n            {isLoading ? (\n              <>\n                <LoadingSpinner size=\"lg\" className=\"mx-auto mb-4\" />\n                <p className=\"text-muted-foreground font-medium\">Loading map...</p>\n              </>\n            ) : (\n              <>\n                <div className=\"w-16 h-16 rounded-3xl gradient-primary flex items-center justify-center mb-4 mx-auto shadow-lg\">\n                  <MapPin className=\"w-8 h-8 text-white\" />\n                </div>\n                <h3 className=\"font-bold text-foreground mb-2\">Map unavailable</h3>\n                <p className=\"text-muted-foreground text-sm\">Please try again later</p>\n              </>\n            )}\n          </div>\n        </div>\n      ) : (\n        <div ref={mapRef} className=\"h-screen w-full\" />\n      )}\n\n      <AnimatePresence>\n        {selectedTask && (\n          <motion.div \n            initial={{ opacity: 0, y: 100 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 100 }}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n            className=\"absolute bottom-0 left-0 right-0 z-20 p-4 pb-safe\"\n          >\n            <Link href={`/task/${selectedTask.id}`}>\n              <motion.div \n                whileTap={{ scale: 0.98 }}\n                className=\"glass-premium p-5 rounded-3xl shadow-2xl cursor-pointer\"\n                data-testid={`task-preview-${selectedTask.id}`}\n              >\n                <div className=\"flex items-start justify-between mb-3\">\n                  <div>\n                    <span className=\"text-[10px] font-bold text-primary uppercase tracking-widest\">\n                      {selectedTask.category}\n                    </span>\n                    <h3 className=\"text-lg font-bold text-foreground\">{selectedTask.title}</h3>\n                  </div>\n                  <motion.button \n                    whileHover={{ scale: 1.1 }}\n                    whileTap={{ scale: 0.9 }}\n                    onClick={(e) => { e.preventDefault(); e.stopPropagation(); setSelectedTask(null); }}\n                    className=\"w-8 h-8 flex items-center justify-center rounded-full glass-button\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </motion.button>\n                </div>\n                <p className=\"text-sm text-muted-foreground line-clamp-2 mb-4\">{selectedTask.description}</p>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-4 text-xs font-bold text-muted-foreground\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <MapPin className=\"w-4 h-4 text-primary\" />\n                      {selectedTask.distance || selectedTask.location}\n                    </div>\n                    <div className=\"flex items-center gap-1.5\">\n                      <Clock className=\"w-4 h-4 text-primary\" />\n                      {selectedTask.time}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-1 bg-primary/15 px-3 py-1.5 rounded-xl\">\n                    <DollarSign className=\"w-4 h-4 text-primary\" />\n                    <span className=\"font-extrabold text-lg text-primary\">\n                      {formatCurrency(selectedTask.budget).replace('$', '')}\n                    </span>\n                  </div>\n                </div>\n              </motion.div>\n            </Link>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n});\n\nexport default MapScreen;\n","path":null,"size_bytes":8250,"size_tokens":null},"attached_assets/SplashScreen_1764551029324.tsx":{"content":"\nimport React from 'react';\n\nexport const SplashScreen: React.FC = () => {\n  return (\n    <div className=\"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background-light dark:bg-background-dark transition-colors duration-500\">\n      <div className=\"relative flex flex-col items-center\">\n        <div className=\"w-32 h-32 bg-primary/10 rounded-full flex items-center justify-center mb-8 animate-pulse-slow relative\">\n           <div className=\"absolute inset-0 bg-primary/20 rounded-full animate-ping opacity-20\"></div>\n           <span className=\"material-symbols-outlined text-7xl text-primary relative z-10\">task_alt</span>\n        </div>\n        \n        <h1 className=\"text-4xl font-extrabold text-text-primary dark:text-text-primary-dark tracking-tight animate-fade-in\">\n          TaskField\n        </h1>\n        <p className=\"mt-4 text-text-secondary dark:text-text-secondary-dark font-medium animate-slide-up opacity-0\" style={{animationDelay: '0.3s', animationFillMode: 'forwards'}}>\n          Your community marketplace\n        </p>\n      </div>\n\n      <div className=\"absolute bottom-12 flex flex-col items-center gap-3 opacity-0 animate-fade-in\" style={{animationDelay: '0.8s', animationFillMode: 'forwards'}}>\n        <div className=\"w-8 h-8 border-3 border-gray-200 border-t-primary rounded-full animate-spin\"></div>\n      </div>\n    </div>\n  );\n};\n","path":null,"size_bytes":1379,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/pages/ProfileScreen.tsx":{"content":"import { memo, useCallback, useMemo, useState } from 'react';\nimport { Link, useParams, useLocation } from 'wouter';\nimport { motion } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery } from '@tanstack/react-query';\nimport { Skeleton } from '@/components/ui/animated';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { cn } from '@/lib/utils';\nimport { \n  ArrowLeft, Settings, Star, CheckCircle, Calendar, \n  MapPin, ChevronRight, User, ListTodo, HelpCircle, Edit3, Shield, Send\n} from 'lucide-react';\nimport { ProfessionalBadgeList } from '@/components/ProfessionalBadge';\nimport { AvailabilityCalendar } from '@/components/AvailabilityCalendar';\nimport { PortfolioGallery } from '@/components/PortfolioGallery';\nimport { DirectServiceRequestModal } from '@/components/DirectServiceRequestModal';\nimport type { User as UserType, ProfessionalRole, UserProfessionalRole, TaskerAvailability, UserPhoto } from '@shared/schema';\n\ntype UserWithExtended = UserType & {\n  professionalRoles?: (UserProfessionalRole & { role: ProfessionalRole })[];\n  availability?: TaskerAvailability[];\n  photos?: UserPhoto[];\n};\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: { staggerChildren: 0.06, delayChildren: 0.1 }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 16 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 }\n  }\n};\n\nconst ProfileScreen = memo(function ProfileScreen() {\n  const { userId } = useParams<{ userId?: string }>();\n  const [, setLocation] = useLocation();\n  const { user: currentUser, userRole } = useApp();\n  const { t, i18n } = useTranslation();\n  const [showRequestModal, setShowRequestModal] = useState(false);\n  \n  const isArabic = i18n.language === 'ar';\n  const isOwnProfile = !userId;\n  const targetUserId = userId || currentUser?.id;\n  \n  const { data: profileUser, isLoading } = useQuery<UserWithExtended>({\n    queryKey: ['/api/users', targetUserId],\n    queryFn: () => targetUserId \n      ? fetch(`/api/users/${targetUserId}`).then(res => res.json())\n      : Promise.resolve(currentUser),\n    enabled: !!targetUserId,\n  });\n\n  const user = profileUser || currentUser;\n  const isTasker = user?.role === 'tasker';\n\n  const getInitials = useCallback((name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n  }, []);\n\n  const stats = useMemo(() => [\n    { \n      labelKey: 'profile.rating', \n      value: user?.rating ? parseFloat(String(user.rating)).toFixed(1) : '0.0',\n      icon: Star,\n      color: 'text-warning',\n      bgColor: 'bg-gradient-to-br from-warning/20 to-warning/5'\n    },\n    { \n      labelKey: 'profile.tasksCompleted', \n      value: user?.completedTasks || 0,\n      icon: CheckCircle,\n      color: 'text-success',\n      bgColor: 'bg-gradient-to-br from-success/20 to-success/5'\n    },\n    { \n      labelKey: 'profile.memberSince', \n      value: user?.createdAt ? new Date(user.createdAt).getFullYear() : new Date().getFullYear(),\n      icon: Calendar,\n      color: 'text-primary',\n      bgColor: 'bg-gradient-to-br from-primary/20 to-primary/5'\n    },\n  ], [user]);\n\n  const menuItems = useMemo(() => {\n    const items = [\n      { icon: User, labelKey: 'profile.editProfile', path: '/profile/edit', testId: 'button-edit-profile-full' },\n      { icon: ListTodo, labelKey: userRole === 'tasker' ? 'tasks.assignedTasks' : 'tasks.myTasks', path: '/my-tasks', testId: 'button-my-tasks' },\n      { icon: HelpCircle, labelKey: 'settings.help', path: '/help', testId: 'button-help' },\n    ];\n    return items;\n  }, [userRole]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe px-5 py-5\">\n        <div className=\"flex items-center justify-center mb-8\">\n          <Skeleton className=\"w-28 h-28 rounded-full\" />\n        </div>\n        <Skeleton className=\"h-8 w-48 mx-auto mb-2 rounded-lg\" />\n        <Skeleton className=\"h-4 w-32 mx-auto mb-6 rounded-lg\" />\n        <div className=\"grid grid-cols-3 gap-3 mb-8\">\n          {[1, 2, 3].map((i) => (\n            <Skeleton key={i} className=\"h-28 rounded-2xl\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.4, scale: 1 }}\n          transition={{ duration: 1 }}\n          className=\"absolute top-20 -right-24 w-72 h-72 bg-gradient-to-br from-accent/25 to-accent/5 rounded-full blur-3xl rtl:-left-24 rtl:right-auto\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.25 }}\n          transition={{ delay: 0.3 }}\n          className=\"absolute bottom-60 -left-16 w-48 h-48 bg-gradient-to-tr from-primary/20 to-transparent rounded-full blur-3xl rtl:-right-16 rtl:left-auto\"\n        />\n      </div>\n\n      <motion.div \n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"relative z-10 px-5 py-5\"\n      >\n        <motion.div \n          variants={itemVariants}\n          className=\"flex items-center justify-between mb-6\"\n        >\n          {!isOwnProfile ? (\n            <motion.button \n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.92 }}\n              onClick={() => window.history.back()}\n              className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"w-5 h-5 text-foreground/80 rtl:rotate-180\" />\n            </motion.button>\n          ) : <div className=\"w-11\" />}\n          \n          <h1 className=\"text-xl font-bold text-foreground\">\n            {isOwnProfile ? t('profile.title') : t('profile.myProfile')}\n          </h1>\n          \n          {isOwnProfile ? (\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.92 }}\n              onClick={() => setLocation('/settings')}\n              className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n              data-testid=\"button-settings\"\n            >\n              <Settings className=\"w-5 h-5 text-foreground/80\" />\n            </motion.button>\n          ) : <div className=\"w-11\" />}\n        </motion.div>\n\n        <motion.div\n          variants={itemVariants}\n          className=\"flex flex-col items-center mb-7\"\n        >\n          <div className=\"relative mb-5\">\n            <motion.div\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              transition={{ type: \"spring\", stiffness: 200, damping: 20 }}\n              className=\"relative\"\n            >\n              <div className=\"absolute -inset-1 bg-gradient-to-br from-primary/40 to-accent/40 rounded-full blur-md\" />\n              <Avatar className=\"relative w-28 h-28 border-4 border-white/50 dark:border-white/20 shadow-2xl\">\n                <AvatarImage src={user?.avatar || undefined} alt={user?.name} />\n                <AvatarFallback className=\"gradient-primary text-white text-3xl font-bold\">\n                  {user?.name ? getInitials(user.name) : 'U'}\n                </AvatarFallback>\n              </Avatar>\n            </motion.div>\n            {isOwnProfile && (\n              <Link href=\"/profile/edit\">\n                <motion.button \n                  whileHover={{ scale: 1.1, rotate: 5 }}\n                  whileTap={{ scale: 0.9 }}\n                  className=\"absolute -bottom-1 -right-1 w-10 h-10 gradient-primary text-white rounded-2xl flex items-center justify-center shadow-lg shadow-primary/30 border-2 border-white/50 rtl:-left-1 rtl:right-auto\"\n                  data-testid=\"button-edit-profile\"\n                >\n                  <Edit3 className=\"w-4 h-4\" />\n                </motion.button>\n              </Link>\n            )}\n          </div>\n          \n          <h2 className=\"text-2xl font-extrabold text-foreground mb-1 tracking-tight\">{user?.name || t('common.guest')}</h2>\n          <p className=\"text-muted-foreground text-sm mb-4\">@{user?.username || 'guest'}</p>\n          \n          <motion.div\n            initial={{ scale: 0.8, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            transition={{ delay: 0.2 }}\n            className={cn(\n              \"flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider mb-3\",\n              userRole === 'tasker' \n                ? \"bg-success/15 text-success\" \n                : \"bg-primary/15 text-primary\"\n            )}\n          >\n            <Shield className=\"w-3.5 h-3.5\" />\n            {userRole === 'tasker' ? t('roles.tasker') : t('roles.client')}\n          </motion.div>\n          \n          {profileUser?.professionalRoles && profileUser.professionalRoles.length > 0 && (\n            <motion.div\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.25 }}\n            >\n              <ProfessionalBadgeList roles={profileUser.professionalRoles} size=\"md\" maxDisplay={4} />\n            </motion.div>\n          )}\n        </motion.div>\n\n        <motion.div \n          variants={itemVariants}\n          className=\"grid grid-cols-3 gap-3 mb-6\"\n        >\n          {stats.map((stat, index) => {\n            const Icon = stat.icon;\n            return (\n              <motion.div\n                key={stat.labelKey}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.25 + index * 0.05 }}\n                className=\"glass rounded-[20px] p-4 text-center\"\n              >\n                <div className={cn(\"w-9 h-9 rounded-xl mx-auto mb-2.5 flex items-center justify-center\", stat.bgColor)}>\n                  <Icon className={cn(\"w-4 h-4\", stat.color)} />\n                </div>\n                <p className=\"text-xl font-extrabold text-foreground\">{stat.value}</p>\n                <p className=\"text-[10px] text-muted-foreground font-semibold uppercase tracking-wider mt-0.5\">{t(stat.labelKey)}</p>\n              </motion.div>\n            );\n          })}\n        </motion.div>\n\n        {user?.bio && (\n          <motion.div\n            variants={itemVariants}\n            className=\"glass rounded-[20px] p-5 mb-4\"\n          >\n            <h3 className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-2.5\">{t('profile.about')}</h3>\n            <p className=\"text-foreground leading-relaxed text-sm\">{user.bio}</p>\n          </motion.div>\n        )}\n\n        {user?.location && (\n          <motion.div\n            variants={itemVariants}\n            className=\"glass rounded-[20px] p-4 mb-5\"\n          >\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center\">\n                <MapPin className=\"w-5 h-5 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-[10px] text-muted-foreground font-semibold uppercase tracking-wider\">{t('tasks.location')}</p>\n                <p className=\"font-bold text-foreground\">{user.location}</p>\n              </div>\n            </div>\n          </motion.div>\n        )}\n\n        {!isOwnProfile && isTasker && userRole === 'client' && (\n          <motion.div\n            variants={itemVariants}\n            className=\"mb-5\"\n          >\n            <motion.button\n              whileHover={{ scale: 1.01 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => setShowRequestModal(true)}\n              className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-lg shadow-primary/25 flex items-center justify-center gap-3\"\n              data-testid=\"button-request-service\"\n            >\n              <Send className=\"w-5 h-5\" />\n              {isArabic ? 'اطلب خدمة مباشرة' : 'Request Direct Service'}\n            </motion.button>\n          </motion.div>\n        )}\n\n        {isTasker && targetUserId && (\n          <motion.div\n            variants={itemVariants}\n            className=\"mb-5\"\n          >\n            <h3 className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-wider px-1 mb-3\">\n              {t('portfolio.title', 'Portfolio')}\n            </h3>\n            <PortfolioGallery userId={targetUserId} isEditable={isOwnProfile} />\n          </motion.div>\n        )}\n\n        {isTasker && targetUserId && (\n          <motion.div\n            variants={itemVariants}\n            className=\"mb-5\"\n          >\n            <h3 className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-wider px-1 mb-3\">\n              {t('availability.title', 'Availability')}\n            </h3>\n            <AvailabilityCalendar userId={targetUserId} isEditable={isOwnProfile} />\n          </motion.div>\n        )}\n\n        {isOwnProfile && (\n          <motion.div\n            variants={itemVariants}\n            className=\"space-y-2.5\"\n          >\n            <p className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-wider px-1 mb-2\">{t('wallet.quickActions')}</p>\n            {menuItems.map((item, index) => {\n              const Icon = item.icon;\n              return (\n                <motion.div\n                  key={item.testId}\n                  initial={{ opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ delay: 0.45 + index * 0.05 }}\n                >\n                  <Link href={item.path}>\n                    <motion.button \n                      whileHover={{ x: 4 }}\n                      whileTap={{ scale: 0.98 }}\n                      className=\"w-full glass rounded-[18px] font-semibold flex items-center justify-between p-4\"\n                      data-testid={item.testId}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary/15 to-primary/5 flex items-center justify-center\">\n                          <Icon className=\"w-4 h-4 text-primary\" />\n                        </div>\n                        <span className=\"text-foreground text-sm\">{t(item.labelKey)}</span>\n                      </div>\n                      <ChevronRight className=\"w-4 h-4 text-muted-foreground rtl:rotate-180\" />\n                    </motion.button>\n                  </Link>\n                </motion.div>\n              );\n            })}\n          </motion.div>\n        )}\n      </motion.div>\n\n      {profileUser && !isOwnProfile && isTasker && (\n        <DirectServiceRequestModal\n          isOpen={showRequestModal}\n          onClose={() => setShowRequestModal(false)}\n          tasker={profileUser}\n        />\n      )}\n    </div>\n  );\n});\n\nexport default ProfileScreen;\n","path":null,"size_bytes":15103,"size_tokens":null},"client/src/components/CategoryPicker.tsx":{"content":"import { useState, useCallback, memo, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { TASK_CATEGORIES_WITH_SUBS, type TaskCategoryId } from '@shared/schema';\nimport { \n  Sparkles, GraduationCap, Palette, HardHat, Star, MoreHorizontal,\n  ChevronDown, Check\n} from 'lucide-react';\nimport { useTranslation } from 'react-i18next';\n\ninterface CategoryPickerProps {\n  selected: string | null;\n  onSelect: (category: string) => void;\n}\n\nconst categoryIcons: Record<TaskCategoryId, typeof Sparkles> = {\n  beauty_fashion: Sparkles,\n  teaching_education: GraduationCap,\n  art: Palette,\n  construction: HardHat,\n  special: Star,\n  other: MoreHorizontal,\n};\n\nconst getAllSubcategoryIds = (): Set<string> => {\n  const ids = new Set<string>();\n  Object.values(TASK_CATEGORIES_WITH_SUBS).forEach(cat => {\n    cat.subcategories.forEach(sub => ids.add(sub.id));\n  });\n  return ids;\n};\n\nconst findCategoryForSelection = (selected: string | null): TaskCategoryId | null => {\n  if (!selected) return null;\n  \n  if (selected === 'other') return 'other';\n  \n  for (const [catId, cat] of Object.entries(TASK_CATEGORIES_WITH_SUBS)) {\n    if (cat.subcategories.some(sub => sub.id === selected)) {\n      return catId as TaskCategoryId;\n    }\n  }\n  \n  return null;\n};\n\nconst CategoryCard = memo(function CategoryCard({\n  categoryId,\n  category,\n  isExpanded,\n  selectedValue,\n  onToggleExpand,\n  onSelectCategory,\n}: {\n  categoryId: TaskCategoryId;\n  category: typeof TASK_CATEGORIES_WITH_SUBS[TaskCategoryId];\n  isExpanded: boolean;\n  selectedValue: string | null;\n  onToggleExpand: () => void;\n  onSelectCategory: (value: string) => void;\n}) {\n  const { i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  const Icon = categoryIcons[categoryId];\n  const name = isArabic ? category.nameAr : category.nameEn;\n  const hasSubcategories = category.subcategories.length > 0;\n  \n  const mainCategoryOfSelection = useMemo(() => findCategoryForSelection(selectedValue), [selectedValue]);\n  const isSelected = mainCategoryOfSelection === categoryId;\n  \n  const handleClick = useCallback(() => {\n    if (hasSubcategories) {\n      onToggleExpand();\n    } else {\n      onSelectCategory(categoryId);\n    }\n  }, [hasSubcategories, onToggleExpand, onSelectCategory, categoryId]);\n\n  return (\n    <motion.div\n      layout\n      className=\"overflow-visible\"\n    >\n      <motion.button\n        onClick={handleClick}\n        className={cn(\n          \"relative w-full overflow-hidden rounded-[24px] transition-all duration-300\",\n          \"backdrop-blur-2xl border border-white/10\",\n          isExpanded \n            ? \"bg-gradient-to-br from-white/15 to-white/5 shadow-2xl\" \n            : \"bg-gradient-to-br from-white/10 to-white/5 hover:from-white/15 hover:to-white/8\",\n          isSelected && !isExpanded && \"ring-2 ring-primary shadow-lg shadow-primary/20\"\n        )}\n        style={{\n          boxShadow: isExpanded \n            ? `0 20px 40px -15px ${category.colorHex}30` \n            : undefined,\n        }}\n        whileTap={{ scale: 0.98 }}\n        data-testid={`button-category-${categoryId}`}\n      >\n        <div \n          className=\"absolute inset-0 opacity-20\"\n          style={{\n            background: `linear-gradient(135deg, ${category.colorHex}40 0%, transparent 60%)`,\n          }}\n        />\n        \n        <div className=\"relative p-5\">\n          <div className=\"flex items-center gap-4\">\n            <div \n              className=\"w-14 h-14 rounded-2xl flex items-center justify-center shrink-0\"\n              style={{\n                background: `linear-gradient(135deg, ${category.colorHex}30 0%, ${category.colorHex}10 100%)`,\n                boxShadow: `0 8px 24px -8px ${category.colorHex}40`,\n              }}\n            >\n              <Icon \n                className=\"w-7 h-7\"\n                style={{ color: category.colorHex }}\n              />\n            </div>\n            \n            <div className=\"flex-1 text-start\">\n              <h3 className=\"text-lg font-bold text-foreground mb-0.5\">\n                {name}\n              </h3>\n              {hasSubcategories && (\n                <p className=\"text-xs text-muted-foreground\">\n                  {category.subcategories.length} {isArabic ? 'تصنيفات' : 'subcategories'}\n                </p>\n              )}\n            </div>\n            \n            {hasSubcategories ? (\n              <motion.div\n                animate={{ rotate: isExpanded ? 180 : 0 }}\n                transition={{ duration: 0.3 }}\n                className=\"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center\"\n              >\n                <ChevronDown className=\"w-5 h-5 text-muted-foreground\" />\n              </motion.div>\n            ) : isSelected ? (\n              <div \n                className=\"w-10 h-10 rounded-xl flex items-center justify-center\"\n                style={{ backgroundColor: `${category.colorHex}30` }}\n              >\n                <Check className=\"w-5 h-5\" style={{ color: category.colorHex }} />\n              </div>\n            ) : null}\n          </div>\n        </div>\n      </motion.button>\n      \n      <AnimatePresence>\n        {isExpanded && hasSubcategories && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ \n              height: { duration: 0.3, ease: [0.4, 0, 0.2, 1] },\n              opacity: { duration: 0.2 }\n            }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"pt-3 px-1\">\n              <div className=\"grid grid-cols-2 gap-2\">\n                {category.subcategories.map((sub, index) => {\n                  const isSubSelected = selectedValue === sub.id;\n                  const subName = isArabic ? sub.nameAr : sub.nameEn;\n                  \n                  return (\n                    <motion.button\n                      key={sub.id}\n                      initial={{ opacity: 0, y: 10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      transition={{ delay: index * 0.05 }}\n                      onClick={() => onSelectCategory(sub.id)}\n                      className={cn(\n                        \"relative p-4 rounded-2xl text-start transition-all\",\n                        \"backdrop-blur-xl border\",\n                        isSubSelected \n                          ? \"border-white/20 bg-white/15\" \n                          : \"border-white/5 bg-white/5 hover:bg-white/10\"\n                      )}\n                      style={{\n                        boxShadow: isSubSelected \n                          ? `0 8px 20px -8px ${category.colorHex}40, inset 0 0 0 1px ${category.colorHex}30` \n                          : undefined,\n                      }}\n                      whileTap={{ scale: 0.97 }}\n                      data-testid={`button-subcategory-${sub.id}`}\n                    >\n                      {isSubSelected && (\n                        <motion.div\n                          layoutId=\"subcategory-selected\"\n                          className=\"absolute inset-0 rounded-2xl\"\n                          style={{\n                            background: `linear-gradient(135deg, ${category.colorHex}20 0%, transparent 50%)`,\n                          }}\n                        />\n                      )}\n                      \n                      <div className=\"relative flex items-center gap-3\">\n                        <div \n                          className={cn(\n                            \"w-8 h-8 rounded-xl flex items-center justify-center transition-all\",\n                            isSubSelected ? \"scale-100\" : \"scale-90 opacity-70\"\n                          )}\n                          style={{\n                            backgroundColor: isSubSelected \n                              ? `${category.colorHex}30` \n                              : `${category.colorHex}15`,\n                          }}\n                        >\n                          {isSubSelected ? (\n                            <Check \n                              className=\"w-4 h-4\" \n                              style={{ color: category.colorHex }}\n                            />\n                          ) : (\n                            <div \n                              className=\"w-2 h-2 rounded-full\"\n                              style={{ backgroundColor: category.colorHex }}\n                            />\n                          )}\n                        </div>\n                        \n                        <span className={cn(\n                          \"font-semibold text-sm flex-1\",\n                          isSubSelected ? \"text-foreground\" : \"text-foreground/80\"\n                        )}>\n                          {subName}\n                        </span>\n                      </div>\n                    </motion.button>\n                  );\n                })}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n});\n\nexport const CategoryPicker = memo(function CategoryPicker({ \n  selected, \n  onSelect \n}: CategoryPickerProps) {\n  const [expandedCategory, setExpandedCategory] = useState<TaskCategoryId | null>(null);\n  \n  const handleToggleExpand = useCallback((categoryId: TaskCategoryId) => {\n    setExpandedCategory(prev => prev === categoryId ? null : categoryId);\n  }, []);\n  \n  const handleSelectCategory = useCallback((value: string) => {\n    onSelect(value);\n    setTimeout(() => setExpandedCategory(null), 200);\n  }, [onSelect]);\n\n  const categories = Object.entries(TASK_CATEGORIES_WITH_SUBS) as [TaskCategoryId, typeof TASK_CATEGORIES_WITH_SUBS[TaskCategoryId]][];\n\n  return (\n    <motion.div \n      className=\"space-y-3\"\n      layout\n    >\n      {categories.map(([categoryId, category]) => (\n        <CategoryCard\n          key={categoryId}\n          categoryId={categoryId}\n          category={category}\n          isExpanded={expandedCategory === categoryId}\n          selectedValue={selected}\n          onToggleExpand={() => handleToggleExpand(categoryId)}\n          onSelectCategory={handleSelectCategory}\n        />\n      ))}\n    </motion.div>\n  );\n});\n\nexport { findCategoryForSelection, getAllSubcategoryIds };\n","path":null,"size_bytes":10366,"size_tokens":null},"client/src/components/TaskCard.tsx":{"content":"import { memo, useCallback, useMemo } from 'react';\nimport { Link } from 'wouter';\nimport { motion } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { cn } from '@/lib/utils';\nimport { MapPin, Clock, Heart, DollarSign, ChevronRight } from 'lucide-react';\nimport type { TaskWithDetails } from '@shared/schema';\nimport { getCategoryInfo, TASK_CATEGORIES_WITH_SUBS } from '@shared/schema';\nimport { useTranslation } from 'react-i18next';\n\ninterface TaskCardProps {\n  task: TaskWithDetails;\n  showSaveButton?: boolean;\n  index?: number;\n}\n\nexport const TaskCard = memo(function TaskCard({ task, showSaveButton = true, index = 0 }: TaskCardProps) {\n  const { savedTaskIds, toggleSavedTask } = useApp();\n  const { i18n } = useTranslation();\n  const isSaved = savedTaskIds.includes(task.id);\n  const isArabic = i18n.language === 'ar';\n\n  const categoryDisplay = useMemo(() => {\n    const info = getCategoryInfo(task.category);\n    if (!info) return task.category;\n    \n    if (info.subcategory) {\n      return isArabic ? info.subcategory.nameAr : info.subcategory.nameEn;\n    }\n    \n    const mainCat = TASK_CATEGORIES_WITH_SUBS[info.mainCategory];\n    return isArabic ? mainCat.nameAr : mainCat.nameEn;\n  }, [task.category, isArabic]);\n\n  const categoryColor = useMemo(() => {\n    const info = getCategoryInfo(task.category);\n    if (!info) return '#6B7280';\n    return TASK_CATEGORIES_WITH_SUBS[info.mainCategory]?.colorHex || '#6B7280';\n  }, [task.category]);\n\n  const handleToggleSave = useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    toggleSavedTask(task.id);\n  }, [task.id, toggleSavedTask]);\n\n  const formatCurrency = useCallback((amount: number | string) => {\n    const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(num);\n  }, []);\n\n  const getStatusStyles = useCallback((status: string) => {\n    switch (status) {\n      case 'open': return 'bg-success/15 text-success';\n      case 'assigned': return 'bg-warning/15 text-warning';\n      case 'in_progress': return 'bg-primary/15 text-primary';\n      case 'completed': return 'bg-muted text-muted-foreground';\n      case 'cancelled': return 'bg-destructive/15 text-destructive';\n      default: return 'bg-muted text-muted-foreground';\n    }\n  }, []);\n\n  return (\n    <Link href={`/task/${task.id}`} data-testid={`task-card-${task.id}`}>\n      <motion.div \n        whileHover={{ y: -2 }}\n        whileTap={{ scale: 0.985 }}\n        transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n        className=\"glass rounded-[24px] p-5 relative cursor-pointer group\"\n      >\n        {showSaveButton && (\n          <motion.button \n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n            aria-label={isSaved ? \"Remove from saved\" : \"Save task\"}\n            onClick={handleToggleSave}\n            className=\"absolute top-4 right-4 w-9 h-9 flex items-center justify-center rounded-xl bg-white/60 dark:bg-white/10 backdrop-blur-sm z-10 transition-all\"\n            data-testid={`button-save-task-${task.id}`}\n          >\n            <Heart \n              className={cn(\n                \"w-[18px] h-[18px] transition-all duration-200\",\n                isSaved \n                  ? \"fill-destructive text-destructive\" \n                  : \"text-muted-foreground group-hover:text-foreground\"\n              )}\n            />\n          </motion.button>\n        )}\n\n        <div className=\"flex justify-between items-start mb-3 pr-10\">\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-1.5 flex-wrap\">\n              <span \n                className=\"px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wider\"\n                style={{\n                  backgroundColor: `${categoryColor}20`,\n                  color: categoryColor,\n                }}\n              >\n                {categoryDisplay}\n              </span>\n              <span className={cn(\n                \"px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wider\",\n                getStatusStyles(task.status)\n              )}>\n                {task.status.replace('_', ' ')}\n              </span>\n            </div>\n            <h3 className=\"text-lg font-bold text-foreground leading-snug pr-2\">\n              {task.title}\n            </h3>\n          </div>\n        </div>\n        \n        <p className=\"text-muted-foreground text-sm mb-4 line-clamp-2 leading-relaxed\">\n          {task.description}\n        </p>\n        \n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\n              <MapPin className=\"w-3.5 h-3.5 text-primary/70\" />\n              <span className=\"max-w-[90px] truncate font-medium\">{task.distance || task.location}</span>\n            </div>\n            <span className=\"text-muted-foreground/30\">|</span>\n            <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\n              <Clock className=\"w-3.5 h-3.5 text-primary/70\" />\n              <span className=\"font-medium\">{task.time}</span>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex items-center gap-1 font-bold text-base text-primary\">\n              <DollarSign className=\"w-4 h-4\" />\n              <span>{formatCurrency(task.budget).replace('$', '')}</span>\n            </div>\n            <ChevronRight className=\"w-4 h-4 text-muted-foreground/50 group-hover:text-primary group-hover:translate-x-0.5 transition-all\" />\n          </div>\n        </div>\n      </motion.div>\n    </Link>\n  );\n});\n","path":null,"size_bytes":5894,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"attached_assets/BottomNav_1764551029324.tsx":{"content":"\nimport React from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { useTranslation } from '../hooks/useTranslation';\nimport { useHaptic } from '../hooks/useHaptic';\n\nexport const BottomNav: React.FC = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const role = localStorage.getItem('userRole') || 'client';\n  const { t } = useTranslation();\n  const { trigger } = useHaptic();\n\n  const isActive = (path: string) => location.pathname === path;\n\n  // Define Nav items based on Role\n  const navItems = role === 'tasker' \n    ? [\n        { icon: 'dashboard', label: t.navHome, path: '/home' }, // Dashboard\n        { icon: 'list_alt', label: t.navTasks, path: '/tasks-feed' }, // Marketplace\n        { icon: 'account_balance_wallet', label: t.navWallet, path: '/wallet' },\n        { icon: 'person', label: t.navProfile, path: '/profile' },\n      ]\n    : [\n        { icon: 'home', label: t.navHome, path: '/home' }, // Dashboard\n        { icon: 'list', label: t.navMyTasks, path: '/my-tasks' }, // Posted Tasks\n        { icon: 'account_balance_wallet', label: t.navWallet, path: '/wallet' },\n        { icon: 'person', label: t.navProfile, path: '/profile' },\n      ];\n\n  // Define paths where the bottom navigation should be hidden\n  const hiddenPaths = [\n    '/', \n    '/role', \n    '/register', \n    '/settings',\n    '/wallet/withdraw',\n    '/wallet/add-card'\n  ];\n\n  // Check if current path matches exact hidden paths or starts with specific prefixes\n  const shouldHide = hiddenPaths.includes(location.pathname) || \n                     location.pathname.startsWith('/post-task') || \n                     location.pathname.startsWith('/task/') ||\n                     location.pathname.startsWith('/chat/');\n\n  if (shouldHide) {\n    return null;\n  }\n\n  const handleNav = (path: string) => {\n      if (location.pathname !== path) {\n          trigger(5); // Light tap\n          navigate(path);\n      }\n  };\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-surface/85 dark:bg-surface-dark/85 backdrop-blur-xl border-t border-gray-100 dark:border-gray-800/50 pb-safe pt-2 px-6 shadow-[0_-4px_30px_rgba(0,0,0,0.03)] z-40 transition-all duration-500\">\n      <div className=\"flex justify-between items-center h-16\">\n        {navItems.map((item) => (\n          <button\n            key={item.label}\n            onClick={() => handleNav(item.path)}\n            className={`flex flex-col items-center justify-center gap-1 w-16 group transition-all duration-300 active:scale-90`}\n          >\n            <div className={`relative p-1.5 rounded-2xl transition-all duration-500 ${isActive(item.path) ? 'bg-primary/10 -translate-y-1 shadow-[0_4px_12px_rgba(19,200,236,0.2)]' : 'hover:bg-gray-50 dark:hover:bg-white/5'}`}>\n                <span className={`material-symbols-outlined text-[26px] transition-all duration-300 ${\n                    isActive(item.path) \n                    ? 'material-symbols-filled text-primary scale-110' \n                    : 'text-text-secondary dark:text-text-secondary-dark group-hover:text-primary/70'\n                }`}>\n                {item.icon}\n                </span>\n            </div>\n            <span className={`text-[10px] font-bold transition-all duration-300 ${\n                isActive(item.path) \n                ? 'text-primary opacity-100 translate-y-0' \n                : 'text-text-secondary dark:text-text-secondary-dark opacity-0 -translate-y-2 h-0 overflow-hidden'\n            }`}>\n                {item.label}\n            </span>\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n};\n","path":null,"size_bytes":3617,"size_tokens":null},"client/src/pages/PostTaskScreen.tsx":{"content":"import { useState, useEffect, memo, useCallback } from 'react';\nimport { useParams, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { FloatingInput } from '@/components/FloatingInput';\nimport { CategoryPicker } from '@/components/CategoryPicker';\nimport { DateTimePicker } from '@/components/DateTimePicker';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport { ArrowLeft, AlertCircle, Loader2, MapPin, CheckCircle2 } from 'lucide-react';\nimport type { TaskWithDetails } from '@shared/schema';\n\ninterface TaskFormData {\n  title: string;\n  description: string;\n  category: string;\n  budget: string;\n  location: string;\n  latitude: number | null;\n  longitude: number | null;\n  date: string;\n  time: string;\n}\n\nconst PostTaskScreen = memo(function PostTaskScreen() {\n  const { step } = useParams<{ step: string }>();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  const currentStep = parseInt(step || '1');\n  const isEditMode = window.location.pathname.includes('/edit');\n  const taskId = isEditMode ? window.location.pathname.split('/')[2] : null;\n  \n  const categoryFromUrl = new URLSearchParams(window.location.search).get('category');\n\n  const { data: existingTask } = useQuery<TaskWithDetails>({\n    queryKey: ['/api/tasks', taskId],\n    enabled: !!taskId && isEditMode,\n  });\n\n  const [formData, setFormData] = useState<TaskFormData>({\n    title: '',\n    description: '',\n    category: '',\n    budget: '',\n    location: '',\n    latitude: null,\n    longitude: null,\n    date: '',\n    time: '',\n  });\n\n  const [showDatePicker, setShowDatePicker] = useState(false);\n  const [showTimePicker, setShowTimePicker] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [locationStatus, setLocationStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');\n  const [locationError, setLocationError] = useState<string>('');\n\n  useEffect(() => {\n    if (existingTask && isEditMode) {\n      setFormData({\n        title: existingTask.title,\n        description: existingTask.description,\n        category: existingTask.category,\n        budget: String(existingTask.budget),\n        location: existingTask.location,\n        latitude: existingTask.latitude ? parseFloat(String(existingTask.latitude)) : null,\n        longitude: existingTask.longitude ? parseFloat(String(existingTask.longitude)) : null,\n        date: existingTask.date,\n        time: existingTask.time,\n      });\n      if (existingTask.location) {\n        setLocationStatus('success');\n      }\n    }\n  }, [existingTask, isEditMode]);\n\n  useEffect(() => {\n    if (categoryFromUrl && !isEditMode && !formData.category) {\n      setFormData(prev => ({ ...prev, category: categoryFromUrl }));\n    }\n  }, [categoryFromUrl, isEditMode, formData.category]);\n\n  const reverseGeocode = useCallback(async (latitude: number, longitude: number): Promise<string> => {\n    try {\n      const response = await fetch(\n        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=16&addressdetails=1`,\n        {\n          headers: {\n            'Accept-Language': 'en',\n          },\n        }\n      );\n      \n      if (!response.ok) {\n        throw new Error('Geocoding failed');\n      }\n      \n      const data = await response.json();\n      const address = data.address;\n      \n      const neighborhood = address.neighbourhood || address.suburb || address.district || address.quarter || '';\n      const city = address.city || address.town || address.municipality || address.county || '';\n      \n      if (neighborhood && city) {\n        return `${neighborhood}, ${city}`;\n      } else if (city) {\n        return city;\n      } else if (neighborhood) {\n        return neighborhood;\n      } else if (address.state) {\n        return address.state;\n      }\n      \n      return data.display_name?.split(',').slice(0, 2).join(',').trim() || 'Unknown location';\n    } catch (error) {\n      console.error('Reverse geocoding error:', error);\n      return 'Location found';\n    }\n  }, []);\n\n  const getCurrentLocation = useCallback(() => {\n    if (!navigator.geolocation) {\n      setLocationError('Geolocation is not supported by your browser');\n      setLocationStatus('error');\n      return;\n    }\n\n    setLocationStatus('loading');\n    setLocationError('');\n\n    navigator.geolocation.getCurrentPosition(\n      async (position) => {\n        const { latitude, longitude } = position.coords;\n        \n        const locationName = await reverseGeocode(latitude, longitude);\n        \n        setFormData(prev => ({\n          ...prev,\n          location: locationName,\n          latitude,\n          longitude,\n        }));\n        setLocationStatus('success');\n        if (errors.location) {\n          setErrors(prev => ({ ...prev, location: '' }));\n        }\n      },\n      (error) => {\n        let errorMessage = 'Unable to get your location';\n        switch (error.code) {\n          case error.PERMISSION_DENIED:\n            errorMessage = 'Location permission denied. Please enable it in your browser settings.';\n            break;\n          case error.POSITION_UNAVAILABLE:\n            errorMessage = 'Location information is unavailable.';\n            break;\n          case error.TIMEOUT:\n            errorMessage = 'Location request timed out.';\n            break;\n        }\n        setLocationError(errorMessage);\n        setLocationStatus('error');\n      },\n      {\n        enableHighAccuracy: true,\n        timeout: 10000,\n        maximumAge: 60000,\n      }\n    );\n  }, [errors.location, reverseGeocode]);\n\n  const createTaskMutation = useMutation({\n    mutationFn: async (data: TaskFormData) => {\n      const endpoint = isEditMode ? `/api/tasks/${taskId}` : '/api/tasks';\n      const method = isEditMode ? 'PATCH' : 'POST';\n      return apiRequest(method, endpoint, {\n        title: data.title,\n        description: data.description,\n        category: data.category,\n        budget: parseFloat(data.budget),\n        location: data.location,\n        latitude: data.latitude,\n        longitude: data.longitude,\n        date: data.date,\n        time: data.time,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      toast({ \n        title: isEditMode ? 'Task updated!' : 'Task posted!', \n        description: isEditMode ? 'Your changes have been saved' : 'Your task is now live' \n      });\n      setLocation('/my-tasks');\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Failed to save task', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const validateStep = useCallback((stepNum: number): boolean => {\n    const newErrors: Record<string, string> = {};\n    \n    if (stepNum === 1) {\n      if (!formData.category) newErrors.category = 'Please select a category';\n    } else if (stepNum === 2) {\n      if (!formData.title.trim()) newErrors.title = 'Title is required';\n      if (!formData.description.trim()) newErrors.description = 'Description is required';\n    } else if (stepNum === 3) {\n      if (!formData.budget) newErrors.budget = 'Budget is required';\n      if (!formData.location.trim()) newErrors.location = 'Location is required';\n      if (!formData.date) newErrors.date = 'Date is required';\n      if (!formData.time) newErrors.time = 'Time is required';\n    }\n    \n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  }, [formData]);\n\n  const handleNext = useCallback(() => {\n    if (validateStep(currentStep)) {\n      if (currentStep < 3) {\n        const queryParams = categoryFromUrl ? `?category=${categoryFromUrl}` : '';\n        setLocation(`/post-task/${currentStep + 1}${queryParams}`);\n      } else {\n        createTaskMutation.mutate(formData);\n      }\n    }\n  }, [validateStep, currentStep, setLocation, createTaskMutation, formData, categoryFromUrl]);\n\n  const handleBack = useCallback(() => {\n    if (currentStep > 1) {\n      const queryParams = categoryFromUrl ? `?category=${categoryFromUrl}` : '';\n      setLocation(`/post-task/${currentStep - 1}${queryParams}`);\n    } else {\n      setLocation('/categories');\n    }\n  }, [currentStep, setLocation, categoryFromUrl]);\n\n  const updateField = useCallback((field: keyof TaskFormData, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: '' }));\n    }\n  }, [errors]);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-8\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute -top-20 -left-20 w-80 h-80 bg-primary/15 rounded-full blur-3xl\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 flex flex-col min-h-screen\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center justify-between py-4\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={handleBack}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n          </motion.button>\n          <div className=\"flex gap-2\">\n            {[1, 2, 3].map((s) => (\n              <motion.div \n                key={s}\n                initial={{ scaleX: 0 }}\n                animate={{ scaleX: 1 }}\n                transition={{ delay: s * 0.1 }}\n                className={cn(\n                  \"w-10 h-1.5 rounded-full transition-colors\",\n                  s <= currentStep ? \"bg-primary\" : \"bg-muted\"\n                )}\n              />\n            ))}\n          </div>\n          <div className=\"w-11\"></div>\n        </motion.div>\n\n        <div className=\"flex-1 flex flex-col py-8\">\n          <AnimatePresence mode=\"wait\">\n            {currentStep === 1 && (\n              <motion.div\n                key=\"step1\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"flex-1 flex flex-col\"\n              >\n                <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n                  What do you need help with?\n                </h1>\n                <p className=\"text-muted-foreground text-lg mb-8\">\n                  Select a category for your task\n                </p>\n                <CategoryPicker\n                  selected={formData.category}\n                  onSelect={(cat) => updateField('category', cat)}\n                />\n                <AnimatePresence>\n                  {errors.category && (\n                    <motion.p \n                      initial={{ opacity: 0, y: -5 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -5 }}\n                      className=\"text-destructive text-sm font-bold mt-4 flex items-center gap-1.5\"\n                    >\n                      <AlertCircle className=\"w-4 h-4\" />\n                      {errors.category}\n                    </motion.p>\n                  )}\n                </AnimatePresence>\n              </motion.div>\n            )}\n\n            {currentStep === 2 && (\n              <motion.div\n                key=\"step2\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"flex-1 flex flex-col\"\n              >\n                <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n                  Describe your task\n                </h1>\n                <p className=\"text-muted-foreground text-lg mb-8\">\n                  Be specific so taskers understand what you need\n                </p>\n                <div className=\"space-y-4\">\n                  <FloatingInput\n                    label=\"Task Title\"\n                    value={formData.title}\n                    onChange={(e) => updateField('title', e.target.value)}\n                    error={errors.title}\n                    placeholder=\"e.g., Help me move furniture\"\n                  />\n                  <div className=\"relative\">\n                    <textarea\n                      value={formData.description}\n                      onChange={(e) => updateField('description', e.target.value)}\n                      placeholder=\"Describe your task in detail...\"\n                      className={cn(\n                        \"w-full h-40 p-5 rounded-2xl glass-input transition-all placeholder:text-muted-foreground font-medium text-foreground resize-none focus:outline-none focus:ring-2 focus:ring-primary/30\",\n                        errors.description && \"border-destructive\"\n                      )}\n                      data-testid=\"textarea-description\"\n                    />\n                    <AnimatePresence>\n                      {errors.description && (\n                        <motion.p \n                          initial={{ opacity: 0, y: -5 }}\n                          animate={{ opacity: 1, y: 0 }}\n                          exit={{ opacity: 0, y: -5 }}\n                          className=\"text-destructive text-sm font-bold mt-2 flex items-center gap-1.5\"\n                        >\n                          <AlertCircle className=\"w-4 h-4\" />\n                          {errors.description}\n                        </motion.p>\n                      )}\n                    </AnimatePresence>\n                  </div>\n                </div>\n              </motion.div>\n            )}\n\n            {currentStep === 3 && (\n              <motion.div\n                key=\"step3\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"flex-1 flex flex-col\"\n              >\n                <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n                  Task details\n                </h1>\n                <p className=\"text-muted-foreground text-lg mb-8\">\n                  Set your budget, location, and schedule\n                </p>\n                <div className=\"space-y-4\">\n                  <FloatingInput\n                    label=\"Budget ($)\"\n                    type=\"number\"\n                    value={formData.budget}\n                    onChange={(e) => updateField('budget', e.target.value)}\n                    error={errors.budget}\n                    placeholder=\"0\"\n                  />\n                  <motion.button\n                    whileTap={{ scale: 0.98 }}\n                    onClick={getCurrentLocation}\n                    disabled={locationStatus === 'loading'}\n                    className={cn(\n                      \"w-full h-16 px-5 rounded-2xl glass text-left transition-all flex items-center gap-4\",\n                      locationStatus === 'success' && \"ring-2 ring-green-500/30\",\n                      errors.location && \"ring-2 ring-destructive/50\"\n                    )}\n                    data-testid=\"button-get-location\"\n                  >\n                    <div className={cn(\n                      \"w-11 h-11 rounded-xl flex items-center justify-center transition-colors\",\n                      locationStatus === 'success' ? \"bg-green-500/15\" : \"bg-primary/15\"\n                    )}>\n                      {locationStatus === 'loading' ? (\n                        <Loader2 className=\"w-5 h-5 text-primary animate-spin\" />\n                      ) : locationStatus === 'success' ? (\n                        <CheckCircle2 className=\"w-5 h-5 text-green-500\" />\n                      ) : (\n                        <MapPin className=\"w-5 h-5 text-primary\" />\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <span className=\"text-[10px] font-bold text-primary uppercase tracking-widest block\">Location</span>\n                      <span className={cn(\n                        \"font-medium block truncate\",\n                        locationStatus === 'success' ? \"text-foreground\" : \"text-muted-foreground\"\n                      )}>\n                        {locationStatus === 'loading' \n                          ? 'Getting location...' \n                          : locationStatus === 'success' \n                            ? formData.location \n                            : 'Tap to use current location'}\n                      </span>\n                    </div>\n                  </motion.button>\n                  <AnimatePresence>\n                    {(errors.location || locationError) && (\n                      <motion.p \n                        initial={{ opacity: 0, y: -5 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        exit={{ opacity: 0, y: -5 }}\n                        className=\"text-destructive text-sm font-bold flex items-center gap-1.5\"\n                      >\n                        <AlertCircle className=\"w-4 h-4\" />\n                        {locationError || errors.location}\n                      </motion.p>\n                    )}\n                  </AnimatePresence>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <motion.button\n                      whileTap={{ scale: 0.98 }}\n                      onClick={() => setShowDatePicker(true)}\n                      className={cn(\n                        \"h-16 px-4 rounded-2xl glass text-left transition-all\",\n                        formData.date && \"ring-2 ring-primary/30\",\n                        errors.date && \"ring-2 ring-destructive/50\"\n                      )}\n                      data-testid=\"button-select-date\"\n                    >\n                      <span className=\"text-[10px] font-bold text-primary uppercase tracking-widest block\">Date</span>\n                      <span className={cn(\"font-medium\", formData.date ? \"text-foreground\" : \"text-muted-foreground\")}>\n                        {formData.date || \"Select date\"}\n                      </span>\n                    </motion.button>\n                    <motion.button\n                      whileTap={{ scale: 0.98 }}\n                      onClick={() => setShowTimePicker(true)}\n                      className={cn(\n                        \"h-16 px-4 rounded-2xl glass text-left transition-all\",\n                        formData.time && \"ring-2 ring-primary/30\",\n                        errors.time && \"ring-2 ring-destructive/50\"\n                      )}\n                      data-testid=\"button-select-time\"\n                    >\n                      <span className=\"text-[10px] font-bold text-primary uppercase tracking-widest block\">Time</span>\n                      <span className={cn(\"font-medium\", formData.time ? \"text-foreground\" : \"text-muted-foreground\")}>\n                        {formData.time || \"Select time\"}\n                      </span>\n                    </motion.button>\n                  </div>\n                  <AnimatePresence>\n                    {(errors.date || errors.time) && (\n                      <motion.p \n                        initial={{ opacity: 0, y: -5 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        exit={{ opacity: 0, y: -5 }}\n                        className=\"text-destructive text-sm font-bold flex items-center gap-1.5\"\n                      >\n                        <AlertCircle className=\"w-4 h-4\" />\n                        Please select date and time\n                      </motion.p>\n                    )}\n                  </AnimatePresence>\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          <motion.div \n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.3 }}\n            className=\"mt-auto pt-6\"\n          >\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={handleNext}\n              disabled={createTaskMutation.isPending}\n              className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/25 transition-all disabled:opacity-60 flex items-center justify-center gap-2\"\n              data-testid=\"button-next\"\n            >\n              {createTaskMutation.isPending ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\n                  {isEditMode ? 'Saving...' : 'Posting...'}\n                </>\n              ) : currentStep === 3 ? (\n                isEditMode ? 'Save Changes' : 'Post Task'\n              ) : (\n                'Continue'\n              )}\n            </motion.button>\n          </motion.div>\n        </div>\n      </div>\n\n      <DateTimePicker\n        isOpen={showDatePicker}\n        onClose={() => setShowDatePicker(false)}\n        onSelect={(value) => updateField('date', value)}\n        mode=\"date\"\n        title=\"Select Date\"\n      />\n\n      <DateTimePicker\n        isOpen={showTimePicker}\n        onClose={() => setShowTimePicker(false)}\n        onSelect={(value) => updateField('time', value)}\n        mode=\"time\"\n        title=\"Select Time\"\n      />\n    </div>\n  );\n});\n\nexport default PostTaskScreen;\n","path":null,"size_bytes":21722,"size_tokens":null},"client/src/pages/NotificationScreen.tsx":{"content":"import { memo, useMemo } from 'react';\nimport { useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { NotificationCard } from '@/components/NotificationCard';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { Skeleton, EmptyState } from '@/components/ui/animated';\nimport { ArrowLeft, BellOff, CheckCheck } from 'lucide-react';\nimport type { Notification } from '@shared/schema';\n\nconst NotificationScreen = memo(function NotificationScreen() {\n  const [, setLocation] = useLocation();\n  const isAuthenticated = !!localStorage.getItem('userId');\n  \n  const { data: notifications, isLoading } = useQuery<Notification[]>({\n    queryKey: ['/api/notifications'],\n    enabled: isAuthenticated,\n  });\n\n  const markReadMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest('PATCH', `/api/notifications/${id}/read`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n    },\n  });\n\n  const markAllReadMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest('POST', '/api/notifications/read-all');\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n    },\n  });\n\n  const unreadCount = useMemo(() => \n    notifications?.filter(n => !n.read).length || 0,\n    [notifications]\n  );\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-24\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-40 -left-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center justify-between mb-8\"\n        >\n          <div className=\"flex items-center gap-4\">\n            <motion.button \n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={() => window.history.back()}\n              className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"w-5 h-5\" />\n            </motion.button>\n            <div>\n              <h1 className=\"text-2xl font-extrabold text-foreground\">Notifications</h1>\n              {unreadCount > 0 && (\n                <motion.p \n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  className=\"text-sm text-muted-foreground\"\n                >\n                  {unreadCount} unread\n                </motion.p>\n              )}\n            </div>\n          </div>\n          \n          <AnimatePresence>\n            {unreadCount > 0 && (\n              <motion.button\n                initial={{ opacity: 0, scale: 0.8 }}\n                animate={{ opacity: 1, scale: 1 }}\n                exit={{ opacity: 0, scale: 0.8 }}\n                whileHover={{ scale: 1.05 }}\n                whileTap={{ scale: 0.95 }}\n                onClick={() => markAllReadMutation.mutate()}\n                disabled={markAllReadMutation.isPending}\n                className=\"h-10 px-4 rounded-xl glass text-sm font-bold text-primary flex items-center gap-2\"\n                data-testid=\"button-mark-all-read\"\n              >\n                <CheckCheck className=\"w-4 h-4\" />\n                Mark all read\n              </motion.button>\n            )}\n          </AnimatePresence>\n        </motion.div>\n\n        <div className=\"space-y-2\">\n          <AnimatePresence mode=\"wait\">\n            {isLoading ? (\n              <motion.div\n                key=\"loading\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"space-y-2\"\n              >\n                {[1, 2, 3, 4].map((i) => (\n                  <div key={i} className=\"flex items-start gap-4 p-4 glass rounded-2xl\">\n                    <Skeleton className=\"w-12 h-12 rounded-2xl flex-shrink-0\" />\n                    <div className=\"flex-1\">\n                      <Skeleton className=\"h-4 w-40 mb-2\" />\n                      <Skeleton className=\"h-3 w-full mb-1\" />\n                      <Skeleton className=\"h-3 w-2/3\" />\n                    </div>\n                  </div>\n                ))}\n              </motion.div>\n            ) : notifications && notifications.length > 0 ? (\n              <motion.div\n                key=\"notifications\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"space-y-2\"\n              >\n                {notifications.map((notification, index) => (\n                  <motion.div\n                    key={notification.id}\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    transition={{ delay: index * 0.05 }}\n                  >\n                    <NotificationCard\n                      notification={notification}\n                      onMarkRead={(id) => markReadMutation.mutate(id)}\n                    />\n                  </motion.div>\n                ))}\n              </motion.div>\n            ) : (\n              <motion.div\n                key=\"empty\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n              >\n                <EmptyState\n                  icon={<BellOff className=\"w-8 h-8\" />}\n                  title=\"No notifications\"\n                  description=\"You're all caught up!\"\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nexport default NotificationScreen;\n","path":null,"size_bytes":6109,"size_tokens":null},"attached_assets/Modal_1764551029324.tsx":{"content":"\nimport React, { useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\ninterface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: React.ReactNode;\n  children: React.ReactNode;\n  action?: React.ReactNode;\n}\n\nexport const Modal: React.FC<ModalProps> = ({ isOpen, onClose, title, children, action }) => {\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      // Prevent scrolling on the body\n      document.body.style.overflow = 'hidden';\n      \n      // Focus the modal for accessibility\n      modalRef.current?.focus();\n\n      // Handle Escape key\n      const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') onClose();\n      };\n      document.addEventListener('keydown', handleEscape);\n\n      return () => {\n        document.body.style.overflow = 'unset';\n        document.removeEventListener('keydown', handleEscape);\n      };\n    }\n  }, [isOpen, onClose]);\n\n  if (!isOpen) return null;\n\n  return createPortal(\n    <div \n      className=\"fixed inset-0 z-50 flex items-end justify-center sm:items-center\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n    >\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/40 backdrop-blur-sm animate-fade-in\"\n        onClick={onClose}\n        aria-hidden=\"true\"\n      />\n\n      {/* Modal Content */}\n      <div \n        ref={modalRef}\n        className=\"bg-surface/85 dark:bg-surface-dark/85 w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] p-6 pb-safe shadow-2xl border-t border-white/20 dark:border-gray-700/50 backdrop-blur-2xl ring-1 ring-black/5 animate-slide-up outline-none relative z-10 m-0 sm:m-4\"\n        tabIndex={-1}\n      >\n        {/* Handle Bar for mobile feel */}\n        <div className=\"w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-6 sm:hidden\"></div>\n\n        <div className=\"flex justify-between items-center mb-6\">\n          {title && <div className=\"text-2xl font-extrabold tracking-tight\">{title}</div>}\n          <button \n            onClick={onClose} \n            className=\"w-10 h-10 flex items-center justify-center rounded-full bg-gray-100/50 dark:bg-gray-800/50 hover:bg-gray-200/50 dark:hover:bg-gray-700/50 transition-colors active:scale-90 ms-auto\"\n            aria-label=\"Close modal\"\n          >\n            <span className=\"material-symbols-outlined\">close</span>\n          </button>\n        </div>\n\n        <div className=\"space-y-6\">\n          {children}\n        </div>\n\n        {action && (\n          <div className=\"mt-8 pt-4\">\n            {action}\n          </div>\n        )}\n      </div>\n    </div>,\n    document.body\n  );\n};\n","path":null,"size_bytes":2655,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/pages/TaskDetailsScreen.tsx":{"content":"import { useState, memo, useCallback, useMemo } from 'react';\nimport { Link, useParams, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { OfferCard } from '@/components/OfferCard';\nimport { Modal } from '@/components/Modal';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { Skeleton, LoadingSpinner } from '@/components/ui/animated';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport { \n  ArrowLeft, Heart, Edit3, MapPin, Clock, DollarSign, \n  MessageCircle, Star, AlertCircle, Loader2, Send, Calendar, Sparkles, Trash2, CheckCircle\n} from 'lucide-react';\nimport TaskLocationMap from '@/components/TaskLocationMap';\nimport type { TaskWithDetails, BidWithTasker } from '@shared/schema';\nimport { getCategoryInfo, TASK_CATEGORIES_WITH_SUBS } from '@shared/schema';\nimport { useTranslation } from 'react-i18next';\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: { staggerChildren: 0.06, delayChildren: 0.1 }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 16 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 }\n  }\n};\n\nconst TaskDetailsScreen = memo(function TaskDetailsScreen() {\n  const { id } = useParams<{ id: string }>();\n  const [, setLocation] = useLocation();\n  const { user, userRole, savedTaskIds, toggleSavedTask } = useApp();\n  const { toast } = useToast();\n  const { i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  \n  const [showBidModal, setShowBidModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [showRatingModal, setShowRatingModal] = useState(false);\n  const [selectedRating, setSelectedRating] = useState(0);\n  const [ratingComment, setRatingComment] = useState('');\n  const [bidAmount, setBidAmount] = useState('');\n  const [bidMessage, setBidMessage] = useState('');\n  \n  const handleBidAmountChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setBidAmount(e.target.value);\n  }, []);\n  \n  const handleBidMessageChange = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setBidMessage(e.target.value);\n  }, []);\n  \n  const handleCloseBidModal = useCallback(() => {\n    setShowBidModal(false);\n  }, []);\n  \n  const handleCloseDeleteModal = useCallback(() => {\n    setShowDeleteModal(false);\n  }, []);\n\n  const { data: task, isLoading } = useQuery<TaskWithDetails>({\n    queryKey: ['/api/tasks', id],\n  });\n\n  const { data: bids } = useQuery<BidWithTasker[]>({\n    queryKey: ['/api/tasks', id, 'bids'],\n  });\n\n  const placeBidMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest('POST', `/api/tasks/${id}/bids`, {\n        amount: parseFloat(bidAmount),\n        message: bidMessage,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks', id, 'bids'] });\n      setShowBidModal(false);\n      setBidAmount('');\n      setBidMessage('');\n      toast({ title: 'Offer sent!', description: 'The client will review your offer' });\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Failed to send offer', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const acceptBidMutation = useMutation({\n    mutationFn: async (bidId: string) => {\n      return apiRequest('POST', `/api/bids/${bidId}/accept`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks', id] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks', id, 'bids'] });\n      toast({ title: 'Offer accepted!', description: 'The tasker has been assigned' });\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Failed to accept offer', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const deleteTaskMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest('DELETE', `/api/tasks/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks/my'] });\n      setShowDeleteModal(false);\n      toast({ title: isArabic ? 'تم حذف المهمة' : 'Task deleted', description: isArabic ? 'تم حذف المهمة بنجاح' : 'The task has been removed successfully' });\n      setLocation('/my-tasks');\n    },\n    onError: (error: Error) => {\n      toast({ title: isArabic ? 'فشل الحذف' : 'Failed to delete', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const requestCompletionMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest('POST', `/api/tasks/${id}/request-completion`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks', id] });\n      toast({ \n        title: isArabic ? 'تم إرسال الطلب' : 'Request sent', \n        description: isArabic ? 'تم إرسال طلب إتمام المهمة للعميل' : 'Completion request sent to client'\n      });\n    },\n    onError: (error: Error) => {\n      toast({ title: isArabic ? 'فشل الإرسال' : 'Request failed', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  // Check if task has been reviewed\n  const { data: reviewData } = useQuery<{ hasReview: boolean; review: any }>({\n    queryKey: ['/api/tasks', id, 'review'],\n    enabled: !!id,\n  });\n\n  // Submit review mutation\n  const submitReviewMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest('POST', '/api/reviews', {\n        taskId: id,\n        rating: selectedRating,\n        comment: ratingComment || null,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks', id, 'review'] });\n      setShowRatingModal(false);\n      setSelectedRating(0);\n      setRatingComment('');\n      toast({ \n        title: isArabic ? 'شكراً لتقييمك' : 'Thank you for rating!', \n        description: isArabic ? 'تم إرسال تقييمك بنجاح' : 'Your review has been submitted'\n      });\n    },\n    onError: (error: Error) => {\n      toast({ title: isArabic ? 'فشل الإرسال' : 'Failed to submit', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const isSaved = useMemo(() => id ? savedTaskIds.includes(id) : false, [id, savedTaskIds]);\n  const isClient = userRole === 'client';\n  const isTasker = userRole === 'tasker';\n\n  const formatCurrency = useCallback((amount: number | string) => {\n    const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(num);\n  }, []);\n\n  const getStatusConfig = useCallback((status: string) => {\n    switch (status) {\n      case 'open': return { bg: 'bg-success/15', text: 'text-success', label: 'Open' };\n      case 'assigned': return { bg: 'bg-warning/15', text: 'text-warning', label: 'Assigned' };\n      case 'in_progress': return { bg: 'bg-primary/15', text: 'text-primary', label: 'In Progress' };\n      case 'completed': return { bg: 'bg-muted', text: 'text-muted-foreground', label: 'Completed' };\n      case 'cancelled': return { bg: 'bg-destructive/15', text: 'text-destructive', label: 'Cancelled' };\n      default: return { bg: 'bg-muted', text: 'text-muted-foreground', label: status };\n    }\n  }, []);\n\n  const handleBack = useCallback(() => {\n    window.history.back();\n  }, []);\n\n  const handleToggleSave = useCallback(() => {\n    if (id) toggleSavedTask(id);\n  }, [id, toggleSavedTask]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe px-5 py-5\">\n        <div className=\"flex items-center gap-3 mb-6\">\n          <Skeleton className=\"h-11 w-11 rounded-2xl\" />\n          <Skeleton className=\"h-6 w-24 rounded-lg\" />\n        </div>\n        <Skeleton className=\"h-8 w-3/4 mb-4 rounded-lg\" />\n        <Skeleton className=\"h-20 w-full rounded-2xl mb-5\" />\n        <div className=\"grid grid-cols-2 gap-3 mb-5\">\n          <Skeleton className=\"h-24 rounded-2xl\" />\n          <Skeleton className=\"h-24 rounded-2xl\" />\n        </div>\n        <Skeleton className=\"h-32 rounded-2xl mb-5\" />\n        <Skeleton className=\"h-24 rounded-2xl\" />\n      </div>\n    );\n  }\n\n  if (!task) {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe flex items-center justify-center px-5\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"text-center glass-premium rounded-3xl p-8\"\n        >\n          <div className=\"w-16 h-16 rounded-2xl bg-destructive/15 flex items-center justify-center mx-auto mb-5\">\n            <AlertCircle className=\"w-8 h-8 text-destructive\" />\n          </div>\n          <h3 className=\"text-xl font-bold text-foreground mb-2\">Task not found</h3>\n          <p className=\"text-muted-foreground mb-6 text-sm\">This task may have been removed</p>\n          <Link href=\"/home\">\n            <motion.button\n              whileHover={{ scale: 1.03 }}\n              whileTap={{ scale: 0.97 }}\n              className=\"gradient-primary text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-primary/25\"\n            >\n              Go back home\n            </motion.button>\n          </Link>\n        </motion.div>\n      </div>\n    );\n  }\n\n  const statusConfig = getStatusConfig(task.status);\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.4, scale: 1 }}\n          transition={{ duration: 1 }}\n          className=\"absolute top-20 -right-24 w-72 h-72 bg-gradient-to-br from-primary/20 to-primary/5 rounded-full blur-3xl\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.25 }}\n          transition={{ delay: 0.3 }}\n          className=\"absolute bottom-40 -left-16 w-48 h-48 bg-gradient-to-tr from-accent/20 to-transparent rounded-full blur-3xl\"\n        />\n      </div>\n\n      <motion.div \n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"relative z-10 px-5 py-5\"\n      >\n        <motion.div \n          variants={itemVariants}\n          className=\"flex items-center justify-between mb-6\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.92 }}\n            onClick={handleBack}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5 text-foreground/80\" />\n          </motion.button>\n          \n          <div className=\"flex items-center gap-2.5\">\n            {isTasker && (\n              <motion.button\n                whileHover={{ scale: 1.05 }}\n                whileTap={{ scale: 0.92 }}\n                onClick={handleToggleSave}\n                className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n                data-testid=\"button-save-task\"\n              >\n                <Heart className={cn(\n                  \"w-5 h-5 transition-all\",\n                  isSaved ? \"fill-destructive text-destructive\" : \"text-foreground/80\"\n                )} />\n              </motion.button>\n            )}\n            {isClient && task.status === 'open' && (\n              <>\n                <Link href={`/task/${id}/edit`}>\n                  <motion.button \n                    whileHover={{ scale: 1.05 }}\n                    whileTap={{ scale: 0.92 }}\n                    className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n                    data-testid=\"button-edit-task\"\n                  >\n                    <Edit3 className=\"w-5 h-5 text-foreground/80\" />\n                  </motion.button>\n                </Link>\n                <motion.button\n                  whileHover={{ scale: 1.05 }}\n                  whileTap={{ scale: 0.92 }}\n                  onClick={() => setShowDeleteModal(true)}\n                  className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n                  data-testid=\"button-delete-task\"\n                >\n                  <Trash2 className=\"w-5 h-5 text-destructive\" />\n                </motion.button>\n              </>\n            )}\n          </div>\n        </motion.div>\n\n        <motion.div variants={itemVariants}>\n          {(() => {\n            const catInfo = getCategoryInfo(task.category);\n            let categoryDisplay: string;\n            let categoryColor: string;\n            \n            if (catInfo?.subcategory) {\n              categoryDisplay = isArabic ? catInfo.subcategory.nameAr : catInfo.subcategory.nameEn;\n              categoryColor = TASK_CATEGORIES_WITH_SUBS[catInfo.mainCategory]?.colorHex || '#6B7280';\n            } else if (catInfo) {\n              categoryDisplay = isArabic \n                ? TASK_CATEGORIES_WITH_SUBS[catInfo.mainCategory]?.nameAr || task.category\n                : TASK_CATEGORIES_WITH_SUBS[catInfo.mainCategory]?.nameEn || task.category;\n              categoryColor = TASK_CATEGORIES_WITH_SUBS[catInfo.mainCategory]?.colorHex || '#6B7280';\n            } else {\n              categoryDisplay = task.category;\n              categoryColor = '#6B7280';\n            }\n            \n            return (\n              <div className=\"flex items-center gap-2 mb-3\">\n                <span \n                  className=\"px-3 py-1.5 rounded-xl text-[10px] font-bold uppercase tracking-wider\"\n                  style={{\n                    backgroundColor: `${categoryColor}20`,\n                    color: categoryColor,\n                  }}\n                >\n                  {categoryDisplay}\n                </span>\n                <span className={cn(\n                  \"px-3 py-1.5 rounded-xl text-[10px] font-bold uppercase tracking-wider\",\n                  statusConfig.bg, statusConfig.text\n                )}>\n                  {statusConfig.label}\n                </span>\n              </div>\n            );\n          })()}\n\n          <h1 className=\"text-2xl font-extrabold text-foreground mb-3 leading-tight tracking-tight\">\n            {task.title}\n          </h1>\n\n          <p className=\"text-muted-foreground leading-relaxed mb-6\">\n            {task.description}\n          </p>\n        </motion.div>\n\n        <motion.div variants={itemVariants} className=\"grid grid-cols-2 gap-3 mb-3\">\n          <div className=\"glass rounded-[20px] p-4\">\n            <div className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary/15 to-primary/5 flex items-center justify-center mb-2.5\">\n              <MapPin className=\"w-4 h-4 text-primary\" />\n            </div>\n            <p className=\"text-[10px] text-muted-foreground font-semibold uppercase tracking-wider mb-0.5\">Location</p>\n            <p className=\"font-bold text-foreground text-sm truncate\">{task.location}</p>\n          </div>\n          <div className=\"glass rounded-[20px] p-4\">\n            <div className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-accent/15 to-accent/5 flex items-center justify-center mb-2.5\">\n              <Calendar className=\"w-4 h-4 text-accent\" />\n            </div>\n            <p className=\"text-[10px] text-muted-foreground font-semibold uppercase tracking-wider mb-0.5\">When</p>\n            <p className=\"font-bold text-foreground text-sm\">{task.date}</p>\n            <p className=\"text-xs text-muted-foreground mt-0.5\">{task.time}</p>\n          </div>\n        </motion.div>\n\n        <motion.div variants={itemVariants} className=\"mb-5\">\n          <TaskLocationMap \n            latitude={task.latitude}\n            longitude={task.longitude}\n            location={task.location}\n          />\n        </motion.div>\n\n        <motion.div variants={itemVariants} className=\"relative overflow-hidden rounded-[24px] mb-5\">\n          <div className=\"absolute inset-0 glass-premium\" />\n          <div className=\"absolute inset-0 gradient-border\" />\n          \n          <div className=\"relative p-5\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-xs text-muted-foreground font-semibold uppercase tracking-wider mb-1\">Budget</p>\n                <p className=\"text-3xl font-extrabold gradient-text-primary\">{formatCurrency(task.budget)}</p>\n              </div>\n              <motion.div \n                whileHover={{ rotate: 5 }}\n                className=\"w-14 h-14 rounded-2xl gradient-primary flex items-center justify-center shadow-lg shadow-primary/30\"\n              >\n                <DollarSign className=\"w-7 h-7 text-white\" />\n              </motion.div>\n            </div>\n          </div>\n        </motion.div>\n\n        {task.client && (\n          <motion.div variants={itemVariants} className=\"glass rounded-[24px] p-5 mb-5\">\n            <p className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-3\">Posted by</p>\n            <div className=\"flex items-center gap-3\">\n              <Avatar className=\"w-12 h-12 border-2 border-white/30 shadow-lg\">\n                <AvatarImage src={task.client.avatar || undefined} />\n                <AvatarFallback className=\"gradient-primary text-white font-bold\">\n                  {task.client.name?.charAt(0) || 'U'}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"font-bold text-foreground truncate\">{task.client.name}</p>\n                <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\n                  <Star className=\"w-3.5 h-3.5 fill-warning text-warning\" />\n                  <span className=\"font-medium\">{parseFloat(String(task.client.rating || 0)).toFixed(1)}</span>\n                </div>\n              </div>\n              <Link href={`/chat/${task.id}`}>\n                <motion.button \n                  whileHover={{ scale: 1.05 }}\n                  whileTap={{ scale: 0.92 }}\n                  className=\"w-11 h-11 flex items-center justify-center rounded-xl gradient-primary text-white shadow-md shadow-primary/25\"\n                  data-testid=\"button-chat\"\n                >\n                  <MessageCircle className=\"w-5 h-5\" />\n                </motion.button>\n              </Link>\n            </div>\n          </motion.div>\n        )}\n\n        {isClient && bids && bids.length > 0 && (\n          <motion.div variants={itemVariants} className=\"mb-5\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-lg font-bold text-foreground\">\n                Offers\n              </h2>\n              <span className=\"px-2.5 py-1 rounded-lg bg-primary/10 text-primary text-xs font-bold\">\n                {bids.length}\n              </span>\n            </div>\n            <div className=\"space-y-3\">\n              {bids.map((bid, index) => (\n                <motion.div\n                  key={bid.id}\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.1 + index * 0.05 }}\n                >\n                  <OfferCard \n                    offer={bid}\n                    onAccept={(bidId) => acceptBidMutation.mutate(bidId)}\n                    showActions={task.status === 'open'}\n                  />\n                </motion.div>\n              ))}\n            </div>\n          </motion.div>\n        )}\n      </motion.div>\n\n      <AnimatePresence>\n        {isTasker && task.status === 'open' && (\n          <motion.div \n            initial={{ y: 100, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            exit={{ y: 100, opacity: 0 }}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n            className=\"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe\"\n          >\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => setShowBidModal(true)}\n              className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-base shadow-xl shadow-primary/30 flex items-center justify-center gap-2.5\"\n              data-testid=\"button-make-offer\"\n            >\n              <Sparkles className=\"w-5 h-5\" />\n              Make an Offer\n            </motion.button>\n          </motion.div>\n        )}\n\n        {isTasker && task.status === 'assigned' && task.taskerId === user?.id && (\n          <motion.div \n            initial={{ y: 100, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            exit={{ y: 100, opacity: 0 }}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n            className=\"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe\"\n          >\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => requestCompletionMutation.mutate()}\n              disabled={requestCompletionMutation.isPending}\n              className=\"w-full h-14 bg-gradient-to-r from-success to-success/80 text-white rounded-2xl font-bold text-base shadow-xl shadow-success/30 flex items-center justify-center gap-2.5 disabled:opacity-50\"\n              data-testid=\"button-request-completion\"\n            >\n              {requestCompletionMutation.isPending ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\n                  {isArabic ? 'جاري الإرسال...' : 'Sending...'}\n                </>\n              ) : (\n                <>\n                  <CheckCircle className=\"w-5 h-5\" />\n                  {isArabic ? 'تم إنجاز المهمة' : 'Task Completed'}\n                </>\n              )}\n            </motion.button>\n          </motion.div>\n        )}\n\n        {isClient && task.status === 'in_progress' && task.clientId === user?.id && (\n          <motion.div \n            initial={{ y: 100, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            exit={{ y: 100, opacity: 0 }}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n            className=\"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe\"\n          >\n            <Link href={`/task/${id}/payment`}>\n              <motion.button\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n                className=\"w-full h-14 bg-gradient-to-r from-success to-success/80 text-white rounded-2xl font-bold text-base shadow-xl shadow-success/30 flex items-center justify-center gap-2.5\"\n                data-testid=\"button-complete-payment\"\n              >\n                <DollarSign className=\"w-5 h-5\" />\n                {isArabic ? 'إتمام الدفع' : 'Complete Payment'}\n              </motion.button>\n            </Link>\n          </motion.div>\n        )}\n\n        {isTasker && task.status === 'in_progress' && task.taskerId === user?.id && (\n          <motion.div \n            initial={{ y: 100, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            exit={{ y: 100, opacity: 0 }}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n            className=\"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe\"\n          >\n            <div className=\"text-center\">\n              <div className=\"w-12 h-12 rounded-2xl bg-warning/15 flex items-center justify-center mx-auto mb-3\">\n                <Clock className=\"w-6 h-6 text-warning\" />\n              </div>\n              <p className=\"font-bold text-foreground mb-1\" data-testid=\"text-waiting-payment\">\n                {isArabic ? 'في انتظار الدفع' : 'Awaiting Payment'}\n              </p>\n              <p className=\"text-sm text-muted-foreground\">\n                {isArabic ? 'العميل سيقوم بالدفع لإتمام المهمة' : 'Client will complete payment to finish the task'}\n              </p>\n            </div>\n          </motion.div>\n        )}\n\n        {/* Rate Tasker Button for completed tasks */}\n        {isClient && task.status === 'completed' && task.clientId === user?.id && !reviewData?.hasReview && (\n          <motion.div \n            initial={{ y: 100, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            exit={{ y: 100, opacity: 0 }}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n            className=\"fixed bottom-0 left-0 right-0 p-5 glass-premium border-t-0 rounded-t-[28px] pb-safe\"\n          >\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => setShowRatingModal(true)}\n              className=\"w-full h-14 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-2xl font-bold text-base shadow-xl shadow-amber-500/30 flex items-center justify-center gap-2.5\"\n              data-testid=\"button-rate-tasker\"\n            >\n              <Star className=\"w-5 h-5\" />\n              {isArabic ? 'قيّم المنفذ' : 'Rate Tasker'}\n            </motion.button>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      <Modal\n        isOpen={showBidModal}\n        onClose={handleCloseBidModal}\n        title=\"Make an Offer\"\n        action={\n          <motion.button\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => placeBidMutation.mutate()}\n            disabled={!bidAmount || placeBidMutation.isPending}\n            className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold shadow-xl shadow-primary/30 disabled:opacity-50 flex items-center justify-center gap-2.5\"\n            data-testid=\"button-submit-offer\"\n          >\n            {placeBidMutation.isPending ? (\n              <>\n                <Loader2 className=\"w-5 h-5 animate-spin\" />\n                Sending...\n              </>\n            ) : (\n              <>\n                <Send className=\"w-5 h-5\" />\n                Send Offer\n              </>\n            )}\n          </motion.button>\n        }\n      >\n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <div className=\"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground\">\n              <DollarSign className=\"w-5 h-5\" />\n            </div>\n            <input\n              type=\"number\"\n              inputMode=\"decimal\"\n              value={bidAmount}\n              onChange={handleBidAmountChange}\n              placeholder=\"Your offer amount\"\n              autoComplete=\"off\"\n              autoCorrect=\"off\"\n              className=\"w-full h-13 pl-12 pr-5 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none text-base\"\n              data-testid=\"input-bid-amount\"\n            />\n          </div>\n          <textarea\n            value={bidMessage}\n            onChange={handleBidMessageChange}\n            placeholder=\"Tell them why you're a great fit... (optional)\"\n            rows={3}\n            autoComplete=\"off\"\n            autoCorrect=\"off\"\n            className=\"w-full p-4 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none resize-none text-base\"\n            data-testid=\"input-bid-message\"\n          />\n          <div className=\"text-center py-2\">\n            <p className=\"text-sm text-muted-foreground\">\n              Client's budget: <span className=\"font-bold text-primary\">{formatCurrency(task.budget)}</span>\n            </p>\n          </div>\n        </div>\n      </Modal>\n\n      <Modal\n        isOpen={showDeleteModal}\n        onClose={handleCloseDeleteModal}\n        title={isArabic ? 'حذف المهمة' : 'Delete Task'}\n        action={\n          <div className=\"flex gap-3\">\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={handleCloseDeleteModal}\n              className=\"flex-1 h-14 rounded-2xl font-bold glass\"\n              data-testid=\"button-cancel-delete\"\n            >\n              {isArabic ? 'إلغاء' : 'Cancel'}\n            </motion.button>\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => deleteTaskMutation.mutate()}\n              disabled={deleteTaskMutation.isPending}\n              className=\"flex-1 h-14 bg-destructive text-white rounded-2xl font-bold shadow-xl shadow-destructive/30 disabled:opacity-50 flex items-center justify-center gap-2\"\n              data-testid=\"button-confirm-delete\"\n            >\n              {deleteTaskMutation.isPending ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\n                  {isArabic ? 'جاري الحذف...' : 'Deleting...'}\n                </>\n              ) : (\n                <>\n                  <Trash2 className=\"w-5 h-5\" />\n                  {isArabic ? 'حذف' : 'Delete'}\n                </>\n              )}\n            </motion.button>\n          </div>\n        }\n      >\n        <div className=\"text-center py-4\">\n          <div className=\"w-16 h-16 rounded-2xl bg-destructive/15 flex items-center justify-center mx-auto mb-5\">\n            <AlertCircle className=\"w-8 h-8 text-destructive\" />\n          </div>\n          <p className=\"text-muted-foreground mb-2\" data-testid=\"text-delete-confirmation\">\n            {isArabic \n              ? 'هل أنت متأكد من حذف هذه المهمة؟ لا يمكن التراجع عن هذا الإجراء.'\n              : 'Are you sure you want to delete this task? This action cannot be undone.'}\n          </p>\n          <p className=\"font-bold text-foreground\" data-testid=\"text-delete-task-title\">\n            {task.title}\n          </p>\n        </div>\n      </Modal>\n\n      {/* Rating Modal */}\n      <Modal\n        isOpen={showRatingModal}\n        onClose={() => setShowRatingModal(false)}\n        title={isArabic ? 'قيّم المنفذ' : 'Rate Tasker'}\n        action={\n          <motion.button\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={() => submitReviewMutation.mutate()}\n            disabled={selectedRating === 0 || submitReviewMutation.isPending}\n            className=\"w-full h-14 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-2xl font-bold shadow-xl shadow-amber-500/30 disabled:opacity-50 flex items-center justify-center gap-2.5\"\n            data-testid=\"button-submit-rating\"\n          >\n            {submitReviewMutation.isPending ? (\n              <>\n                <Loader2 className=\"w-5 h-5 animate-spin\" />\n                {isArabic ? 'جاري الإرسال...' : 'Submitting...'}\n              </>\n            ) : (\n              <>\n                <Star className=\"w-5 h-5\" />\n                {isArabic ? 'إرسال التقييم' : 'Submit Rating'}\n              </>\n            )}\n          </motion.button>\n        }\n      >\n        <div className=\"space-y-6\">\n          {/* Tasker info */}\n          {task.tasker && (\n            <div className=\"flex items-center gap-3 p-4 rounded-2xl bg-muted/50\">\n              <Avatar className=\"w-12 h-12\">\n                <AvatarImage src={task.tasker.avatar || undefined} />\n                <AvatarFallback className=\"bg-primary/15 text-primary font-bold\">\n                  {task.tasker.name?.charAt(0)}\n                </AvatarFallback>\n              </Avatar>\n              <div>\n                <p className=\"font-bold\">{task.tasker.name}</p>\n                <p className=\"text-sm text-muted-foreground\">@{task.tasker.username}</p>\n              </div>\n            </div>\n          )}\n\n          {/* Star Rating */}\n          <div className=\"text-center\">\n            <p className=\"text-sm text-muted-foreground mb-3\">\n              {isArabic ? 'كيف كانت تجربتك؟' : 'How was your experience?'}\n            </p>\n            <div className=\"flex justify-center gap-2\">\n              {[1, 2, 3, 4, 5].map((star) => (\n                <motion.button\n                  key={star}\n                  whileHover={{ scale: 1.15 }}\n                  whileTap={{ scale: 0.95 }}\n                  onClick={() => setSelectedRating(star)}\n                  className=\"p-1\"\n                  data-testid={`button-star-${star}`}\n                >\n                  <Star \n                    className={cn(\n                      \"w-10 h-10 transition-colors\",\n                      selectedRating >= star \n                        ? \"fill-amber-500 text-amber-500\" \n                        : \"text-muted-foreground\"\n                    )} \n                  />\n                </motion.button>\n              ))}\n            </div>\n            {selectedRating > 0 && (\n              <motion.p \n                initial={{ opacity: 0, y: -5 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"text-sm font-medium text-amber-500 mt-2\"\n              >\n                {selectedRating === 5 ? (isArabic ? 'ممتاز!' : 'Excellent!') :\n                 selectedRating === 4 ? (isArabic ? 'جيد جداً' : 'Very Good') :\n                 selectedRating === 3 ? (isArabic ? 'جيد' : 'Good') :\n                 selectedRating === 2 ? (isArabic ? 'مقبول' : 'Fair') :\n                 (isArabic ? 'ضعيف' : 'Poor')}\n              </motion.p>\n            )}\n          </div>\n\n          {/* Comment */}\n          <div>\n            <label className=\"text-sm text-muted-foreground mb-2 block\">\n              {isArabic ? 'تعليق (اختياري)' : 'Comment (optional)'}\n            </label>\n            <textarea\n              value={ratingComment}\n              onChange={(e) => setRatingComment(e.target.value)}\n              placeholder={isArabic ? 'شارك تجربتك مع هذا المنفذ...' : 'Share your experience with this tasker...'}\n              className=\"w-full h-24 p-4 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none resize-none text-base\"\n              data-testid=\"input-rating-comment\"\n            />\n          </div>\n        </div>\n      </Modal>\n    </div>\n  );\n});\n\nexport default TaskDetailsScreen;\n","path":null,"size_bytes":34690,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/context/AppContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, useMemo, useCallback, type ReactNode } from 'react';\nimport type { User, Task, Transaction, Notification, Bid, TaskWithDetails } from '@shared/schema';\nimport { apiRequest } from '@/lib/queryClient';\n\nexport type UserRole = 'client' | 'tasker';\n\ninterface AppContextType {\n  user: User | null;\n  userRole: UserRole;\n  theme: 'light' | 'dark';\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  savedTaskIds: string[];\n  setUser: (user: User | null) => void;\n  toggleTheme: () => void;\n  switchRole: (role: UserRole) => Promise<{ success: boolean; error?: string }>;\n  setLocalRole: (role: UserRole) => void;\n  toggleSavedTask: (taskId: string) => void;\n  logout: () => void;\n}\n\nconst AppContext = createContext<AppContextType | undefined>(undefined);\n\nexport const useApp = () => {\n  const context = useContext(AppContext);\n  if (!context) {\n    throw new Error('useApp must be used within an AppProvider');\n  }\n  return context;\n};\n\nconst getInitialTheme = (): 'light' | 'dark' => {\n  if (typeof window !== 'undefined') {\n    const saved = localStorage.getItem('theme');\n    if (saved === 'dark' || saved === 'light') return saved;\n    if (window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark';\n  }\n  return 'light';\n};\n\nexport const AppProvider = ({ children }: { children: ReactNode }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [userRole, setUserRole] = useState<UserRole>(() => {\n    if (typeof window !== 'undefined') {\n      return (localStorage.getItem('userRole') as UserRole) || 'client';\n    }\n    return 'client';\n  });\n  const [theme, setTheme] = useState<'light' | 'dark'>(getInitialTheme);\n  const [savedTaskIds, setSavedTaskIds] = useState<string[]>(() => {\n    if (typeof window !== 'undefined') {\n      try {\n        const saved = localStorage.getItem('savedTaskIds');\n        return saved ? JSON.parse(saved) : [];\n      } catch {\n        return [];\n      }\n    }\n    return [];\n  });\n\n  useEffect(() => {\n    const checkAuth = async () => {\n      try {\n        const res = await fetch('/api/users/me', { credentials: 'include' });\n        if (res.ok) {\n          const userData = await res.json();\n          setUser(userData);\n          if (userData.role) {\n            setUserRole(userData.role as UserRole);\n          }\n        }\n      } catch {\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    checkAuth();\n  }, []);\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n    root.classList.remove('light', 'dark');\n    root.classList.add(theme);\n    localStorage.setItem('theme', theme);\n  }, [theme]);\n\n  useEffect(() => {\n    localStorage.setItem('userRole', userRole);\n  }, [userRole]);\n\n  useEffect(() => {\n    localStorage.setItem('savedTaskIds', JSON.stringify(savedTaskIds));\n  }, [savedTaskIds]);\n\n  const toggleTheme = useCallback(() => {\n    setTheme(prev => prev === 'light' ? 'dark' : 'light');\n  }, []);\n\n  const setLocalRole = useCallback((role: UserRole) => {\n    setUserRole(role);\n  }, []);\n\n  const switchRole = useCallback(async (role: UserRole): Promise<{ success: boolean; error?: string }> => {\n    try {\n      const response = await apiRequest('POST', '/api/users/switch-role', { role });\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n        setUserRole(role);\n        return { success: true };\n      } else {\n        const errorData = await response.json();\n        return { success: false, error: errorData.error || 'Failed to switch role' };\n      }\n    } catch (error) {\n      console.error('Failed to switch role:', error);\n      return { success: false, error: 'Network error' };\n    }\n  }, []);\n\n  const toggleSavedTask = useCallback((taskId: string) => {\n    setSavedTaskIds(prev => \n      prev.includes(taskId) \n        ? prev.filter(id => id !== taskId) \n        : [...prev, taskId]\n    );\n  }, []);\n\n  const logout = useCallback(() => {\n    setUser(null);\n    localStorage.removeItem('userId');\n  }, []);\n\n  const contextValue = useMemo(() => ({\n    user,\n    userRole,\n    theme,\n    isAuthenticated: !!user,\n    isLoading,\n    savedTaskIds,\n    setUser,\n    toggleTheme,\n    switchRole,\n    setLocalRole,\n    toggleSavedTask,\n    logout,\n  }), [user, userRole, theme, isLoading, savedTaskIds, toggleTheme, switchRole, setLocalRole, toggleSavedTask, logout]);\n\n  return (\n    <AppContext.Provider value={contextValue}>\n      {children}\n    </AppContext.Provider>\n  );\n};\n","path":null,"size_bytes":4569,"size_tokens":null},"attached_assets/DateTimePicker_1764551029324.tsx":{"content":"\nimport React, { useState } from 'react';\nimport { Modal } from './Modal';\nimport { useHaptic } from '../hooks/useHaptic';\n\ninterface DateTimePickerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelect: (value: string) => void;\n  mode: 'date' | 'time';\n  title: string;\n}\n\nexport const DateTimePicker: React.FC<DateTimePickerProps> = ({ isOpen, onClose, onSelect, mode, title }) => {\n  const { trigger } = useHaptic();\n  const [selected, setSelected] = useState<string>('');\n\n  // Mock Data for Date Generation\n  const getDates = () => {\n    const dates = [];\n    const today = new Date();\n    for (let i = 0; i < 14; i++) {\n      const d = new Date(today);\n      d.setDate(today.getDate() + i);\n      dates.push({\n        full: d.toISOString(),\n        day: d.toLocaleDateString('en-US', { weekday: 'short' }),\n        date: d.getDate(),\n        label: i === 0 ? 'Today' : i === 1 ? 'Tomorrow' : d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n      });\n    }\n    return dates;\n  };\n\n  // Mock Data for Time Generation\n  const getTimes = () => {\n    const times = [];\n    for (let i = 8; i <= 20; i++) {\n      times.push(`${i > 12 ? i - 12 : i}:00 ${i >= 12 ? 'PM' : 'AM'}`);\n      times.push(`${i > 12 ? i - 12 : i}:30 ${i >= 12 ? 'PM' : 'AM'}`);\n    }\n    return times;\n  };\n\n  const dates = getDates();\n  const times = getTimes();\n\n  const handleSelect = (val: string) => {\n      trigger(5);\n      setSelected(val);\n  };\n\n  const handleConfirm = () => {\n      trigger(10);\n      if (selected) onSelect(selected);\n      onClose();\n  };\n\n  return (\n    <Modal\n        isOpen={isOpen}\n        onClose={onClose}\n        title={title}\n        action={\n            <button \n                disabled={!selected}\n                onClick={handleConfirm}\n                className=\"w-full h-14 bg-primary text-white rounded-2xl font-bold text-lg hover:bg-primary/90 shadow-lg shadow-primary/25 active:scale-[0.98] transition-all disabled:opacity-50 disabled:shadow-none\"\n            >\n                Confirm\n            </button>\n        }\n    >\n        <div className=\"max-h-[40vh] overflow-y-auto no-scrollbar py-2\">\n            {mode === 'date' ? (\n                <div className=\"grid grid-cols-3 gap-3\">\n                    {dates.map((date, idx) => (\n                        <button\n                            key={idx}\n                            onClick={() => handleSelect(date.label)}\n                            className={`flex flex-col items-center justify-center p-4 rounded-2xl border-2 transition-all active:scale-95 ${\n                                selected === date.label \n                                ? 'border-primary bg-primary/10 text-primary ring-1 ring-primary/50' \n                                : 'border-transparent bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700'\n                            }`}\n                        >\n                            <span className=\"text-xs font-bold uppercase opacity-60\">{date.day}</span>\n                            <span className=\"text-xl font-black\">{date.date}</span>\n                            {idx < 2 && <span className=\"text-[10px] font-bold text-primary\">{idx === 0 ? 'Today' : 'Tmrw'}</span>}\n                        </button>\n                    ))}\n                </div>\n            ) : (\n                <div className=\"grid grid-cols-3 gap-3\">\n                    {times.map((time, idx) => (\n                        <button\n                            key={idx}\n                            onClick={() => handleSelect(time)}\n                            className={`p-3 rounded-2xl font-bold text-sm border-2 transition-all active:scale-95 ${\n                                selected === time \n                                ? 'border-primary bg-primary/10 text-primary' \n                                : 'border-transparent bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700'\n                            }`}\n                        >\n                            {time}\n                        </button>\n                    ))}\n                </div>\n            )}\n        </div>\n    </Modal>\n  );\n};\n","path":null,"size_bytes":4150,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/layout/BottomNav.tsx":{"content":"import { memo, useMemo, useCallback } from 'react';\nimport { useLocation, Link } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { useTranslation } from 'react-i18next';\nimport { cn } from '@/lib/utils';\nimport { LayoutDashboard, ListTodo, Wallet, User, Home, List, Search, Plus } from 'lucide-react';\n\ninterface NavItem {\n  icon: typeof Home;\n  labelKey: string;\n  path: string;\n  isCenter?: boolean;\n}\n\nexport const BottomNav = memo(function BottomNav() {\n  const [location] = useLocation();\n  const { userRole } = useApp();\n  const { t } = useTranslation();\n\n  const isActive = useCallback((path: string) => {\n    if (path === '/home') return location === '/home' || location === '/';\n    return location === path || location.startsWith(path + '/');\n  }, [location]);\n\n  const navItems: NavItem[] = useMemo(() => \n    userRole === 'tasker' \n      ? [\n          { icon: LayoutDashboard, labelKey: 'nav.home', path: '/home' },\n          { icon: ListTodo, labelKey: 'nav.tasks', path: '/tasks-feed' },\n          { icon: Wallet, labelKey: 'wallet.title', path: '/wallet' },\n          { icon: User, labelKey: 'nav.profile', path: '/profile' },\n        ]\n      : [\n          { icon: Home, labelKey: 'nav.home', path: '/home' },\n          { icon: List, labelKey: 'tasks.myTasks', path: '/my-tasks' },\n          { icon: Plus, labelKey: 'nav.categories', path: '/categories', isCenter: true },\n          { icon: Search, labelKey: 'searchTaskers.title', path: '/search-taskers' },\n          { icon: User, labelKey: 'nav.profile', path: '/profile' },\n        ],\n    [userRole]\n  );\n\n  const hiddenPaths = useMemo(() => [\n    '/',\n    '/welcome',\n    '/role',\n    '/register',\n    '/login',\n    '/settings',\n    '/wallet/withdraw',\n    '/wallet/add-card',\n  ], []);\n\n  const shouldHide = useMemo(() => \n    hiddenPaths.includes(location) || \n    location.startsWith('/post-task') || \n    location.startsWith('/task/') ||\n    location.startsWith('/chat/'),\n    [hiddenPaths, location]\n  );\n\n  if (shouldHide) {\n    return null;\n  }\n\n  return (\n    <motion.div \n      initial={{ y: 100, opacity: 0 }}\n      animate={{ y: 0, opacity: 1 }}\n      transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n      className=\"fixed bottom-0 left-0 right-0 z-50\"\n    >\n      <div className=\"mx-4 mb-4 pb-safe\">\n        <div className=\"glass-premium rounded-[28px] px-2 py-2 max-w-md mx-auto\">\n          <div className=\"flex justify-between items-center\">\n            {navItems.map((item) => {\n              const Icon = item.icon;\n              const active = isActive(item.path);\n              const label = t(item.labelKey);\n              \n              if (item.isCenter) {\n                return (\n                  <Link\n                    key={item.path}\n                    href={item.path}\n                    data-testid=\"nav-categories-center\"\n                    className=\"flex-1 flex justify-center\"\n                  >\n                    <motion.button\n                      whileTap={{ scale: 0.92 }}\n                      transition={{ type: \"spring\", stiffness: 400, damping: 20 }}\n                      className={cn(\n                        \"relative flex flex-col items-center justify-center gap-1 py-3 px-4 rounded-[22px] transition-all duration-300\",\n                        active && \"bg-primary/10 dark:bg-primary/20\"\n                      )}\n                    >\n                      <div className=\"w-10 h-10 rounded-full bg-white/10 dark:bg-white/5 backdrop-blur-sm border border-white/20 dark:border-white/10 flex items-center justify-center\">\n                        <Icon \n                          className={cn(\n                            \"w-5 h-5 transition-all duration-300\",\n                            active \n                              ? \"text-primary\" \n                              : \"text-muted-foreground\"\n                          )}\n                          strokeWidth={2}\n                        />\n                      </div>\n                      <motion.span \n                        initial={false}\n                        animate={{\n                          opacity: active ? 1 : 0.6,\n                          fontWeight: active ? 700 : 500,\n                        }}\n                        className={cn(\n                          \"text-[10px] tracking-wide transition-colors duration-300\",\n                          active ? \"text-primary\" : \"text-muted-foreground\"\n                        )}\n                      >\n                        {label}\n                      </motion.span>\n                    </motion.button>\n                  </Link>\n                );\n              }\n              \n              return (\n                <Link\n                  key={item.path}\n                  href={item.path}\n                  data-testid={`nav-${label.toLowerCase().replace(/\\s+/g, '-')}`}\n                  className=\"flex-1\"\n                >\n                  <motion.button\n                    whileTap={{ scale: 0.92 }}\n                    transition={{ type: \"spring\", stiffness: 400, damping: 20 }}\n                    className={cn(\n                      \"relative w-full flex flex-col items-center justify-center gap-1 py-3 px-2 rounded-[22px] transition-all duration-300\",\n                      active && \"bg-primary/10 dark:bg-primary/20\"\n                    )}\n                  >\n                    <AnimatePresence mode=\"wait\">\n                      {active && (\n                        <motion.div\n                          layoutId=\"activeNavPill\"\n                          initial={{ opacity: 0, scale: 0.8 }}\n                          animate={{ opacity: 1, scale: 1 }}\n                          exit={{ opacity: 0, scale: 0.8 }}\n                          transition={{ type: \"spring\", stiffness: 500, damping: 30 }}\n                          className=\"absolute inset-0 rounded-[22px] bg-gradient-to-r from-primary/15 to-accent/10 dark:from-primary/25 dark:to-accent/15\"\n                        />\n                      )}\n                    </AnimatePresence>\n                    \n                    <motion.div\n                      animate={{ \n                        scale: active ? 1 : 0.95,\n                        y: active ? -2 : 0\n                      }}\n                      transition={{ type: \"spring\", stiffness: 400, damping: 20 }}\n                      className=\"relative\"\n                    >\n                      <Icon \n                        className={cn(\n                          \"w-[22px] h-[22px] transition-all duration-300\",\n                          active \n                            ? \"text-primary drop-shadow-[0_0_8px_rgba(59,91,255,0.4)]\" \n                            : \"text-muted-foreground\"\n                        )}\n                        strokeWidth={active ? 2.5 : 2}\n                      />\n                      {active && (\n                        <motion.div\n                          initial={{ scale: 0 }}\n                          animate={{ scale: 1 }}\n                          className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-primary\"\n                        />\n                      )}\n                    </motion.div>\n                    \n                    <motion.span \n                      initial={false}\n                      animate={{\n                        opacity: active ? 1 : 0.6,\n                        fontWeight: active ? 700 : 500,\n                      }}\n                      className={cn(\n                        \"text-[10px] tracking-wide transition-colors duration-300\",\n                        active ? \"text-primary\" : \"text-muted-foreground\"\n                      )}\n                    >\n                      {label}\n                    </motion.span>\n                  </motion.button>\n                </Link>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n});\n","path":null,"size_bytes":7993,"size_tokens":null},"client/src/pages/SavedTasksScreen.tsx":{"content":"import { memo } from 'react';\nimport { useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { TaskCard } from '@/components/TaskCard';\nimport { useQuery } from '@tanstack/react-query';\nimport { TaskCardSkeleton, EmptyState } from '@/components/ui/animated';\nimport { ArrowLeft, Heart } from 'lucide-react';\nimport type { TaskWithDetails } from '@shared/schema';\n\nconst SavedTasksScreen = memo(function SavedTasksScreen() {\n  const [, setLocation] = useLocation();\n  const { savedTaskIds } = useApp();\n\n  const { data: savedTasks, isLoading, error } = useQuery<TaskWithDetails[]>({\n    queryKey: ['/api/tasks/saved', savedTaskIds],\n    enabled: savedTaskIds.length > 0,\n  });\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-b from-background to-primary/5 pt-safe pb-24 flex items-center justify-center\">\n        <EmptyState\n          icon={<Heart className=\"w-8 h-8\" />}\n          title=\"Something went wrong\"\n          description=\"We couldn't load your saved tasks. Please try again.\"\n          action={\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => window.location.reload()}\n              className=\"px-6 py-3 gradient-primary text-white rounded-xl font-bold\"\n            >\n              Retry\n            </motion.button>\n          }\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-24\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-20 -right-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center gap-4 mb-8\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => window.history.back()}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n          </motion.button>\n          <h1 className=\"text-2xl font-extrabold text-foreground\">Saved Tasks</h1>\n        </motion.div>\n\n        <AnimatePresence mode=\"wait\">\n          {isLoading ? (\n            <motion.div\n              key=\"loading\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              <TaskCardSkeleton count={3} />\n            </motion.div>\n          ) : savedTasks && savedTasks.length > 0 ? (\n            <motion.div\n              key=\"tasks\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"space-y-4\"\n            >\n              {savedTasks.map((task, index) => (\n                <motion.div\n                  key={task.id}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: index * 0.05 }}\n                >\n                  <TaskCard task={task} />\n                </motion.div>\n              ))}\n            </motion.div>\n          ) : (\n            <motion.div\n              key=\"empty\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              <EmptyState\n                icon={<Heart className=\"w-8 h-8\" />}\n                title=\"No saved tasks\"\n                description=\"Save tasks you're interested in to view them later\"\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n});\n\nexport default SavedTasksScreen;\n","path":null,"size_bytes":4100,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/TransactionCard.tsx":{"content":"import { memo, useCallback } from 'react';\nimport { Link } from 'wouter';\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { ArrowDownLeft, ArrowUpRight, Check, Clock } from 'lucide-react';\nimport type { Transaction } from '@shared/schema';\n\ninterface TransactionCardProps {\n  transaction: Transaction;\n  index?: number;\n}\n\nexport const TransactionCard = memo(function TransactionCard({ transaction, index = 0 }: TransactionCardProps) {\n  const formatCurrency = useCallback((amount: number | string) => {\n    const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(num);\n  }, []);\n\n  const formatDate = useCallback((date: Date | string) => {\n    const d = typeof date === 'string' ? new Date(date) : date;\n    return d.toLocaleDateString('en-US', { \n      month: 'short', \n      day: 'numeric',\n      year: 'numeric'\n    });\n  }, []);\n\n  const isCredit = transaction.type === 'credit';\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, x: -20 }}\n      animate={{ opacity: 1, x: 0 }}\n      transition={{ delay: index * 0.05 }}\n    >\n      <Link \n        href={`/wallet/transaction/${transaction.id}`}\n        data-testid={`transaction-card-${transaction.id}`}\n      >\n        <motion.div \n          whileTap={{ scale: 0.98 }}\n          className=\"flex items-center gap-4 p-4 glass rounded-2xl cursor-pointer hover:shadow-lg transition-shadow\"\n        >\n          <div className={cn(\n            \"w-12 h-12 rounded-2xl flex items-center justify-center\",\n            isCredit ? \"bg-success/15\" : \"bg-destructive/15\"\n          )}>\n            {isCredit ? (\n              <ArrowDownLeft className=\"w-5 h-5 text-success\" />\n            ) : (\n              <ArrowUpRight className=\"w-5 h-5 text-destructive\" />\n            )}\n          </div>\n          \n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-bold text-foreground truncate\">{transaction.title}</h4>\n            <div className=\"flex items-center gap-2 text-xs text-muted-foreground mt-1\">\n              <span>{formatDate(transaction.createdAt)}</span>\n              <span className={cn(\n                \"px-2 py-0.5 rounded-full font-bold uppercase tracking-wider text-[10px] flex items-center gap-1\",\n                transaction.status === 'completed' \n                  ? \"bg-success/15 text-success\" \n                  : \"bg-warning/15 text-warning\"\n              )}>\n                {transaction.status === 'completed' ? (\n                  <Check className=\"w-3 h-3\" />\n                ) : (\n                  <Clock className=\"w-3 h-3\" />\n                )}\n                {transaction.status}\n              </span>\n            </div>\n          </div>\n          \n          <div className={cn(\n            \"font-extrabold text-lg\",\n            isCredit ? 'text-success' : 'text-destructive'\n          )}>\n            {isCredit ? '+' : '-'}{formatCurrency(transaction.amount)}\n          </div>\n        </motion.div>\n      </Link>\n    </motion.div>\n  );\n});\n","path":null,"size_bytes":3163,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n  ToastIcon,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, variant, ...props }) {\n        return (\n          <Toast key={id} variant={variant} {...props}>\n            <ToastIcon variant={variant as \"default\" | \"destructive\" | \"success\" | undefined} />\n            <div className=\"flex-1 grid gap-0.5 pe-6\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":923,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"attached_assets/TaskCard_1764551029324.tsx":{"content":"\nimport React, { useEffect } from 'react';\nimport { Task } from '../types';\nimport { useApp } from '../context/AppContext';\nimport { useToast } from './Toast';\nimport { useIntersectionObserver } from '../hooks/useIntersectionObserver';\nimport { useSwipe } from '../hooks/useSwipe';\nimport { useHaptic } from '../hooks/useHaptic';\nimport { formatCurrency } from '../utils/helpers';\nimport { useViewTransitionNavigate } from '../hooks/useViewTransitionNavigate';\n\ninterface TaskCardProps {\n    task: Task;\n    idx: number;\n}\n\nexport const TaskCard: React.FC<TaskCardProps> = ({ task, idx }) => {\n    const navigate = useViewTransitionNavigate(); // Use the new hook\n    const { savedTaskIds, toggleSavedTask } = useApp();\n    const { showToast } = useToast();\n    const { ref, isIntersecting } = useIntersectionObserver({ freezeOnceVisible: true });\n    const { trigger } = useHaptic();\n\n    // Swipe Logic\n    const { handlers, offset } = useSwipe({\n        onSwipeLeft: async () => {\n            trigger(10);\n            await toggleSavedTask(task.id);\n            showToast(!savedTaskIds.includes(task.id) ? \"Task saved\" : \"Removed from saved\", \"info\");\n        },\n        threshold: 80\n    });\n\n    // Data Prefetching Simulation\n    useEffect(() => {\n        if (isIntersecting) {\n            // Preload images\n            if (task.images) {\n                task.images.forEach(imgSrc => {\n                    const img = new Image();\n                    img.src = imgSrc;\n                });\n            }\n            if (task.taskerAvatar) {\n                const img = new Image();\n                img.src = task.taskerAvatar;\n            }\n        }\n    }, [isIntersecting, task]);\n\n    const handleToggleSave = async (e: React.MouseEvent) => {\n        e.stopPropagation();\n        trigger(5);\n        try {\n            await toggleSavedTask(task.id);\n            showToast(!savedTaskIds.includes(task.id) ? \"Task saved\" : \"Removed from saved\", \"info\");\n        } catch (e) {\n            showToast(\"Failed to update. Please try again.\", \"error\");\n        }\n    };\n\n    // Swipe Styling\n    const swipeStyle = {\n        transform: `translateX(${offset.x}px)`,\n        transition: offset.x === 0 ? 'transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)' : 'none'\n    };\n\n    const isSaved = savedTaskIds.includes(task.id);\n\n    return (\n        <div className=\"relative overflow-hidden rounded-[2rem]\">\n            {/* Swipe Background Layer */}\n            <div className=\"absolute inset-0 bg-surface dark:bg-surface-dark flex items-center justify-end px-8 rounded-[2rem]\">\n                <div className={`flex items-center gap-2 font-bold transition-all duration-300 ${Math.abs(offset.x) > 50 ? 'opacity-100 scale-110' : 'opacity-50 scale-100'} ${isSaved ? 'text-gray-500' : 'text-primary'}`}>\n                    <span className={`material-symbols-outlined ${isSaved ? '' : 'material-symbols-filled'}`}>favorite</span>\n                    <span>{isSaved ? 'Unsave' : 'Save'}</span>\n                </div>\n            </div>\n\n            <div \n                ref={ref as React.RefObject<HTMLDivElement>}\n                onClick={() => navigate(`/task/${task.id}`)}\n                {...handlers}\n                style={{ ...swipeStyle, viewTransitionName: `task-card-${task.id}` }}\n                className=\"bg-white dark:bg-surface-dark shadow-sm overflow-hidden cursor-pointer group p-6 relative transition-shadow duration-300 hover:shadow-xl border border-transparent hover:border-gray-100 dark:hover:border-gray-700 active:scale-[0.99] z-10\"\n            >\n                <button \n                    aria-label={isSaved ? \"Remove from saved\" : \"Save task\"}\n                    onClick={handleToggleSave}\n                    className=\"absolute top-5 end-5 w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-50 dark:hover:bg-gray-800 transition-all z-10 active:scale-75 duration-300\"\n                >\n                    <span className={`material-symbols-outlined text-[22px] transition-all duration-300 ${isSaved ? 'material-symbols-filled text-danger scale-110 animate-pulse-slow' : 'text-gray-400'}`}>favorite</span>\n                </button>\n\n                <div className=\"flex justify-between items-start mb-3 pe-10\">\n                    <div>\n                        <div className=\"text-[10px] font-bold text-text-secondary uppercase tracking-wider mb-1\">{task.category}</div>\n                        <h3 className=\"text-xl font-bold text-text-primary dark:text-text-primary-dark leading-tight\">{task.title}</h3>\n                    </div>\n                </div>\n                \n                <p className=\"text-text-secondary dark:text-text-secondary-dark text-sm mb-5 line-clamp-2 leading-relaxed\">{task.description}</p>\n                \n                <div className=\"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-800\">\n                    <div className=\"flex items-center gap-4 text-xs font-bold text-text-secondary dark:text-text-secondary-dark\">\n                        <div className=\"flex items-center gap-1.5 bg-gray-50 dark:bg-gray-800 px-3 py-1.5 rounded-xl transition-colors group-hover:bg-gray-100 dark:group-hover:bg-gray-700\">\n                            <span className=\"material-symbols-outlined text-base text-primary\">location_on</span>\n                            {task.distance}\n                        </div>\n                        <div className=\"flex items-center gap-1.5 bg-gray-50 dark:bg-gray-800 px-3 py-1.5 rounded-xl transition-colors group-hover:bg-gray-100 dark:group-hover:bg-gray-700\">\n                            <span className=\"material-symbols-outlined text-base text-primary\">schedule</span>\n                            {task.time}\n                        </div>\n                    </div>\n                    <div className=\"font-extrabold text-lg text-primary bg-primary/5 px-3 py-1 rounded-lg\">\n                        {formatCurrency(task.budget)}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","path":null,"size_bytes":6061,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/pages/EditProfileScreen.tsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useLocation } from 'wouter';\nimport { motion } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { Screen } from '@/components/layout/Screen';\nimport { FloatingInput } from '@/components/FloatingInput';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { useToast } from '@/hooks/use-toast';\nimport { useTranslation } from 'react-i18next';\nimport { Camera, ArrowLeft, Loader2 } from 'lucide-react';\nimport type { User } from '@shared/schema';\n\nexport default function EditProfileScreen() {\n  const [, setLocation] = useLocation();\n  const { setUser } = useApp();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const isAuthenticated = !!localStorage.getItem('userId');\n  \n  const { data: currentUser } = useQuery<User>({\n    queryKey: ['/api/users/me'],\n    enabled: isAuthenticated,\n  });\n\n  const [formData, setFormData] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    bio: '',\n    location: '',\n  });\n  const [avatarPreview, setAvatarPreview] = useState<string | null>(null);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    if (currentUser) {\n      setFormData({\n        name: currentUser.name || '',\n        email: currentUser.email || '',\n        phone: currentUser.phone || '',\n        bio: currentUser.bio || '',\n        location: currentUser.location || '',\n      });\n      if (currentUser.avatar) {\n        setAvatarPreview(currentUser.avatar);\n      }\n    }\n  }, [currentUser]);\n\n  const handleAvatarClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (file.size > 5 * 1024 * 1024) {\n        toast({ \n          title: t('errors.somethingWentWrong'), \n          description: 'Image size must be less than 5MB', \n          variant: 'destructive' \n        });\n        return;\n      }\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        const base64 = event.target?.result as string;\n        setAvatarPreview(base64);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: typeof formData & { avatar?: string }) => {\n      const response = await apiRequest('PATCH', '/api/users/me', data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setUser(data);\n      queryClient.invalidateQueries({ queryKey: ['/api/users/me'] });\n      toast({ title: t('profile.editProfile'), description: t('common.save') });\n      setLocation('/profile');\n    },\n    onError: (error: Error) => {\n      toast({ title: t('errors.somethingWentWrong'), description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const validateForm = () => {\n    const newErrors: Record<string, string> = {};\n    \n    if (!formData.name.trim()) newErrors.name = 'Name is required';\n    if (!formData.email.trim()) newErrors.email = 'Email is required';\n    else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) newErrors.email = 'Invalid email';\n    \n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = () => {\n    if (validateForm()) {\n      const dataToSend = avatarPreview && avatarPreview !== currentUser?.avatar\n        ? { ...formData, avatar: avatarPreview }\n        : formData;\n      updateProfileMutation.mutate(dataToSend);\n    }\n  };\n\n  const handleChange = (field: string) => (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    setFormData(prev => ({ ...prev, [field]: e.target.value }));\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: '' }));\n    }\n  };\n\n  const getInitials = (name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n  };\n\n  return (\n    <Screen className=\"px-6\">\n      <motion.div \n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"flex items-center gap-4 py-4 mb-4\"\n      >\n        <motion.button \n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={() => window.history.back()}\n          className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-5 h-5 text-foreground/80 rtl:rotate-180\" />\n        </motion.button>\n        <h1 className=\"text-2xl font-extrabold text-foreground\">{t('profile.editProfile')}</h1>\n      </motion.div>\n\n      <motion.div \n        initial={{ opacity: 0, scale: 0.9 }}\n        animate={{ opacity: 1, scale: 1 }}\n        className=\"flex flex-col items-center mb-8\"\n      >\n        <div className=\"relative\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/*\"\n            onChange={handleFileChange}\n            className=\"hidden\"\n            data-testid=\"input-avatar-file\"\n          />\n          <motion.div\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={handleAvatarClick}\n            className=\"cursor-pointer\"\n          >\n            <div className=\"absolute -inset-1 bg-gradient-to-br from-primary/40 to-accent/40 rounded-full blur-md\" />\n            <Avatar className=\"relative w-28 h-28 border-4 border-white/50 dark:border-white/20 shadow-2xl\">\n              <AvatarImage src={avatarPreview || undefined} />\n              <AvatarFallback className=\"gradient-primary text-white text-3xl font-bold\">\n                {formData.name ? getInitials(formData.name) : 'U'}\n              </AvatarFallback>\n            </Avatar>\n          </motion.div>\n          <motion.button \n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n            onClick={handleAvatarClick}\n            className=\"absolute -bottom-1 -right-1 w-10 h-10 gradient-primary text-white rounded-2xl flex items-center justify-center shadow-lg shadow-primary/30 border-2 border-white/50 rtl:-left-1 rtl:right-auto\"\n            data-testid=\"button-change-avatar\"\n          >\n            <Camera className=\"w-4 h-4\" />\n          </motion.button>\n        </div>\n        <p className=\"text-sm text-muted-foreground mt-4\">{t('profile.editProfile')}</p>\n      </motion.div>\n\n      <div className=\"space-y-4 flex-1\">\n        <FloatingInput\n          label=\"Full Name\"\n          value={formData.name}\n          onChange={handleChange('name')}\n          error={errors.name}\n        />\n        \n        <FloatingInput\n          label=\"Email Address\"\n          type=\"email\"\n          value={formData.email}\n          onChange={handleChange('email')}\n          error={errors.email}\n        />\n        \n        <FloatingInput\n          label=\"Phone Number\"\n          type=\"tel\"\n          value={formData.phone}\n          onChange={handleChange('phone')}\n        />\n        \n        <FloatingInput\n          label=\"Location\"\n          value={formData.location}\n          onChange={handleChange('location')}\n        />\n        \n        <div className=\"relative\">\n          <textarea\n            value={formData.bio}\n            onChange={handleChange('bio')}\n            placeholder=\"Tell others about yourself...\"\n            className=\"w-full h-32 p-4 rounded-2xl border-2 border-transparent bg-card shadow-sm outline-none transition-all placeholder:text-muted-foreground font-medium text-foreground resize-none focus:border-primary/50\"\n            data-testid=\"textarea-bio\"\n          />\n          <label className=\"absolute left-4 top-3 text-[10px] font-bold text-primary uppercase tracking-wider\">\n            Bio\n          </label>\n        </div>\n      </div>\n\n      <motion.div \n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.2 }}\n        className=\"mt-8 pb-4\"\n      >\n        <motion.button\n          whileHover={{ scale: 1.01 }}\n          whileTap={{ scale: 0.98 }}\n          onClick={handleSubmit}\n          disabled={updateProfileMutation.isPending}\n          className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-lg shadow-primary/25 disabled:opacity-50 disabled:shadow-none transition-all\"\n          data-testid=\"button-save-profile\"\n        >\n          {updateProfileMutation.isPending ? (\n            <div className=\"flex items-center justify-center gap-2\">\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n              {t('common.loading')}\n            </div>\n          ) : (\n            t('common.save')\n          )}\n        </motion.button>\n      </motion.div>\n    </Screen>\n  );\n}\n","path":null,"size_bytes":8903,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"attached_assets/types_1764551013653.ts":{"content":"\nexport type UserRole = 'client' | 'tasker';\n\nexport interface Task {\n  id: string;\n  title: string;\n  description: string;\n  budget: number;\n  location: string;\n  date: string;\n  time: string;\n  status: 'open' | 'assigned' | 'in_progress' | 'completed' | 'cancelled';\n  category: string;\n  distance?: string;\n  images?: string[];\n  clientName?: string;\n  taskerName?: string;\n  taskerAvatar?: string;\n}\n\nexport interface Offer {\n  id: string;\n  taskId?: string;\n  taskerName: string;\n  taskerAvatar: string;\n  rating: number;\n  jobs: number;\n  amount: number;\n  message: string;\n  time: string;\n}\n\nexport interface Transaction {\n  id: string;\n  title: string;\n  date: string;\n  amount: number;\n  type: 'credit' | 'debit';\n  status: 'completed' | 'pending';\n  icon: string;\n  colorClass: string;\n}\n\nexport interface User {\n  name: string;\n  role: UserRole;\n  balance: number;\n  avatar: string;\n  rating: number;\n  completedTasks: number;\n}\n\nexport interface Notification {\n  id: number;\n  type: 'offer' | 'system' | 'chat';\n  title: string;\n  message: string;\n  time: string;\n  read: boolean;\n  icon: string;\n  color: string;\n  action?: string;\n}\n","path":null,"size_bytes":1147,"size_tokens":null},"client/src/pages/ConversationsScreen.tsx":{"content":"import { memo, useCallback } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useQuery } from '@tanstack/react-query';\nimport { Skeleton, EmptyState } from '@/components/ui/animated';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { cn } from '@/lib/utils';\nimport { ArrowLeft, MessageSquare } from 'lucide-react';\nimport type { ConversationPreview } from '@shared/schema';\n\nconst ConversationsScreen = memo(function ConversationsScreen() {\n  const [, setLocation] = useLocation();\n  const isAuthenticated = !!localStorage.getItem('userId');\n  \n  const { data: conversations, isLoading, error } = useQuery<ConversationPreview[]>({\n    queryKey: ['/api/conversations'],\n    enabled: isAuthenticated,\n  });\n\n  const getInitials = useCallback((name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n  }, []);\n\n  const formatTime = useCallback((date: Date | string) => {\n    const d = typeof date === 'string' ? new Date(date) : date;\n    const now = new Date();\n    const diff = now.getTime() - d.getTime();\n    const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n    \n    if (days === 0) {\n      return d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });\n    } else if (days === 1) {\n      return 'Yesterday';\n    } else if (days < 7) {\n      return d.toLocaleDateString('en-US', { weekday: 'short' });\n    } else {\n      return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n    }\n  }, []);\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-b from-background to-primary/5 pt-safe pb-24 flex items-center justify-center\">\n        <EmptyState\n          icon={<MessageSquare className=\"w-8 h-8\" />}\n          title=\"Something went wrong\"\n          description=\"We couldn't load your messages. Please try again.\"\n          action={\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => window.location.reload()}\n              className=\"px-6 py-3 gradient-primary text-white rounded-xl font-bold\"\n            >\n              Retry\n            </motion.button>\n          }\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-24\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-40 -left-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center gap-4 mb-8\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => setLocation('/home')}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n          </motion.button>\n          <h1 className=\"text-2xl font-extrabold text-foreground\">Messages</h1>\n        </motion.div>\n\n        <div className=\"space-y-2\">\n          <AnimatePresence mode=\"wait\">\n            {isLoading ? (\n              <motion.div\n                key=\"loading\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"space-y-2\"\n              >\n                {[1, 2, 3, 4].map((i) => (\n                  <div key={i} className=\"flex items-center gap-4 p-4 glass rounded-2xl\">\n                    <Skeleton className=\"w-14 h-14 rounded-full flex-shrink-0\" />\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center justify-between mb-1\">\n                        <Skeleton className=\"h-4 w-32\" />\n                        <Skeleton className=\"h-3 w-12\" />\n                      </div>\n                      <Skeleton className=\"h-3 w-full\" />\n                    </div>\n                  </div>\n                ))}\n              </motion.div>\n            ) : conversations && conversations.length > 0 ? (\n              <motion.div\n                key=\"conversations\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"space-y-2\"\n              >\n                {conversations.map((conv, index) => (\n                  <motion.div\n                    key={conv.taskId}\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    transition={{ delay: index * 0.05 }}\n                  >\n                    <Link href={`/chat/${conv.taskId}`}>\n                      <motion.div \n                        whileTap={{ scale: 0.98 }}\n                        className={cn(\n                          \"flex items-center gap-4 p-4 rounded-2xl cursor-pointer transition-all\",\n                          conv.unreadCount > 0 ? \"glass-premium gradient-border\" : \"glass\"\n                        )}\n                        data-testid={`conversation-${conv.taskId}`}\n                      >\n                        <div className=\"relative\">\n                          <Avatar className=\"w-14 h-14 border-2 border-white/20 shadow-lg\">\n                            <AvatarImage src={conv.otherUser?.avatar || undefined} />\n                            <AvatarFallback className=\"gradient-primary text-white font-bold\">\n                              {conv.otherUser?.name ? getInitials(conv.otherUser.name) : 'U'}\n                            </AvatarFallback>\n                          </Avatar>\n                          {conv.unreadCount > 0 && (\n                            <motion.div \n                              initial={{ scale: 0 }}\n                              animate={{ scale: 1 }}\n                              className=\"absolute -top-1 -right-1 w-6 h-6 gradient-primary text-white rounded-full flex items-center justify-center text-xs font-bold shadow-lg shadow-primary/30\"\n                            >\n                              {conv.unreadCount > 9 ? '9+' : conv.unreadCount}\n                            </motion.div>\n                          )}\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between mb-1\">\n                            <h3 className=\"font-bold text-foreground truncate\">\n                              {conv.otherUser?.name}\n                            </h3>\n                            <span className=\"text-xs text-muted-foreground flex-shrink-0\">\n                              {conv.lastMessage?.createdAt && formatTime(conv.lastMessage.createdAt)}\n                            </span>\n                          </div>\n                          <p className=\"text-sm text-muted-foreground truncate mb-1\">\n                            {conv.taskTitle}\n                          </p>\n                          <p className={cn(\n                            \"text-sm truncate\",\n                            conv.unreadCount > 0 ? \"font-bold text-foreground\" : \"text-muted-foreground\"\n                          )}>\n                            {conv.lastMessage?.content || 'No messages yet'}\n                          </p>\n                        </div>\n                      </motion.div>\n                    </Link>\n                  </motion.div>\n                ))}\n              </motion.div>\n            ) : (\n              <motion.div\n                key=\"empty\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n              >\n                <EmptyState\n                  icon={<MessageSquare className=\"w-8 h-8\" />}\n                  title=\"No conversations yet\"\n                  description=\"Start chatting with clients or taskers about tasks\"\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nexport default ConversationsScreen;\n","path":null,"size_bytes":8429,"size_tokens":null},"attached_assets/Screen_1764551039408.tsx":{"content":"import React from 'react';\nimport { cn } from '../../lib/utils';\n\ninterface ScreenProps extends React.HTMLAttributes<HTMLDivElement> {\n  children: React.ReactNode;\n  safeAreaBottom?: boolean;\n  safeAreaTop?: boolean;\n}\n\nexport const Screen: React.FC<ScreenProps> = ({ \n  children, \n  className, \n  safeAreaBottom = true, \n  safeAreaTop = true,\n  ...props \n}) => {\n  return (\n    <div \n      className={cn(\n        \"flex flex-col min-h-screen w-full bg-background-light dark:bg-background-dark\",\n        safeAreaTop && \"pt-[env(safe-area-inset-top)]\",\n        safeAreaBottom && \"pb-[calc(env(safe-area-inset-bottom)+80px)]\", // +80px for bottom nav clearance\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n};","path":null,"size_bytes":743,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./i18n\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":174,"size_tokens":null},"client/src/components/layout/Screen.tsx":{"content":"import { cn } from '@/lib/utils';\nimport type { ReactNode, HTMLAttributes } from 'react';\n\ninterface ScreenProps extends HTMLAttributes<HTMLDivElement> {\n  children: ReactNode;\n  safeAreaBottom?: boolean;\n  safeAreaTop?: boolean;\n  noPadding?: boolean;\n}\n\nexport function Screen({ \n  children, \n  className, \n  safeAreaBottom = true, \n  safeAreaTop = true,\n  noPadding = false,\n  ...props \n}: ScreenProps) {\n  return (\n    <div \n      className={cn(\n        \"flex flex-col min-h-screen w-full bg-background\",\n        safeAreaTop && \"pt-safe\",\n        safeAreaBottom && \"pb-[calc(env(safe-area-inset-bottom)+80px)]\",\n        !noPadding && \"px-4\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n}\n","path":null,"size_bytes":731,"size_tokens":null},"client/src/components/Logo.tsx":{"content":"import { memo } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface LogoProps {\n  className?: string;\n  size?: number;\n}\n\nconst Logo = memo(function Logo({ className, size = 48 }: LogoProps) {\n  return (\n    <svg\n      width={size}\n      height={size}\n      viewBox=\"0 0 100 100\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className={cn('flex-shrink-0', className)}\n      data-testid=\"logo\"\n    >\n      {/* Top person - head */}\n      <circle cx=\"50\" cy=\"8\" r=\"5\" fill=\"#3B5BFF\" />\n      {/* Top person - body (V shape like checkmark) */}\n      <path\n        d=\"M42 18 C42 18 50 28 50 28 C50 28 58 18 58 18\"\n        stroke=\"#3B5BFF\"\n        strokeWidth=\"6\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n      />\n      \n      {/* Top-right person - head */}\n      <circle cx=\"83\" cy=\"25\" r=\"5\" fill=\"#3B5BFF\" />\n      {/* Top-right person - body */}\n      <path\n        d=\"M73 30 C73 30 78 42 78 42 C78 42 88 35 88 35\"\n        stroke=\"#3B5BFF\"\n        strokeWidth=\"6\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n      />\n      \n      {/* Bottom-right person - head */}\n      <circle cx=\"83\" cy=\"75\" r=\"5\" fill=\"#3B5BFF\" />\n      {/* Bottom-right person - body */}\n      <path\n        d=\"M88 65 C88 65 78 58 78 58 C78 58 73 70 73 70\"\n        stroke=\"#3B5BFF\"\n        strokeWidth=\"6\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n      />\n      \n      {/* Bottom person - head */}\n      <circle cx=\"50\" cy=\"92\" r=\"5\" fill=\"#3B5BFF\" />\n      {/* Bottom person - body (inverted V) */}\n      <path\n        d=\"M58 82 C58 82 50 72 50 72 C50 72 42 82 42 82\"\n        stroke=\"#3B5BFF\"\n        strokeWidth=\"6\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n      />\n      \n      {/* Bottom-left person - head */}\n      <circle cx=\"17\" cy=\"75\" r=\"5\" fill=\"#3B5BFF\" />\n      {/* Bottom-left person - body */}\n      <path\n        d=\"M12 65 C12 65 22 58 22 58 C22 58 27 70 27 70\"\n        stroke=\"#3B5BFF\"\n        strokeWidth=\"6\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n      />\n      \n      {/* Top-left person - head */}\n      <circle cx=\"17\" cy=\"25\" r=\"5\" fill=\"#3B5BFF\" />\n      {/* Top-left person - body */}\n      <path\n        d=\"M27 30 C27 30 22 42 22 42 C22 42 12 35 12 35\"\n        stroke=\"#3B5BFF\"\n        strokeWidth=\"6\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n      />\n      \n      {/* Center checkmark - accent color (turquoise) - smaller size */}\n      <path\n        d=\"M38 52 L46 60 L62 42\"\n        stroke=\"#2ED1C4\"\n        strokeWidth=\"7\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n      />\n    </svg>\n  );\n});\n\nexport default Logo;\n","path":null,"size_bytes":2822,"size_tokens":null},"client/src/pages/SettingsScreen.tsx":{"content":"import { memo, useCallback, useMemo, useState, useEffect } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useApp } from '@/context/AppContext';\nimport { useToast } from '@/hooks/use-toast';\nimport { usePushNotifications } from '@/hooks/usePushNotifications';\nimport { useBiometricAuth } from '@/hooks/useBiometricAuth';\nimport { cn } from '@/lib/utils';\nimport { \n  ArrowLeft, User, Lock, Bell, Moon, Sun, ArrowLeftRight, \n  HelpCircle, FileText, Shield, LogOut, ChevronRight, Languages,\n  BadgeCheck, Check, Briefcase, BellRing, Fingerprint\n} from 'lucide-react';\n\ninterface SettingItem {\n  icon: typeof User;\n  label: string;\n  path?: string;\n  action?: () => void;\n  toggle?: boolean;\n  value?: boolean;\n  rightText?: string;\n  destructive?: boolean;\n  iconColor?: string;\n}\n\ninterface SettingGroup {\n  title: string;\n  items: SettingItem[];\n}\n\nconst SettingsScreen = memo(function SettingsScreen() {\n  const [, setLocation] = useLocation();\n  const { t, i18n } = useTranslation();\n  const { theme, toggleTheme, userRole, switchRole, logout, user } = useApp();\n  const { toast } = useToast();\n  const [showLanguageSheet, setShowLanguageSheet] = useState(false);\n  \n  const { isSupported: pushSupported, isSubscribed, subscribe, unsubscribe, isLoading: pushLoading } = usePushNotifications();\n  const { isSupported: biometricSupported, isEnabled: biometricEnabled, enable: enableBiometric, disable: disableBiometric, checkAvailability, isLoading: biometricLoading } = useBiometricAuth();\n  \n  useEffect(() => {\n    checkAvailability();\n  }, [checkAvailability]);\n  \n  const isArabic = i18n.language === 'ar';\n  const currentLanguage = isArabic ? t('settings.arabic') : t('settings.english');\n  \n  const handlePushToggle = useCallback(async () => {\n    if (isSubscribed) {\n      await unsubscribe();\n    } else {\n      await subscribe();\n    }\n  }, [isSubscribed, subscribe, unsubscribe]);\n  \n  const handleBiometricToggle = useCallback(async () => {\n    if (biometricEnabled) {\n      await disableBiometric();\n    } else {\n      await enableBiometric();\n    }\n  }, [biometricEnabled, enableBiometric, disableBiometric]);\n\n  const handleLogout = useCallback(() => {\n    logout();\n    setLocation('/');\n  }, [logout, setLocation]);\n  \n  const handleLanguageChange = useCallback((lang: string) => {\n    i18n.changeLanguage(lang);\n    setShowLanguageSheet(false);\n  }, [i18n]);\n\n  const handleSwitchRole = useCallback(async () => {\n    const result = await switchRole(userRole === 'client' ? 'tasker' : 'client');\n    if (!result.success) {\n      toast({\n        title: isArabic ? 'خطأ' : 'Error',\n        description: result.error || (isArabic ? 'فشل في تبديل الدور' : 'Failed to switch role'),\n        variant: 'destructive',\n      });\n    }\n  }, [switchRole, userRole, toast, isArabic]);\n\n  const accountItems: SettingItem[] = useMemo(() => [\n    { icon: User, label: t('profile.editProfile'), path: '/profile/edit' },\n    { icon: Lock, label: t('settings.changePassword'), action: () => {} },\n    ...(pushSupported ? [{\n      icon: BellRing,\n      label: isArabic ? 'الإشعارات الفورية' : 'Push Notifications',\n      toggle: true,\n      value: isSubscribed,\n      action: handlePushToggle,\n    }] : []),\n    ...(biometricSupported ? [{\n      icon: Fingerprint,\n      label: isArabic ? 'تسجيل الدخول بالبصمة' : 'Face ID / Touch ID',\n      toggle: true,\n      value: biometricEnabled,\n      action: handleBiometricToggle,\n    }] : []),\n    ...(userRole === 'tasker' ? [{ icon: BadgeCheck, label: t('settings.verifyIdentity'), path: '/verify', iconColor: 'text-accent' }] : []),\n  ], [t, userRole, pushSupported, isSubscribed, handlePushToggle, biometricSupported, biometricEnabled, handleBiometricToggle, isArabic]);\n\n  const preferencesItems: SettingItem[] = useMemo(() => [\n    { \n      icon: Languages, \n      label: t('settings.language'), \n      rightText: currentLanguage,\n      action: () => setShowLanguageSheet(true)\n    },\n  ], [t, currentLanguage]);\n\n  const supportItems: SettingItem[] = useMemo(() => [\n    { icon: HelpCircle, label: t('settings.help'), path: '/help' },\n    { icon: FileText, label: t('settings.terms'), path: '/terms' },\n    { icon: Shield, label: t('settings.privacy_policy'), path: '/privacy' },\n  ], [t]);\n\n  const adminItems: SettingItem[] = useMemo(() => \n    user?.isAdmin ? [\n      { icon: Shield, label: isArabic ? 'لوحة الأدمن' : 'Admin Panel', path: '/admin', iconColor: 'text-amber-500' },\n    ] : []\n  , [user?.isAdmin, isArabic]);\n\n  const renderSettingItem = (item: SettingItem, idx: number, total: number) => {\n    const Icon = item.icon;\n    const itemClasses = cn(\n      \"flex items-center justify-between p-4 transition-all hover:bg-white/5 w-full\",\n      idx < total - 1 && \"border-b border-white/10\"\n    );\n    \n    const itemContent = (\n      <>\n        <div className=\"flex items-center gap-4\">\n          <div className={cn(\n            \"w-11 h-11 rounded-2xl flex items-center justify-center\",\n            item.destructive ? \"bg-destructive/15\" : \"bg-primary/15\"\n          )}>\n            <Icon className={cn(\n              \"w-5 h-5\",\n              item.iconColor || (item.destructive ? \"text-destructive\" : \"text-primary\")\n            )} />\n          </div>\n          <span className={cn(\n            \"font-medium text-start\",\n            item.destructive ? \"text-destructive\" : \"text-foreground\"\n          )}>\n            {item.label}\n          </span>\n        </div>\n        {item.toggle ? (\n          <div\n            className={cn(\n              \"w-14 h-8 rounded-full transition-all relative flex-shrink-0\",\n              item.value ? \"gradient-primary shadow-lg shadow-primary/30\" : \"bg-muted\"\n            )}\n          >\n            <motion.div \n              animate={{ x: item.value ? 24 : 4 }}\n              transition={{ type: \"spring\", stiffness: 500, damping: 30 }}\n              className=\"w-6 h-6 bg-white rounded-full absolute top-1 shadow-sm\"\n            />\n          </div>\n        ) : item.rightText ? (\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-muted-foreground text-sm\">{item.rightText}</span>\n            <ChevronRight className=\"w-5 h-5 text-muted-foreground rtl:rotate-180\" />\n          </div>\n        ) : (\n          <ChevronRight className=\"w-5 h-5 text-muted-foreground rtl:rotate-180\" />\n        )}\n      </>\n    );\n\n    if (item.path) {\n      return (\n        <Link key={item.label} href={item.path}>\n          <motion.div \n            whileTap={{ scale: 0.98 }}\n            className={itemClasses}\n            data-testid={`link-${item.label.toLowerCase().replace(/\\s+/g, '-')}`}\n          >\n            {itemContent}\n          </motion.div>\n        </Link>\n      );\n    }\n    \n    return (\n      <motion.button \n        key={item.label} \n        onClick={item.action} \n        whileTap={{ scale: 0.98 }}\n        className={itemClasses}\n        data-testid={`button-${item.label.toLowerCase().replace(/\\s+/g, '-')}`}\n      >\n        {itemContent}\n      </motion.button>\n    );\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-40\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-40 -right-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center gap-4 mb-8\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => window.history.back()}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5 rtl:rotate-180\" />\n          </motion.button>\n          <h1 className=\"text-2xl font-extrabold text-foreground\">{t('settings.title')}</h1>\n        </motion.div>\n\n        <div className=\"space-y-6\">\n          <motion.div \n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.1 }}\n          >\n            <h2 className=\"text-xs font-bold text-muted-foreground uppercase tracking-widest mb-3 px-1\">\n              {t('settings.account')}\n            </h2>\n            <div className=\"glass rounded-3xl overflow-hidden\">\n              {accountItems.map((item, idx) => renderSettingItem(item, idx, accountItems.length))}\n            </div>\n          </motion.div>\n\n          <motion.div \n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.2 }}\n          >\n            <h2 className=\"text-xs font-bold text-muted-foreground uppercase tracking-widest mb-3 px-1\">\n              {t('settings.preferences')}\n            </h2>\n            <div className=\"glass rounded-3xl overflow-hidden\">\n              {preferencesItems.map((item, idx) => renderSettingItem(item, idx, preferencesItems.length))}\n              <motion.button \n                onClick={toggleTheme}\n                whileTap={{ scale: 0.98 }}\n                className=\"flex items-center justify-between p-4 transition-all hover:bg-white/5 w-full\"\n                data-testid=\"button-theme-toggle\"\n              >\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"w-11 h-11 rounded-2xl flex items-center justify-center bg-primary/15\">\n                    {theme === 'dark' ? (\n                      <Moon className=\"w-5 h-5 text-primary\" />\n                    ) : (\n                      <Sun className=\"w-5 h-5 text-primary\" />\n                    )}\n                  </div>\n                  <span className=\"font-medium text-foreground text-start\">\n                    {t('settings.darkMode')}\n                  </span>\n                </div>\n                <div className=\"flex items-center gap-2 p-1 rounded-full bg-muted/50\">\n                  <motion.button\n                    whileTap={{ scale: 0.95 }}\n                    onClick={(e) => { e.stopPropagation(); if (theme === 'dark') toggleTheme(); }}\n                    className={cn(\n                      \"w-9 h-9 rounded-full flex items-center justify-center transition-all\",\n                      theme === 'light' \n                        ? \"gradient-primary text-white shadow-lg\" \n                        : \"text-muted-foreground hover:text-foreground\"\n                    )}\n                  >\n                    <Sun className=\"w-4 h-4\" />\n                  </motion.button>\n                  <motion.button\n                    whileTap={{ scale: 0.95 }}\n                    onClick={(e) => { e.stopPropagation(); if (theme === 'light') toggleTheme(); }}\n                    className={cn(\n                      \"w-9 h-9 rounded-full flex items-center justify-center transition-all\",\n                      theme === 'dark' \n                        ? \"gradient-primary text-white shadow-lg\" \n                        : \"text-muted-foreground hover:text-foreground\"\n                    )}\n                  >\n                    <Moon className=\"w-4 h-4\" />\n                  </motion.button>\n                </div>\n              </motion.button>\n            </div>\n          </motion.div>\n\n          {user?.verificationStatus === 'approved' && (\n            <motion.button\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.25 }}\n              whileHover={{ scale: 1.01 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={handleSwitchRole}\n              className=\"w-full p-4 bg-primary/10 border-2 border-primary/30 rounded-2xl flex items-center justify-between transition-all hover:bg-primary/15\"\n              data-testid=\"button-switch-mode\"\n            >\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-11 h-11 bg-primary/20 rounded-2xl flex items-center justify-center\">\n                  <ArrowLeftRight className=\"w-5 h-5 text-primary\" />\n                </div>\n                <div className=\"text-start\">\n                  <span className=\"font-bold text-foreground block\">\n                    {userRole === 'client' ? t('settings.switchToTasker') : t('settings.switchToClient')}\n                  </span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {t('settings.switchModeDesc')}\n                  </span>\n                </div>\n              </div>\n              <ChevronRight className=\"w-5 h-5 text-primary rtl:rotate-180\" />\n            </motion.button>\n          )}\n\n          {!user?.verificationStatus && userRole === 'client' && (\n            <Link href=\"/tasker-type\">\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.25 }}\n                whileHover={{ scale: 1.01 }}\n                whileTap={{ scale: 0.98 }}\n                className=\"w-full p-4 bg-accent/10 border-2 border-accent/30 rounded-2xl flex items-center justify-between transition-all hover:bg-accent/15 cursor-pointer\"\n                data-testid=\"button-become-tasker\"\n              >\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"w-11 h-11 bg-accent/20 rounded-2xl flex items-center justify-center\">\n                    <Briefcase className=\"w-5 h-5 text-accent\" />\n                  </div>\n                  <div className=\"text-start\">\n                    <span className=\"font-bold text-foreground block\">\n                      {isArabic ? 'أصبح منفذًا' : 'Become a Tasker'}\n                    </span>\n                    <span className=\"text-xs text-muted-foreground\">\n                      {isArabic ? 'قدم للانضمام كمنفذ' : 'Apply to join as a tasker'}\n                    </span>\n                  </div>\n                </div>\n                <ChevronRight className=\"w-5 h-5 text-accent rtl:rotate-180\" />\n              </motion.div>\n            </Link>\n          )}\n\n          {user?.verificationStatus === 'pending' && userRole === 'client' && (\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.25 }}\n              className=\"w-full p-4 bg-warning/10 border-2 border-warning/30 rounded-2xl flex items-center justify-between\"\n              data-testid=\"status-pending-tasker\"\n            >\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-11 h-11 bg-warning/20 rounded-2xl flex items-center justify-center\">\n                  <Briefcase className=\"w-5 h-5 text-warning\" />\n                </div>\n                <div className=\"text-start\">\n                  <span className=\"font-bold text-foreground block\">\n                    {isArabic ? 'طلبك قيد المراجعة' : 'Application Under Review'}\n                  </span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {isArabic ? 'سيتم إشعارك عند الموافقة' : 'You will be notified upon approval'}\n                  </span>\n                </div>\n              </div>\n            </motion.div>\n          )}\n\n          {adminItems.length > 0 && (\n            <motion.div \n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.28 }}\n            >\n              <h2 className=\"text-xs font-bold text-amber-500 uppercase tracking-widest mb-3 px-1\">\n                {isArabic ? 'الإدارة' : 'Administration'}\n              </h2>\n              <div className=\"glass rounded-3xl overflow-hidden border border-amber-500/30\">\n                {adminItems.map((item, idx) => renderSettingItem(item, idx, adminItems.length))}\n              </div>\n            </motion.div>\n          )}\n\n          <motion.div \n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.3 }}\n          >\n            <h2 className=\"text-xs font-bold text-muted-foreground uppercase tracking-widest mb-3 px-1\">\n              {t('settings.support')}\n            </h2>\n            <div className=\"glass rounded-3xl overflow-hidden\">\n              {supportItems.map((item, idx) => renderSettingItem(item, idx, supportItems.length))}\n            </div>\n          </motion.div>\n\n          <motion.div \n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.35 }}\n          >\n            <motion.button \n              onClick={handleLogout}\n              whileHover={{ scale: 1.01 }}\n              whileTap={{ scale: 0.98 }}\n              className=\"w-full p-4 glass rounded-2xl flex items-center justify-center gap-3 transition-all hover:bg-white/5\"\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"w-5 h-5 text-foreground\" />\n              <span className=\"font-bold text-foreground\">{t('auth.logout')}</span>\n            </motion.button>\n          </motion.div>\n\n          <motion.p \n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ delay: 0.5 }}\n            className=\"text-center text-xs text-muted-foreground pt-6 pb-8\"\n          >\n            {t('welcome.title')} v1.0.0\n          </motion.p>\n        </div>\n      </div>\n\n      <AnimatePresence>\n        {showLanguageSheet && (\n          <>\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              onClick={() => setShowLanguageSheet(false)}\n              className=\"fixed inset-0 bg-black/60 z-50\"\n            />\n            <motion.div\n              initial={{ y: '100%' }}\n              animate={{ y: 0 }}\n              exit={{ y: '100%' }}\n              transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n              className=\"fixed bottom-0 inset-x-0 z-50 bg-card rounded-t-3xl p-6 pb-safe\"\n            >\n              <div className=\"w-12 h-1.5 bg-muted rounded-full mx-auto mb-6\" />\n              <h3 className=\"text-lg font-bold mb-4\">{t('settings.language')}</h3>\n              <div className=\"space-y-3\">\n                <button\n                  onClick={() => handleLanguageChange('ar')}\n                  className={cn(\n                    \"w-full p-4 rounded-2xl flex items-center justify-between transition-all\",\n                    isArabic ? \"bg-primary/15 border-2 border-primary\" : \"bg-muted/50 border-2 border-transparent\"\n                  )}\n                  data-testid=\"button-language-arabic\"\n                >\n                  <span className={cn(\"font-medium\", isArabic && \"text-primary\")}>{t('settings.arabic')}</span>\n                  {isArabic && <Check className=\"w-5 h-5 text-primary\" />}\n                </button>\n                <button\n                  onClick={() => handleLanguageChange('en')}\n                  className={cn(\n                    \"w-full p-4 rounded-2xl flex items-center justify-between transition-all\",\n                    !isArabic ? \"bg-primary/15 border-2 border-primary\" : \"bg-muted/50 border-2 border-transparent\"\n                  )}\n                  data-testid=\"button-language-english\"\n                >\n                  <span className={cn(\"font-medium\", !isArabic && \"text-primary\")}>{t('settings.english')}</span>\n                  {!isArabic && <Check className=\"w-5 h-5 text-primary\" />}\n                </button>\n              </div>\n            </motion.div>\n          </>\n        )}\n      </AnimatePresence>\n\n    </div>\n  );\n});\n\nexport default SettingsScreen;\n","path":null,"size_bytes":20154,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/NotificationCard.tsx":{"content":"import { memo, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { Tag, MessageCircle, CheckCircle2, Info, Bell } from 'lucide-react';\nimport type { Notification } from '@shared/schema';\n\ninterface NotificationCardProps {\n  notification: Notification;\n  onMarkRead?: (id: string) => void;\n}\n\nexport const NotificationCard = memo(function NotificationCard({ \n  notification, \n  onMarkRead \n}: NotificationCardProps) {\n  const formatTime = useCallback((date: Date | string) => {\n    const d = typeof date === 'string' ? new Date(date) : date;\n    const now = new Date();\n    const diff = now.getTime() - d.getTime();\n    const minutes = Math.floor(diff / 60000);\n    const hours = Math.floor(diff / 3600000);\n    const days = Math.floor(diff / 86400000);\n\n    if (minutes < 1) return 'Just now';\n    if (minutes < 60) return `${minutes}m ago`;\n    if (hours < 24) return `${hours}h ago`;\n    if (days < 7) return `${days}d ago`;\n    return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n  }, []);\n\n  const getTypeIcon = useCallback((type: string) => {\n    switch (type) {\n      case 'offer': return Tag;\n      case 'chat': return MessageCircle;\n      case 'task_update': return CheckCircle2;\n      case 'system': return Info;\n      default: return Bell;\n    }\n  }, []);\n\n  const getTypeStyles = useCallback((type: string) => {\n    switch (type) {\n      case 'offer': return 'bg-primary/15 text-primary';\n      case 'chat': return 'bg-success/15 text-success';\n      case 'task_update': return 'bg-warning/15 text-warning';\n      case 'system': return 'bg-muted text-muted-foreground';\n      default: return 'bg-muted text-muted-foreground';\n    }\n  }, []);\n\n  const Icon = getTypeIcon(notification.type);\n\n  const handleClick = useCallback(() => {\n    if (!notification.read && onMarkRead) {\n      onMarkRead(notification.id);\n    }\n  }, [notification.read, notification.id, onMarkRead]);\n\n  return (\n    <motion.div \n      whileTap={{ scale: 0.98 }}\n      className={cn(\n        \"flex items-start gap-4 p-4 rounded-2xl transition-all duration-300 cursor-pointer\",\n        notification.read \n          ? \"glass\" \n          : \"glass-premium gradient-border\"\n      )}\n      onClick={handleClick}\n      data-testid={`notification-card-${notification.id}`}\n    >\n      <div className={cn(\n        \"w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0\",\n        getTypeStyles(notification.type)\n      )}>\n        <Icon className=\"w-5 h-5\" />\n      </div>\n      \n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <h4 className={cn(\n            \"font-bold\",\n            !notification.read ? \"text-primary\" : \"text-foreground\"\n          )}>\n            {notification.title}\n          </h4>\n          {!notification.read && (\n            <motion.div \n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              className=\"w-2.5 h-2.5 rounded-full gradient-primary flex-shrink-0 mt-1.5 shadow-lg shadow-primary/30\"\n            />\n          )}\n        </div>\n        <p className=\"text-sm text-muted-foreground line-clamp-2 mt-1\">\n          {notification.message}\n        </p>\n        <span className=\"text-xs text-muted-foreground mt-2 block font-medium\">\n          {formatTime(notification.createdAt)}\n        </span>\n      </div>\n    </motion.div>\n  );\n});\n","path":null,"size_bytes":3434,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"attached_assets/Input_1764551029324.tsx":{"content":"\nimport React, { useState } from 'react';\n\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  label: string;\n  error?: string;\n  containerClassName?: string;\n}\n\nexport const Input: React.FC<InputProps> = ({ \n  label, \n  error, \n  className = '', \n  containerClassName = '',\n  value, \n  onFocus, \n  onBlur, \n  ...props \n}) => {\n  const [isFocused, setIsFocused] = useState(false);\n  const hasValue = value !== '' && value !== undefined;\n\n  return (\n    <div className={`relative ${containerClassName}`}>\n      <div className=\"relative\">\n        <input\n          {...props}\n          value={value}\n          onFocus={(e) => { setIsFocused(true); onFocus?.(e); }}\n          onBlur={(e) => { setIsFocused(false); onBlur?.(e); }}\n          className={`peer w-full h-16 px-4 pt-5 pb-1 rounded-2xl border-2 bg-white dark:bg-surface-dark shadow-sm outline-none transition-all placeholder-transparent font-medium text-text-primary dark:text-text-primary-dark ${\n            error \n              ? 'border-danger/50 focus:border-danger text-danger' \n              : 'border-transparent focus:border-primary/50'\n          } ${className}`}\n          placeholder={label} // Required for peer-placeholder-shown logic if we used CSS only, but we use JS state too\n        />\n        <label \n          className={`absolute left-4 transition-all duration-200 pointer-events-none truncate max-w-[calc(100%-32px)] ${\n            isFocused || hasValue \n              ? 'top-3 text-[10px] font-bold text-primary uppercase tracking-wider' \n              : 'top-5 text-base text-text-secondary dark:text-text-secondary-dark'\n          } ${error ? '!text-danger' : ''}`}\n        >\n          {label}\n        </label>\n      </div>\n      {error && (\n        <div className=\"flex items-center gap-1 mt-1.5 ml-2 animate-slide-up\">\n            <span className=\"material-symbols-outlined text-xs text-danger\">error</span>\n            <p className=\"text-xs text-danger font-bold\">{error}</p>\n        </div>\n      )}\n    </div>\n  );\n};\n","path":null,"size_bytes":2028,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/pages/TasksFeedScreen.tsx":{"content":"import { useState, memo, useCallback, useMemo } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { TaskCard } from '@/components/TaskCard';\nimport { useQuery } from '@tanstack/react-query';\nimport { TaskCardSkeleton, EmptyState } from '@/components/ui/animated';\nimport { cn } from '@/lib/utils';\nimport { TASK_CATEGORIES_WITH_SUBS, getCategoryInfo, type TaskCategoryId } from '@shared/schema';\nimport { Search, SearchX, X, Filter } from 'lucide-react';\nimport type { TaskWithDetails } from '@shared/schema';\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: {\n      staggerChildren: 0.06,\n      delayChildren: 0.1\n    }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 16 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: {\n      type: \"spring\",\n      stiffness: 300,\n      damping: 24\n    }\n  }\n};\n\nconst TasksFeedScreen = memo(function TasksFeedScreen() {\n  const [, setLocation] = useLocation();\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState('');\n  const isAuthenticated = !!localStorage.getItem('userId');\n\n  const { data: tasks, isLoading } = useQuery<TaskWithDetails[]>({\n    queryKey: ['/api/tasks/available', selectedCategory],\n    enabled: isAuthenticated,\n  });\n\n  const filteredTasks = useMemo(() => {\n    return tasks?.filter(task => {\n      if (!selectedCategory) return true;\n      \n      const taskCatInfo = getCategoryInfo(task.category);\n      const matchesCategory = taskCatInfo?.mainCategory === selectedCategory;\n      const matchesSearch = !searchQuery || \n        task.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        task.description.toLowerCase().includes(searchQuery.toLowerCase());\n      return matchesCategory && matchesSearch;\n    }) || [];\n  }, [tasks, selectedCategory, searchQuery]);\n\n  const handleCategorySelect = useCallback((category: string | null) => {\n    setSelectedCategory(category);\n  }, []);\n\n  const handleClearSearch = useCallback(() => {\n    setSearchQuery('');\n  }, []);\n\n  const taskCount = filteredTasks.length;\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.4, scale: 1 }}\n          transition={{ duration: 1 }}\n          className=\"absolute top-32 -left-24 w-72 h-72 bg-gradient-to-br from-accent/25 to-accent/5 rounded-full blur-3xl rtl:-right-24 rtl:left-auto\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.25 }}\n          transition={{ duration: 1.2, delay: 0.3 }}\n          className=\"absolute bottom-60 -right-16 w-48 h-48 bg-gradient-to-tl from-primary/20 to-transparent rounded-full blur-3xl rtl:-left-16 rtl:right-auto\"\n        />\n      </div>\n\n      <motion.div \n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"relative z-10 px-5 py-5\"\n      >\n        <motion.div \n          variants={itemVariants}\n          className=\"flex items-center justify-between mb-6\"\n        >\n          <div>\n            <h1 className=\"text-2xl font-extrabold text-foreground tracking-tight\">{t('tasks.feed')}</h1>\n            <p className=\"text-sm text-muted-foreground mt-0.5\">\n              {taskCount} {t('tasks.available')}\n            </p>\n          </div>\n        </motion.div>\n\n        <motion.div\n          variants={itemVariants}\n          className=\"relative mb-5\"\n        >\n          <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground rtl:right-4 rtl:left-auto\" />\n          <input\n            type=\"search\"\n            placeholder={`${t('common.search')}...`}\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"w-full h-13 ps-12 pe-12 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none transition-all text-base\"\n            data-testid=\"input-search-tasks\"\n          />\n          <AnimatePresence>\n            {searchQuery && (\n              <motion.button\n                initial={{ opacity: 0, scale: 0.8 }}\n                animate={{ opacity: 1, scale: 1 }}\n                exit={{ opacity: 0, scale: 0.8 }}\n                onClick={handleClearSearch}\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full bg-muted/80 hover:bg-muted transition-colors rtl:left-4 rtl:right-auto\"\n              >\n                <X className=\"w-3.5 h-3.5 text-muted-foreground\" />\n              </motion.button>\n            )}\n          </AnimatePresence>\n        </motion.div>\n\n        <motion.div\n          variants={itemVariants}\n          className=\"mb-6\"\n        >\n          <div className=\"flex items-center gap-2 mb-3\">\n            <Filter className=\"w-4 h-4 text-muted-foreground\" />\n            <span className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">{t('tasks.category')}</span>\n          </div>\n          <div className=\"flex gap-2 overflow-x-auto no-scrollbar pb-1 -mx-5 px-5\">\n            <motion.button\n              whileTap={{ scale: 0.95 }}\n              onClick={() => handleCategorySelect(null)}\n              data-testid=\"button-category-all\"\n              className={cn(\n                \"px-4 py-2.5 rounded-xl font-semibold text-sm whitespace-nowrap transition-all duration-200\",\n                selectedCategory === null\n                  ? \"gradient-primary text-white shadow-lg shadow-primary/25\"\n                  : \"glass text-muted-foreground hover:text-foreground\"\n              )}\n            >\n              {t('tasks.filters.allCategories')}\n            </motion.button>\n            {(Object.entries(TASK_CATEGORIES_WITH_SUBS) as [TaskCategoryId, typeof TASK_CATEGORIES_WITH_SUBS[TaskCategoryId]][]).map(([categoryId, category]) => {\n              const displayName = isArabic ? category.nameAr : category.nameEn;\n              const colorHex = category.colorHex || '#6B7280';\n              \n              return (\n                <motion.button\n                  key={categoryId}\n                  whileTap={{ scale: 0.95 }}\n                  onClick={() => handleCategorySelect(categoryId)}\n                  data-testid={`button-filter-${categoryId}`}\n                  className={cn(\n                    \"px-4 py-2.5 rounded-xl font-semibold text-sm whitespace-nowrap transition-all duration-200\",\n                    selectedCategory === categoryId\n                      ? \"text-white shadow-lg\"\n                      : \"glass text-muted-foreground hover:text-foreground\"\n                  )}\n                  style={{\n                    background: selectedCategory === categoryId \n                      ? `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}CC 100%)`\n                      : undefined,\n                    boxShadow: selectedCategory === categoryId \n                      ? `0 8px 20px -8px ${colorHex}60`\n                      : undefined,\n                  }}\n                >\n                  {displayName}\n                </motion.button>\n              );\n            })}\n          </div>\n        </motion.div>\n      </motion.div>\n\n      <div className=\"relative z-10 px-5\">\n        <AnimatePresence mode=\"wait\">\n          {isLoading ? (\n            <motion.div\n              key=\"loading\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              <TaskCardSkeleton count={4} />\n            </motion.div>\n          ) : filteredTasks.length > 0 ? (\n            <motion.div\n              key=\"tasks\"\n              variants={containerVariants}\n              initial=\"hidden\"\n              animate=\"visible\"\n              className=\"space-y-3\"\n            >\n              {filteredTasks.map((task, index) => (\n                <motion.div key={task.id} variants={itemVariants}>\n                  <TaskCard task={task} index={index} />\n                </motion.div>\n              ))}\n            </motion.div>\n          ) : (\n            <motion.div\n              key=\"empty\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -20 }}\n            >\n              <EmptyState\n                icon={<SearchX className=\"w-8 h-8\" />}\n                title={t('tasks.empty.title')}\n                description={t('tasks.empty.description')}\n                action={\n                  (searchQuery || selectedCategory) && (\n                    <motion.button\n                      whileHover={{ scale: 1.03 }}\n                      whileTap={{ scale: 0.97 }}\n                      onClick={() => {\n                        setSearchQuery('');\n                        setSelectedCategory(null);\n                      }}\n                      className=\"glass-premium text-foreground px-6 py-3 rounded-2xl font-bold flex items-center gap-2\"\n                    >\n                      <X className=\"w-4 h-4\" />\n                      {t('common.filter')}\n                    </motion.button>\n                  )\n                }\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n});\n\nexport default TasksFeedScreen;\n","path":null,"size_bytes":9657,"size_tokens":null},"client/src/i18n/index.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\nimport arTranslations from './locales/ar.json';\nimport enTranslations from './locales/en.json';\n\nconst resources = {\n  ar: {\n    translation: arTranslations\n  },\n  en: {\n    translation: enTranslations\n  }\n};\n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    resources,\n    lng: 'ar',\n    fallbackLng: 'ar',\n    interpolation: {\n      escapeValue: false\n    },\n    detection: {\n      order: ['localStorage', 'navigator'],\n      caches: ['localStorage']\n    }\n  });\n\nexport const isRTL = () => {\n  const rtlLanguages = ['ar', 'he', 'fa', 'ur'];\n  return rtlLanguages.includes(i18n.language);\n};\n\nexport const changeLanguage = (lng: string) => {\n  i18n.changeLanguage(lng);\n  document.documentElement.lang = lng;\n  document.documentElement.dir = isRTL() ? 'rtl' : 'ltr';\n};\n\nconst updateDirection = () => {\n  document.documentElement.lang = i18n.language;\n  document.documentElement.dir = isRTL() ? 'rtl' : 'ltr';\n};\n\ni18n.on('languageChanged', () => {\n  updateDirection();\n});\n\nupdateDirection();\n\nexport default i18n;\n","path":null,"size_bytes":1182,"size_tokens":null},"client/src/pages/ChatScreen.tsx":{"content":"import { useState, useEffect, useRef, memo, useCallback } from 'react';\nimport { useParams, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { Skeleton, EmptyState } from '@/components/ui/animated';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { cn } from '@/lib/utils';\nimport { ArrowLeft, Send, MessageCircle } from 'lucide-react';\nimport type { MessageWithUsers, TaskWithDetails, User } from '@shared/schema';\n\nconst ChatScreen = memo(function ChatScreen() {\n  const { taskId } = useParams<{ taskId: string }>();\n  const [, setLocation] = useLocation();\n  const [message, setMessage] = useState('');\n  const [displayMessages, setDisplayMessages] = useState<MessageWithUsers[]>([]);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const wsRef = useRef<WebSocket | null>(null);\n  const isAuthenticated = !!localStorage.getItem('userId');\n\n  const { data: currentUser } = useQuery<User>({\n    queryKey: ['/api/users/me'],\n    enabled: isAuthenticated,\n  });\n\n  const { data: task } = useQuery<TaskWithDetails>({\n    queryKey: ['/api/tasks', taskId],\n    enabled: isAuthenticated && !!taskId,\n  });\n\n  const { data: messages, isLoading } = useQuery<MessageWithUsers[]>({\n    queryKey: ['/api/tasks', taskId, 'messages'],\n    refetchInterval: 3000,\n    enabled: isAuthenticated && !!taskId,\n  });\n\n  useEffect(() => {\n    if (!taskId) return;\n\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/ws?taskId=${taskId}`;\n    \n    try {\n      wsRef.current = new WebSocket(wsUrl);\n      \n      wsRef.current.onmessage = (event) => {\n        try {\n          const { type, data } = JSON.parse(event.data);\n          if (type === 'message') {\n            setDisplayMessages(prev => [...prev, data]);\n          }\n        } catch (error) {\n          console.error('Failed to parse WebSocket message', error);\n        }\n      };\n    } catch (error) {\n      console.error('WebSocket connection failed, falling back to polling', error);\n    }\n\n    return () => {\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, [taskId]);\n\n  useEffect(() => {\n    if (messages) {\n      setDisplayMessages(messages);\n    }\n  }, [messages]);\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      const response = await apiRequest('POST', `/api/tasks/${taskId}/messages`, { content });\n      return response.json();\n    },\n    onSuccess: (newMessage) => {\n      setDisplayMessages(prev => [...prev, newMessage]);\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks', taskId, 'messages'] });\n      setMessage('');\n      \n      if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({ type: 'message', data: newMessage }));\n      }\n    },\n  });\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [displayMessages]);\n\n  const handleSend = useCallback(() => {\n    if (message.trim()) {\n      sendMessageMutation.mutate(message.trim());\n    }\n  }, [message, sendMessageMutation]);\n\n  const handleKeyPress = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  }, [handleSend]);\n\n  const formatTime = useCallback((date: Date | string) => {\n    const d = typeof date === 'string' ? new Date(date) : date;\n    return d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });\n  }, []);\n\n  const getInitials = useCallback((name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n  }, []);\n\n  const otherUser = task?.client?.id === currentUser?.id ? task?.tasker : task?.client;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background to-primary/5 flex flex-col\">\n      <motion.div \n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"flex items-center gap-4 px-6 py-4 glass border-b border-white/10 sticky top-0 z-10 pt-safe\"\n      >\n        <motion.button \n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={() => window.history.back()}\n          className=\"w-10 h-10 flex items-center justify-center rounded-2xl glass-button\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-5 h-5\" />\n        </motion.button>\n        \n        <Avatar className=\"w-11 h-11 border-2 border-white/20 shadow-lg\">\n          <AvatarImage src={otherUser?.avatar || undefined} />\n          <AvatarFallback className=\"gradient-primary text-white font-bold text-sm\">\n            {otherUser?.name ? getInitials(otherUser.name) : 'U'}\n          </AvatarFallback>\n        </Avatar>\n        \n        <div className=\"flex-1 min-w-0\">\n          <h2 className=\"font-bold text-foreground truncate\">{otherUser?.name || 'Chat'}</h2>\n          <p className=\"text-xs text-muted-foreground truncate\">{task?.title}</p>\n        </div>\n      </motion.div>\n\n      <div className=\"flex-1 overflow-y-auto px-6 py-4 space-y-4\">\n        <AnimatePresence mode=\"wait\">\n          {isLoading && displayMessages.length === 0 ? (\n            <motion.div\n              key=\"loading\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"space-y-4\"\n            >\n              {[1, 2, 3].map((i) => (\n                <div key={i} className={cn(\"flex gap-3\", i % 2 === 0 && \"justify-end\")}>\n                  {i % 2 !== 0 && <Skeleton className=\"w-8 h-8 rounded-full flex-shrink-0\" />}\n                  <Skeleton className={cn(\"h-16 rounded-2xl\", i % 2 === 0 ? \"w-2/3\" : \"w-3/4\")} />\n                </div>\n              ))}\n            </motion.div>\n          ) : displayMessages.length > 0 ? (\n            <motion.div\n              key=\"messages\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"space-y-4\"\n            >\n              {displayMessages.map((msg, index) => {\n                const isOwn = msg.senderId === currentUser?.id;\n                return (\n                  <motion.div \n                    key={msg.id} \n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ delay: index * 0.03 }}\n                    className={cn(\"flex gap-3\", isOwn && \"justify-end\")}\n                  >\n                    {!isOwn && (\n                      <Avatar className=\"w-8 h-8 border border-white/20 flex-shrink-0 shadow\">\n                        <AvatarImage src={msg.sender?.avatar || undefined} />\n                        <AvatarFallback className=\"gradient-primary text-white font-bold text-xs\">\n                          {msg.sender?.name ? getInitials(msg.sender.name) : 'U'}\n                        </AvatarFallback>\n                      </Avatar>\n                    )}\n                    <div className={cn(\"max-w-[75%]\", isOwn && \"order-first\")}>\n                      <div className={cn(\n                        \"px-4 py-3 rounded-2xl shadow-sm\",\n                        isOwn \n                          ? \"gradient-primary text-white rounded-br-md\" \n                          : \"glass rounded-bl-md\"\n                      )}>\n                        <p className=\"text-sm leading-relaxed\">{msg.content}</p>\n                      </div>\n                      <p className={cn(\n                        \"text-xs text-muted-foreground mt-1.5\",\n                        isOwn && \"text-right\"\n                      )}>\n                        {formatTime(msg.createdAt)}\n                      </p>\n                    </div>\n                  </motion.div>\n                );\n              })}\n            </motion.div>\n          ) : (\n            <motion.div\n              key=\"empty\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"h-full flex items-center justify-center\"\n            >\n              <EmptyState\n                icon={<MessageCircle className=\"w-8 h-8\" />}\n                title=\"No messages yet\"\n                description=\"Start the conversation\"\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n        <div ref={messagesEndRef} />\n      </div>\n\n      <motion.div \n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"sticky bottom-0 left-0 right-0 p-4 glass border-t border-white/10 pb-safe\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            onKeyPress={handleKeyPress}\n            placeholder=\"Type a message...\"\n            className=\"flex-1 h-12 px-5 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all\"\n            data-testid=\"input-message\"\n          />\n          <motion.button\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={handleSend}\n            disabled={!message.trim() || sendMessageMutation.isPending}\n            className=\"w-12 h-12 gradient-primary text-white rounded-2xl flex items-center justify-center shadow-lg shadow-primary/30 transition-all disabled:opacity-50\"\n            data-testid=\"button-send\"\n          >\n            <Send className=\"w-5 h-5\" />\n          </motion.button>\n        </div>\n      </motion.div>\n    </div>\n  );\n});\n\nexport default ChatScreen;\n","path":null,"size_bytes":9985,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"server/routes.ts":{"content":"import { Router, Request, Response } from \"express\";\nimport { storage } from \"./storage\";\nimport { insertUserSchema, insertTaskSchema, insertBidSchema, insertMessageSchema } from \"@shared/schema\";\nimport type { User } from \"@shared/schema\";\nimport \"express-session\";\nimport { sendOtpEmail } from \"./email\";\nimport { sendOtpSms, isValidSaudiPhone } from \"./sms\";\nimport { getVapidPublicKey, sendPushNotification } from \"./push\";\nimport { calculateLevel, calculateProgress, POINT_VALUES, getLevelInfo } from \"./levels\";\nimport crypto from \"crypto\";\n\nlet bcrypt: any;\ntry {\n  bcrypt = require(\"bcryptjs\");\n} catch {\n  bcrypt = {\n    hash: (pass: string) => Promise.resolve(pass),\n    compare: (pass: string, hash: string) => Promise.resolve(pass === hash),\n  };\n}\n\n// Simple token store for Capacitor iOS auth (tokens map to user IDs)\nconst authTokens = new Map<string, { userId: string; expiresAt: number }>();\n\nfunction generateToken(): string {\n  return crypto.randomBytes(32).toString('hex');\n}\n\nfunction createAuthToken(userId: string): string {\n  const token = generateToken();\n  const expiresAt = Date.now() + 24 * 60 * 60 * 1000; // 24 hours\n  authTokens.set(token, { userId, expiresAt });\n  return token;\n}\n\nfunction validateAuthToken(token: string): string | null {\n  const data = authTokens.get(token);\n  if (!data) return null;\n  if (Date.now() > data.expiresAt) {\n    authTokens.delete(token);\n    return null;\n  }\n  return data.userId;\n}\n\nfunction removeAuthToken(token: string): void {\n  authTokens.delete(token);\n}\n\nexport const router = Router();\n\n// Extend session type to include userId\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n  }\n}\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      userId?: string;\n      user?: User;\n    }\n  }\n}\n\n// Helper to strip password from user objects\nfunction sanitizeUser(user: User): Omit<User, 'password'> {\n  const { password, ...safeUser } = user;\n  return safeUser;\n}\n\n// Middleware to get current user (supports both session and token auth)\nconst getCurrentUser = async (req: Request, res: Response, next: Function) => {\n  let userId = req.session?.userId;\n  \n  // Check for Bearer token (for Capacitor iOS)\n  const authHeader = req.headers.authorization;\n  if (!userId && authHeader?.startsWith('Bearer ')) {\n    const token = authHeader.substring(7);\n    const tokenUserId = validateAuthToken(token);\n    if (tokenUserId) {\n      userId = tokenUserId;\n    }\n  }\n  \n  if (userId) {\n    req.user = await storage.getUser(userId);\n    req.userId = userId;\n  }\n  next();\n};\n\nrouter.use(getCurrentUser);\n\n// Auth routes\nrouter.post(\"/api/auth/register\", async (req, res) => {\n  try {\n    const { username, email, password, name, role, taskerType, certificateUrl, phone } = req.body;\n    \n    // Check if phone number is already registered (username = phone)\n    const existingPhone = await storage.getUserByPhone(username);\n    if (existingPhone) {\n      return res.status(400).json({ error: \"رقم الجوال مسجل مسبقاً\" });\n    }\n    \n    // Also check by username\n    const existingUser = await storage.getUserByUsername(username);\n    if (existingUser) {\n      return res.status(400).json({ error: \"رقم الجوال مسجل مسبقاً\" });\n    }\n    \n    // Check if email is already registered\n    if (email) {\n      const existingEmail = await storage.getUserByEmail(email);\n      if (existingEmail) {\n        return res.status(400).json({ error: \"البريد الإلكتروني مسجل مسبقاً\" });\n      }\n    }\n    \n    const hashedPassword = await bcrypt.hash(password, 10);\n    const userData: any = {\n      username,\n      email,\n      password: hashedPassword,\n      name,\n      phone: phone || username, // Store phone number\n      role: role || \"client\",\n    };\n    \n    if (role === 'tasker') {\n      const validTaskerType = taskerType === 'specialized' ? 'specialized' : 'general';\n      userData.taskerType = validTaskerType;\n      userData.verificationStatus = 'pending';\n      \n      if (validTaskerType === 'specialized' && certificateUrl) {\n        if (typeof certificateUrl === 'string' && certificateUrl.startsWith('data:image/')) {\n          const base64Length = certificateUrl.length * 0.75;\n          const maxSize = 5 * 1024 * 1024;\n          if (base64Length <= maxSize) {\n            userData.certificateUrl = certificateUrl;\n          }\n        }\n      }\n    }\n    \n    const user = await storage.createUser(userData);\n    \n    // Create auth token for Capacitor iOS\n    const token = createAuthToken(user.id);\n    \n    req.session!.userId = user.id;\n    res.json({ user: sanitizeUser(user), token });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/auth/login\", async (req, res) => {\n  try {\n    const { username, password } = req.body;\n    \n    const user = await storage.getUserByUsername(username);\n    if (!user) {\n      return res.status(401).json({ error: \"Invalid credentials\" });\n    }\n    \n    const validPassword = await bcrypt.compare(password, user.password);\n    if (!validPassword) {\n      return res.status(401).json({ error: \"Invalid credentials\" });\n    }\n    \n    // Create auth token for Capacitor iOS\n    const token = createAuthToken(user.id);\n    \n    req.session!.userId = user.id;\n    res.json({ user: sanitizeUser(user), token });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/auth/logout\", (req, res) => {\n  req.session?.destroy((err) => {\n    if (err) return res.status(500).json({ error: \"Logout failed\" });\n    res.json({ success: true });\n  });\n});\n\n// Generate a 6-digit OTP\nfunction generateOTP(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString();\n}\n\n// Send OTP via email\nrouter.post(\"/api/auth/send-otp\", async (req, res) => {\n  try {\n    const { email, type = \"registration\" } = req.body;\n    \n    if (!email) {\n      return res.status(400).json({ error: \"Email is required\" });\n    }\n    \n    // Check if email already exists for registration\n    if (type === \"registration\") {\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ error: \"Email already registered\" });\n      }\n    }\n    \n    // For login type, verify user exists\n    if (type === \"login\") {\n      const existingUser = await storage.getUserByEmail(email);\n      if (!existingUser) {\n        return res.status(400).json({ error: \"No account found with this email\" });\n      }\n    }\n    \n    const code = generateOTP();\n    const expiresAt = new Date(Date.now() + 10 * 60 * 1000); // 10 minutes\n    \n    await storage.createOtpCode({\n      email,\n      code,\n      type,\n      expiresAt,\n    });\n    \n    // Send email via Resend\n    const emailResult = await sendOtpEmail(email, code, type as any);\n    \n    if (!emailResult.success) {\n      console.warn(`[OTP] Email sending failed, falling back to console: ${emailResult.error}`);\n      console.log(`[OTP] Email: ${email}, Code: ${code}, Type: ${type}`);\n    }\n    \n    res.json({ \n      success: true, \n      message: \"OTP sent successfully\",\n      // Include OTP in dev mode for testing if email fails\n      ...(process.env.NODE_ENV !== 'production' && !emailResult.success && { devCode: code })\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Verify OTP\nrouter.post(\"/api/auth/verify-otp\", async (req, res) => {\n  try {\n    const { email, code, type = \"registration\" } = req.body;\n    \n    if (!email || !code) {\n      return res.status(400).json({ error: \"Email and code are required\" });\n    }\n    \n    const otpRecord = await storage.getValidOtpCode(email, code, type);\n    \n    if (!otpRecord) {\n      // Check if there's any pending OTP for this email to increment attempts\n      const existingOtp = await storage.getPendingOtpByEmail(email, type);\n      if (existingOtp) {\n        await storage.incrementOtpAttempts(existingOtp.id);\n      }\n      return res.status(400).json({ error: \"Invalid or expired OTP\" });\n    }\n    \n    await storage.markOtpAsVerified(otpRecord.id);\n    \n    // If verifying email for existing user, mark email as verified\n    if (type === \"email_verification\") {\n      const user = await storage.getUserByEmail(email);\n      if (user) {\n        await storage.updateUser(user.id, { emailVerified: true } as any);\n      }\n    }\n    \n    res.json({ success: true, message: \"OTP verified successfully\" });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Login with OTP (passwordless)\nrouter.post(\"/api/auth/login-with-otp\", async (req, res) => {\n  try {\n    const { email, otpCode } = req.body;\n    \n    if (!email || !otpCode) {\n      return res.status(400).json({ error: \"Email and OTP code are required\" });\n    }\n    \n    // Verify OTP\n    const otpRecord = await storage.getValidOtpCode(email, otpCode, \"login\");\n    \n    if (!otpRecord) {\n      // Check if there's any pending OTP for this email to increment attempts\n      const existingOtp = await storage.getPendingOtpByEmail(email, \"login\");\n      if (existingOtp) {\n        await storage.incrementOtpAttempts(existingOtp.id);\n      }\n      return res.status(400).json({ error: \"Invalid or expired OTP\" });\n    }\n    \n    // Get user by email\n    const user = await storage.getUserByEmail(email);\n    if (!user) {\n      return res.status(400).json({ error: \"No account found with this email\" });\n    }\n    \n    // Mark OTP as verified\n    await storage.markOtpAsVerified(otpRecord.id);\n    \n    // Create auth token for Capacitor iOS\n    const token = createAuthToken(user.id);\n    \n    // Create session\n    req.session!.userId = user.id;\n    \n    res.json({ \n      success: true, \n      user: sanitizeUser(user),\n      token,\n      message: \"Logged in successfully\" \n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Send OTP via SMS (phone)\nrouter.post(\"/api/auth/send-phone-otp\", async (req, res) => {\n  try {\n    const { phone, type = \"login\" } = req.body;\n    \n    if (!phone) {\n      return res.status(400).json({ error: \"Phone number is required\" });\n    }\n    \n    // Validate Saudi phone number\n    if (!isValidSaudiPhone(phone)) {\n      return res.status(400).json({ error: \"Please enter a valid Saudi phone number\" });\n    }\n    \n    // For login type, verify user exists with this phone\n    if (type === \"login\") {\n      const existingUser = await storage.getUserByPhone(phone);\n      if (!existingUser) {\n        return res.status(400).json({ error: \"No account found with this phone number\" });\n      }\n    }\n    \n    // For registration, check phone isn't already registered\n    if (type === \"registration\") {\n      const existingUser = await storage.getUserByPhone(phone);\n      if (existingUser) {\n        return res.status(400).json({ error: \"Phone number already registered\" });\n      }\n    }\n    \n    const code = generateOTP();\n    const expiresAt = new Date(Date.now() + 10 * 60 * 1000); // 10 minutes\n    \n    // Store OTP with phone as identifier (using email field for compatibility)\n    await storage.createOtpCode({\n      email: phone, // Using email field to store phone for OTP lookup\n      code,\n      type: `phone_${type}`,\n      expiresAt,\n    });\n    \n    // Send SMS via Infobip\n    const smsResult = await sendOtpSms(phone, code, type as any);\n    \n    if (!smsResult.success) {\n      console.warn(`[OTP] SMS sending failed: ${smsResult.error}`);\n      console.log(`[OTP] Phone: ${phone}, Code: ${code}, Type: ${type}`);\n    }\n    \n    res.json({ \n      success: true, \n      message: \"OTP sent successfully\",\n      // Include OTP in dev mode for testing if SMS fails\n      ...(process.env.NODE_ENV !== 'production' && !smsResult.success && { devCode: code })\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Verify phone OTP (for registration)\nrouter.post(\"/api/auth/verify-phone-otp\", async (req, res) => {\n  try {\n    const { phone, otpCode } = req.body;\n    \n    if (!phone || !otpCode) {\n      return res.status(400).json({ error: \"Phone and OTP code are required\" });\n    }\n    \n    // Verify OTP (phone stored in email field)\n    const otpRecord = await storage.getValidOtpCode(phone, otpCode, \"phone_registration\");\n    \n    if (!otpRecord) {\n      const existingOtp = await storage.getPendingOtpByEmail(phone, \"phone_registration\");\n      if (existingOtp) {\n        await storage.incrementOtpAttempts(existingOtp.id);\n      }\n      return res.status(400).json({ error: \"Invalid or expired OTP\" });\n    }\n    \n    // Mark OTP as verified\n    await storage.markOtpAsVerified(otpRecord.id);\n    \n    res.json({ \n      success: true, \n      message: \"Phone verified successfully\" \n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Login with phone OTP\nrouter.post(\"/api/auth/login-with-phone-otp\", async (req, res) => {\n  try {\n    const { phone, otpCode } = req.body;\n    \n    if (!phone || !otpCode) {\n      return res.status(400).json({ error: \"Phone and OTP code are required\" });\n    }\n    \n    // Verify OTP (phone stored in email field)\n    const otpRecord = await storage.getValidOtpCode(phone, otpCode, \"phone_login\");\n    \n    if (!otpRecord) {\n      const existingOtp = await storage.getPendingOtpByEmail(phone, \"phone_login\");\n      if (existingOtp) {\n        await storage.incrementOtpAttempts(existingOtp.id);\n      }\n      return res.status(400).json({ error: \"Invalid or expired OTP\" });\n    }\n    \n    // Get user by phone\n    const user = await storage.getUserByPhone(phone);\n    if (!user) {\n      return res.status(400).json({ error: \"No account found with this phone number\" });\n    }\n    \n    // Mark OTP as verified\n    await storage.markOtpAsVerified(otpRecord.id);\n    \n    // Create auth token for Capacitor iOS\n    const token = createAuthToken(user.id);\n    \n    // Create session\n    req.session!.userId = user.id;\n    \n    res.json({ \n      success: true, \n      user: sanitizeUser(user),\n      token,\n      message: \"Logged in successfully\" \n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Register with OTP verification\nrouter.post(\"/api/auth/register-with-otp\", async (req, res) => {\n  try {\n    const { username, email, password, name, role, taskerType, certificateUrl, otpCode } = req.body;\n    \n    // Verify OTP first\n    const otpRecord = await storage.getValidOtpCode(email, otpCode, \"registration\");\n    if (!otpRecord || !otpRecord.verified) {\n      // Try to verify the OTP if not already verified\n      if (otpRecord && !otpRecord.verified) {\n        const validOtp = await storage.getValidOtpCode(email, otpCode, \"registration\");\n        if (!validOtp) {\n          return res.status(400).json({ error: \"Invalid or expired OTP\" });\n        }\n        await storage.markOtpAsVerified(validOtp.id);\n      } else if (!otpRecord) {\n        return res.status(400).json({ error: \"Please verify your email first\" });\n      }\n    }\n    \n    const existingUser = await storage.getUserByUsername(username);\n    if (existingUser) {\n      return res.status(400).json({ error: \"Username already taken\" });\n    }\n    \n    const existingEmail = await storage.getUserByEmail(email);\n    if (existingEmail) {\n      return res.status(400).json({ error: \"Email already registered\" });\n    }\n    \n    const hashedPassword = await bcrypt.hash(password, 10);\n    const userData: any = {\n      username,\n      email,\n      password: hashedPassword,\n      name,\n      role: role || \"client\",\n      emailVerified: true, // Email verified through OTP\n    };\n    \n    if (role === 'tasker') {\n      const validTaskerType = taskerType === 'specialized' ? 'specialized' : 'general';\n      userData.taskerType = validTaskerType;\n      userData.verificationStatus = 'pending';\n      \n      if (validTaskerType === 'specialized' && certificateUrl) {\n        if (typeof certificateUrl === 'string' && certificateUrl.startsWith('data:image/')) {\n          const base64Length = certificateUrl.length * 0.75;\n          const maxSize = 5 * 1024 * 1024;\n          if (base64Length <= maxSize) {\n            userData.certificateUrl = certificateUrl;\n          }\n        }\n      }\n    }\n    \n    const user = await storage.createUser(userData);\n    \n    // Create auth token for Capacitor iOS\n    const token = createAuthToken(user.id);\n    \n    req.session!.userId = user.id;\n    res.json({ user: sanitizeUser(user), token });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/api/users/me\", (req, res) => {\n  if (!req.user) {\n    return res.status(401).json({ error: \"Not authenticated\" });\n  }\n  res.json(sanitizeUser(req.user));\n});\n\nrouter.patch(\"/api/users/me\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const updated = await storage.updateUser(req.userId, req.body);\n    res.json(sanitizeUser(updated));\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Apply to become a tasker (for existing clients)\nrouter.post(\"/api/users/apply-tasker\", async (req, res) => {\n  try {\n    if (!req.userId || !req.user) {\n      return res.status(401).json({ error: \"Not authenticated\" });\n    }\n    \n    const { taskerType, certificateUrl } = req.body;\n    \n    if (!taskerType || !['general', 'specialized'].includes(taskerType)) {\n      return res.status(400).json({ error: \"Invalid tasker type\" });\n    }\n    \n    // For specialized taskers, require certificate\n    if (taskerType === 'specialized' && !certificateUrl) {\n      return res.status(400).json({ error: \"Certificate required for specialized taskers\" });\n    }\n    \n    const updateData: any = {\n      taskerType,\n      verificationStatus: 'pending',\n    };\n    \n    if (certificateUrl) {\n      if (typeof certificateUrl === 'string' && certificateUrl.startsWith('data:image/')) {\n        const base64Length = certificateUrl.length * 0.75;\n        const maxSize = 5 * 1024 * 1024;\n        if (base64Length <= maxSize) {\n          updateData.certificateUrl = certificateUrl;\n        }\n      }\n    }\n    \n    const updated = await storage.updateUser(req.userId, updateData);\n    \n    // Create notification - all taskers are pending until admin approval\n    await storage.createNotification({\n      userId: req.userId,\n      type: 'system',\n      title: 'تم استلام طلبك',\n      message: taskerType === 'specialized' \n        ? 'تم استلام طلبك للانضمام كمنفذ متخصص وسيتم مراجعته قريبًا'\n        : 'تم استلام طلبك للانضمام كمنفذ وسيتم مراجعته قريبًا',\n      icon: 'clock',\n      color: 'warning',\n      actionUrl: '/settings',\n    });\n    \n    res.json({ user: sanitizeUser(updated) });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Switch role between client and tasker\nrouter.post(\"/api/users/switch-role\", async (req, res) => {\n  try {\n    if (!req.userId || !req.user) {\n      return res.status(401).json({ error: \"Not authenticated\" });\n    }\n    \n    const { role } = req.body;\n    \n    if (!role || !['client', 'tasker'].includes(role)) {\n      return res.status(400).json({ error: \"Invalid role\" });\n    }\n    \n    // If switching to tasker, check that user is approved\n    if (role === 'tasker') {\n      if (!req.user.taskerType) {\n        return res.status(403).json({ error: \"You must apply to become a tasker first\" });\n      }\n      if (req.user.verificationStatus !== 'approved') {\n        return res.status(403).json({ error: \"Your tasker application is still pending approval\" });\n      }\n    }\n    \n    const updated = await storage.updateUser(req.userId, { role });\n    res.json({ user: sanitizeUser(updated) });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Tasks routes\nrouter.get(\"/api/tasks\", async (req, res) => {\n  try {\n    const { status, category, clientId } = req.query;\n    const tasks = await storage.getTasks({\n      status: status as string,\n      category: category as string,\n      clientId: clientId as string,\n    });\n    res.json(tasks);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/api/tasks/my\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const userTasks = await storage.getTasks({ clientId: req.userId });\n    res.json(userTasks);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/api/tasks/available\", async (req, res) => {\n  try {\n    const tasks = await storage.getTasks({ status: \"open\" });\n    res.json(tasks);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/api/tasks/saved\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const savedTasks = await storage.getSavedTasksForUser(req.userId);\n    res.json(savedTasks);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/api/tasks/:id\", async (req, res) => {\n  try {\n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    res.json(task);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Daily task limit for clients: 5 tasks per day\nconst DAILY_TASK_LIMIT = 5;\n\n// Riyadh city boundaries for location validation\nconst RIYADH_BOUNDS = {\n  north: 25.1,\n  south: 24.3,\n  east: 47.1,\n  west: 46.4,\n};\n\nfunction isLocationInRiyadh(latitude?: number, longitude?: number): boolean {\n  if (latitude === undefined || longitude === undefined) return true; // Skip validation if no coords\n  return (\n    latitude >= RIYADH_BOUNDS.south &&\n    latitude <= RIYADH_BOUNDS.north &&\n    longitude >= RIYADH_BOUNDS.west &&\n    longitude <= RIYADH_BOUNDS.east\n  );\n}\n\nrouter.get(\"/api/tasks/my/today-count\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const count = await storage.getTasksCreatedToday(String(req.userId));\n    res.json({ count, limit: DAILY_TASK_LIMIT, remaining: DAILY_TASK_LIMIT - count });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/tasks\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    // Check daily task limit for clients\n    const todayCount = await storage.getTasksCreatedToday(String(req.userId));\n    if (todayCount >= DAILY_TASK_LIMIT) {\n      return res.status(429).json({ \n        error: \"Daily task limit reached\",\n        message: \"You can only post 5 tasks per day. Please try again tomorrow.\",\n        limit: DAILY_TASK_LIMIT,\n        count: todayCount\n      });\n    }\n    \n    // Validate location is within Riyadh\n    const { latitude, longitude } = req.body;\n    if (latitude !== undefined && longitude !== undefined) {\n      const lat = typeof latitude === 'string' ? parseFloat(latitude) : Number(latitude);\n      const lng = typeof longitude === 'string' ? parseFloat(longitude) : Number(longitude);\n      \n      // Validate they are valid numbers\n      if (isNaN(lat) || isNaN(lng)) {\n        return res.status(400).json({ \n          error: \"Invalid coordinates\",\n          message: \"إحداثيات الموقع غير صحيحة\",\n        });\n      }\n      \n      // Validate they are in valid ranges\n      if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n        return res.status(400).json({ \n          error: \"Invalid coordinates\",\n          message: \"إحداثيات الموقع غير صحيحة\",\n        });\n      }\n      \n      if (!isLocationInRiyadh(lat, lng)) {\n        return res.status(400).json({ \n          error: \"Location outside Riyadh\",\n          message: \"الخدمة متاحة حالياً في الرياض فقط\",\n        });\n      }\n    }\n    \n    const data = { ...req.body, clientId: req.userId };\n    const task = await storage.createTask(data);\n    \n    // Send notifications to taskers in the same category\n    try {\n      const taskersInCategory = await storage.getTaskersByCategory(task.category);\n      for (const tasker of taskersInCategory) {\n        if (tasker.id !== req.userId) {\n          await storage.createNotification({\n            userId: tasker.id,\n            type: 'new_task',\n            title: 'مهمة جديدة في تخصصك',\n            message: `تم نشر مهمة جديدة: \"${task.title}\"`,\n            icon: 'briefcase',\n            color: 'primary',\n            actionUrl: `/task/${task.id}`,\n          });\n        }\n      }\n    } catch (notifError) {\n      console.error('Failed to send category notifications:', notifError);\n    }\n    \n    res.json(task);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.patch(\"/api/tasks/:id\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    if (task.clientId !== req.userId) return res.status(403).json({ error: \"Not authorized\" });\n    \n    // Validate location is within Riyadh if updating coordinates\n    const { latitude, longitude } = req.body;\n    if (latitude !== undefined && longitude !== undefined) {\n      const lat = typeof latitude === 'string' ? parseFloat(latitude) : Number(latitude);\n      const lng = typeof longitude === 'string' ? parseFloat(longitude) : Number(longitude);\n      \n      // Validate they are valid numbers\n      if (isNaN(lat) || isNaN(lng)) {\n        return res.status(400).json({ \n          error: \"Invalid coordinates\",\n          message: \"إحداثيات الموقع غير صحيحة\",\n        });\n      }\n      \n      // Validate they are in valid ranges\n      if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n        return res.status(400).json({ \n          error: \"Invalid coordinates\",\n          message: \"إحداثيات الموقع غير صحيحة\",\n        });\n      }\n      \n      if (!isLocationInRiyadh(lat, lng)) {\n        return res.status(400).json({ \n          error: \"Location outside Riyadh\",\n          message: \"الخدمة متاحة حالياً في الرياض فقط\",\n        });\n      }\n    }\n    \n    const updated = await storage.updateTask(req.params.id, req.body);\n    res.json(updated);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.delete(\"/api/tasks/:id\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    if (task.clientId !== req.userId) return res.status(403).json({ error: \"Not authorized\" });\n    \n    if (task.status !== 'open') {\n      return res.status(400).json({ error: \"Only open tasks can be deleted\" });\n    }\n    \n    await storage.deleteTask(req.params.id);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/tasks/:id/request-completion\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    \n    if (task.taskerId !== req.userId) {\n      return res.status(403).json({ error: \"Only the assigned tasker can request completion\" });\n    }\n    \n    if (task.status !== 'assigned' && task.status !== 'in_progress') {\n      return res.status(400).json({ error: \"Task is not in a state that can be completed\" });\n    }\n    \n    const updated = await storage.updateTask(req.params.id, { status: 'in_progress' });\n    \n    const tasker = await storage.getUser(req.userId);\n    await storage.createNotification({\n      userId: task.clientId,\n      type: 'task_update',\n      title: 'طلب إتمام المهمة',\n      message: `${tasker?.name || 'المنفذ'} يطلب تأكيد إتمام \"${task.title}\"`,\n      icon: 'check_circle',\n      color: 'success',\n      actionUrl: `/task/${task.id}`,\n    });\n    \n    res.json({ task: updated });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Bids routes\nrouter.get(\"/api/tasks/:id/bids\", async (req, res) => {\n  try {\n    const bids = await storage.getBidsForTask(req.params.id);\n    res.json(bids);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/tasks/:id/bids\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    \n    const bid = await storage.createBid({\n      taskId: req.params.id,\n      taskerId: req.userId,\n      amount: req.body.amount,\n      message: req.body.message,\n    });\n    \n    // Notify client about new bid\n    const tasker = await storage.getUser(req.userId);\n    await storage.createNotification({\n      userId: task.clientId,\n      type: 'bid_received',\n      title: 'عرض جديد على مهمتك',\n      message: `قدم ${tasker?.name || 'منفذ'} عرضًا بقيمة $${req.body.amount} على \"${task.title}\"`,\n      icon: 'tag',\n      color: 'accent',\n      actionUrl: `/task/${task.id}`,\n    });\n    \n    res.json(bid);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/bids/:id/accept\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const bid = await storage.getBid(req.params.id);\n    if (!bid) return res.status(404).json({ error: \"Bid not found\" });\n    \n    const task = await storage.getTask(bid.taskId);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    if (task.clientId !== req.userId) return res.status(403).json({ error: \"Not authorized\" });\n    \n    const updatedBid = await storage.updateBid(req.params.id, { status: \"accepted\" });\n    const updatedTask = await storage.updateTask(bid.taskId, { status: \"assigned\", taskerId: bid.taskerId });\n    \n    res.json({ bid: updatedBid, task: updatedTask });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Platform fee configuration: 5% for platform, 95% for tasker\n// The platform fee is retained as the difference between client payment and tasker payout\n// Client pays: totalAmount (100%)\n// Tasker receives: taskerPayout (95%)\n// Platform retains: platformFee (5%) - tracked in transactions for audit purposes\nconst PLATFORM_FEE_PERCENTAGE = 0.05;\nconst PLATFORM_ACCOUNT_ID = \"platform\"; // Virtual account for fee tracking\n\nrouter.post(\"/api/tasks/:id/complete\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    \n    if (task.clientId !== req.userId && task.taskerId !== req.userId) {\n      return res.status(403).json({ error: \"Not authorized\" });\n    }\n    \n    if (task.status !== \"assigned\" && task.status !== \"in_progress\") {\n      return res.status(400).json({ error: \"Task cannot be completed in current status\" });\n    }\n    \n    if (!task.taskerId) {\n      return res.status(400).json({ error: \"Task has no assigned tasker\" });\n    }\n    \n    const acceptedBid = await storage.getAcceptedBidForTask(task.id);\n    if (!acceptedBid) {\n      return res.status(400).json({ error: \"No accepted bid found for task\" });\n    }\n    \n    const totalAmount = parseFloat(acceptedBid.amount);\n    const platformFee = totalAmount * PLATFORM_FEE_PERCENTAGE;\n    const taskerPayout = totalAmount - platformFee;\n    \n    const updatedTask = await storage.updateTask(task.id, { status: \"completed\" });\n    \n    const client = await storage.getUser(task.clientId);\n    if (!client) {\n      return res.status(400).json({ error: \"Client not found\" });\n    }\n    \n    const clientBalance = parseFloat(client.balance || \"0\");\n    if (clientBalance < totalAmount) {\n      return res.status(400).json({ error: \"Insufficient client balance\" });\n    }\n    \n    await storage.createTransaction({\n      userId: task.taskerId,\n      taskId: task.id,\n      title: `أرباح: ${task.title}`,\n      amount: taskerPayout.toFixed(2),\n      type: \"credit\",\n      status: \"completed\",\n      icon: \"account_balance_wallet\",\n    });\n    \n    await storage.createTransaction({\n      userId: task.clientId,\n      taskId: task.id,\n      title: `دفع: ${task.title}`,\n      amount: totalAmount.toFixed(2),\n      type: \"debit\",\n      status: \"completed\",\n      icon: \"payment\",\n    });\n    \n    try {\n      await storage.createTransaction({\n        userId: PLATFORM_ACCOUNT_ID,\n        taskId: task.id,\n        title: `رسوم المنصة: ${task.title}`,\n        amount: platformFee.toFixed(2),\n        type: \"credit\",\n        status: \"completed\",\n        icon: \"percent\",\n      });\n    } catch {\n    }\n    \n    await storage.updateUser(task.clientId, {\n      balance: (clientBalance - totalAmount).toFixed(2)\n    });\n    \n    const tasker = await storage.getUser(task.taskerId);\n    if (tasker) {\n      const newBalance = parseFloat(tasker.balance || \"0\") + taskerPayout;\n      await storage.updateUser(task.taskerId, { \n        balance: newBalance.toFixed(2),\n        completedTasks: (tasker.completedTasks || 0) + 1\n      });\n    }\n    \n    res.json({ \n      task: updatedTask, \n      payment: {\n        total: totalAmount,\n        platformFee,\n        taskerPayout,\n        feePercentage: PLATFORM_FEE_PERCENTAGE * 100\n      }\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Messages routes\nrouter.get(\"/api/tasks/:id/messages\", async (req, res) => {\n  try {\n    const messages = await storage.getMessagesForTask(req.params.id);\n    res.json(messages);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/tasks/:id/messages\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    \n    const receiverId = task.clientId === req.userId ? task.taskerId : task.clientId;\n    if (!receiverId) return res.status(400).json({ error: \"No receiver for message\" });\n    \n    const message = await storage.createMessage({\n      taskId: req.params.id,\n      senderId: req.userId,\n      receiverId,\n      content: req.body.content,\n    });\n    res.json(message);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Transactions routes\nrouter.get(\"/api/transactions\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const transactions = await storage.getTransactionsForUser(req.userId);\n    res.json(transactions);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Notifications routes\nrouter.get(\"/api/notifications\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const notifications = await storage.getNotificationsForUser(req.userId);\n    res.json(notifications);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.patch(\"/api/notifications/:id/read\", async (req, res) => {\n  try {\n    const notification = await storage.markNotificationAsRead(req.params.id);\n    res.json(notification);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/notifications/read-all\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const notifications = await storage.getNotificationsForUser(req.userId);\n    for (const notif of notifications) {\n      if (!notif.read) {\n        await storage.markNotificationAsRead(notif.id);\n      }\n    }\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Save/unsave task routes\nrouter.post(\"/api/tasks/:id/save\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const saved = await storage.saveTask(req.userId, req.params.id);\n    res.json(saved);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.delete(\"/api/tasks/:id/save\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    await storage.unsaveTask(req.userId, req.params.id);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Conversations routes\nrouter.get(\"/api/conversations\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    res.json([]); // Placeholder for conversations list\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Professional Roles routes\nrouter.get(\"/api/professional-roles\", async (req, res) => {\n  try {\n    const roles = await storage.getProfessionalRoles();\n    res.json(roles);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/api/professional-roles/:slug\", async (req, res) => {\n  try {\n    const role = await storage.getProfessionalRoleBySlug(req.params.slug);\n    if (!role) return res.status(404).json({ error: \"Role not found\" });\n    res.json(role);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// User Professional Roles routes\nrouter.get(\"/api/users/:userId/professional-roles\", async (req, res) => {\n  try {\n    const roles = await storage.getUserProfessionalRoles(req.params.userId);\n    res.json(roles);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/users/:userId/professional-roles\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    // Only admins can assign professional roles (admin-verified badges)\n    if (!req.user?.isAdmin) {\n      return res.status(403).json({ error: \"Only administrators can assign professional roles\" });\n    }\n    \n    const assigned = await storage.assignProfessionalRole({\n      userId: req.params.userId,\n      roleId: req.body.roleId,\n      verifiedBy: req.userId,\n    });\n    res.json(assigned);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.delete(\"/api/users/:userId/professional-roles/:roleId\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    // Only admins can remove professional roles\n    if (!req.user?.isAdmin) {\n      return res.status(403).json({ error: \"Only administrators can remove professional roles\" });\n    }\n    \n    await storage.removeProfessionalRole(req.params.userId, req.params.roleId);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Tasker Availability routes\nrouter.get(\"/api/users/:userId/availability\", async (req, res) => {\n  try {\n    const { startDate, endDate } = req.query;\n    const availability = await storage.getTaskerAvailability(\n      req.params.userId,\n      startDate as string | undefined,\n      endDate as string | undefined\n    );\n    res.json(availability);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/availability\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const availability = await storage.setTaskerAvailability({\n      userId: req.userId,\n      date: req.body.date,\n      status: req.body.status,\n      note: req.body.note,\n    });\n    res.json(availability);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.patch(\"/api/availability/:id\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    // Verify ownership\n    const availability = await storage.getTaskerAvailabilityById(req.params.id);\n    if (!availability) return res.status(404).json({ error: \"Availability not found\" });\n    if (availability.userId !== req.userId) {\n      return res.status(403).json({ error: \"Not authorized to modify this availability\" });\n    }\n    \n    const updated = await storage.updateTaskerAvailability(req.params.id, req.body);\n    res.json(updated);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.delete(\"/api/availability/:id\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    // Verify ownership\n    const availability = await storage.getTaskerAvailabilityById(req.params.id);\n    if (!availability) return res.status(404).json({ error: \"Availability not found\" });\n    if (availability.userId !== req.userId) {\n      return res.status(403).json({ error: \"Not authorized to delete this availability\" });\n    }\n    \n    await storage.deleteTaskerAvailability(req.params.id);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// User Photos (Portfolio) routes\nrouter.get(\"/api/users/:userId/photos\", async (req, res) => {\n  try {\n    const photos = await storage.getUserPhotos(req.params.userId);\n    res.json(photos);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/photos\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const photo = await storage.addUserPhoto({\n      userId: req.userId,\n      url: req.body.url,\n      caption: req.body.caption,\n    });\n    res.json(photo);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.patch(\"/api/photos/:id\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    // Verify ownership\n    const photo = await storage.getUserPhotoById(req.params.id);\n    if (!photo) return res.status(404).json({ error: \"Photo not found\" });\n    if (photo.userId !== req.userId) {\n      return res.status(403).json({ error: \"Not authorized to modify this photo\" });\n    }\n    \n    const updated = await storage.updateUserPhoto(req.params.id, req.body);\n    res.json(updated);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.delete(\"/api/photos/:id\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    // Verify ownership\n    const photo = await storage.getUserPhotoById(req.params.id);\n    if (!photo) return res.status(404).json({ error: \"Photo not found\" });\n    if (photo.userId !== req.userId) {\n      return res.status(403).json({ error: \"Not authorized to delete this photo\" });\n    }\n    \n    await storage.deleteUserPhoto(req.params.id);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/api/photos/reorder\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    // Verify ownership of all photos being reordered\n    const { photoIds } = req.body;\n    if (!Array.isArray(photoIds) || photoIds.length === 0) {\n      return res.status(400).json({ error: \"photoIds array required\" });\n    }\n    \n    for (const photoId of photoIds) {\n      const photo = await storage.getUserPhotoById(photoId);\n      if (!photo) return res.status(404).json({ error: `Photo ${photoId} not found` });\n      if (photo.userId !== req.userId) {\n        return res.status(403).json({ error: \"Not authorized to reorder these photos\" });\n      }\n    }\n    \n    await storage.reorderUserPhotos(req.userId, photoIds);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Get user with extended details (roles, availability, photos)\nrouter.get(\"/api/users/:userId\", async (req, res) => {\n  try {\n    const user = await storage.getUser(req.params.userId);\n    if (!user) return res.status(404).json({ error: \"User not found\" });\n    \n    const [professionalRoles, availability, photos] = await Promise.all([\n      storage.getUserProfessionalRoles(req.params.userId),\n      storage.getTaskerAvailability(req.params.userId),\n      storage.getUserPhotos(req.params.userId),\n    ]);\n    \n    res.json({\n      ...sanitizeUser(user),\n      professionalRoles,\n      availability,\n      photos,\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Delete task (client only - soft delete by setting status to cancelled)\nrouter.delete(\"/api/tasks/:id\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    if (task.clientId !== req.userId) return res.status(403).json({ error: \"Not authorized\" });\n    \n    if (task.status !== 'open') {\n      return res.status(400).json({ error: \"Can only delete open tasks\" });\n    }\n    \n    await storage.deleteTask(req.params.id);\n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Search taskers with professional roles\nrouter.get(\"/api/taskers/search\", async (req, res) => {\n  try {\n    const { category, verified, search } = req.query;\n    const taskers = await storage.searchTaskers({\n      category: category as string,\n      verified: verified === 'true',\n      search: search as string,\n    });\n    \n    const taskersWithRoles = await Promise.all(\n      taskers.map(async (tasker) => {\n        const professionalRoles = await storage.getUserProfessionalRoles(tasker.id);\n        return {\n          ...sanitizeUser(tasker),\n          professionalRoles,\n        };\n      })\n    );\n    \n    res.json(taskersWithRoles);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Tasker marks task as completed - triggers payment request to client\nrouter.post(\"/api/tasks/:id/request-completion\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const task = await storage.getTask(req.params.id);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    if (task.taskerId !== req.userId) return res.status(403).json({ error: \"Only assigned tasker can complete\" });\n    \n    if (task.status !== 'assigned' && task.status !== 'in_progress') {\n      return res.status(400).json({ error: \"Task is not in progress\" });\n    }\n    \n    const acceptedBid = await storage.getAcceptedBidForTask(task.id);\n    if (!acceptedBid) {\n      return res.status(400).json({ error: \"No accepted bid found\" });\n    }\n    \n    // Notify client that tasker has completed and payment is required\n    await storage.createNotification({\n      userId: task.clientId,\n      type: 'payment_request',\n      title: 'تم إنجاز المهمة',\n      message: `أكمل المنفذ المهمة \"${task.title}\". يرجى الدفع لإتمام المعاملة.`,\n      icon: 'check-circle',\n      color: 'success',\n      actionUrl: `/task/${task.id}/payment`,\n    });\n    \n    res.json({ \n      success: true,\n      taskId: task.id,\n      amount: acceptedBid.amount,\n      message: 'Completion request sent to client'\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Create Stripe payment intent for task completion\nrouter.post(\"/api/payments/create-intent\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const { taskId } = req.body;\n    if (!taskId) return res.status(400).json({ error: \"taskId required\" });\n    \n    const task = await storage.getTask(taskId);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    if (task.clientId !== req.userId) return res.status(403).json({ error: \"Only client can pay\" });\n    \n    const acceptedBid = await storage.getAcceptedBidForTask(task.id);\n    if (!acceptedBid) {\n      return res.status(400).json({ error: \"No accepted bid found\" });\n    }\n    \n    const amount = Math.round(parseFloat(acceptedBid.amount) * 100); // Convert to cents\n    \n    const { getUncachableStripeClient } = await import('./stripeClient');\n    const stripe = await getUncachableStripeClient();\n    \n    const paymentIntent = await stripe.paymentIntents.create({\n      amount,\n      currency: 'usd',\n      metadata: {\n        taskId: task.id,\n        clientId: task.clientId,\n        taskerId: task.taskerId || '',\n        bidId: acceptedBid.id,\n      },\n    });\n    \n    const { getStripePublishableKey } = await import('./stripeClient');\n    const publishableKey = await getStripePublishableKey();\n    \n    res.json({\n      clientSecret: paymentIntent.client_secret,\n      publishableKey,\n      amount: parseFloat(acceptedBid.amount),\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Confirm payment and complete task\nrouter.post(\"/api/payments/confirm\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const { taskId, paymentIntentId } = req.body;\n    if (!taskId || !paymentIntentId) {\n      return res.status(400).json({ error: \"taskId and paymentIntentId required\" });\n    }\n    \n    const task = await storage.getTask(taskId);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    if (task.clientId !== req.userId) return res.status(403).json({ error: \"Only client can confirm\" });\n    \n    const { getUncachableStripeClient } = await import('./stripeClient');\n    const stripe = await getUncachableStripeClient();\n    \n    const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);\n    \n    if (paymentIntent.status !== 'succeeded') {\n      return res.status(400).json({ error: \"Payment not successful\" });\n    }\n    \n    const acceptedBid = await storage.getAcceptedBidForTask(task.id);\n    if (!acceptedBid) {\n      return res.status(400).json({ error: \"No accepted bid found\" });\n    }\n    \n    const totalAmount = parseFloat(acceptedBid.amount);\n    const platformFee = totalAmount * PLATFORM_FEE_PERCENTAGE;\n    const taskerPayout = totalAmount - platformFee;\n    \n    // Update task status\n    await storage.updateTask(task.id, { status: \"completed\" });\n    \n    // Credit tasker\n    if (task.taskerId) {\n      const tasker = await storage.getUser(task.taskerId);\n      if (tasker) {\n        const newBalance = parseFloat(tasker.balance || \"0\") + taskerPayout;\n        await storage.updateUser(task.taskerId, { \n          balance: newBalance.toFixed(2),\n          completedTasks: (tasker.completedTasks || 0) + 1\n        });\n        \n        // Create transaction for tasker\n        await storage.createTransaction({\n          userId: task.taskerId,\n          taskId: task.id,\n          title: `أرباح: ${task.title}`,\n          amount: taskerPayout.toFixed(2),\n          type: \"credit\",\n          status: \"completed\",\n          icon: \"account_balance_wallet\",\n        });\n        \n        // Notify tasker\n        await storage.createNotification({\n          userId: task.taskerId,\n          type: 'task_completed',\n          title: 'تم إتمام الدفع',\n          message: `تم استلام ${taskerPayout.toFixed(2)} ريال مقابل \"${task.title}\"`,\n          icon: 'check-circle',\n          color: 'success',\n          actionUrl: `/task/${task.id}`,\n        });\n      }\n    }\n    \n    // Create transaction for client\n    await storage.createTransaction({\n      userId: task.clientId,\n      taskId: task.id,\n      title: `دفع: ${task.title}`,\n      amount: totalAmount.toFixed(2),\n      type: \"debit\",\n      status: \"completed\",\n      icon: \"payment\",\n    });\n    \n    res.json({ \n      success: true,\n      payment: {\n        total: totalAmount,\n        platformFee,\n        taskerPayout,\n      }\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ===== Direct Service Requests =====\n\n// Create a direct service request\nrouter.post(\"/api/direct-requests\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const { taskerId, category, title, description, scheduledDate, scheduledTime, location, latitude, longitude, budget } = req.body;\n    \n    if (!taskerId || !category || !title || !description || !scheduledDate || !scheduledTime || !location || !budget) {\n      return res.status(400).json({ error: \"Missing required fields\" });\n    }\n    \n    // Verify tasker exists\n    const tasker = await storage.getUser(taskerId);\n    if (!tasker || tasker.role !== 'tasker') {\n      return res.status(400).json({ error: \"Invalid tasker\" });\n    }\n    \n    const request = await storage.createDirectServiceRequest({\n      clientId: req.userId,\n      taskerId,\n      category,\n      title,\n      description,\n      scheduledDate,\n      scheduledTime,\n      location,\n      latitude: latitude || null,\n      longitude: longitude || null,\n      budget: budget.toString(),\n    });\n    \n    // Notify the tasker about the new service request\n    const client = await storage.getUser(req.userId);\n    await storage.createNotification({\n      userId: taskerId,\n      type: 'direct_request',\n      title: 'طلب خدمة مباشر',\n      message: `${client?.name || 'عميل'} يطلب خدمتك: ${title}`,\n      icon: 'user-check',\n      color: 'primary',\n      actionUrl: `/direct-requests`,\n    });\n    \n    res.status(201).json(request);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Get direct requests for current user (client or tasker)\nrouter.get(\"/api/direct-requests\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const user = await storage.getUser(req.userId);\n    if (!user) return res.status(404).json({ error: \"User not found\" });\n    \n    let requests;\n    if (user.role === 'tasker') {\n      requests = await storage.getDirectServiceRequestsForTasker(req.userId);\n    } else {\n      requests = await storage.getDirectServiceRequestsForClient(req.userId);\n    }\n    \n    // Enrich with user details\n    const enrichedRequests = await Promise.all(requests.map(async (r) => {\n      const client = await storage.getUser(r.clientId);\n      const tasker = await storage.getUser(r.taskerId);\n      return {\n        ...r,\n        client: client ? sanitizeUser(client) : null,\n        tasker: tasker ? sanitizeUser(tasker) : null,\n      };\n    }));\n    \n    res.json(enrichedRequests);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Get a single direct request\nrouter.get(\"/api/direct-requests/:id\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const request = await storage.getDirectServiceRequest(req.params.id);\n    if (!request) return res.status(404).json({ error: \"Request not found\" });\n    \n    // Only client or tasker can view\n    if (request.clientId !== req.userId && request.taskerId !== req.userId) {\n      return res.status(403).json({ error: \"Forbidden\" });\n    }\n    \n    const client = await storage.getUser(request.clientId);\n    const tasker = await storage.getUser(request.taskerId);\n    \n    res.json({\n      ...request,\n      client: client ? sanitizeUser(client) : null,\n      tasker: tasker ? sanitizeUser(tasker) : null,\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Accept a direct request (tasker only)\nrouter.post(\"/api/direct-requests/:id/accept\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const request = await storage.getDirectServiceRequest(req.params.id);\n    if (!request) return res.status(404).json({ error: \"Request not found\" });\n    \n    if (request.taskerId !== req.userId) {\n      return res.status(403).json({ error: \"Only the assigned tasker can accept\" });\n    }\n    \n    if (request.status !== 'pending') {\n      return res.status(400).json({ error: \"Request is no longer pending\" });\n    }\n    \n    // Create a task from this direct request\n    const task = await storage.createTask({\n      clientId: request.clientId,\n      title: request.title,\n      description: request.description,\n      category: request.category,\n      location: request.location,\n      latitude: request.latitude,\n      longitude: request.longitude,\n      budget: request.budget,\n      date: request.scheduledDate,\n      time: request.scheduledTime,\n    });\n    \n    // Update task with assigned tasker and status\n    await storage.updateTask(task.id, { \n      taskerId: request.taskerId,\n      status: 'assigned',\n    });\n    \n    // Create a bid for consistency\n    const bid = await storage.createBid({\n      taskId: task.id,\n      taskerId: request.taskerId,\n      amount: request.budget,\n      message: `طلب خدمة مباشر - موعد: ${request.scheduledDate} ${request.scheduledTime}`,\n    });\n    \n    // Accept the bid\n    await storage.updateBid(bid.id, { status: 'accepted' });\n    \n    // Update the direct request\n    const updatedRequest = await storage.updateDirectServiceRequest(request.id, {\n      status: 'accepted',\n      linkedTaskId: task.id,\n    });\n    \n    // Notify client\n    const tasker = await storage.getUser(request.taskerId);\n    await storage.createNotification({\n      userId: request.clientId,\n      type: 'direct_request_accepted',\n      title: 'تم قبول طلبك',\n      message: `${tasker?.name || 'المنفذ'} قبل طلب خدمتك: ${request.title}`,\n      icon: 'check-circle',\n      color: 'success',\n      actionUrl: `/task/${task.id}`,\n    });\n    \n    res.json({\n      ...updatedRequest,\n      task,\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Reject a direct request (tasker only)\nrouter.post(\"/api/direct-requests/:id/reject\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const request = await storage.getDirectServiceRequest(req.params.id);\n    if (!request) return res.status(404).json({ error: \"Request not found\" });\n    \n    if (request.taskerId !== req.userId) {\n      return res.status(403).json({ error: \"Only the assigned tasker can reject\" });\n    }\n    \n    if (request.status !== 'pending') {\n      return res.status(400).json({ error: \"Request is no longer pending\" });\n    }\n    \n    const updatedRequest = await storage.updateDirectServiceRequest(request.id, {\n      status: 'rejected',\n    });\n    \n    // Notify client\n    const tasker = await storage.getUser(request.taskerId);\n    await storage.createNotification({\n      userId: request.clientId,\n      type: 'direct_request_rejected',\n      title: 'تم رفض طلبك',\n      message: `${tasker?.name || 'المنفذ'} رفض طلب خدمتك: ${request.title}`,\n      icon: 'x-circle',\n      color: 'error',\n      actionUrl: `/direct-requests`,\n    });\n    \n    res.json(updatedRequest);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Cancel a direct request (client only)\nrouter.post(\"/api/direct-requests/:id/cancel\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const request = await storage.getDirectServiceRequest(req.params.id);\n    if (!request) return res.status(404).json({ error: \"Request not found\" });\n    \n    if (request.clientId !== req.userId) {\n      return res.status(403).json({ error: \"Only the client can cancel\" });\n    }\n    \n    if (request.status !== 'pending') {\n      return res.status(400).json({ error: \"Request is no longer pending\" });\n    }\n    \n    const updatedRequest = await storage.updateDirectServiceRequest(request.id, {\n      status: 'cancelled',\n    });\n    \n    // Notify tasker\n    const client = await storage.getUser(request.clientId);\n    await storage.createNotification({\n      userId: request.taskerId,\n      type: 'system',\n      title: 'تم إلغاء الطلب',\n      message: `${client?.name || 'العميل'} ألغى طلب الخدمة: ${request.title}`,\n      icon: 'x-circle',\n      color: 'warning',\n      actionUrl: `/direct-requests`,\n    });\n    \n    res.json(updatedRequest);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============= ADMIN ROUTES =============\n\n// Middleware to check if user is admin\nconst requireAdmin = async (req: Request, res: Response, next: Function) => {\n  if (!req.user?.isAdmin) {\n    return res.status(403).json({ error: \"Admin access required\" });\n  }\n  next();\n};\n\n// Get all users (admin only)\nrouter.get(\"/api/admin/users\", requireAdmin, async (req, res) => {\n  try {\n    const users = await storage.getAllUsers();\n    res.json(users.map(u => sanitizeUser(u)));\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Get pending certificate verifications (admin only)\nrouter.get(\"/api/admin/pending-verifications\", requireAdmin, async (req, res) => {\n  try {\n    const pending = await storage.getPendingVerifications();\n    res.json(pending.map(u => sanitizeUser(u)));\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Approve tasker verification (admin only)\nrouter.post(\"/api/admin/users/:id/approve\", requireAdmin, async (req, res) => {\n  try {\n    const user = await storage.getUser(req.params.id);\n    if (!user) return res.status(404).json({ error: \"User not found\" });\n    \n    const updated = await storage.updateUser(req.params.id, {\n      verificationStatus: 'approved',\n    } as any);\n    \n    // Notify tasker\n    await storage.createNotification({\n      userId: user.id,\n      type: 'system',\n      title: 'تم اعتماد حسابك',\n      message: 'تهانينا! تم التحقق من شهادتك واعتماد حسابك كمنفذ متخصص',\n      icon: 'badge-check',\n      color: 'success',\n      actionUrl: '/profile',\n    });\n    \n    res.json(sanitizeUser(updated));\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Reject tasker verification (admin only)\nrouter.post(\"/api/admin/users/:id/reject\", requireAdmin, async (req, res) => {\n  try {\n    const { reason } = req.body;\n    const user = await storage.getUser(req.params.id);\n    if (!user) return res.status(404).json({ error: \"User not found\" });\n    \n    const updated = await storage.updateUser(req.params.id, {\n      verificationStatus: 'rejected',\n    } as any);\n    \n    // Notify tasker\n    await storage.createNotification({\n      userId: user.id,\n      type: 'system',\n      title: 'تم رفض طلب التحقق',\n      message: reason || 'للأسف، لم يتم قبول الشهادة المقدمة. يرجى التواصل مع الدعم لمزيد من المعلومات',\n      icon: 'alert-circle',\n      color: 'error',\n      actionUrl: '/verify',\n    });\n    \n    res.json(sanitizeUser(updated));\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Get admin dashboard stats\nrouter.get(\"/api/admin/stats\", requireAdmin, async (req, res) => {\n  try {\n    const allUsers = await storage.getAllUsers();\n    const allTasks = await storage.getTasks({});\n    const pendingVerifications = await storage.getPendingVerifications();\n    \n    const stats = {\n      totalUsers: allUsers.length,\n      totalClients: allUsers.filter(u => u.role === 'client').length,\n      totalTaskers: allUsers.filter(u => u.role === 'tasker').length,\n      verifiedTaskers: allUsers.filter(u => u.role === 'tasker' && u.verificationStatus === 'approved').length,\n      pendingVerifications: pendingVerifications.length,\n      totalTasks: allTasks.length,\n      openTasks: allTasks.filter(t => t.status === 'open').length,\n      completedTasks: allTasks.filter(t => t.status === 'completed').length,\n      assignedTasks: allTasks.filter(t => t.status === 'assigned' || t.status === 'in_progress').length,\n    };\n    \n    res.json(stats);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Update user (admin only)\nrouter.patch(\"/api/admin/users/:id\", requireAdmin, async (req, res) => {\n  try {\n    const user = await storage.getUser(req.params.id);\n    if (!user) return res.status(404).json({ error: \"User not found\" });\n    \n    const updated = await storage.updateUser(req.params.id, req.body);\n    res.json(sanitizeUser(updated));\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============= REVIEWS ROUTES =============\n\n// Create a review for a completed task\nrouter.post(\"/api/reviews\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const { taskId, rating, comment } = req.body;\n    \n    if (!taskId || !rating) {\n      return res.status(400).json({ error: \"Task ID and rating are required\" });\n    }\n    \n    if (rating < 1 || rating > 5) {\n      return res.status(400).json({ error: \"Rating must be between 1 and 5\" });\n    }\n    \n    const task = await storage.getTask(taskId);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    \n    // Only client can review the tasker\n    if (task.clientId !== req.userId) {\n      return res.status(403).json({ error: \"Only the client can review the tasker\" });\n    }\n    \n    // Task must be completed\n    if (task.status !== 'completed') {\n      return res.status(400).json({ error: \"Task must be completed before reviewing\" });\n    }\n    \n    if (!task.taskerId) {\n      return res.status(400).json({ error: \"Task has no assigned tasker\" });\n    }\n    \n    // Check if review already exists\n    const existingReview = await storage.getReviewForTask(taskId);\n    if (existingReview) {\n      return res.status(400).json({ error: \"Review already exists for this task\" });\n    }\n    \n    const review = await storage.createReview({\n      taskId,\n      reviewerId: req.userId,\n      revieweeId: task.taskerId,\n      rating,\n      comment: comment || null,\n    });\n    \n    // Update tasker's average rating\n    const { rating: avgRating, count } = await storage.calculateUserRating(task.taskerId);\n    await storage.updateUser(task.taskerId, { rating: avgRating });\n    \n    // Notify tasker\n    const client = await storage.getUser(req.userId);\n    await storage.createNotification({\n      userId: task.taskerId,\n      type: 'review',\n      title: 'تقييم جديد',\n      message: `${client?.name || 'العميل'} قيّمك ${rating} نجوم`,\n      icon: 'star',\n      color: 'warning',\n      actionUrl: `/profile`,\n    });\n    \n    res.json({ review, newRating: avgRating, totalReviews: count });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Get reviews for a user\nrouter.get(\"/api/users/:id/reviews\", async (req, res) => {\n  try {\n    const reviews = await storage.getReviewsForUser(req.params.id);\n    res.json(reviews);\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Check if a task has been reviewed\nrouter.get(\"/api/tasks/:id/review\", async (req, res) => {\n  try {\n    const review = await storage.getReviewForTask(req.params.id);\n    res.json({ hasReview: !!review, review });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============= PUSH NOTIFICATIONS =============\n\n// Get VAPID public key\nrouter.get(\"/api/push/vapid-key\", (req, res) => {\n  res.json({ publicKey: getVapidPublicKey() });\n});\n\n// Subscribe to push notifications\nrouter.post(\"/api/push/subscribe\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const { endpoint, p256dh, auth, deviceType } = req.body;\n    \n    if (!endpoint || typeof endpoint !== 'string') {\n      return res.status(400).json({ error: \"Endpoint is required\" });\n    }\n    \n    if (!deviceType || typeof deviceType !== 'string') {\n      return res.status(400).json({ error: \"Device type is required\" });\n    }\n    \n    // Validate device type\n    const validDeviceTypes = ['web', 'ios', 'android'];\n    if (!validDeviceTypes.includes(deviceType)) {\n      return res.status(400).json({ error: \"Invalid device type\" });\n    }\n    \n    // For web subscriptions, require valid p256dh and auth keys\n    if (deviceType === 'web') {\n      if (!p256dh || typeof p256dh !== 'string' || p256dh === '' || p256dh === 'native' || p256dh.length < 20) {\n        return res.status(400).json({ error: \"Valid p256dh key is required for web subscriptions\" });\n      }\n      if (!auth || typeof auth !== 'string' || auth === '' || auth === 'native' || auth.length < 10) {\n        return res.status(400).json({ error: \"Valid auth key is required for web subscriptions\" });\n      }\n      // Web push endpoints must be HTTPS URLs\n      if (!endpoint.startsWith('https://')) {\n        return res.status(400).json({ error: \"Invalid web push endpoint\" });\n      }\n    }\n    \n    // For native platforms (ios/android), endpoint should contain native prefix\n    if ((deviceType === 'ios' || deviceType === 'android')) {\n      // Native tokens can be plain tokens or prefixed - accept either\n      console.log(`[Push] Native subscription: ${deviceType}, endpoint length: ${endpoint.length}`);\n    }\n    \n    // Save subscription to database\n    await storage.savePushSubscription({\n      userId: req.userId,\n      endpoint,\n      p256dh: deviceType === 'web' ? p256dh : 'native',\n      auth: deviceType === 'web' ? auth : 'native',\n      deviceType,\n    });\n    \n    // Update user's push token for native apps\n    if (deviceType === 'ios' || deviceType === 'android') {\n      await storage.updateUser(req.userId, { pushToken: endpoint });\n    }\n    \n    console.log(`[Push] Subscription saved for user ${req.userId}, type: ${deviceType}`);\n    res.json({ success: true });\n  } catch (error: any) {\n    console.error('[Push] Subscribe error:', error);\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// Unsubscribe from push notifications\nrouter.post(\"/api/push/unsubscribe\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    await storage.deletePushSubscription(req.userId);\n    await storage.updateUser(req.userId, { pushToken: null });\n    \n    res.json({ success: true });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============= LEVEL SYSTEM =============\n\n// Get user level info\nrouter.get(\"/api/users/:id/level\", async (req, res) => {\n  try {\n    const user = await storage.getUser(req.params.id);\n    if (!user) return res.status(404).json({ error: \"User not found\" });\n    \n    const progress = calculateProgress(user.experiencePoints || 0);\n    \n    res.json({\n      level: user.taskerLevel || 'bronze',\n      experiencePoints: user.experiencePoints || 0,\n      ...progress,\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\n// ============= ENHANCED REVIEWS =============\n\n// Create review with detailed ratings\nrouter.post(\"/api/tasks/:id/review-detailed\", async (req, res) => {\n  try {\n    if (!req.userId) return res.status(401).json({ error: \"Not authenticated\" });\n    \n    const taskId = req.params.id;\n    const { rating, qualityRating, speedRating, communicationRating, comment } = req.body;\n    \n    if (!rating || rating < 1 || rating > 5) {\n      return res.status(400).json({ error: \"Rating must be between 1 and 5\" });\n    }\n    \n    const task = await storage.getTask(taskId);\n    if (!task) return res.status(404).json({ error: \"Task not found\" });\n    \n    if (task.clientId !== req.userId) {\n      return res.status(403).json({ error: \"Only the client can review the tasker\" });\n    }\n    \n    if (task.status !== 'completed') {\n      return res.status(400).json({ error: \"Task must be completed before reviewing\" });\n    }\n    \n    if (!task.taskerId) {\n      return res.status(400).json({ error: \"Task has no assigned tasker\" });\n    }\n    \n    const existingReview = await storage.getReviewForTask(taskId);\n    if (existingReview) {\n      return res.status(400).json({ error: \"Review already exists for this task\" });\n    }\n    \n    const review = await storage.createReview({\n      taskId,\n      reviewerId: req.userId,\n      revieweeId: task.taskerId,\n      rating,\n      qualityRating: qualityRating || null,\n      speedRating: speedRating || null,\n      communicationRating: communicationRating || null,\n      comment: comment || null,\n    });\n    \n    // Update tasker's rating\n    const { rating: avgRating, count } = await storage.calculateUserRating(task.taskerId);\n    await storage.updateUser(task.taskerId, { rating: avgRating });\n    \n    // Award experience points based on rating\n    const tasker = await storage.getUser(task.taskerId);\n    if (tasker) {\n      let pointsEarned = POINT_VALUES.taskCompleted;\n      if (rating === 5) pointsEarned += POINT_VALUES.fiveStarRating;\n      else if (rating === 4) pointsEarned += POINT_VALUES.fourStarRating;\n      else if (rating === 3) pointsEarned += POINT_VALUES.threeStarRating;\n      \n      const newPoints = (tasker.experiencePoints || 0) + pointsEarned;\n      const newLevel = calculateLevel(newPoints);\n      \n      await storage.updateUser(task.taskerId, {\n        experiencePoints: newPoints,\n        taskerLevel: newLevel,\n      });\n      \n      // Notify tasker of level up if applicable\n      if (newLevel !== tasker.taskerLevel) {\n        const levelInfo = getLevelInfo(newLevel);\n        await storage.createNotification({\n          userId: task.taskerId,\n          type: 'system',\n          title: 'ترقية المستوى! 🎉',\n          message: `مبروك! وصلت إلى المستوى ${levelInfo.nameAr}`,\n          icon: 'trophy',\n          color: 'success',\n          actionUrl: '/profile',\n        });\n      }\n    }\n    \n    // Notify tasker\n    const client = await storage.getUser(req.userId);\n    await storage.createNotification({\n      userId: task.taskerId,\n      type: 'review',\n      title: 'تقييم جديد',\n      message: `${client?.name || 'العميل'} قيّمك ${rating} نجوم`,\n      icon: 'star',\n      color: 'warning',\n      actionUrl: '/profile',\n    });\n    \n    res.json({ review, newRating: avgRating, totalReviews: count });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n","path":null,"size_bytes":76056,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/pages/WelcomeScreen.tsx":{"content":"import { useLocation } from 'wouter';\nimport { motion } from 'framer-motion';\nimport { memo } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Sparkles } from 'lucide-react';\nimport Logo from '@/components/Logo';\n\nconst WelcomeScreen = memo(function WelcomeScreen() {\n  const [, setLocation] = useLocation();\n  const { t } = useTranslation();\n\n  const tags = [\n    { key: 'welcome.trusted' },\n    { key: 'welcome.secure' },\n    { key: 'welcome.local' }\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-background via-background to-primary/5 pt-safe\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.5 }}\n          transition={{ duration: 1.5 }}\n          className=\"absolute top-20 -right-20 w-64 h-64 bg-primary/20 rounded-full blur-3xl rtl:-left-20 rtl:right-auto\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          transition={{ duration: 1.5, delay: 0.3 }}\n          className=\"absolute bottom-40 -left-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl rtl:-right-20 rtl:left-auto\"\n        />\n      </div>\n\n      <div className=\"flex-1 flex flex-col items-center justify-center px-8 relative z-10\">\n        <motion.div \n          initial={{ scale: 0, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          transition={{ \n            type: \"spring\",\n            stiffness: 200,\n            damping: 20,\n            delay: 0.1 \n          }}\n          className=\"relative mb-10\"\n        >\n          <div className=\"w-32 h-32 rounded-[2rem] glass flex items-center justify-center shadow-2xl shadow-primary/30 border border-white/20\">\n            <Logo size={80} />\n          </div>\n          <motion.div\n            animate={{ \n              scale: [1, 1.2, 1],\n              opacity: [0.5, 0.8, 0.5]\n            }}\n            transition={{ \n              duration: 2,\n              repeat: Infinity,\n              ease: \"easeInOut\"\n            }}\n            className=\"absolute inset-0 rounded-[2rem] bg-primary/20 blur-xl -z-10\"\n          />\n        </motion.div>\n        \n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3, duration: 0.5 }}\n          className=\"text-center max-w-sm\"\n        >\n          <h1 className=\"text-5xl font-extrabold tracking-tight mb-4 gradient-text\">\n            {t('welcome.title')}\n          </h1>\n          <p className=\"text-xl text-muted-foreground leading-relaxed\">\n            {t('welcome.subtitle')}\n          </p>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 30 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.5, duration: 0.5 }}\n          className=\"flex flex-wrap justify-center gap-3 mt-8\"\n        >\n          {tags.map((tag, i) => (\n            <motion.div\n              key={tag.key}\n              initial={{ opacity: 0, scale: 0.8 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ delay: 0.6 + i * 0.1 }}\n              className=\"px-4 py-2 rounded-full glass text-sm font-medium text-foreground/80 flex items-center gap-2\"\n            >\n              <Sparkles className=\"w-3.5 h-3.5 text-primary\" />\n              {t(tag.key)}\n            </motion.div>\n          ))}\n        </motion.div>\n      </div>\n\n      <motion.div\n        initial={{ opacity: 0, y: 40 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.7, duration: 0.5 }}\n        className=\"px-8 pb-12 pb-safe space-y-4\"\n      >\n        <motion.button \n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n          onClick={() => setLocation('/role')}\n          className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/25 transition-all flex items-center justify-center gap-2\"\n          data-testid=\"button-get-started\"\n        >\n          {t('auth.getStarted')}\n          <motion.span\n            animate={{ x: [0, 4, 0] }}\n            transition={{ duration: 1.5, repeat: Infinity }}\n            className=\"rtl:rotate-180\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7l5 5m0 0l-5 5m5-5H6\" />\n            </svg>\n          </motion.span>\n        </motion.button>\n        \n        <motion.button \n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n          onClick={() => setLocation('/login')}\n          className=\"w-full h-14 glass rounded-2xl font-bold text-lg text-foreground transition-all\"\n          data-testid=\"button-login\"\n        >\n          {t('auth.alreadyHaveAccount')}\n        </motion.button>\n\n        <p className=\"text-xs text-muted-foreground text-center pt-4 leading-relaxed\">\n          {t('settings.terms')} {t('common.and')} {t('settings.privacy_policy')}\n        </p>\n      </motion.div>\n    </div>\n  );\n});\n\nexport default WelcomeScreen;\n","path":null,"size_bytes":5165,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/OfferCard.tsx":{"content":"import { memo, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Star, Briefcase, Clock, Check, X, DollarSign } from 'lucide-react';\nimport type { BidWithTasker } from '@shared/schema';\n\ninterface OfferCardProps {\n  offer: BidWithTasker;\n  onAccept?: (offerId: string) => void;\n  onReject?: (offerId: string) => void;\n  showActions?: boolean;\n}\n\nexport const OfferCard = memo(function OfferCard({ \n  offer, \n  onAccept, \n  onReject, \n  showActions = true \n}: OfferCardProps) {\n  const formatCurrency = useCallback((amount: number | string) => {\n    const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(num);\n  }, []);\n\n  const getInitials = useCallback((name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n  }, []);\n\n  const getStatusBadge = useCallback((status: string) => {\n    const styles = {\n      pending: { bg: 'bg-warning/15 text-warning border-warning/20', icon: Clock, label: 'Pending' },\n      accepted: { bg: 'bg-success/15 text-success border-success/20', icon: Check, label: 'Accepted' },\n      rejected: { bg: 'bg-destructive/15 text-destructive border-destructive/20', icon: X, label: 'Rejected' },\n    };\n    \n    const style = styles[status as keyof typeof styles];\n    if (!style) return null;\n    \n    const Icon = style.icon;\n    return (\n      <span className={cn(\n        \"text-[10px] font-bold uppercase tracking-wider px-2.5 py-1 rounded-full flex items-center gap-1 border\",\n        style.bg\n      )}>\n        <Icon className=\"w-3 h-3\" />\n        {style.label}\n      </span>\n    );\n  }, []);\n\n  const taskerName = offer.tasker?.name || 'Unknown Tasker';\n  const taskerRating = offer.tasker?.rating ? parseFloat(String(offer.tasker.rating)) : 0;\n  const taskerJobs = offer.tasker?.completedTasks || 0;\n\n  return (\n    <motion.div \n      whileTap={{ scale: 0.98 }}\n      className=\"glass rounded-3xl p-5 transition-all hover:shadow-lg\"\n      data-testid={`offer-card-${offer.id}`}\n    >\n      <div className=\"flex items-start gap-4\">\n        <Avatar className=\"w-14 h-14 border-2 border-white/20 shadow-lg\">\n          <AvatarImage src={offer.tasker?.avatar || undefined} alt={taskerName} />\n          <AvatarFallback className=\"gradient-primary text-white font-bold\">\n            {getInitials(taskerName)}\n          </AvatarFallback>\n        </Avatar>\n\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center justify-between gap-2 mb-2\">\n            <h4 className=\"font-bold text-foreground text-lg truncate\">{taskerName}</h4>\n            {getStatusBadge(offer.status)}\n          </div>\n          \n          <div className=\"flex items-center gap-4 text-sm text-muted-foreground mb-3\">\n            <div className=\"flex items-center gap-1.5\">\n              <Star className=\"w-4 h-4 fill-warning text-warning\" />\n              <span className=\"font-bold\">{taskerRating.toFixed(1)}</span>\n            </div>\n            <div className=\"flex items-center gap-1.5\">\n              <Briefcase className=\"w-4 h-4\" />\n              <span>{taskerJobs} jobs</span>\n            </div>\n          </div>\n\n          {offer.message && (\n            <div className=\"bg-white/30 dark:bg-white/5 rounded-xl p-3 mb-4\">\n              <p className=\"text-sm text-muted-foreground italic\">\n                \"{offer.message}\"\n              </p>\n            </div>\n          )}\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-1.5 bg-primary/10 px-4 py-2 rounded-xl\">\n              <DollarSign className=\"w-5 h-5 text-primary\" />\n              <span className=\"text-xl font-extrabold text-primary\">\n                {formatCurrency(offer.amount).replace('$', '')}\n              </span>\n            </div>\n\n            {showActions && offer.status === 'pending' && (\n              <div className=\"flex items-center gap-2\">\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={() => onReject?.(offer.id)}\n                  className=\"px-5 py-2.5 rounded-xl glass-button font-bold text-sm\"\n                  data-testid={`button-reject-offer-${offer.id}`}\n                >\n                  Decline\n                </motion.button>\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={() => onAccept?.(offer.id)}\n                  className=\"px-5 py-2.5 rounded-xl gradient-primary text-white font-bold text-sm shadow-lg shadow-primary/25\"\n                  data-testid={`button-accept-offer-${offer.id}`}\n                >\n                  Accept\n                </motion.button>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n});\n","path":null,"size_bytes":5141,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { router } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport session from \"express-session\";\nimport createMemoryStore from \"memorystore\";\nimport { WebSocketServer } from \"ws\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\n// CORS middleware for Capacitor iOS app\napp.use((req, res, next) => {\n  const allowedOrigins = [\n    'capacitor://localhost',\n    'ionic://localhost',\n    'http://localhost',\n    'http://localhost:5000',\n    'https://localhost',\n    'https://758b6ce0-8b1f-4d3b-91fc-8a652cb0679b-00-1f8q924g3ablw.worf.replit.dev',\n    'null' // For file:// or capacitor:// origins that show as null\n  ];\n  \n  const origin = req.headers.origin;\n  if (origin && allowedOrigins.includes(origin)) {\n    res.setHeader('Access-Control-Allow-Origin', origin);\n  } else if (!origin || origin === 'null') {\n    // Allow requests with no origin (like from Capacitor iOS)\n    res.setHeader('Access-Control-Allow-Origin', '*');\n  }\n  \n  res.setHeader('Access-Control-Allow-Credentials', 'true');\n  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, PATCH, DELETE, OPTIONS');\n  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization, X-Requested-With');\n  \n  if (req.method === 'OPTIONS') {\n    return res.status(200).end();\n  }\n  \n  next();\n});\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\n// Session middleware\nconst MemoryStore = createMemoryStore(session);\napp.set('trust proxy', 1);\napp.use(\n  session({\n    store: new MemoryStore({ checkPeriod: 86400000 }),\n    secret: process.env.SESSION_SECRET || \"secret\",\n    resave: false,\n    saveUninitialized: false,\n    proxy: true,\n    cookie: { \n      secure: true, \n      httpOnly: true, \n      sameSite: \"none\", \n      maxAge: 24 * 60 * 60 * 1000 \n    },\n  })\n);\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n// WebSocket setup for real-time chat\nconst wss = new WebSocketServer({ noServer: true });\nconst connections = new Map<string, Set<any>>();\n\nhttpServer.on(\"upgrade\", (req, socket, head) => {\n  // Only handle /ws routes for our chat WebSocket\n  if (req.url?.startsWith(\"/ws\")) {\n    wss.handleUpgrade(req, socket, head, (ws) => {\n      const url = new URL(req.url || \"\", \"http://localhost\");\n      const taskId = url.searchParams.get(\"taskId\");\n      \n      if (!taskId) {\n        ws.close();\n        return;\n      }\n      \n      if (!connections.has(taskId)) {\n        connections.set(taskId, new Set());\n      }\n      connections.get(taskId)!.add(ws);\n      \n      ws.on(\"message\", (data) => {\n        try {\n          const message = JSON.parse(data.toString());\n          const taskConnections = connections.get(taskId);\n          if (taskConnections) {\n            taskConnections.forEach((client) => {\n              if (client.readyState === 1) { // OPEN\n                client.send(JSON.stringify({ type: \"message\", data: message }));\n              }\n            });\n          }\n        } catch (error) {\n          console.error(\"WebSocket message error:\", error);\n        }\n      });\n      \n      ws.on(\"close\", () => {\n        const taskConnections = connections.get(taskId);\n        if (taskConnections) {\n          taskConnections.delete(ws);\n        }\n      });\n    });\n  }\n  // Other upgrade requests are handled by Vite automatically\n});\n\n(async () => {\n  app.use(router);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":5579,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/TaskLocationMap.tsx":{"content":"import { useEffect, useRef, memo } from 'react';\nimport { motion } from 'framer-motion';\nimport { MapPin, Navigation, Maximize2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ndeclare global {\n  interface Window {\n    L: any;\n  }\n}\n\ninterface TaskLocationMapProps {\n  latitude: number | string | null;\n  longitude: number | string | null;\n  location?: string;\n  className?: string;\n}\n\nconst TaskLocationMap = memo(function TaskLocationMap({ \n  latitude, \n  longitude, \n  location,\n  className \n}: TaskLocationMapProps) {\n  const mapRef = useRef<HTMLDivElement>(null);\n  const mapInstanceRef = useRef<any>(null);\n\n  const lat = latitude ? parseFloat(String(latitude)) : null;\n  const lng = longitude ? parseFloat(String(longitude)) : null;\n  const hasCoordinates = lat !== null && lng !== null && !isNaN(lat) && !isNaN(lng);\n\n  useEffect(() => {\n    if (!mapRef.current || !window.L || !hasCoordinates) return;\n\n    if (mapInstanceRef.current) {\n      mapInstanceRef.current.remove();\n      mapInstanceRef.current = null;\n    }\n\n    const map = window.L.map(mapRef.current, {\n      zoomControl: false,\n      attributionControl: false,\n      dragging: false,\n      touchZoom: false,\n      scrollWheelZoom: false,\n      doubleClickZoom: false,\n      boxZoom: false,\n      keyboard: false,\n    }).setView([lat, lng], 18);\n\n    window.L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {\n      maxZoom: 20,\n      subdomains: 'abcd',\n    }).addTo(map);\n\n    const pulsingIcon = window.L.divIcon({\n      className: 'task-location-marker',\n      html: `\n        <div class=\"relative\">\n          <div class=\"absolute inset-0 bg-primary/30 rounded-full animate-ping\"></div>\n          <div class=\"relative w-8 h-8 bg-gradient-to-br from-primary to-primary/80 rounded-full flex items-center justify-center shadow-lg shadow-primary/40 border-2 border-white\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <path d=\"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z\"/>\n              <circle cx=\"12\" cy=\"10\" r=\"3\"/>\n            </svg>\n          </div>\n        </div>\n      `,\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    });\n\n    window.L.marker([lat, lng], { icon: pulsingIcon }).addTo(map);\n\n    mapInstanceRef.current = map;\n\n    return () => {\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove();\n        mapInstanceRef.current = null;\n      }\n    };\n  }, [lat, lng, hasCoordinates]);\n\n  const openInMaps = () => {\n    if (!hasCoordinates) return;\n    const url = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;\n    window.open(url, '_blank');\n  };\n\n  if (!hasCoordinates) {\n    return (\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className={cn(\n          \"glass rounded-3xl overflow-hidden\",\n          className\n        )}\n      >\n        <div className=\"h-48 bg-gradient-to-br from-primary/5 to-primary/10 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center mx-auto mb-3\">\n              <MapPin className=\"w-6 h-6 text-primary\" />\n            </div>\n            <p className=\"text-sm text-muted-foreground font-medium\">Location not available</p>\n          </div>\n        </div>\n      </motion.div>\n    );\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={cn(\n        \"glass rounded-3xl overflow-hidden relative group\",\n        className\n      )}\n      data-testid=\"task-location-map\"\n    >\n      <div \n        ref={mapRef} \n        className=\"h-48 w-full\"\n        style={{ minHeight: '192px' }}\n      />\n      \n      <div className=\"absolute inset-0 pointer-events-none rounded-3xl ring-1 ring-inset ring-white/10\" />\n      \n      <motion.button\n        whileHover={{ scale: 1.05 }}\n        whileTap={{ scale: 0.95 }}\n        onClick={openInMaps}\n        className=\"absolute top-3 right-3 w-10 h-10 glass flex items-center justify-center rounded-xl shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-auto\"\n        data-testid=\"button-open-maps\"\n      >\n        <Maximize2 className=\"w-4 h-4\" />\n      </motion.button>\n      \n      <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent p-4 pt-8\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-white/20 backdrop-blur-sm flex items-center justify-center\">\n            <Navigation className=\"w-4 h-4 text-white\" />\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-white text-sm font-bold truncate\">\n              {location || `${lat?.toFixed(4)}, ${lng?.toFixed(4)}`}\n            </p>\n            <p className=\"text-white/70 text-xs\">Tap to open in Maps</p>\n          </div>\n        </div>\n      </div>\n      \n      <button \n        onClick={openInMaps}\n        className=\"absolute inset-0 cursor-pointer\"\n        aria-label=\"Open location in maps\"\n      />\n    </motion.div>\n  );\n});\n\nexport default TaskLocationMap;\n","path":null,"size_bytes":5340,"size_tokens":null},"design_guidelines.md":{"content":"# TaskField Design Guidelines - Premium Glassmorphism Edition\n\n## Design Approach\n**Premium Glassmorphism Mobile App** - Luxury fintech-inspired design with frosted glass effects, vibrant gradients, and elegant animations. Think Revolut meets Apple Card meets iOS productivity excellence.\n\n## Core Design Elements\n\n### A. Typography\n- **Primary Font**: Plus Jakarta Sans (weights: 400, 500, 600, 700, 800)\n- **Hierarchy**:\n  - Headers: 28-36px, font-extrabold (800), tracking-tight, gradient text for emphasis\n  - Subheaders: 20-24px, font-bold (700), semi-transparent for glass effect\n  - Body: 15-17px, font-medium (500), slightly increased line-height (1.6)\n  - Labels: 11-13px, font-bold uppercase, tracking-widest, 50% opacity\n  - Metadata: 11px, font-medium, 40% opacity\n\n### B. Layout & Spacing\n- **Tailwind Units**: 3, 4, 6, 8, 12, 16 (generous whitespace: p-6, p-8, gap-12)\n- **Container Padding**: px-6 to px-8 standard, never cramped\n- **Vertical Rhythm**: py-8 to py-16 for sections, mb-8 to mb-12 between blocks\n- **Safe Areas**: env(safe-area-inset-*) for notches and gesture areas\n\n### C. Glassmorphism System\n\n**Glass Cards** (Primary Pattern):\n- Background: bg-white/60 dark:bg-white/5 (subtle, frosted)\n- Backdrop: backdrop-blur-2xl backdrop-saturate-150\n- Border: border border-white/20 dark:border-white/10\n- Rounded: rounded-3xl (24px minimum)\n- Shadow: shadow-2xl shadow-black/5 dark:shadow-black/40\n- Padding: p-6 to p-8\n- Active: active:scale-[0.98] with duration-200\n\n**Premium Glass Cards** (Featured Content):\n- Background: bg-gradient-to-br from-white/70 to-white/50 dark:from-white/10 dark:to-white/5\n- Backdrop: backdrop-blur-3xl backdrop-saturate-200\n- Border: border-2 border-white/30 dark:border-white/15\n- Shadow: shadow-[0_8px_32px_0_rgba(0,0,0,0.08)] dark:shadow-[0_8px_32px_0_rgba(0,0,0,0.6)]\n- Rounded: rounded-[2rem]\n\n**Buttons**:\n- Primary: h-14 rounded-2xl bg-gradient-to-r from-primary to-primary-dark shadow-xl shadow-primary/30 text-white font-bold\n- Glass: h-14 rounded-2xl bg-white/20 backdrop-blur-xl border border-white/30 font-bold\n- Icon: w-12 h-12 rounded-2xl bg-white/10 backdrop-blur-md active:scale-90\n- Active states: active:scale-[0.96] active:shadow-lg\n\n**Inputs**:\n- Height: h-16 with floating labels\n- Background: bg-white/40 dark:bg-white/5 backdrop-blur-xl\n- Border: border-2 border-white/20 focus:border-primary/40 focus:bg-white/60\n- Rounded: rounded-2xl\n- Label: Floats with translate-y-7 scale-75 on focus\n\n**Modals & Overlays**:\n- Bottom sheet: rounded-t-[2.5rem] bg-white/90 dark:bg-black/90 backdrop-blur-3xl\n- Backdrop: bg-black/60 backdrop-blur-md\n- Handle: w-12 h-1.5 rounded-full bg-white/30\n- Content padding: p-8\n\n**Navigation**:\n- Bottom nav: Fixed, bg-white/80 dark:bg-black/80 backdrop-blur-2xl border-t border-white/20\n- Height: h-20 with pb-safe\n- Active indicator: bg-gradient-to-r from-primary/20 to-primary/10 rounded-2xl\n- Icon scale: active:scale-110 with translate-y-[-2px]\n\n**Badges & Status**:\n- Rounded: rounded-full\n- Padding: px-4 py-2\n- Glass effect: bg-white/30 dark:bg-white/10 backdrop-blur-md border border-white/20\n- Gradient variants: bg-gradient-to-r with 20% opacity for categories\n\n### D. Gradient & Accent System\n\n**Primary Gradients**:\n- Hero: bg-gradient-to-br from-primary via-primary-dark to-accent\n- Cards: bg-gradient-to-br from-white/80 to-white/60 dark:from-white/8 to-white/4\n- Buttons: bg-gradient-to-r from-primary to-primary-dark\n- Overlays: bg-gradient-to-t from-black/80 to-transparent\n\n**Vibrant Accents** (High-Impact Areas):\n- Primary: #0066FF (vibrant blue)\n- Secondary: #00D4FF (cyan)\n- Success: #00E676 (neon green)\n- Warning: #FFB800 (gold)\n- Danger: #FF1744 (red)\n- Purple: #9C27FF (premium tier)\n\n**Text on Glass**:\n- Primary: text-gray-900 dark:text-white (full opacity on glass)\n- Secondary: text-gray-600 dark:text-gray-300 (60% opacity)\n- Labels: text-gray-500 dark:text-gray-400 uppercase tracking-widest\n\n### E. Premium Animations\n\n**Micro-interactions**:\n- Card entrance: animate-fade-in-up with stagger (50ms delay)\n- Button press: scale-[0.96] + shadow reduction, duration-200\n- Glass shimmer: Subtle gradient shift on hover (disabled on mobile)\n- Success states: animate-scale-bounce with checkmark\n\n**Page Transitions**:\n- Slide in: translate-x-full to translate-x-0, duration-300 ease-out\n- Modal open: scale-95 opacity-0 to scale-100 opacity-100, backdrop-blur increase\n- Loading: Skeleton with shimmer gradient animation\n\n**Gesture Feedback**:\n- Swipe cards: translateX with spring animation (cubic-bezier(0.34, 1.56, 0.64, 1))\n- Pull refresh: Scale icon from 0.8 to 1 with rotation\n- Long press: Pulse shadow expansion\n\n## Mobile-Specific Patterns\n\n**Screen Backgrounds**:\n- Light mode: bg-gradient-to-b from-gray-50 to-white\n- Dark mode: bg-gradient-to-b from-gray-950 to-black\n- Mesh gradient overlays for depth\n\n**Touch Targets**:\n- Minimum: 48x48px\n- Primary actions: 56x56px\n- Glass buttons feel larger due to blur/shadow\n\n**List & Grid Patterns**:\n- Gap: gap-6 between glass cards\n- Masonry grid for varied content heights\n- Floating action button: bottom-24 right-6, glass effect with primary gradient\n\n**Visual Hierarchy**:\n- Z-index layers: bg → cards (blur) → elevated cards → modals → toasts\n- Shadow depth correlates to importance\n- Blur intensity: 2xl (standard) → 3xl (premium) → none (text)\n\n## Icons & Images\n\n**Icons**:\n- Material Symbols Outlined (CDN)\n- Sizes: 20px inline, 24px buttons, 48px features\n- Filled variant for active states with gradient fill\n\n**Images**:\n- User Avatars: 48px circular with border-2 border-white/30 shadow-lg\n- Task Cards: Full-width 16:9 with rounded-t-3xl, gradient overlay from-transparent to-black/60\n- Map Markers: Custom glass-morphic pins with primary gradient\n- Background patterns: Subtle mesh gradients, never distracting\n\n**Hero Sections** (Dashboard Top):\n- Gradient background with glass card overlay\n- User greeting with large avatar (80px)\n- Stats cards in horizontal scroll with glass effect\n- Height: Auto-fit content, minimum py-12\n\n## Premium Touches\n\n**Elevation System**:\n- Level 1: shadow-lg (standard cards)\n- Level 2: shadow-xl (interactive elements)\n- Level 3: shadow-2xl (modals, featured)\n- All shadows: Colored tint matching primary (shadow-primary/10)\n\n**Separator Lines**:\n- border-t border-white/10 dark:border-white/5 (nearly invisible on glass)\n- Gradient dividers: h-px bg-gradient-to-r from-transparent via-white/20 to-transparent\n\n**Empty States**:\n- Glass card with gradient icon\n- Motivational copy with generous spacing\n- CTA button with gradient\n\nThis design creates a cohesive, premium mobile experience where every interaction feels polished and intentional, with glassmorphism enhancing depth without compromising readability or performance.","path":null,"size_bytes":6784,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"attached_assets/vite.config_1764551013653.ts":{"content":"import path from 'path';\nimport { defineConfig, loadEnv } from 'vite';\nimport react from '@vitejs/plugin-react';\n\nexport default defineConfig(({ mode }) => {\n    const env = loadEnv(mode, '.', '');\n    return {\n      server: {\n        port: 3000,\n        host: '0.0.0.0',\n      },\n      plugins: [react()],\n      define: {\n        'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),\n        'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)\n      },\n      resolve: {\n        alias: {\n          '@': path.resolve(__dirname, '.'),\n        }\n      }\n    };\n});\n","path":null,"size_bytes":580,"size_tokens":null},"client/src/components/FloatingInput.tsx":{"content":"import { useState, type InputHTMLAttributes } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { cn } from '@/lib/utils';\nimport { AlertCircle } from 'lucide-react';\n\ninterface FloatingInputProps extends InputHTMLAttributes<HTMLInputElement> {\n  label: string;\n  error?: string;\n  containerClassName?: string;\n}\n\nexport function FloatingInput({ \n  label, \n  error, \n  className = '', \n  containerClassName = '',\n  value, \n  onFocus, \n  onBlur, \n  ...props \n}: FloatingInputProps) {\n  const [isFocused, setIsFocused] = useState(false);\n  const { i18n } = useTranslation();\n  const isRTL = i18n.language === 'ar';\n  const hasValue = value !== '' && value !== undefined;\n\n  return (\n    <div className={cn(\"relative\", containerClassName)}>\n      <div className=\"relative\">\n        <input\n          {...props}\n          value={value}\n          onFocus={(e) => { setIsFocused(true); onFocus?.(e); }}\n          onBlur={(e) => { setIsFocused(false); onBlur?.(e); }}\n          className={cn(\n            \"peer w-full h-16 px-4 pt-5 pb-1 rounded-2xl border-2 bg-card shadow-sm outline-none transition-all placeholder-transparent font-medium text-foreground\",\n            error \n              ? \"border-destructive/50 focus:border-destructive text-destructive\" \n              : \"border-transparent focus:border-primary/50\",\n            isRTL && \"text-right\",\n            className\n          )}\n          placeholder={label}\n          dir={props.type === 'email' || props.type === 'tel' ? 'ltr' : undefined}\n          data-testid={`input-${label.toLowerCase().replace(/\\s+/g, '-')}`}\n        />\n        <label \n          className={cn(\n            \"absolute transition-all duration-200 pointer-events-none truncate max-w-[calc(100%-32px)]\",\n            isRTL ? \"right-4\" : \"left-4\",\n            isFocused || hasValue \n              ? \"top-3 text-[10px] font-bold text-primary uppercase tracking-wider\" \n              : \"top-5 text-base text-muted-foreground\",\n            error && \"!text-destructive\"\n          )}\n        >\n          {label}\n        </label>\n      </div>\n      {error && (\n        <div className={cn(\n          \"flex items-center gap-1.5 mt-1.5 animate-slide-up\",\n          isRTL ? \"mr-2 flex-row-reverse\" : \"ml-2\"\n        )}>\n          <AlertCircle className=\"w-3.5 h-3.5 text-destructive shrink-0\" />\n          <p className=\"text-xs text-destructive font-bold\">{error}</p>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":2443,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/pages/SelectRoleScreen.tsx":{"content":"import { useState, memo, useCallback } from 'react';\nimport { useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useApp } from '@/context/AppContext';\nimport { cn } from '@/lib/utils';\nimport { ArrowLeft, Users, Wrench, Check, ChevronRight, ChevronLeft } from 'lucide-react';\n\ntype Role = 'client' | 'tasker';\n\ninterface RoleOption {\n  id: Role;\n  titleKey: string;\n  subtitleKey: string;\n  icon: typeof Users;\n  featuresKeys: string[];\n  gradient: string;\n}\n\nconst roles: RoleOption[] = [\n  {\n    id: 'tasker',\n    titleKey: 'roles.tasker',\n    subtitleKey: 'roles.taskerDesc',\n    icon: Wrench,\n    featuresKeys: ['roles.taskerFeatures.access', 'roles.taskerFeatures.browse', 'roles.taskerFeatures.earn'],\n    gradient: 'from-purple-500 to-pink-500',\n  },\n  {\n    id: 'client',\n    titleKey: 'roles.client',\n    subtitleKey: 'roles.clientDesc',\n    icon: Users,\n    featuresKeys: ['roles.clientFeatures.post', 'roles.clientFeatures.compare', 'roles.clientFeatures.choose'],\n    gradient: 'from-blue-500 to-cyan-500',\n  },\n];\n\nconst RoleCard = memo(function RoleCard({ \n  role, \n  isSelected, \n  onSelect,\n  t\n}: { \n  role: RoleOption; \n  isSelected: boolean; \n  onSelect: () => void;\n  t: (key: string) => string;\n}) {\n  const Icon = role.icon;\n  \n  return (\n    <motion.button\n      layout\n      onClick={onSelect}\n      whileTap={{ scale: 0.98 }}\n      className={cn(\n        \"w-full text-start p-6 rounded-3xl transition-all duration-300 relative overflow-hidden\",\n        isSelected\n          ? \"glass-premium shadow-xl border-2 border-primary\"\n          : \"glass hover:shadow-lg border-2 border-transparent\"\n      )}\n      data-testid={`button-role-${role.id}`}\n    >\n      \n      <div className=\"flex items-start gap-4 relative z-10\">\n        <motion.div \n          animate={{ \n            scale: isSelected ? 1.05 : 1,\n            rotate: isSelected ? 5 : 0\n          }}\n          className={cn(\n            \"w-14 h-14 rounded-2xl flex items-center justify-center transition-all shadow-lg\",\n            isSelected \n              ? `bg-gradient-to-br ${role.gradient} text-white shadow-lg` \n              : \"bg-muted/50 text-muted-foreground\"\n          )}\n        >\n          <Icon className=\"w-7 h-7\" />\n        </motion.div>\n        \n        <div className=\"flex-1 min-w-0\">\n          <h3 className=\"text-xl font-bold text-foreground mb-1\">{t(role.titleKey)}</h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">{t(role.subtitleKey)}</p>\n          \n          <AnimatePresence>\n            {isSelected && (\n              <motion.div \n                initial={{ opacity: 0, height: 0 }}\n                animate={{ opacity: 1, height: \"auto\" }}\n                exit={{ opacity: 0, height: 0 }}\n                className=\"space-y-2 overflow-hidden\"\n              >\n                {role.featuresKeys.map((featureKey, idx) => (\n                  <motion.div \n                    key={featureKey}\n                    initial={{ opacity: 0, x: -10 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    transition={{ delay: idx * 0.1 }}\n                    className=\"flex items-center gap-3 text-sm text-foreground/80 rtl:flex-row-reverse rtl:text-right\"\n                  >\n                    <div className=\"w-5 h-5 rounded-full bg-success/20 flex items-center justify-center shrink-0\">\n                      <Check className=\"w-3 h-3 text-success\" />\n                    </div>\n                    <span className=\"flex-1\">{t(featureKey)}</span>\n                  </motion.div>\n                ))}\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n        \n        <motion.div \n          animate={{ \n            scale: isSelected ? 1 : 0.8,\n            opacity: isSelected ? 1 : 0.5\n          }}\n          className={cn(\n            \"w-7 h-7 rounded-full flex items-center justify-center transition-all\",\n            isSelected\n              ? \"bg-primary text-white shadow-lg shadow-primary/30\"\n              : \"border-2 border-muted\"\n          )}\n        >\n          {isSelected && (\n            <motion.div\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              transition={{ type: \"spring\", stiffness: 500 }}\n            >\n              <Check className=\"w-4 h-4\" />\n            </motion.div>\n          )}\n        </motion.div>\n      </div>\n    </motion.button>\n  );\n});\n\nconst SelectRoleScreen = memo(function SelectRoleScreen() {\n  const [, setLocation] = useLocation();\n  const { setLocalRole } = useApp();\n  const { t } = useTranslation();\n  const [selectedRole, setSelectedRole] = useState<Role | null>(null);\n\n  const handleContinue = useCallback(() => {\n    if (selectedRole) {\n      setLocalRole(selectedRole);\n      if (selectedRole === 'tasker') {\n        setLocation('/tasker-type');\n      } else {\n        setLocation('/register');\n      }\n    }\n  }, [selectedRole, setLocalRole, setLocation]);\n\n  const handleBack = useCallback(() => {\n    setLocation('/');\n  }, [setLocation]);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-background to-primary/5 pt-safe\">\n      <motion.div \n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"flex items-center justify-between px-6 py-4\"\n      >\n        <motion.button \n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={handleBack}\n          className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-5 h-5 rtl:rotate-180\" />\n        </motion.button>\n        \n        <div className=\"flex gap-2\">\n          {[0, 1, 2].map((step) => (\n            <motion.div \n              key={step}\n              initial={{ scaleX: 0 }}\n              animate={{ scaleX: 1 }}\n              transition={{ delay: step * 0.1 }}\n              className={cn(\n                \"w-10 h-1.5 rounded-full transition-colors\",\n                step === 0 ? \"bg-primary\" : \"bg-muted\"\n              )}\n            />\n          ))}\n        </div>\n        \n        <div className=\"w-11\" />\n      </motion.div>\n\n      <div className=\"flex-1 flex flex-col px-6 py-8\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n        >\n          <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n            {t('roles.title')}\n          </h1>\n          <p className=\"text-muted-foreground text-lg\">\n            {t('roles.subtitle')}\n          </p>\n        </motion.div>\n\n        <motion.div \n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.2 }}\n          className=\"space-y-4 mt-8 flex-1\"\n        >\n          {roles.map((role, index) => (\n            <motion.div\n              key={role.id}\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.3 + index * 0.1 }}\n            >\n              <RoleCard\n                role={role}\n                isSelected={selectedRole === role.id}\n                onSelect={() => setSelectedRole(role.id)}\n                t={t}\n              />\n            </motion.div>\n          ))}\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.5 }}\n          className=\"mt-6 pb-safe\"\n        >\n          <motion.button\n            whileHover={{ scale: selectedRole ? 1.02 : 1 }}\n            whileTap={{ scale: selectedRole ? 0.98 : 1 }}\n            onClick={handleContinue}\n            disabled={!selectedRole}\n            className={cn(\n              \"w-full h-14 rounded-2xl font-bold text-lg transition-all flex items-center justify-center gap-2\",\n              selectedRole\n                ? \"gradient-primary text-white shadow-xl shadow-primary/25\"\n                : \"bg-muted text-muted-foreground cursor-not-allowed\"\n            )}\n            data-testid=\"button-continue\"\n          >\n            {t('common.next')}\n            <ChevronLeft className=\"w-5 h-5 rtl:rotate-180\" />\n          </motion.button>\n        </motion.div>\n      </div>\n    </div>\n  );\n});\n\nexport default SelectRoleScreen;\n","path":null,"size_bytes":8420,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X, CheckCircle2, AlertCircle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:top-auto sm:bottom-0 sm:flex-col md:max-w-[420px] rtl:sm:left-0 ltr:sm:right-0\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center gap-4 overflow-hidden rounded-2xl p-4 shadow-2xl transition-all backdrop-blur-xl data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-card/95 border border-border/50 text-foreground shadow-primary/5\",\n        destructive:\n          \"destructive group bg-destructive/95 border border-destructive/50 text-destructive-foreground\",\n        success:\n          \"bg-success/10 border border-success/30 text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute end-3 top-3 rounded-full p-1.5 text-foreground/50 opacity-0 transition-all hover:text-foreground hover:bg-foreground/10 focus:opacity-100 focus:outline-none group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastIcon = ({ variant }: { variant?: \"default\" | \"destructive\" | \"success\" }) => {\n  if (variant === \"success\") {\n    return (\n      <div className=\"flex-shrink-0 w-10 h-10 rounded-full bg-success/20 flex items-center justify-center\">\n        <CheckCircle2 className=\"w-5 h-5 text-success\" />\n      </div>\n    )\n  }\n  if (variant === \"destructive\") {\n    return (\n      <div className=\"flex-shrink-0 w-10 h-10 rounded-full bg-destructive/20 flex items-center justify-center\">\n        <AlertCircle className=\"w-5 h-5 text-destructive-foreground\" />\n      </div>\n    )\n  }\n  return (\n    <div className=\"flex-shrink-0 w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center\">\n      <CheckCircle2 className=\"w-5 h-5 text-primary\" />\n    </div>\n  )\n}\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n  ToastIcon,\n}\n","path":null,"size_bytes":5709,"size_tokens":null},"client/src/components/CountUp.tsx":{"content":"import { useEffect, useState } from 'react';\n\ninterface CountUpProps {\n  end: number;\n  duration?: number;\n  decimals?: number;\n  suffix?: string;\n  prefix?: string;\n}\n\nexport function CountUp({ \n  end, \n  duration = 1500, \n  decimals = 2, \n  suffix = '', \n  prefix = '' \n}: CountUpProps) {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    let startTime: number | null = null;\n    let animationFrameId: number;\n\n    const animate = (timestamp: number) => {\n      if (!startTime) startTime = timestamp;\n      const progress = timestamp - startTime;\n      const percentage = Math.min(progress / duration, 1);\n      \n      const ease = percentage === 1 ? 1 : 1 - Math.pow(2, -10 * percentage);\n      \n      setCount(end * ease);\n\n      if (progress < duration) {\n        animationFrameId = requestAnimationFrame(animate);\n      }\n    };\n\n    animationFrameId = requestAnimationFrame(animate);\n\n    return () => cancelAnimationFrame(animationFrameId);\n  }, [end, duration]);\n\n  const formatted = count.toLocaleString('en-US', {\n    minimumFractionDigits: decimals,\n    maximumFractionDigits: decimals,\n  });\n\n  return <span>{prefix}{formatted}{suffix}</span>;\n}\n","path":null,"size_bytes":1175,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/pages/LoginScreen.tsx":{"content":"import { useState, memo, useCallback } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useApp } from '@/context/AppContext';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequest, setAuthToken } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { ArrowLeft, LogIn, Loader2, Smartphone, Phone } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface FormData {\n  phone: string;\n  otpCode: string;\n}\n\nconst LoginScreen = memo(function LoginScreen() {\n  const [, setLocation] = useLocation();\n  const { setUser, setLocalRole } = useApp();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  const isRTL = i18n.language === 'ar';\n  const isArabic = i18n.language === 'ar';\n  \n  const [otpSent, setOtpSent] = useState(false);\n  const [formData, setFormData] = useState<FormData>({\n    phone: '',\n    otpCode: '',\n  });\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [focusedField, setFocusedField] = useState<string | null>(null);\n\n  // Send Phone OTP mutation\n  const sendPhoneOtpMutation = useMutation({\n    mutationFn: async (phone: string) => {\n      const response = await apiRequest('POST', '/api/auth/send-phone-otp', { phone, type: 'login' });\n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || 'Failed to send OTP');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      setOtpSent(true);\n      toast({ \n        title: isArabic ? 'تم إرسال الرمز' : 'Code Sent', \n        description: isArabic ? 'تحقق من رسائلك SMS' : 'Check your SMS for the verification code'\n      });\n    },\n    onError: (error: Error) => {\n      let errorMessage = error.message;\n      if (error.message.includes('No account found')) {\n        errorMessage = isArabic ? 'لا يوجد حساب مسجل بهذا الرقم' : 'No account found with this phone number';\n      }\n      toast({ \n        title: isArabic ? 'خطأ' : 'Error', \n        description: errorMessage, \n        variant: 'destructive' \n      });\n    },\n  });\n\n  // Phone OTP login mutation\n  const phoneOtpLoginMutation = useMutation({\n    mutationFn: async (data: { phone: string; otpCode: string }) => {\n      const response = await apiRequest('POST', '/api/auth/login-with-phone-otp', data);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Login failed');\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      if (data.token) {\n        setAuthToken(data.token);\n      }\n      setUser(data.user);\n      setLocalRole(data.user.role);\n      localStorage.setItem('userId', data.user.id);\n      toast({ \n        title: t('auth.welcomeBack'), \n        description: t('auth.welcomeBackName', { name: data.user.name })\n      });\n      setLocation('/home');\n    },\n    onError: (error: Error) => {\n      let errorMessage = error.message;\n      if (error.message.includes('Invalid') || error.message.includes('expired')) {\n        errorMessage = isArabic ? 'رمز التحقق غير صحيح أو منتهي الصلاحية' : 'Invalid or expired verification code';\n      }\n      toast({ \n        title: isArabic ? 'خطأ' : 'Error', \n        description: errorMessage, \n        variant: 'destructive' \n      });\n    },\n  });\n\n  const validatePhoneForm = useCallback(() => {\n    const newErrors: Record<string, string> = {};\n    if (!formData.phone.trim()) {\n      newErrors.phone = t('errors.required');\n    } else {\n      const cleaned = formData.phone.replace(/[\\s\\-\\(\\)\\.]/g, '');\n      const patterns = [/^05\\d{8}$/, /^5\\d{8}$/, /^9665\\d{8}$/, /^\\+9665\\d{8}$/];\n      if (!patterns.some(p => p.test(cleaned))) {\n        newErrors.phone = isArabic ? 'رقم جوال سعودي غير صالح' : 'Invalid Saudi phone number';\n      }\n    }\n    if (otpSent && !formData.otpCode.trim()) {\n      newErrors.otpCode = t('errors.required');\n    }\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  }, [formData, otpSent, t, isArabic]);\n\n  const handleSubmit = useCallback(() => {\n    if (!validatePhoneForm()) return;\n    \n    if (!otpSent) {\n      sendPhoneOtpMutation.mutate(formData.phone);\n    } else {\n      phoneOtpLoginMutation.mutate({ phone: formData.phone, otpCode: formData.otpCode });\n    }\n  }, [validatePhoneForm, otpSent, sendPhoneOtpMutation, phoneOtpLoginMutation, formData]);\n\n  const handleChange = useCallback((field: keyof FormData) => (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData(prev => ({ ...prev, [field]: e.target.value }));\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: '' }));\n    }\n  }, [errors]);\n\n  const handleBack = useCallback(() => {\n    if (otpSent) {\n      setOtpSent(false);\n      setFormData(prev => ({ ...prev, otpCode: '' }));\n    } else {\n      setLocation('/');\n    }\n  }, [setLocation, otpSent]);\n\n  const isPending = sendPhoneOtpMutation.isPending || phoneOtpLoginMutation.isPending;\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-background to-primary/5 pt-safe\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.4 }}\n          className={cn(\n            \"absolute top-40 w-80 h-80 bg-primary/15 rounded-full blur-3xl\",\n            isRTL ? \"-left-32\" : \"-right-32\"\n          )}\n        />\n      </div>\n\n      <motion.div \n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"flex items-center px-6 py-4\"\n      >\n        <motion.button \n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={handleBack}\n          className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className={cn(\"w-5 h-5\", isRTL && \"rotate-180\")} />\n        </motion.button>\n      </motion.div>\n\n      <div className=\"flex-1 flex flex-col px-6 py-8 relative z-10\">\n        <motion.div\n          initial={{ scale: 0, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          transition={{ type: \"spring\", stiffness: 200, damping: 20 }}\n          className=\"w-20 h-20 rounded-[1.5rem] gradient-primary flex items-center justify-center mb-8 mx-auto shadow-xl shadow-primary/25\"\n        >\n          <LogIn className=\"w-10 h-10 text-white\" />\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n          className=\"text-center mb-8\"\n        >\n          <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n            {t('auth.login')}\n          </h1>\n          <p className=\"text-muted-foreground text-lg\">\n            {isArabic ? 'سجل دخولك برقم الجوال' : 'Sign in with your phone number'}\n          </p>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n          className=\"space-y-5 flex-1\"\n        >\n          {/* Phone Number Input */}\n          <div className=\"relative\">\n            <div className=\"absolute start-4 top-1/2 -translate-y-1/2 text-muted-foreground\">\n              <Phone className=\"w-5 h-5\" />\n            </div>\n            <motion.input\n              type=\"tel\"\n              value={formData.phone}\n              onChange={handleChange('phone')}\n              onFocus={() => setFocusedField('phone')}\n              onBlur={() => setFocusedField(null)}\n              placeholder=\"05XXXXXXXX\"\n              autoComplete=\"tel\"\n              disabled={otpSent}\n              dir=\"ltr\"\n              className={cn(\n                \"w-full h-16 ps-14 pe-5 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none transition-all duration-200\",\n                errors.phone && \"border-destructive\",\n                focusedField === 'phone' && \"ring-2 ring-primary/30\",\n                otpSent && \"opacity-60\"\n              )}\n              data-testid=\"input-phone\"\n            />\n            <AnimatePresence>\n              {errors.phone && (\n                <motion.p\n                  initial={{ opacity: 0, y: -5 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  exit={{ opacity: 0, y: -5 }}\n                  className=\"mt-2 text-xs text-destructive font-medium\"\n                >\n                  {errors.phone}\n                </motion.p>\n              )}\n            </AnimatePresence>\n          </div>\n\n          <p className=\"text-xs text-muted-foreground text-center\">\n            {isArabic ? 'أدخل رقم جوال سعودي (يبدأ بـ 05)' : 'Enter Saudi mobile number (starts with 05)'}\n          </p>\n\n          {/* OTP Input - Shows after code is sent */}\n          <AnimatePresence>\n            {otpSent && (\n              <motion.div\n                initial={{ opacity: 0, height: 0 }}\n                animate={{ opacity: 1, height: 'auto' }}\n                exit={{ opacity: 0, height: 0 }}\n                className=\"space-y-4\"\n              >\n                <div className=\"text-center py-4\">\n                  <div className=\"w-16 h-16 rounded-2xl bg-success/15 flex items-center justify-center mx-auto mb-3\">\n                    <Smartphone className=\"w-8 h-8 text-success\" />\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {isArabic \n                      ? `تم إرسال رمز التحقق إلى ${formData.phone}` \n                      : `A verification code was sent to ${formData.phone}`}\n                  </p>\n                </div>\n\n                <div className=\"relative\">\n                  <motion.input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={formData.otpCode}\n                    onChange={handleChange('otpCode')}\n                    onFocus={() => setFocusedField('otpCode')}\n                    onBlur={() => setFocusedField(null)}\n                    placeholder={isArabic ? 'أدخل رمز التحقق' : 'Enter verification code'}\n                    maxLength={6}\n                    autoComplete=\"one-time-code\"\n                    className={cn(\n                      \"w-full h-16 px-5 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none transition-all duration-200 text-center text-2xl tracking-[0.5em] font-bold\",\n                      errors.otpCode && \"border-destructive\",\n                      focusedField === 'otpCode' && \"ring-2 ring-primary/30\"\n                    )}\n                    data-testid=\"input-otp-code\"\n                  />\n                  <AnimatePresence>\n                    {errors.otpCode && (\n                      <motion.p\n                        initial={{ opacity: 0, y: -5 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        exit={{ opacity: 0, y: -5 }}\n                        className=\"mt-2 text-xs text-destructive font-medium text-center\"\n                      >\n                        {errors.otpCode}\n                      </motion.p>\n                    )}\n                  </AnimatePresence>\n                </div>\n\n                <div className=\"text-center\">\n                  <button \n                    onClick={() => sendPhoneOtpMutation.mutate(formData.phone)}\n                    disabled={sendPhoneOtpMutation.isPending}\n                    className=\"text-sm text-primary font-semibold hover:underline disabled:opacity-50\"\n                    data-testid=\"button-resend-code\"\n                  >\n                    {isArabic ? 'إعادة إرسال الرمز' : 'Resend code'}\n                  </button>\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3 }}\n          className=\"mt-6 pb-safe\"\n        >\n          <motion.button\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            onClick={handleSubmit}\n            disabled={isPending}\n            className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/25 transition-all disabled:opacity-60 flex items-center justify-center gap-2\"\n            data-testid=\"button-sign-in\"\n          >\n            {isPending ? (\n              <>\n                <Loader2 className=\"w-5 h-5 animate-spin\" />\n                {t('common.loading')}\n              </>\n            ) : !otpSent ? (\n              isArabic ? 'إرسال رمز التحقق' : 'Send Code'\n            ) : (\n              t('auth.login')\n            )}\n          </motion.button>\n\n          <p className=\"text-center text-muted-foreground mt-6\">\n            {t('auth.noAccount')}{' '}\n            <Link href=\"/role\" className=\"text-primary font-bold hover:underline\">\n              {t('auth.register')}\n            </Link>\n          </p>\n        </motion.div>\n      </div>\n    </div>\n  );\n});\n\nexport default LoginScreen;\n","path":null,"size_bytes":13467,"size_tokens":null},"attached_assets/Toast_1764551029324.tsx":{"content":"\nimport React, { createContext, useContext, useState, useEffect } from 'react';\n\ntype ToastType = 'success' | 'error' | 'info';\n\ninterface Toast {\n  id: number;\n  message: string;\n  type: ToastType;\n}\n\ninterface ToastContextType {\n  showToast: (message: string, type?: ToastType) => void;\n}\n\nconst ToastContext = createContext<ToastContextType | undefined>(undefined);\n\nexport const useToast = () => {\n  const context = useContext(ToastContext);\n  if (!context) {\n    throw new Error('useToast must be used within a ToastProvider');\n  }\n  return context;\n};\n\nexport const ToastProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [toasts, setToasts] = useState<Toast[]>([]);\n\n  const showToast = (message: string, type: ToastType = 'success') => {\n    const id = Date.now();\n    setToasts((prev) => [...prev, { id, message, type }]);\n    setTimeout(() => {\n      setToasts((prev) => prev.filter((t) => t.id !== id));\n    }, 3000);\n  };\n\n  return (\n    <ToastContext.Provider value={{ showToast }}>\n      {children}\n      <div className=\"fixed bottom-20 left-0 right-0 flex flex-col items-center pointer-events-none z-50 space-y-2 px-4\">\n        {toasts.map((toast) => (\n          <div\n            key={toast.id}\n            className={`animate-slide-up shadow-lg rounded-full px-6 py-3 text-sm font-bold text-white flex items-center gap-2 ${\n              toast.type === 'success' ? 'bg-green-600' : toast.type === 'error' ? 'bg-red-500' : 'bg-gray-800'\n            }`}\n          >\n            {toast.type === 'success' && <span className=\"material-symbols-outlined text-lg\">check_circle</span>}\n            {toast.type === 'error' && <span className=\"material-symbols-outlined text-lg\">error</span>}\n            {toast.type === 'info' && <span className=\"material-symbols-outlined text-lg\">info</span>}\n            {toast.message}\n          </div>\n        ))}\n      </div>\n    </ToastContext.Provider>\n  );\n};\n","path":null,"size_bytes":1938,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/Modal.tsx":{"content":"import { useEffect, useRef, memo, type ReactNode } from 'react';\nimport { createPortal } from 'react-dom';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport { X } from 'lucide-react';\n\ninterface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: ReactNode;\n  children: ReactNode;\n  action?: ReactNode;\n  className?: string;\n}\n\nexport const Modal = memo(function Modal({ \n  isOpen, \n  onClose, \n  title, \n  children, \n  action, \n  className \n}: ModalProps) {\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = 'hidden';\n      modalRef.current?.focus();\n\n      const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') onClose();\n      };\n      document.addEventListener('keydown', handleEscape);\n\n      return () => {\n        document.body.style.overflow = 'unset';\n        document.removeEventListener('keydown', handleEscape);\n      };\n    }\n  }, [isOpen, onClose]);\n\n  return createPortal(\n    <AnimatePresence>\n      {isOpen && (\n        <div \n          className=\"fixed inset-0 z-50 flex items-end justify-center sm:items-center\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n        >\n          <motion.div \n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"absolute inset-0 bg-black/50 backdrop-blur-md\"\n            onClick={onClose}\n            aria-hidden=\"true\"\n            data-testid=\"modal-backdrop\"\n          />\n\n          <motion.div \n            ref={modalRef}\n            initial={{ opacity: 0, y: 100, scale: 0.95 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 100, scale: 0.95 }}\n            transition={{ \n              type: \"spring\",\n              stiffness: 300,\n              damping: 30\n            }}\n            className={cn(\n              \"glass-premium w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] p-8 pb-safe shadow-2xl outline-none relative z-10 m-0 sm:m-4\",\n              className\n            )}\n            tabIndex={-1}\n            data-testid=\"modal-content\"\n          >\n            <div className=\"w-12 h-1.5 bg-white/20 rounded-full mx-auto mb-6 sm:hidden\" />\n\n            <div className=\"flex justify-between items-center mb-6 gap-4\">\n              {title && (\n                <motion.h2 \n                  initial={{ opacity: 0, x: -10 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  className=\"text-2xl font-extrabold tracking-tight text-foreground\"\n                >\n                  {title}\n                </motion.h2>\n              )}\n              <motion.button \n                whileHover={{ scale: 1.1 }}\n                whileTap={{ scale: 0.9 }}\n                onClick={onClose} \n                className=\"w-10 h-10 flex items-center justify-center rounded-2xl glass-button ms-auto flex-shrink-0\"\n                aria-label=\"Close modal\"\n                data-testid=\"button-close-modal\"\n              >\n                <X className=\"w-5 h-5\" />\n              </motion.button>\n            </div>\n\n            <div className=\"space-y-6\">\n              {children}\n            </div>\n\n            {action && (\n              <motion.div \n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.2 }}\n                className=\"mt-8\"\n              >\n                {action}\n              </motion.div>\n            )}\n          </motion.div>\n        </div>\n      )}\n    </AnimatePresence>,\n    document.body\n  );\n});\n","path":null,"size_bytes":3702,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"attached_assets/ErrorBoundary_1764551029324.tsx":{"content":"\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\n\ninterface Props {\n  children: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n}\n\nexport class ErrorBoundary extends Component<Props, State> {\n  public state: State = {\n    hasError: false,\n    error: null,\n  };\n\n  public static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error };\n  }\n\n  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    console.error('Uncaught error:', error, errorInfo);\n  }\n\n  public render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"min-h-screen flex flex-col items-center justify-center bg-background-light dark:bg-background-dark p-6 text-center\">\n          <div className=\"w-24 h-24 bg-red-100 dark:bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mb-6 animate-bounce\">\n            <span className=\"material-symbols-outlined text-5xl\">error_outline</span>\n          </div>\n          <h1 className=\"text-2xl font-extrabold text-text-primary dark:text-text-primary-dark mb-2\">\n            Oops! Something went wrong.\n          </h1>\n          <p className=\"text-text-secondary dark:text-text-secondary-dark mb-8 max-w-xs\">\n            We encountered an unexpected error. Our team has been notified.\n          </p>\n          <button\n            onClick={() => {\n                this.setState({ hasError: false });\n                window.location.href = '/';\n            }}\n            className=\"px-8 py-4 bg-primary text-white rounded-2xl font-bold shadow-lg shadow-primary/30 hover:bg-primary-dark transition-all active:scale-95\"\n          >\n            Restart App\n          </button>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","path":null,"size_bytes":1777,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/DateTimePicker.tsx":{"content":"import { useState } from 'react';\nimport { Modal } from './Modal';\nimport { cn } from '@/lib/utils';\n\ninterface DateTimePickerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelect: (value: string) => void;\n  mode: 'date' | 'time';\n  title: string;\n}\n\nexport function DateTimePicker({ isOpen, onClose, onSelect, mode, title }: DateTimePickerProps) {\n  const [selected, setSelected] = useState<string>('');\n\n  const getDates = () => {\n    const dates = [];\n    const today = new Date();\n    for (let i = 0; i < 14; i++) {\n      const d = new Date(today);\n      d.setDate(today.getDate() + i);\n      dates.push({\n        full: d.toISOString(),\n        day: d.toLocaleDateString('en-US', { weekday: 'short' }),\n        date: d.getDate(),\n        label: i === 0 ? 'Today' : i === 1 ? 'Tomorrow' : d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n      });\n    }\n    return dates;\n  };\n\n  const getTimes = () => {\n    const times = [];\n    for (let i = 8; i <= 20; i++) {\n      times.push(`${i > 12 ? i - 12 : i}:00 ${i >= 12 ? 'PM' : 'AM'}`);\n      times.push(`${i > 12 ? i - 12 : i}:30 ${i >= 12 ? 'PM' : 'AM'}`);\n    }\n    return times;\n  };\n\n  const dates = getDates();\n  const times = getTimes();\n\n  const handleSelect = (val: string) => {\n    setSelected(val);\n  };\n\n  const handleConfirm = () => {\n    if (selected) onSelect(selected);\n    onClose();\n    setSelected('');\n  };\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={onClose}\n      title={title}\n      action={\n        <button \n          disabled={!selected}\n          onClick={handleConfirm}\n          className=\"w-full h-14 bg-primary text-primary-foreground rounded-2xl font-bold text-lg hover:bg-primary/90 shadow-lg shadow-primary/25 active:scale-[0.98] transition-all disabled:opacity-50 disabled:shadow-none\"\n          data-testid=\"button-confirm-datetime\"\n        >\n          Confirm\n        </button>\n      }\n    >\n      <div className=\"max-h-[40vh] overflow-y-auto no-scrollbar py-2\">\n        {mode === 'date' ? (\n          <div className=\"grid grid-cols-3 gap-3\">\n            {dates.map((date, idx) => (\n              <button\n                key={idx}\n                onClick={() => handleSelect(date.label)}\n                data-testid={`button-date-${idx}`}\n                className={cn(\n                  \"flex flex-col items-center justify-center p-4 rounded-2xl border-2 transition-all active:scale-95\",\n                  selected === date.label \n                    ? \"border-primary bg-primary/10 text-primary ring-1 ring-primary/50\" \n                    : \"border-transparent bg-muted hover:bg-muted/80\"\n                )}\n              >\n                <span className=\"text-xs font-bold uppercase opacity-60\">{date.day}</span>\n                <span className=\"text-xl font-black\">{date.date}</span>\n                {idx < 2 && <span className=\"text-[10px] font-bold text-primary\">{idx === 0 ? 'Today' : 'Tmrw'}</span>}\n              </button>\n            ))}\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-3 gap-3\">\n            {times.map((time, idx) => (\n              <button\n                key={idx}\n                onClick={() => handleSelect(time)}\n                data-testid={`button-time-${idx}`}\n                className={cn(\n                  \"p-3 rounded-2xl font-bold text-sm border-2 transition-all active:scale-95\",\n                  selected === time \n                    ? \"border-primary bg-primary/10 text-primary\" \n                    : \"border-transparent bg-muted hover:bg-muted/80\"\n                )}\n              >\n                {time}\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n    </Modal>\n  );\n}\n","path":null,"size_bytes":3708,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/pages/MyTasksScreen.tsx":{"content":"import { useState, memo, useCallback, useMemo } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { TaskCard } from '@/components/TaskCard';\nimport { useQuery } from '@tanstack/react-query';\nimport { cn } from '@/lib/utils';\nimport { TaskCardSkeleton, EmptyState } from '@/components/ui/animated';\nimport { Plus, ClipboardList, Filter } from 'lucide-react';\nimport type { TaskWithDetails } from '@shared/schema';\n\ntype TabType = 'all' | 'open' | 'in_progress' | 'completed';\n\nconst MyTasksScreen = memo(function MyTasksScreen() {\n  const [, setLocation] = useLocation();\n  const [activeTab, setActiveTab] = useState<TabType>('all');\n  const isAuthenticated = !!localStorage.getItem('userId');\n\n  const { data: tasks, isLoading, error } = useQuery<TaskWithDetails[]>({\n    queryKey: ['/api/tasks/my'],\n    enabled: isAuthenticated,\n  });\n\n  const filteredTasks = useMemo(() => {\n    if (!tasks) return [];\n    if (activeTab === 'all') return tasks;\n    return tasks.filter(task => task.status === activeTab);\n  }, [tasks, activeTab]);\n\n  const tabs = useMemo(() => [\n    { id: 'all' as TabType, label: 'All' },\n    { id: 'open' as TabType, label: 'Open' },\n    { id: 'in_progress' as TabType, label: 'In Progress' },\n    { id: 'completed' as TabType, label: 'Completed' },\n  ], []);\n\n  const getTaskCount = useCallback((status: TabType) => {\n    if (!tasks) return 0;\n    if (status === 'all') return tasks.length;\n    return tasks.filter(t => t.status === status).length;\n  }, [tasks]);\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-b from-background to-primary/5 pt-safe pb-24 flex items-center justify-center\">\n        <EmptyState\n          icon={<ClipboardList className=\"w-8 h-8\" />}\n          title=\"Something went wrong\"\n          description=\"We couldn't load your tasks. Please try again.\"\n          action={\n            <motion.button\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => window.location.reload()}\n              className=\"px-6 py-3 gradient-primary text-white rounded-xl font-bold\"\n            >\n              Retry\n            </motion.button>\n          }\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-24\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-20 -right-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center justify-between mb-6\"\n        >\n          <h1 className=\"text-2xl font-extrabold text-foreground\">My Tasks</h1>\n          <motion.button\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => setLocation('/post-task/1')}\n            className=\"w-12 h-12 gradient-primary rounded-2xl flex items-center justify-center text-white shadow-lg shadow-primary/30\"\n            data-testid=\"button-add-task\"\n          >\n            <Plus className=\"w-5 h-5\" />\n          </motion.button>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n          className=\"flex gap-2 overflow-x-auto no-scrollbar pb-2 -mx-6 px-6 mb-6\"\n        >\n          {tabs.map((tab, index) => (\n            <motion.button\n              key={tab.id}\n              initial={{ opacity: 0, x: -10 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.1 + index * 0.05 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={() => setActiveTab(tab.id)}\n              data-testid={`button-tab-${tab.id}`}\n              className={cn(\n                \"px-5 py-2.5 rounded-2xl font-bold text-sm whitespace-nowrap transition-all flex items-center gap-2\",\n                activeTab === tab.id\n                  ? \"gradient-primary text-white shadow-lg shadow-primary/25\"\n                  : \"glass text-muted-foreground\"\n              )}\n            >\n              {tab.label}\n              <span className={cn(\n                \"px-2 py-0.5 rounded-full text-xs font-bold\",\n                activeTab === tab.id\n                  ? \"bg-white/20\"\n                  : \"bg-muted\"\n              )}>\n                {getTaskCount(tab.id)}\n              </span>\n            </motion.button>\n          ))}\n        </motion.div>\n\n        <AnimatePresence mode=\"wait\">\n          {isLoading ? (\n            <motion.div\n              key=\"loading\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              <TaskCardSkeleton count={3} />\n            </motion.div>\n          ) : filteredTasks.length > 0 ? (\n            <motion.div\n              key=\"tasks\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"space-y-4\"\n            >\n              {filteredTasks.map((task, index) => (\n                <motion.div\n                  key={task.id}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: index * 0.05 }}\n                >\n                  <TaskCard task={task} showSaveButton={false} />\n                </motion.div>\n              ))}\n            </motion.div>\n          ) : (\n            <motion.div\n              key=\"empty\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              <EmptyState\n                icon={activeTab === 'all' ? <ClipboardList className=\"w-8 h-8\" /> : <Filter className=\"w-8 h-8\" />}\n                title={activeTab === 'all' ? 'No tasks yet' : `No ${activeTab.replace('_', ' ')} tasks`}\n                description={\n                  activeTab === 'all' \n                    ? 'Post your first task to get started' \n                    : 'Tasks will appear here when they match this filter'\n                }\n                action={\n                  activeTab === 'all' ? (\n                    <Link href=\"/post-task/1\">\n                      <motion.button \n                        whileHover={{ scale: 1.02 }}\n                        whileTap={{ scale: 0.98 }}\n                        className=\"px-6 py-3 gradient-primary text-white rounded-xl font-bold shadow-lg shadow-primary/25\"\n                      >\n                        Post a Task\n                      </motion.button>\n                    </Link>\n                  ) : undefined\n                }\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n});\n\nexport default MyTasksScreen;\n","path":null,"size_bytes":7130,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"attached_assets/AppContext_1764551047220.tsx":{"content":"\nimport React, { createContext, useContext, useState, useEffect, useMemo, useCallback } from 'react';\nimport { User, Task, Transaction, Notification } from '../types';\nimport { MOCK_USER, AVAILABLE_TASKS, MY_POSTED_TASKS, MOCK_TRANSACTIONS, MOCK_NOTIFICATIONS } from '../data/mockData';\nimport { generateId } from '../utils/helpers';\n\ninterface AppContextType {\n  user: User;\n  availableTasks: Task[];\n  myTasks: Task[];\n  transactions: Transaction[];\n  notifications: Notification[];\n  userRole: 'client' | 'tasker';\n  theme: 'light' | 'dark';\n  language: 'en' | 'ar';\n  savedTaskIds: string[];\n  myBids: { taskId: string; amount: number; status: 'pending' | 'accepted' | 'rejected' }[];\n  stats: { earnings: number; jobsDone: number };\n  toggleTheme: () => void;\n  setLanguage: (lang: 'en' | 'ar') => void;\n  switchRole: (role: 'client' | 'tasker') => void;\n  addTask: (task: Task) => void;\n  updateTaskStatus: (taskId: string, status: Task['status']) => void;\n  cancelTask: (taskId: string) => void;\n  addTransaction: (transaction: Transaction) => void;\n  markNotificationRead: (id: number) => void;\n  updateUserBalance: (amount: number) => void;\n  toggleSavedTask: (taskId: string) => Promise<void>;\n  placeBid: (taskId: string, amount: number) => Promise<void>;\n  updateUserProfile: (data: Partial<User>) => void;\n}\n\nconst AppContext = createContext<AppContextType | undefined>(undefined);\n\nexport const useApp = () => {\n  const context = useContext(AppContext);\n  if (!context) {\n    throw new Error('useApp must be used within an AppProvider');\n  }\n  return context;\n};\n\n// Helper for safe local storage parsing with type guard\nconst getSafeStorage = <T,>(key: string, fallback: T): T => {\n  try {\n    const saved = localStorage.getItem(key);\n    return saved ? JSON.parse(saved) : fallback;\n  } catch (e) {\n    console.error(`Error parsing localStorage key \"${key}\":`, e);\n    return fallback;\n  }\n};\n\nexport const AppProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  // -- Initialize State --\n  const [user, setUser] = useState<User>(() => getSafeStorage('app_user', MOCK_USER));\n  const [availableTasks, setAvailableTasks] = useState<Task[]>(() => getSafeStorage('app_availableTasks', AVAILABLE_TASKS));\n  const [myTasks, setMyTasks] = useState<Task[]>(() => getSafeStorage('app_myTasks', MY_POSTED_TASKS));\n  const [transactions, setTransactions] = useState<Transaction[]>(() => getSafeStorage('app_transactions', MOCK_TRANSACTIONS));\n  const [notifications, setNotifications] = useState<Notification[]>(() => getSafeStorage('app_notifications', MOCK_NOTIFICATIONS));\n  const [userRole, setUserRole] = useState<'client' | 'tasker'>(() => (localStorage.getItem('userRole') as 'client' | 'tasker') || 'client');\n  const [theme, setTheme] = useState<'light' | 'dark'>(() => (localStorage.getItem('theme') as 'light' | 'dark') || 'light');\n  const [language, setLanguageState] = useState<'en' | 'ar'>(() => (localStorage.getItem('app_language') as 'en' | 'ar') || 'en');\n  const [savedTaskIds, setSavedTaskIds] = useState<string[]>(() => getSafeStorage('app_savedTaskIds', []));\n  const [myBids, setMyBids] = useState<{ taskId: string; amount: number; status: 'pending' | 'accepted' | 'rejected' }[]>(() => getSafeStorage('app_myBids', []));\n\n  // -- Derived Stats (Memoized) --\n  const stats = useMemo(() => ({\n      earnings: transactions\n        .filter(t => t.type === 'credit')\n        .reduce((acc, curr) => acc + curr.amount, 0),\n      jobsDone: myTasks.filter(t => t.status === 'completed').length\n  }), [transactions, myTasks]);\n\n  // -- Persistence Effects --\n  useEffect(() => {\n    try {\n      localStorage.setItem('app_user', JSON.stringify(user));\n      localStorage.setItem('app_availableTasks', JSON.stringify(availableTasks));\n      localStorage.setItem('app_myTasks', JSON.stringify(myTasks));\n      localStorage.setItem('app_transactions', JSON.stringify(transactions));\n      localStorage.setItem('app_notifications', JSON.stringify(notifications));\n      localStorage.setItem('userRole', userRole);\n      localStorage.setItem('app_savedTaskIds', JSON.stringify(savedTaskIds));\n      localStorage.setItem('app_myBids', JSON.stringify(myBids));\n      localStorage.setItem('app_language', language);\n      localStorage.setItem('theme', theme);\n    } catch (e) {\n      console.error(\"Failed to save state to localStorage\", e);\n    }\n  }, [user, availableTasks, myTasks, transactions, notifications, userRole, savedTaskIds, myBids, language, theme]);\n  \n  // Theme Effect\n  useEffect(() => {\n      const root = window.document.documentElement;\n      root.classList.remove('light', 'dark');\n      root.classList.add(theme);\n  }, [theme]);\n\n  // Language/Direction Effect\n  useEffect(() => {\n      const root = window.document.documentElement;\n      root.dir = language === 'ar' ? 'rtl' : 'ltr';\n      root.lang = language;\n  }, [language]);\n\n  // -- Actions (Memoized with useCallback for performance) --\n\n  const toggleTheme = useCallback(() => setTheme(prev => prev === 'light' ? 'dark' : 'light'), []);\n  const setLanguage = useCallback((lang: 'en' | 'ar') => setLanguageState(lang), []);\n  const switchRole = useCallback((role: 'client' | 'tasker') => setUserRole(role), []);\n\n  const addTask = useCallback((task: Task) => {\n    const newTask = { ...task, id: generateId(), clientName: user.name, status: 'open' as const };\n    setMyTasks(prev => [newTask, ...prev]);\n  }, [user.name]);\n\n  const updateTaskStatus = useCallback((taskId: string, status: Task['status']) => {\n    setMyTasks(prev => prev.map(t => t.id === taskId ? { ...t, status } : t));\n    setAvailableTasks(prev => prev.map(t => t.id === taskId ? { ...t, status } : t));\n  }, []);\n\n  const cancelTask = useCallback((taskId: string) => {\n    setMyTasks(prev => prev.map(t => t.id === taskId ? { ...t, status: 'cancelled' } : t));\n    setAvailableTasks(prev => prev.filter(t => t.id !== taskId));\n  }, []);\n\n  const addTransaction = useCallback((transaction: Transaction) => {\n    setTransactions(prev => [transaction, ...prev]);\n    setUser(prev => ({ \n        ...prev, \n        balance: transaction.type === 'credit' ? prev.balance + transaction.amount : prev.balance - transaction.amount \n    }));\n  }, []);\n\n  const updateUserBalance = useCallback((amount: number) => {\n      setUser(prev => ({ ...prev, balance: prev.balance + amount }));\n  }, []);\n\n  const markNotificationRead = useCallback((id: number) => {\n    setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n));\n  }, []);\n\n  // Optimistic UI: Update state immediately, then mock API call\n  const toggleSavedTask = useCallback(async (taskId: string) => {\n      // 1. Snapshot previous state\n      const previousSaved = [...savedTaskIds];\n      \n      // 2. Optimistic Update\n      setSavedTaskIds(prev => \n          prev.includes(taskId) ? prev.filter(id => id !== taskId) : [...prev, taskId]\n      );\n\n      // 3. Simulate API Call\n      try {\n          await new Promise(resolve => setTimeout(resolve, 500)); // Mock 500ms latency\n          // Success - do nothing, state is already updated\n      } catch (error) {\n          // 4. Rollback on error\n          console.error(\"Failed to toggle save\", error);\n          setSavedTaskIds(previousSaved);\n          throw error;\n      }\n  }, [savedTaskIds]);\n\n  // Optimistic UI for Bidding\n  const placeBid = useCallback(async (taskId: string, amount: number) => {\n      const previousBids = [...myBids];\n      \n      setMyBids(prev => [...prev, { taskId, amount, status: 'pending' }]);\n\n      try {\n          await new Promise(resolve => setTimeout(resolve, 800));\n      } catch (error) {\n          setMyBids(previousBids);\n          throw error;\n      }\n  }, [myBids]);\n\n  const updateUserProfile = useCallback((data: Partial<User>) => {\n      setUser(prev => ({ ...prev, ...data }));\n  }, []);\n\n  // Memoize the entire context value to prevent downstream re-renders\n  const contextValue = useMemo(() => ({\n      user, availableTasks, myTasks, transactions, notifications, userRole, theme, language, savedTaskIds, myBids, stats,\n      toggleTheme, setLanguage, switchRole, addTask, updateTaskStatus, cancelTask, addTransaction, markNotificationRead, updateUserBalance, toggleSavedTask, placeBid, updateUserProfile\n  }), [user, availableTasks, myTasks, transactions, notifications, userRole, theme, language, savedTaskIds, myBids, stats, toggleTheme, setLanguage, switchRole, addTask, updateTaskStatus, cancelTask, addTransaction, markNotificationRead, updateUserBalance, toggleSavedTask, placeBid, updateUserProfile]);\n\n  return (\n    <AppContext.Provider value={contextValue}>\n      {children}\n    </AppContext.Provider>\n  );\n};\n","path":null,"size_bytes":8680,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/pages/WalletScreen.tsx":{"content":"import { memo, useMemo } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { TransactionCard } from '@/components/TransactionCard';\nimport { CountUp } from '@/components/CountUp';\nimport { useQuery } from '@tanstack/react-query';\nimport { Skeleton, EmptyState } from '@/components/ui/animated';\nimport { Wallet, Plus, ArrowUpRight, Receipt, ArrowLeft, CreditCard, TrendingUp } from 'lucide-react';\nimport type { Transaction, User } from '@shared/schema';\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: { staggerChildren: 0.06, delayChildren: 0.1 }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 16 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 }\n  }\n};\n\nconst WalletScreen = memo(function WalletScreen() {\n  const [, setLocation] = useLocation();\n  const { t } = useTranslation();\n  const isAuthenticated = !!localStorage.getItem('userId');\n  \n  const { data: user } = useQuery<User>({\n    queryKey: ['/api/users/me'],\n    enabled: isAuthenticated,\n  });\n\n  const { data: transactions, isLoading } = useQuery<Transaction[]>({\n    queryKey: ['/api/transactions'],\n    enabled: isAuthenticated,\n  });\n\n  const balance = useMemo(() => \n    user?.balance ? parseFloat(String(user.balance)) : 0,\n    [user?.balance]\n  );\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.5, scale: 1 }}\n          transition={{ duration: 1 }}\n          className=\"absolute -top-24 -right-24 w-80 h-80 bg-gradient-to-br from-primary/25 to-primary/5 rounded-full blur-3xl rtl:-left-24 rtl:right-auto\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.25 }}\n          transition={{ delay: 0.3 }}\n          className=\"absolute top-60 -left-20 w-48 h-48 bg-gradient-to-tr from-accent/25 to-transparent rounded-full blur-3xl rtl:-right-20 rtl:left-auto\"\n        />\n      </div>\n\n      <motion.div \n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"relative z-10 px-5 py-5\"\n      >\n        <motion.div\n          variants={itemVariants}\n          className=\"flex items-center gap-4 mb-6\"\n        >\n          <motion.button\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.92 }}\n            onClick={() => setLocation('/home')}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back-wallet\"\n          >\n            <ArrowLeft className=\"w-5 h-5 text-foreground/80 rtl:rotate-180\" />\n          </motion.button>\n          <h1 className=\"text-2xl font-extrabold text-foreground tracking-tight\">{t('wallet.title')}</h1>\n        </motion.div>\n\n        <motion.div\n          variants={itemVariants}\n          className=\"relative overflow-hidden rounded-[28px] mb-6\"\n        >\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary via-primary-dark to-primary/90\" />\n          \n          <div className=\"absolute inset-0 opacity-30\">\n            <div className=\"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/4 blur-2xl rtl:left-0 rtl:right-auto rtl:-translate-x-1/4\" />\n            <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-accent/20 rounded-full translate-y-1/2 -translate-x-1/4 blur-2xl rtl:right-0 rtl:left-auto rtl:translate-x-1/4\" />\n          </div>\n          \n          <div className=\"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIxIiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9IjAuMDUiLz48L2c+PC9zdmc+')] opacity-60\" />\n          \n          <div className=\"relative p-6\">\n            <div className=\"flex items-start justify-between mb-6\">\n              <div>\n                <p className=\"text-sm text-white/70 font-medium mb-1.5\">{t('wallet.availableBalance')}</p>\n                <p className=\"text-[44px] font-extrabold text-white tracking-tight leading-none\">\n                  $<CountUp end={balance} decimals={2} />\n                </p>\n              </div>\n              <motion.div \n                whileHover={{ rotate: 10, scale: 1.05 }}\n                className=\"w-16 h-16 bg-white/15 backdrop-blur-xl rounded-2xl flex items-center justify-center border border-white/20\"\n              >\n                <Wallet className=\"w-8 h-8 text-white\" />\n              </motion.div>\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-3\">\n              <Link href=\"/wallet/add-card\">\n                <motion.button \n                  whileHover={{ scale: 1.02, y: -2 }}\n                  whileTap={{ scale: 0.98 }}\n                  className=\"w-full h-12 bg-white/20 backdrop-blur-sm hover:bg-white/25 rounded-xl font-bold flex items-center justify-center gap-2 transition-all border border-white/20 text-white text-sm\"\n                  data-testid=\"button-add-funds\"\n                >\n                  <Plus className=\"w-4 h-4\" />\n                  {t('wallet.addFunds')}\n                </motion.button>\n              </Link>\n              <Link href=\"/wallet/withdraw\">\n                <motion.button \n                  whileHover={{ scale: 1.02, y: -2 }}\n                  whileTap={{ scale: 0.98 }}\n                  className=\"w-full h-12 bg-white/20 backdrop-blur-sm hover:bg-white/25 rounded-xl font-bold flex items-center justify-center gap-2 transition-all border border-white/20 text-white text-sm\"\n                  data-testid=\"button-withdraw\"\n                >\n                  <ArrowUpRight className=\"w-4 h-4\" />\n                  {t('wallet.withdrawFunds')}\n                </motion.button>\n              </Link>\n            </div>\n          </div>\n        </motion.div>\n\n        <motion.div variants={itemVariants} className=\"grid grid-cols-2 gap-3 mb-6\">\n          <div className=\"glass rounded-[20px] p-4\">\n            <div className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-success/20 to-success/5 flex items-center justify-center mb-2.5\">\n              <TrendingUp className=\"w-4 h-4 text-success\" />\n            </div>\n            <p className=\"text-[10px] text-muted-foreground font-semibold uppercase tracking-wider mb-0.5\">{t('wallet.recentActivity')}</p>\n            <p className=\"font-bold text-foreground\">+$0.00</p>\n          </div>\n          <div className=\"glass rounded-[20px] p-4\">\n            <div className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-2.5\">\n              <CreditCard className=\"w-4 h-4 text-primary\" />\n            </div>\n            <p className=\"text-[10px] text-muted-foreground font-semibold uppercase tracking-wider mb-0.5\">{t('tasks.statuses.inProgress')}</p>\n            <p className=\"font-bold text-foreground\">$0.00</p>\n          </div>\n        </motion.div>\n\n        <motion.div\n          variants={itemVariants}\n          className=\"flex items-center justify-between mb-4\"\n        >\n          <h2 className=\"text-lg font-bold text-foreground\">{t('wallet.transactionHistory')}</h2>\n        </motion.div>\n\n        <div className=\"space-y-2.5\">\n          <AnimatePresence mode=\"wait\">\n            {isLoading ? (\n              <motion.div\n                key=\"loading\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"space-y-2.5\"\n              >\n                {[1, 2, 3, 4].map((i) => (\n                  <div key={i} className=\"glass rounded-[18px] p-4 flex items-center gap-3\">\n                    <Skeleton className=\"w-10 h-10 rounded-xl\" />\n                    <div className=\"flex-1\">\n                      <Skeleton className=\"h-4 w-32 mb-1.5 rounded\" />\n                      <Skeleton className=\"h-3 w-20 rounded\" />\n                    </div>\n                    <Skeleton className=\"h-5 w-14 rounded\" />\n                  </div>\n                ))}\n              </motion.div>\n            ) : transactions && transactions.length > 0 ? (\n              <motion.div\n                key=\"transactions\"\n                variants={containerVariants}\n                initial=\"hidden\"\n                animate=\"visible\"\n                className=\"space-y-2.5\"\n              >\n                {transactions.map((transaction, index) => (\n                  <motion.div\n                    key={transaction.id}\n                    variants={itemVariants}\n                  >\n                    <TransactionCard transaction={transaction} />\n                  </motion.div>\n                ))}\n              </motion.div>\n            ) : (\n              <motion.div\n                key=\"empty\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0 }}\n              >\n                <EmptyState\n                  icon={<Receipt className=\"w-8 h-8\" />}\n                  title={t('wallet.noTransactions')}\n                  description={t('wallet.transactionHistory')}\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </motion.div>\n    </div>\n  );\n});\n\nexport default WalletScreen;\n","path":null,"size_bytes":9623,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* ============================================\n   LUMINOUS GLASS DESIGN SYSTEM - 2025 Premium\n   ============================================ */\n\n/* LIGHT MODE - Porcelain & Electric Cobalt */\n:root {\n  --button-outline: rgba(0,0,0, .06);\n  --badge-outline: rgba(0,0,0, .04);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .025);\n  --elevate-2: rgba(0,0,0, .05);\n  \n  /* Core palette - Luminous Light */\n  --background: 225 25% 97%;\n  --foreground: 230 25% 10%;\n  --border: 225 15% 90%;\n  \n  /* Glassmorphism surfaces */\n  --surface: 0 0% 100%;\n  --surface-foreground: 230 25% 10%;\n  --card: 0 0% 100%;\n  --card-foreground: 230 25% 10%;\n  --card-border: 225 20% 92%;\n  \n  /* Glass effect colors */\n  --glass: 0 0% 100%;\n  --glass-border: 0 0% 100%;\n  \n  /* Sidebar */\n  --sidebar: 225 25% 96%;\n  --sidebar-foreground: 230 25% 10%;\n  --sidebar-border: 225 15% 90%;\n  --sidebar-primary: 231 98% 61%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 225 20% 94%;\n  --sidebar-accent-foreground: 230 25% 10%;\n  --sidebar-ring: 231 98% 61%;\n  \n  /* Popover */\n  --popover: 0 0% 100%;\n  --popover-foreground: 230 25% 10%;\n  --popover-border: 225 15% 90%;\n  \n  /* Primary - Electric Cobalt */\n  --primary: 231 98% 61%;\n  --primary-foreground: 0 0% 100%;\n  --primary-dark: 231 98% 52%;\n  --primary-light: 231 98% 70%;\n  \n  /* Secondary */\n  --secondary: 225 20% 94%;\n  --secondary-foreground: 230 25% 20%;\n  \n  /* Muted */\n  --muted: 225 20% 95%;\n  --muted-foreground: 225 12% 50%;\n  \n  /* Accent - Aurora Turquoise */\n  --accent: 171 76% 47%;\n  --accent-foreground: 0 0% 100%;\n  \n  /* Destructive - Crimson Flare */\n  --destructive: 350 89% 60%;\n  --destructive-foreground: 0 0% 100%;\n  \n  /* Success - Emerald Glow */\n  --success: 152 76% 48%;\n  --success-foreground: 0 0% 100%;\n  \n  /* Warning - Sunrise Amber */\n  --warning: 36 100% 57%;\n  --warning-foreground: 30 60% 12%;\n  \n  /* Separator */\n  --separator: 225 15% 88%;\n  \n  /* Input & Ring */\n  --input: 225 15% 88%;\n  --ring: 231 98% 61%;\n  \n  /* Charts */\n  --chart-1: 231 98% 61%;\n  --chart-2: 36 100% 57%;\n  --chart-3: 152 76% 48%;\n  --chart-4: 171 76% 47%;\n  --chart-5: 280 85% 60%;\n  \n  /* Typography - Cairo font for Arabic support */\n  --font-sans: \"Cairo\", -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: \"SF Mono\", Menlo, monospace;\n  --radius: .875rem;\n  \n  /* Premium shadows with luminous glow */\n  --shadow-2xs: 0px 1px 2px 0px hsl(231 98% 61% / 0.02), 0px 1px 1px 0px hsl(0 0% 0% / 0.02);\n  --shadow-xs: 0px 2px 4px 0px hsl(231 98% 61% / 0.03), 0px 1px 2px 0px hsl(0 0% 0% / 0.02);\n  --shadow-sm: 0px 4px 8px -2px hsl(231 98% 61% / 0.05), 0px 2px 4px -2px hsl(0 0% 0% / 0.03);\n  --shadow: 0px 8px 16px -4px hsl(231 98% 61% / 0.06), 0px 4px 8px -4px hsl(0 0% 0% / 0.04);\n  --shadow-md: 0px 12px 24px -6px hsl(231 98% 61% / 0.08), 0px 6px 12px -6px hsl(0 0% 0% / 0.05);\n  --shadow-lg: 0px 20px 40px -8px hsl(231 98% 61% / 0.10), 0px 8px 16px -8px hsl(0 0% 0% / 0.06);\n  --shadow-xl: 0px 32px 64px -12px hsl(231 98% 61% / 0.12), 0px 12px 24px -12px hsl(0 0% 0% / 0.08);\n  --shadow-2xl: 0px 48px 96px -16px hsl(231 98% 61% / 0.16), 0px 16px 32px -16px hsl(0 0% 0% / 0.10);\n  \n  /* Glow shadows */\n  --shadow-glow-primary: 0 0 32px hsl(231 98% 61% / 0.25), 0 0 64px hsl(231 98% 61% / 0.15);\n  --shadow-glow-accent: 0 0 32px hsl(171 76% 47% / 0.25), 0 0 64px hsl(171 76% 47% / 0.15);\n  --shadow-glow-success: 0 0 24px hsl(152 76% 48% / 0.3);\n  \n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Border calculations */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --primary-border: hsl(var(--primary));\n  --secondary-border: hsl(var(--secondary));\n  --muted-border: hsl(var(--muted));\n  --accent-border: hsl(var(--accent));\n  --destructive-border: hsl(var(--destructive));\n  \n  /* Safe area insets */\n  --sat: env(safe-area-inset-top);\n  --sab: env(safe-area-inset-bottom);\n  --sal: env(safe-area-inset-left);\n  --sar: env(safe-area-inset-right);\n}\n\n/* DARK MODE - Deep Navy & Luminous Accents */\n.dark {\n  --button-outline: rgba(255,255,255, .08);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .08);\n  \n  /* Core palette - Deep Navy Gradient */\n  --background: 232 45% 6%;\n  --foreground: 220 20% 95%;\n  --border: 232 30% 15%;\n  \n  /* Glassmorphism surfaces */\n  --surface: 232 40% 10%;\n  --surface-foreground: 220 20% 95%;\n  --card: 232 40% 10%;\n  --card-foreground: 220 20% 95%;\n  --card-border: 232 30% 16%;\n  \n  /* Glass effect colors */\n  --glass: 232 40% 12%;\n  --glass-border: 232 30% 20%;\n  \n  /* Sidebar */\n  --sidebar: 232 45% 8%;\n  --sidebar-foreground: 220 20% 95%;\n  --sidebar-border: 232 30% 14%;\n  --sidebar-primary: 231 98% 65%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 232 30% 16%;\n  --sidebar-accent-foreground: 220 20% 95%;\n  --sidebar-ring: 231 98% 65%;\n  \n  /* Popover */\n  --popover: 232 40% 11%;\n  --popover-foreground: 220 20% 95%;\n  --popover-border: 232 30% 18%;\n  \n  /* Primary - Luminous Electric Cobalt */\n  --primary: 231 98% 65%;\n  --primary-foreground: 0 0% 100%;\n  --primary-dark: 231 98% 55%;\n  --primary-light: 231 98% 75%;\n  \n  /* Secondary */\n  --secondary: 232 30% 16%;\n  --secondary-foreground: 220 20% 95%;\n  \n  /* Muted */\n  --muted: 232 30% 14%;\n  --muted-foreground: 225 15% 55%;\n  \n  /* Accent - Luminous Aurora */\n  --accent: 171 76% 52%;\n  --accent-foreground: 0 0% 100%;\n  \n  /* Destructive - Bright Crimson */\n  --destructive: 350 89% 62%;\n  --destructive-foreground: 0 0% 100%;\n  \n  /* Success - Bright Emerald */\n  --success: 152 76% 52%;\n  --success-foreground: 0 0% 100%;\n  \n  /* Warning - Bright Amber */\n  --warning: 36 100% 60%;\n  --warning-foreground: 30 60% 10%;\n  \n  /* Separator */\n  --separator: 232 30% 18%;\n  \n  /* Input & Ring */\n  --input: 232 30% 20%;\n  --ring: 231 98% 65%;\n  \n  /* Charts */\n  --chart-1: 231 98% 68%;\n  --chart-2: 36 100% 62%;\n  --chart-3: 152 76% 55%;\n  --chart-4: 171 76% 55%;\n  --chart-5: 280 85% 65%;\n  \n  /* Premium shadows for dark mode */\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.25);\n  --shadow-xs: 0px 2px 4px 0px hsl(0 0% 0% / 0.30);\n  --shadow-sm: 0px 4px 8px -2px hsl(0 0% 0% / 0.40), inset 0 1px 0 hsl(231 98% 65% / 0.03);\n  --shadow: 0px 8px 16px -4px hsl(0 0% 0% / 0.45), inset 0 1px 0 hsl(231 98% 65% / 0.04);\n  --shadow-md: 0px 12px 24px -6px hsl(0 0% 0% / 0.50), inset 0 1px 0 hsl(231 98% 65% / 0.05);\n  --shadow-lg: 0px 20px 40px -8px hsl(0 0% 0% / 0.55), inset 0 1px 0 hsl(231 98% 65% / 0.06);\n  --shadow-xl: 0px 32px 64px -12px hsl(0 0% 0% / 0.60), inset 0 1px 0 hsl(231 98% 65% / 0.07);\n  --shadow-2xl: 0px 48px 96px -16px hsl(0 0% 0% / 0.65), inset 0 1px 0 hsl(231 98% 65% / 0.08);\n  \n  /* Glow shadows - brighter for dark */\n  --shadow-glow-primary: 0 0 40px hsl(231 98% 65% / 0.35), 0 0 80px hsl(231 98% 65% / 0.20);\n  --shadow-glow-accent: 0 0 40px hsl(171 76% 52% / 0.35), 0 0 80px hsl(171 76% 52% / 0.20);\n  --shadow-glow-success: 0 0 32px hsl(152 76% 52% / 0.4);\n\n  /* Border calculations */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --primary-border: hsl(var(--primary));\n  --secondary-border: hsl(var(--secondary));\n  --muted-border: hsl(var(--muted));\n  --accent-border: hsl(var(--accent));\n  --destructive-border: hsl(var(--destructive));\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    overscroll-behavior-y: none;\n    touch-action: manipulation;\n    -webkit-user-select: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n    -webkit-touch-callout: none;\n    font-feature-settings: 'cv11' 1, 'ss01' 1;\n  }\n\n  input, textarea {\n    -webkit-user-select: text;\n    user-select: text;\n  }\n\n  html {\n    scroll-behavior: smooth;\n  }\n  \n  /* Typography scale - Premium hierarchy */\n  h1, .h1 {\n    @apply text-3xl font-extrabold tracking-tight leading-tight;\n  }\n  h2, .h2 {\n    @apply text-2xl font-bold tracking-tight leading-snug;\n  }\n  h3, .h3 {\n    @apply text-xl font-bold leading-snug;\n  }\n  h4, .h4 {\n    @apply text-lg font-semibold leading-normal;\n  }\n  \n  /* Label styling */\n  .label-micro {\n    @apply text-[11px] font-bold uppercase tracking-[0.1em] text-muted-foreground;\n  }\n  \n  .label-small {\n    @apply text-xs font-semibold text-muted-foreground;\n  }\n}\n\n@layer utilities {\n  /* Hide scrollbar utility */\n  .no-scrollbar::-webkit-scrollbar {\n    display: none;\n  }\n  .no-scrollbar {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n\n  /* Safe area padding */\n  .pt-safe {\n    padding-top: max(env(safe-area-inset-top), 12px);\n  }\n  .pb-safe {\n    padding-bottom: max(env(safe-area-inset-bottom), 12px);\n  }\n  .pl-safe {\n    padding-left: env(safe-area-inset-left);\n  }\n  .pr-safe {\n    padding-right: env(safe-area-inset-right);\n  }\n\n  /* ========== LUMINOUS GLASS SYSTEM ========== */\n  \n  /* Glass Card - Standard frosted */\n  .glass {\n    @apply bg-white/70 dark:bg-white/[0.06] backdrop-blur-2xl;\n    border: 1px solid rgba(255,255,255,0.4);\n    box-shadow: \n      0 4px 24px -4px rgba(0,0,0,0.06),\n      inset 0 1px 0 rgba(255,255,255,0.4);\n  }\n  .dark .glass {\n    border-color: rgba(255,255,255,0.08);\n    box-shadow: \n      0 4px 24px -4px rgba(0,0,0,0.3),\n      inset 0 1px 0 rgba(255,255,255,0.06);\n  }\n  \n  /* Glass Card - Premium with luminous border */\n  .glass-premium {\n    background: linear-gradient(135deg, rgba(255,255,255,0.80) 0%, rgba(255,255,255,0.60) 100%);\n    @apply backdrop-blur-3xl;\n    border: 1.5px solid rgba(255,255,255,0.5);\n    box-shadow: \n      0 8px 32px -8px hsl(231 98% 61% / 0.08),\n      0 4px 16px -4px rgba(0,0,0,0.06),\n      inset 0 1px 0 rgba(255,255,255,0.6);\n  }\n  .dark .glass-premium {\n    background: linear-gradient(135deg, rgba(255,255,255,0.10) 0%, rgba(255,255,255,0.05) 100%);\n    border-color: rgba(255,255,255,0.10);\n    box-shadow: \n      0 8px 32px -8px hsl(231 98% 65% / 0.15),\n      0 4px 16px -4px rgba(0,0,0,0.3),\n      inset 0 1px 0 rgba(255,255,255,0.08);\n  }\n  \n  /* Glass Card - Ultra premium with glow */\n  .glass-ultra {\n    background: linear-gradient(145deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.65) 100%);\n    @apply backdrop-blur-3xl;\n    border: 2px solid transparent;\n    background-clip: padding-box;\n    position: relative;\n  }\n  .glass-ultra::before {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    padding: 2px;\n    border-radius: inherit;\n    background: linear-gradient(135deg, hsl(231 98% 61% / 0.4), hsl(171 76% 47% / 0.4));\n    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    -webkit-mask-composite: xor;\n    mask-composite: exclude;\n    pointer-events: none;\n  }\n  .dark .glass-ultra {\n    background: linear-gradient(145deg, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.06) 100%);\n  }\n  .dark .glass-ultra::before {\n    background: linear-gradient(135deg, hsl(231 98% 65% / 0.5), hsl(171 76% 52% / 0.5));\n  }\n  \n  /* Glass Input - floating label ready */\n  .glass-input {\n    @apply bg-white/60 dark:bg-white/[0.10] backdrop-blur-xl transition-all duration-200;\n    border: 1.5px solid rgba(0,0,0,0.08);\n  }\n  .dark .glass-input {\n    border-color: rgba(255,255,255,0.15);\n  }\n  .glass-input:focus {\n    @apply bg-white/90 dark:bg-white/[0.14];\n    border-color: hsl(231 98% 61% / 0.5);\n    box-shadow: 0 0 0 4px hsl(231 98% 61% / 0.12), 0 4px 12px -2px hsl(231 98% 61% / 0.15);\n  }\n  .dark .glass-input:focus {\n    border-color: hsl(231 98% 65% / 0.6);\n    box-shadow: 0 0 0 4px hsl(231 98% 65% / 0.18), 0 4px 12px -2px hsl(231 98% 65% / 0.25);\n  }\n  \n  /* Glass Button */\n  .glass-button {\n    @apply bg-white/30 dark:bg-white/[0.08] backdrop-blur-xl transition-all duration-200;\n    border: 1px solid rgba(255,255,255,0.4);\n  }\n  .dark .glass-button {\n    border-color: rgba(255,255,255,0.12);\n  }\n  .glass-button:hover {\n    @apply bg-white/50 dark:bg-white/[0.12];\n  }\n  .glass-button:active {\n    transform: scale(0.98);\n  }\n  \n  /* ========== GRADIENT SYSTEM ========== */\n  \n  /* Primary gradient - Electric Cobalt to Light */\n  .gradient-primary {\n    background: linear-gradient(135deg, hsl(231 98% 58%) 0%, hsl(231 98% 68%) 100%);\n  }\n  \n  /* Hero gradient - Full spectrum */\n  .gradient-hero {\n    background: linear-gradient(135deg, hsl(231 98% 58%) 0%, hsl(260 85% 60%) 50%, hsl(171 76% 47%) 100%);\n  }\n  \n  /* Accent gradient - Aurora */\n  .gradient-accent {\n    background: linear-gradient(135deg, hsl(171 76% 42%) 0%, hsl(171 76% 55%) 100%);\n  }\n  \n  /* Mesh gradient background */\n  .gradient-mesh {\n    background: \n      radial-gradient(ellipse at 20% 0%, hsl(231 98% 61% / 0.15) 0%, transparent 50%),\n      radial-gradient(ellipse at 80% 100%, hsl(171 76% 47% / 0.12) 0%, transparent 50%),\n      radial-gradient(ellipse at 50% 50%, hsl(280 85% 60% / 0.08) 0%, transparent 60%),\n      hsl(var(--background));\n  }\n  .dark .gradient-mesh {\n    background: \n      radial-gradient(ellipse at 20% 0%, hsl(231 98% 65% / 0.20) 0%, transparent 50%),\n      radial-gradient(ellipse at 80% 100%, hsl(171 76% 52% / 0.15) 0%, transparent 50%),\n      radial-gradient(ellipse at 50% 50%, hsl(280 85% 65% / 0.10) 0%, transparent 60%),\n      hsl(var(--background));\n  }\n  \n  /* Gradient Text */\n  .gradient-text {\n    @apply bg-clip-text text-transparent;\n    background-image: linear-gradient(135deg, hsl(231 98% 61%) 0%, hsl(171 76% 47%) 100%);\n  }\n  .dark .gradient-text {\n    background-image: linear-gradient(135deg, hsl(231 98% 70%) 0%, hsl(171 76% 55%) 100%);\n  }\n  \n  /* Gradient text primary only */\n  .gradient-text-primary {\n    @apply bg-clip-text text-transparent;\n    background-image: linear-gradient(135deg, hsl(231 98% 58%) 0%, hsl(231 98% 72%) 100%);\n  }\n  \n  /* ========== PREMIUM EFFECTS ========== */\n  \n  /* Shimmer loading animation */\n  .shimmer {\n    background: linear-gradient(\n      90deg,\n      hsl(var(--muted)) 0%,\n      hsl(var(--muted-foreground) / 0.08) 50%,\n      hsl(var(--muted)) 100%\n    );\n    background-size: 200% 100%;\n    animation: shimmer 1.8s ease-in-out infinite;\n  }\n  \n  @keyframes shimmer {\n    0% { background-position: 200% 0; }\n    100% { background-position: -200% 0; }\n  }\n  \n  /* Gradient border effect */\n  .gradient-border {\n    position: relative;\n  }\n  .gradient-border::before {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    padding: 1.5px;\n    border-radius: inherit;\n    background: linear-gradient(135deg, hsl(231 98% 61%), hsl(171 76% 47%));\n    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    -webkit-mask-composite: xor;\n    mask-composite: exclude;\n    pointer-events: none;\n  }\n  \n  /* Glow effects */\n  .glow-primary {\n    box-shadow: var(--shadow-glow-primary);\n  }\n  \n  .glow-accent {\n    box-shadow: var(--shadow-glow-accent);\n  }\n  \n  .glow-success {\n    box-shadow: var(--shadow-glow-success);\n  }\n  \n  /* Subtle floating animation */\n  .float {\n    animation: float 4s ease-in-out infinite;\n  }\n  \n  @keyframes float {\n    0%, 100% { transform: translateY(0px); }\n    50% { transform: translateY(-6px); }\n  }\n  \n  /* Pulse glow animation */\n  .pulse-glow {\n    animation: pulse-glow 2s ease-in-out infinite;\n  }\n  \n  @keyframes pulse-glow {\n    0%, 100% { box-shadow: 0 0 20px hsl(231 98% 61% / 0.3); }\n    50% { box-shadow: 0 0 40px hsl(231 98% 61% / 0.5); }\n  }\n  \n  /* ========== CARD VARIANTS ========== */\n  \n  /* Stat card with luminous icon area */\n  .stat-card {\n    @apply glass rounded-3xl p-5 relative overflow-hidden;\n  }\n  .stat-card::before {\n    content: \"\";\n    position: absolute;\n    top: -50%;\n    right: -30%;\n    width: 100%;\n    height: 150%;\n    background: radial-gradient(ellipse, hsl(231 98% 61% / 0.08) 0%, transparent 60%);\n    pointer-events: none;\n  }\n  \n  /* Feature card with hover lift */\n  .feature-card {\n    @apply glass rounded-3xl p-6 transition-all duration-300;\n  }\n  .feature-card:hover {\n    transform: translateY(-4px);\n    box-shadow: \n      0 20px 40px -12px hsl(231 98% 61% / 0.15),\n      0 8px 16px -8px rgba(0,0,0,0.08);\n  }\n  .dark .feature-card:hover {\n    box-shadow: \n      0 20px 40px -12px hsl(231 98% 65% / 0.25),\n      0 8px 16px -8px rgba(0,0,0,0.3);\n  }\n  \n  /* Action card with gradient accent */\n  .action-card {\n    @apply glass-premium rounded-3xl p-6 cursor-pointer transition-all duration-200;\n  }\n  .action-card:active {\n    transform: scale(0.98);\n  }\n\n  /* ========== END GLASSMORPHISM ========== */\n\n  /* Material Symbols filled variant */\n  .material-symbols-filled {\n    font-variation-settings: 'FILL' 1;\n  }\n\n  /* Hide ugly search cancel button in Chrome */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* Elevation system */\n  .no-default-hover-elevate {}\n  .no-default-active-elevate {}\n\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: -1;\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: 999;\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n\n/* Leaflet Map Customization */\n.leaflet-container {\n  background: transparent !important;\n  font-family: inherit !important;\n}\n\n.custom-marker-pin {\n  position: absolute;\n  width: 24px;\n  height: 24px;\n  background: linear-gradient(135deg, hsl(231 98% 58%), hsl(231 98% 68%));\n  border: 3px solid white;\n  border-radius: 50%;\n  box-shadow: 0 4px 12px rgba(59, 91, 255, 0.4);\n}\n\n.dark .custom-marker-pin {\n  border-color: hsl(232 40% 12%);\n  box-shadow: 0 4px 12px rgba(99, 128, 255, 0.5);\n}\n\n.leaflet-marker-icon,\n.leaflet-zoom-animated {\n  transition: transform 0.2s linear;\n}\n\n/* Hide Leaflet attribution for cleaner mobile look */\n.leaflet-control-attribution {\n  display: none !important;\n}\n\n/* Task Location Map Marker */\n.task-location-marker {\n  background: transparent !important;\n  border: none !important;\n}\n\n.task-location-marker .animate-ping {\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Premium Bottom Navigation Styles */\n.bottom-nav-item {\n  @apply relative flex flex-col items-center justify-center gap-0.5 py-1 transition-all duration-200;\n}\n\n.bottom-nav-item.active {\n  @apply text-primary;\n}\n\n.bottom-nav-item.active::before {\n  content: \"\";\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 32px;\n  height: 3px;\n  background: linear-gradient(90deg, hsl(231 98% 61%), hsl(171 76% 47%));\n  border-radius: 0 0 4px 4px;\n}\n\n/* Premium Input Floating Label */\n.floating-input-wrapper {\n  @apply relative;\n}\n\n.floating-input-wrapper input:focus + label,\n.floating-input-wrapper input:not(:placeholder-shown) + label {\n  @apply -translate-y-5 scale-[0.85] text-primary font-semibold;\n}\n\n.floating-input-wrapper label {\n  @apply absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground transition-all duration-200 pointer-events-none origin-left;\n}\n","path":null,"size_bytes":20970,"size_tokens":null},"client/src/pages/RegisterScreen.tsx":{"content":"import { useState, memo, useCallback, useRef } from 'react';\nimport { Link, useLocation, useSearch } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useApp } from '@/context/AppContext';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequest, setAuthToken } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { ArrowLeft, Eye, EyeOff, Loader2, User, Mail, Phone, Lock, Upload, FileCheck, AlertCircle, X } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface FormData {\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  password: string;\n}\n\ninterface InputFieldProps {\n  icon: typeof User;\n  label: string;\n  type?: string;\n  value: string;\n  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  error?: string;\n  autoComplete?: string;\n  showPasswordToggle?: boolean;\n  showPassword?: boolean;\n  onTogglePassword?: () => void;\n  testId: string;\n  dir?: string;\n}\n\nconst InputField = memo(function InputField({\n  icon: Icon,\n  label,\n  type = 'text',\n  value,\n  onChange,\n  error,\n  autoComplete,\n  showPasswordToggle,\n  showPassword,\n  onTogglePassword,\n  testId,\n  dir,\n}: InputFieldProps) {\n  const [isFocused, setIsFocused] = useState(false);\n  const { i18n } = useTranslation();\n  const isRTL = i18n.language === 'ar';\n  \n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"relative\"\n    >\n      <div className=\"relative\">\n        <div className={cn(\n          \"absolute top-1/2 -translate-y-1/2 text-muted-foreground\",\n          isRTL ? \"right-4\" : \"left-4\"\n        )}>\n          <Icon className=\"w-5 h-5\" />\n        </div>\n        <input\n          type={showPasswordToggle ? (showPassword ? 'text' : 'password') : type}\n          value={value}\n          onChange={onChange}\n          onFocus={() => setIsFocused(true)}\n          onBlur={() => setIsFocused(false)}\n          placeholder={label}\n          autoComplete={autoComplete}\n          dir={dir || (isRTL ? 'rtl' : 'ltr')}\n          className={cn(\n            \"w-full h-14 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none transition-all duration-200\",\n            isRTL ? \"pr-12 pl-5\" : \"pl-12 pr-5\",\n            error && \"border-destructive\",\n            isFocused && \"ring-2 ring-primary/30\",\n            showPasswordToggle && (isRTL ? \"pl-14\" : \"pr-14\"),\n            isRTL && \"text-right\"\n          )}\n          data-testid={testId}\n        />\n        {showPasswordToggle && (\n          <button\n            type=\"button\"\n            onClick={onTogglePassword}\n            className={cn(\n              \"absolute top-1/2 -translate-y-1/2 p-2 text-muted-foreground hover:text-foreground transition-colors\",\n              isRTL ? \"left-4\" : \"right-4\"\n            )}\n          >\n            {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n          </button>\n        )}\n      </div>\n      <AnimatePresence>\n        {error && (\n          <motion.p\n            initial={{ opacity: 0, y: -5 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -5 }}\n            className={cn(\n              \"mt-2 text-xs text-destructive font-medium\",\n              isRTL ? \"pr-1 text-right\" : \"pl-1\"\n            )}\n          >\n            {error}\n          </motion.p>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n});\n\ntype TaskerType = 'general' | 'specialized';\n\nconst RegisterScreen = memo(function RegisterScreen() {\n  const [, setLocation] = useLocation();\n  const searchString = useSearch();\n  const { t, i18n } = useTranslation();\n  const { userRole, setUser } = useApp();\n  const { toast } = useToast();\n  const isRTL = i18n.language === 'ar';\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const searchParams = new URLSearchParams(searchString);\n  const taskerType = (searchParams.get('taskerType') as TaskerType) || 'general';\n  const isSpecialized = userRole === 'tasker' && taskerType === 'specialized';\n  \n  const [formData, setFormData] = useState<FormData>({\n    firstName: '',\n    lastName: '',\n    email: '',\n    phone: '',\n    password: '',\n  });\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [showPassword, setShowPassword] = useState(false);\n  const [showCertificateStep, setShowCertificateStep] = useState(false);\n  const [certificateImage, setCertificateImage] = useState<string | null>(null);\n  const [certificateError, setCertificateError] = useState<string | null>(null);\n  const [showOtpStep, setShowOtpStep] = useState(false);\n  const [otpCode, setOtpCode] = useState('');\n\n  const getPasswordStrength = useCallback((password: string): { level: number; label: string; color: string } => {\n    if (!password) return { level: 0, label: '', color: '' };\n    \n    let score = 0;\n    if (password.length >= 6) score++;\n    if (password.length >= 8) score++;\n    if (/[A-Z]/.test(password)) score++;\n    if (/[0-9]/.test(password)) score++;\n    if (/[^A-Za-z0-9]/.test(password)) score++;\n    \n    if (score <= 2) return { level: 1, label: t('auth.passwordWeak'), color: 'bg-destructive' };\n    if (score <= 3) return { level: 2, label: t('auth.passwordMedium'), color: 'bg-warning' };\n    if (score <= 4) return { level: 3, label: t('auth.passwordStrong'), color: 'bg-success' };\n    return { level: 4, label: t('auth.passwordVeryStrong'), color: 'bg-success' };\n  }, [t]);\n\n  const passwordStrength = getPasswordStrength(formData.password);\n\n  // Send Phone OTP for registration\n  const sendOtpMutation = useMutation({\n    mutationFn: async (phone: string) => {\n      const response = await apiRequest('POST', '/api/auth/send-phone-otp', { phone, type: 'registration' });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to send OTP');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      setShowOtpStep(true);\n      toast({ \n        title: isRTL ? 'تم إرسال الرمز' : 'Code Sent', \n        description: isRTL ? 'تحقق من رسائلك SMS' : 'Check your SMS for the verification code'\n      });\n    },\n    onError: (error: Error) => {\n      let errorMessage = error.message;\n      if (error.message.includes('already registered')) {\n        errorMessage = isRTL ? 'رقم الجوال مسجل مسبقاً' : 'Phone number already registered';\n      }\n      toast({ \n        title: isRTL ? 'خطأ' : 'Error', \n        description: errorMessage, \n        variant: 'destructive' \n      });\n    },\n  });\n\n  // Verify Phone OTP and then register\n  const verifyOtpMutation = useMutation({\n    mutationFn: async (data: { phone: string; otpCode: string }) => {\n      const response = await apiRequest('POST', '/api/auth/verify-phone-otp', data);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Invalid OTP');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      // OTP verified, now proceed to registration or certificate step\n      if (isSpecialized && !showCertificateStep) {\n        setShowCertificateStep(true);\n        setShowOtpStep(false);\n      } else {\n        registerMutation.mutate({ ...formData, certificateUrl: certificateImage || undefined });\n      }\n    },\n    onError: (error: Error) => {\n      let errorMessage = error.message;\n      if (error.message.includes('Invalid') || error.message.includes('expired')) {\n        errorMessage = isRTL ? 'رمز التحقق غير صحيح أو منتهي الصلاحية' : 'Invalid or expired verification code';\n      }\n      toast({ \n        title: isRTL ? 'خطأ' : 'Error', \n        description: errorMessage, \n        variant: 'destructive' \n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: FormData & { certificateUrl?: string }) => {\n      const requestData: Record<string, unknown> = {\n        ...data,\n        name: `${data.firstName} ${data.lastName}`.trim(),\n        username: data.phone,\n        role: userRole,\n      };\n      \n      if (userRole === 'tasker') {\n        requestData.taskerType = taskerType;\n        requestData.verificationStatus = taskerType === 'specialized' ? 'pending' : 'approved';\n        if (data.certificateUrl) {\n          requestData.certificateUrl = data.certificateUrl;\n        }\n      }\n      \n      const response = await apiRequest('POST', '/api/auth/register', requestData);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Registration failed');\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      if (data.token) {\n        setAuthToken(data.token);\n      }\n      setUser(data.user);\n      localStorage.setItem('userId', data.user.id);\n      \n      if (isSpecialized) {\n        toast({ \n          title: t('auth.accountCreatedPending'), \n          description: t('auth.pendingReviewDesc') \n        });\n      } else {\n        toast({ \n          title: t('auth.accountCreated'), \n          description: t('auth.welcomeTo', { appName: t('welcome.title') }) \n        });\n      }\n      setLocation('/home');\n    },\n    onError: (error: Error) => {\n      let errorMessage = error.message;\n      if (error.message.includes('email') || error.message.includes('users_email_key')) {\n        errorMessage = isRTL ? 'البريد الإلكتروني مسجل مسبقاً' : 'Email already registered';\n      } else if (error.message.includes('phone') || error.message.includes('users_phone_key')) {\n        errorMessage = isRTL ? 'رقم الجوال مسجل مسبقاً' : 'Phone number already registered';\n      } else if (error.message.includes('username') || error.message.includes('users_username_key')) {\n        errorMessage = isRTL ? 'اسم المستخدم مسجل مسبقاً' : 'Username already registered';\n      }\n      toast({ \n        title: isRTL ? 'خطأ في التسجيل' : 'Registration Error', \n        description: errorMessage, \n        variant: 'destructive' \n      });\n    },\n  });\n\n  const validateForm = useCallback(() => {\n    const newErrors: Record<string, string> = {};\n    \n    if (!formData.firstName.trim()) newErrors.firstName = t('errors.required');\n    if (!formData.lastName.trim()) newErrors.lastName = t('errors.required');\n    if (!formData.email.trim()) {\n      newErrors.email = t('errors.required');\n    } else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n      newErrors.email = t('errors.invalidEmail');\n    }\n    if (!formData.phone.trim()) {\n      newErrors.phone = t('errors.required');\n    } else if (!/^05\\d{8}$/.test(formData.phone.replace(/\\s/g, ''))) {\n      newErrors.phone = t('errors.invalidPhone');\n    }\n    if (!formData.password.trim()) {\n      newErrors.password = t('errors.required');\n    } else if (formData.password.length < 6) {\n      newErrors.password = t('errors.passwordTooShort');\n    }\n    \n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  }, [formData, t]);\n\n  const handleFormSubmit = useCallback(() => {\n    if (validateForm()) {\n      // Send OTP first before registration\n      sendOtpMutation.mutate(formData.phone);\n    }\n  }, [validateForm, sendOtpMutation, formData.phone]);\n\n  const handleOtpSubmit = useCallback(() => {\n    if (!otpCode.trim() || otpCode.length < 4) {\n      toast({ \n        title: isRTL ? 'خطأ' : 'Error', \n        description: isRTL ? 'أدخل رمز التحقق' : 'Enter verification code', \n        variant: 'destructive' \n      });\n      return;\n    }\n    verifyOtpMutation.mutate({ phone: formData.phone, otpCode });\n  }, [otpCode, verifyOtpMutation, formData.phone, isRTL, toast]);\n\n  const handleCertificateSubmit = useCallback(() => {\n    registerMutation.mutate({ ...formData, certificateUrl: certificateImage || undefined });\n  }, [registerMutation, formData, certificateImage]);\n\n  const handleSkipCertificate = useCallback(() => {\n    registerMutation.mutate({ ...formData, certificateUrl: undefined });\n  }, [registerMutation, formData]);\n\n  const handleChange = useCallback((field: keyof FormData) => (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData(prev => ({ ...prev, [field]: e.target.value }));\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: '' }));\n    }\n  }, [errors]);\n\n  const handleBack = useCallback(() => {\n    if (showCertificateStep) {\n      setShowCertificateStep(false);\n    } else if (showOtpStep) {\n      setShowOtpStep(false);\n      setOtpCode('');\n    } else if (userRole === 'tasker') {\n      setLocation('/tasker-type');\n    } else {\n      setLocation('/role');\n    }\n  }, [setLocation, userRole, showCertificateStep, showOtpStep]);\n\n  const handleCertificateUpload = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > 5 * 1024 * 1024) {\n      setCertificateError(t('taskerType.certificate.fileTooLarge'));\n      return;\n    }\n\n    if (!file.type.startsWith('image/')) {\n      setCertificateError(t('taskerType.certificate.invalidFormat'));\n      return;\n    }\n\n    setCertificateError(null);\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setCertificateImage(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  }, [t]);\n\n  const removeCertificateImage = useCallback(() => {\n    setCertificateImage(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  }, []);\n\n  const currentStep = showCertificateStep ? 3 : showOtpStep ? 2 : 1;\n  const totalSteps = isSpecialized ? 3 : 2;\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-background to-primary/5 pt-safe\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className={cn(\n            \"absolute -top-20 w-80 h-80 bg-accent/20 rounded-full blur-3xl\",\n            isRTL ? \"-right-20\" : \"-left-20\"\n          )}\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.2 }}\n          transition={{ delay: 0.2 }}\n          className={cn(\n            \"absolute bottom-40 w-64 h-64 bg-primary/15 rounded-full blur-3xl\",\n            isRTL ? \"-left-20\" : \"-right-20\"\n          )}\n        />\n      </div>\n\n      <motion.div \n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"flex items-center justify-between px-6 py-4\"\n      >\n        <motion.button \n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={handleBack}\n          className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className={cn(\"w-5 h-5\", isRTL && \"rotate-180\")} />\n        </motion.button>\n        \n        {totalSteps > 1 && (\n          <div className=\"flex gap-2\">\n            {Array.from({ length: totalSteps }).map((_, step) => (\n              <motion.div \n                key={step}\n                initial={{ scaleX: 0 }}\n                animate={{ scaleX: 1 }}\n                transition={{ delay: step * 0.1 }}\n                className={cn(\n                  \"w-10 h-1.5 rounded-full transition-colors\",\n                  step < currentStep ? \"bg-primary\" : \"bg-muted\"\n                )}\n              />\n            ))}\n          </div>\n        )}\n        \n        <div className=\"w-11\" />\n      </motion.div>\n\n      <div className=\"flex-1 flex flex-col px-6 py-6 relative z-10 overflow-y-auto\">\n        <AnimatePresence mode=\"wait\">\n          {/* OTP Verification Step */}\n          {showOtpStep && !showCertificateStep ? (\n            <motion.div\n              key=\"otp-step\"\n              initial={{ opacity: 0, x: isRTL ? 20 : -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: isRTL ? -20 : 20 }}\n              className=\"flex-1 flex flex-col\"\n            >\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.1 }}\n                className={cn(\"mb-8\", isRTL && \"text-right\")}\n              >\n                <div className=\"w-20 h-20 rounded-[1.5rem] bg-success/15 flex items-center justify-center mb-6 mx-auto\">\n                  <Phone className=\"w-10 h-10 text-success\" />\n                </div>\n                <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2 text-center\">\n                  {isRTL ? 'تحقق من رقم الجوال' : 'Verify Phone Number'}\n                </h1>\n                <p className=\"text-muted-foreground text-lg text-center\">\n                  {isRTL \n                    ? `تم إرسال رمز التحقق إلى ${formData.phone}` \n                    : `A verification code was sent to ${formData.phone}`}\n                </p>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.2 }}\n                className=\"space-y-6 flex-1\"\n              >\n                <div className=\"relative\">\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={otpCode}\n                    onChange={(e) => setOtpCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\n                    placeholder={isRTL ? 'أدخل رمز التحقق' : 'Enter verification code'}\n                    maxLength={6}\n                    autoComplete=\"one-time-code\"\n                    className=\"w-full h-16 px-5 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none transition-all duration-200 text-center text-2xl tracking-[0.5em] font-bold\"\n                    data-testid=\"input-otp-code\"\n                  />\n                </div>\n\n                <div className=\"text-center\">\n                  <button \n                    onClick={() => sendOtpMutation.mutate(formData.phone)}\n                    disabled={sendOtpMutation.isPending}\n                    className=\"text-sm text-primary font-semibold hover:underline disabled:opacity-50\"\n                    data-testid=\"button-resend-otp\"\n                  >\n                    {isRTL ? 'إعادة إرسال الرمز' : 'Resend code'}\n                  </button>\n                </div>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3 }}\n                className=\"mt-6 pb-safe\"\n              >\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={handleOtpSubmit}\n                  disabled={verifyOtpMutation.isPending || !otpCode.trim()}\n                  className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/25 transition-all disabled:opacity-60 flex items-center justify-center gap-2\"\n                  data-testid=\"button-verify-otp\"\n                >\n                  {verifyOtpMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"w-5 h-5 animate-spin\" />\n                      {t('common.loading')}\n                    </>\n                  ) : (\n                    isRTL ? 'تأكيد الرمز' : 'Verify Code'\n                  )}\n                </motion.button>\n              </motion.div>\n            </motion.div>\n          ) : !showCertificateStep ? (\n            <motion.div\n              key=\"form-step\"\n              initial={{ opacity: 0, x: isRTL ? 20 : -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: isRTL ? -20 : 20 }}\n              className=\"flex-1 flex flex-col\"\n            >\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.1 }}\n                className={cn(\"mb-8\", isRTL && \"text-right\")}\n              >\n                <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n                  {t('auth.createAccount')}\n                </h1>\n                <p className=\"text-muted-foreground text-lg\">\n                  {userRole === 'tasker' \n                    ? t('auth.taskerRegisterDesc')\n                    : t('auth.clientRegisterDesc')}\n                </p>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.2 }}\n                className=\"space-y-4 flex-1\"\n              >\n                <div className=\"flex gap-3\">\n                  <div className=\"flex-1\">\n                    <InputField\n                      icon={User}\n                      label={isRTL ? 'الاسم الأول' : 'First Name'}\n                      value={formData.firstName}\n                      onChange={handleChange('firstName')}\n                      error={errors.firstName}\n                      autoComplete=\"given-name\"\n                      testId=\"input-first-name\"\n                    />\n                  </div>\n                  <div className=\"flex-1\">\n                    <InputField\n                      icon={User}\n                      label={isRTL ? 'اسم العائلة' : 'Last Name'}\n                      value={formData.lastName}\n                      onChange={handleChange('lastName')}\n                      error={errors.lastName}\n                      autoComplete=\"family-name\"\n                      testId=\"input-last-name\"\n                    />\n                  </div>\n                </div>\n                \n                <InputField\n                  icon={Phone}\n                  label={isRTL ? '05XXXXXXXX' : '05XXXXXXXX'}\n                  type=\"tel\"\n                  value={formData.phone}\n                  onChange={handleChange('phone')}\n                  error={errors.phone}\n                  autoComplete=\"tel\"\n                  testId=\"input-phone\"\n                  dir=\"ltr\"\n                />\n                <p className=\"text-xs text-muted-foreground text-center -mt-2 mb-2\">\n                  {isRTL ? 'رقم جوال سعودي يبدأ بـ 05' : 'Saudi mobile number starting with 05'}\n                </p>\n                \n                <InputField\n                  icon={Mail}\n                  label={t('auth.email')}\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={handleChange('email')}\n                  error={errors.email}\n                  autoComplete=\"email\"\n                  testId=\"input-email\"\n                  dir=\"ltr\"\n                />\n                \n                <InputField\n                  icon={Lock}\n                  label={t('auth.password')}\n                  value={formData.password}\n                  onChange={handleChange('password')}\n                  error={errors.password}\n                  autoComplete=\"new-password\"\n                  showPasswordToggle\n                  showPassword={showPassword}\n                  onTogglePassword={() => setShowPassword(!showPassword)}\n                  testId=\"input-password\"\n                />\n                \n                {formData.password && (\n                  <motion.div\n                    initial={{ opacity: 0, y: -5 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"space-y-2\"\n                  >\n                    <div className=\"flex gap-1.5\">\n                      {[1, 2, 3, 4].map((level) => (\n                        <div\n                          key={level}\n                          className={cn(\n                            \"h-1.5 flex-1 rounded-full transition-all duration-300\",\n                            level <= passwordStrength.level\n                              ? passwordStrength.color\n                              : \"bg-muted\"\n                          )}\n                        />\n                      ))}\n                    </div>\n                    <p className={cn(\n                      \"text-xs font-medium\",\n                      passwordStrength.level <= 1 && \"text-destructive\",\n                      passwordStrength.level === 2 && \"text-warning\",\n                      passwordStrength.level >= 3 && \"text-success\",\n                      isRTL && \"text-right\"\n                    )}>\n                      {passwordStrength.label}\n                    </p>\n                  </motion.div>\n                )}\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.4 }}\n                className=\"mt-6 pb-safe\"\n              >\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={handleFormSubmit}\n                  disabled={sendOtpMutation.isPending}\n                  className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/25 transition-all disabled:opacity-60 flex items-center justify-center gap-2\"\n                  data-testid=\"button-create-account\"\n                >\n                  {sendOtpMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"w-5 h-5 animate-spin\" />\n                      {t('common.loading')}\n                    </>\n                  ) : (\n                    isRTL ? 'تحقق من رقم الجوال' : 'Verify Phone'\n                  )}\n                </motion.button>\n\n                <p className={cn(\"text-center text-muted-foreground mt-6\", isRTL && \"text-center\")}>\n                  {t('auth.haveAccount')}{' '}\n                  <Link href=\"/login\" className=\"text-primary font-bold hover:underline\">\n                    {t('auth.signIn')}\n                  </Link>\n                </p>\n              </motion.div>\n            </motion.div>\n          ) : (\n            <motion.div\n              key=\"certificate-step\"\n              initial={{ opacity: 0, x: isRTL ? -20 : 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: isRTL ? 20 : -20 }}\n              className=\"flex-1 flex flex-col\"\n            >\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.1 }}\n                className={cn(\"mb-8\", isRTL && \"text-right\")}\n              >\n                <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n                  {t('taskerType.certificate.title')}\n                </h1>\n                <p className=\"text-muted-foreground text-lg\">\n                  {t('taskerType.certificate.description')}\n                </p>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.2 }}\n                className=\"flex-1 space-y-6\"\n              >\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleCertificateUpload}\n                  className=\"hidden\"\n                  data-testid=\"input-certificate\"\n                />\n\n                {!certificateImage ? (\n                  <motion.button\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    onClick={() => fileInputRef.current?.click()}\n                    className=\"w-full aspect-[4/3] rounded-3xl glass border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-4 transition-all hover:border-primary/50\"\n                    data-testid=\"button-upload-certificate\"\n                  >\n                    <div className=\"w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center\">\n                      <Upload className=\"w-8 h-8 text-primary\" />\n                    </div>\n                    <span className=\"text-muted-foreground font-medium\">\n                      {t('taskerType.certificate.uploadPrompt')}\n                    </span>\n                  </motion.button>\n                ) : (\n                  <motion.div\n                    initial={{ opacity: 0, scale: 0.95 }}\n                    animate={{ opacity: 1, scale: 1 }}\n                    className=\"relative w-full aspect-[4/3] rounded-3xl overflow-hidden glass\"\n                  >\n                    <img\n                      src={certificateImage}\n                      alt=\"Certificate\"\n                      className=\"w-full h-full object-cover\"\n                    />\n                    <motion.button\n                      whileHover={{ scale: 1.1 }}\n                      whileTap={{ scale: 0.9 }}\n                      onClick={removeCertificateImage}\n                      className={cn(\n                        \"absolute top-4 w-10 h-10 rounded-full bg-black/60 backdrop-blur-md flex items-center justify-center text-white\",\n                        isRTL ? \"left-4\" : \"right-4\"\n                      )}\n                      data-testid=\"button-remove-certificate\"\n                    >\n                      <X className=\"w-5 h-5\" />\n                    </motion.button>\n                    <motion.button\n                      whileHover={{ scale: 1.02 }}\n                      whileTap={{ scale: 0.98 }}\n                      onClick={() => fileInputRef.current?.click()}\n                      className=\"absolute bottom-4 left-1/2 -translate-x-1/2 px-6 py-2 rounded-full bg-white/90 dark:bg-black/80 backdrop-blur-md text-foreground font-medium shadow-lg\"\n                      data-testid=\"button-change-certificate\"\n                    >\n                      {t('taskerType.certificate.changeImage')}\n                    </motion.button>\n                  </motion.div>\n                )}\n\n                <AnimatePresence>\n                  {certificateError && (\n                    <motion.div\n                      initial={{ opacity: 0, y: -10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -10 }}\n                      className=\"flex items-center gap-2 p-4 rounded-2xl bg-destructive/10 text-destructive\"\n                    >\n                      <AlertCircle className=\"w-5 h-5 shrink-0\" />\n                      <span className=\"text-sm font-medium\">{certificateError}</span>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n\n                <motion.div\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.3 }}\n                  className=\"flex items-start gap-3 p-4 rounded-2xl bg-amber-500/10 border border-amber-500/20\"\n                >\n                  <FileCheck className=\"w-5 h-5 text-amber-600 dark:text-amber-400 shrink-0 mt-0.5\" />\n                  <p className={cn(\"text-sm text-amber-700 dark:text-amber-300\", isRTL && \"text-right\")}>\n                    {t('taskerType.certificate.pendingNote')}\n                  </p>\n                </motion.div>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.4 }}\n                className=\"mt-6 pb-safe space-y-3\"\n              >\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={handleCertificateSubmit}\n                  disabled={registerMutation.isPending}\n                  className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/25 transition-all disabled:opacity-60 flex items-center justify-center gap-2\"\n                  data-testid=\"button-submit-certificate\"\n                >\n                  {registerMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"w-5 h-5 animate-spin\" />\n                      {t('auth.creatingAccount')}\n                    </>\n                  ) : (\n                    t('auth.register')\n                  )}\n                </motion.button>\n\n                <motion.button\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                  onClick={handleSkipCertificate}\n                  disabled={registerMutation.isPending}\n                  className=\"w-full h-14 glass text-foreground rounded-2xl font-bold text-lg transition-all disabled:opacity-60 flex items-center justify-center gap-2\"\n                  data-testid=\"button-skip-certificate\"\n                >\n                  {t('taskerType.certificate.skipForNow')}\n                </motion.button>\n              </motion.div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n});\n\nexport default RegisterScreen;\n","path":null,"size_bytes":33533,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/animated.tsx":{"content":"import { motion, AnimatePresence, Variants } from \"framer-motion\";\nimport { forwardRef, memo, ReactNode, ComponentPropsWithoutRef } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst fadeInUp: Variants = {\n  initial: { opacity: 0, y: 20 },\n  animate: { opacity: 1, y: 0 },\n  exit: { opacity: 0, y: -10 }\n};\n\nconst fadeIn: Variants = {\n  initial: { opacity: 0 },\n  animate: { opacity: 1 },\n  exit: { opacity: 0 }\n};\n\nconst scaleIn: Variants = {\n  initial: { opacity: 0, scale: 0.95 },\n  animate: { opacity: 1, scale: 1 },\n  exit: { opacity: 0, scale: 0.95 }\n};\n\nconst slideInRight: Variants = {\n  initial: { opacity: 0, x: 20 },\n  animate: { opacity: 1, x: 0 },\n  exit: { opacity: 0, x: -20 }\n};\n\nconst slideInLeft: Variants = {\n  initial: { opacity: 0, x: -20 },\n  animate: { opacity: 1, x: 0 },\n  exit: { opacity: 0, x: 20 }\n};\n\nexport const pageTransition = {\n  initial: { opacity: 0, y: 8 },\n  animate: { opacity: 1, y: 0 },\n  exit: { opacity: 0, y: -8 },\n  transition: { duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }\n};\n\ninterface PageTransitionProps {\n  children: ReactNode;\n  className?: string;\n}\n\nexport const PageTransition = memo(function PageTransition({ \n  children, \n  className \n}: PageTransitionProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 8 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: -8 }}\n      transition={{ duration: 0.3, ease: [0.25, 0.46, 0.45, 0.94] }}\n      className={className}\n    >\n      {children}\n    </motion.div>\n  );\n});\n\ninterface GlassCardProps extends ComponentPropsWithoutRef<typeof motion.div> {\n  variant?: \"default\" | \"premium\" | \"elevated\";\n  children: ReactNode;\n  className?: string;\n  delay?: number;\n}\n\nexport const GlassCard = memo(forwardRef<HTMLDivElement, GlassCardProps>(\n  function GlassCard({ variant = \"default\", children, className, delay = 0, ...props }, ref) {\n    const baseClasses = \"rounded-3xl p-6 transition-all duration-300\";\n    \n    const variantClasses = {\n      default: \"glass shadow-lg\",\n      premium: \"glass-premium shadow-xl\",\n      elevated: \"glass shadow-2xl hover:shadow-xl\"\n    };\n\n    return (\n      <motion.div\n        ref={ref}\n        initial={{ opacity: 0, y: 20, scale: 0.98 }}\n        animate={{ opacity: 1, y: 0, scale: 1 }}\n        transition={{ \n          duration: 0.4, \n          delay,\n          ease: [0.25, 0.46, 0.45, 0.94] \n        }}\n        whileTap={{ scale: 0.98 }}\n        className={cn(baseClasses, variantClasses[variant], className)}\n        {...props}\n      >\n        {children}\n      </motion.div>\n    );\n  }\n));\n\ninterface AnimatedButtonProps extends ComponentPropsWithoutRef<typeof motion.button> {\n  variant?: \"primary\" | \"secondary\" | \"glass\" | \"ghost\";\n  size?: \"default\" | \"sm\" | \"lg\" | \"icon\";\n  children: ReactNode;\n  className?: string;\n  isLoading?: boolean;\n}\n\nexport const AnimatedButton = memo(forwardRef<HTMLButtonElement, AnimatedButtonProps>(\n  function AnimatedButton({ \n    variant = \"primary\", \n    size = \"default\",\n    children, \n    className,\n    isLoading,\n    disabled,\n    ...props \n  }, ref) {\n    const baseClasses = \"relative font-semibold rounded-2xl transition-all duration-200 flex items-center justify-center gap-2 overflow-hidden\";\n    \n    const variantClasses = {\n      primary: \"gradient-primary text-white shadow-lg shadow-primary/25\",\n      secondary: \"bg-secondary text-secondary-foreground border border-border\",\n      glass: \"glass-button text-foreground\",\n      ghost: \"bg-transparent hover:bg-secondary/50 text-foreground\"\n    };\n    \n    const sizeClasses = {\n      default: \"h-14 px-8 text-base\",\n      sm: \"h-11 px-5 text-sm\",\n      lg: \"h-16 px-10 text-lg\",\n      icon: \"h-12 w-12\"\n    };\n\n    return (\n      <motion.button\n        ref={ref}\n        disabled={disabled || isLoading}\n        whileHover={{ scale: disabled ? 1 : 1.02 }}\n        whileTap={{ scale: disabled ? 1 : 0.96 }}\n        transition={{ duration: 0.15, ease: \"easeOut\" }}\n        className={cn(\n          baseClasses, \n          variantClasses[variant], \n          sizeClasses[size],\n          (disabled || isLoading) && \"opacity-60 cursor-not-allowed\",\n          className\n        )}\n        {...props}\n      >\n        {isLoading ? (\n          <motion.div\n            animate={{ rotate: 360 }}\n            transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n            className=\"w-5 h-5 border-2 border-current border-t-transparent rounded-full\"\n          />\n        ) : children}\n      </motion.button>\n    );\n  }\n));\n\ninterface AnimatedListProps {\n  children: ReactNode[];\n  className?: string;\n  staggerDelay?: number;\n}\n\nexport const AnimatedList = memo(function AnimatedList({ \n  children, \n  className,\n  staggerDelay = 0.05\n}: AnimatedListProps) {\n  return (\n    <motion.div\n      initial=\"initial\"\n      animate=\"animate\"\n      exit=\"exit\"\n      className={className}\n    >\n      <AnimatePresence mode=\"popLayout\">\n        {children.map((child, index) => (\n          <motion.div\n            key={index}\n            variants={fadeInUp}\n            transition={{ \n              duration: 0.3, \n              delay: index * staggerDelay,\n              ease: [0.25, 0.46, 0.45, 0.94]\n            }}\n          >\n            {child}\n          </motion.div>\n        ))}\n      </AnimatePresence>\n    </motion.div>\n  );\n});\n\ninterface AnimatedContainerProps {\n  children: ReactNode;\n  className?: string;\n  animation?: \"fadeIn\" | \"fadeInUp\" | \"scaleIn\" | \"slideInRight\" | \"slideInLeft\";\n  delay?: number;\n  duration?: number;\n}\n\nexport const AnimatedContainer = memo(function AnimatedContainer({ \n  children, \n  className,\n  animation = \"fadeInUp\",\n  delay = 0,\n  duration = 0.4\n}: AnimatedContainerProps) {\n  const animations = {\n    fadeIn,\n    fadeInUp,\n    scaleIn,\n    slideInRight,\n    slideInLeft\n  };\n\n  return (\n    <motion.div\n      variants={animations[animation]}\n      initial=\"initial\"\n      animate=\"animate\"\n      exit=\"exit\"\n      transition={{ \n        duration, \n        delay,\n        ease: [0.25, 0.46, 0.45, 0.94]\n      }}\n      className={className}\n    >\n      {children}\n    </motion.div>\n  );\n});\n\ninterface FloatingLabelInputProps extends ComponentPropsWithoutRef<\"input\"> {\n  label: string;\n  error?: string;\n}\n\nexport const FloatingLabelInput = memo(forwardRef<HTMLInputElement, FloatingLabelInputProps>(\n  function FloatingLabelInput({ label, error, className, ...props }, ref) {\n    return (\n      <motion.div \n        className=\"relative\"\n        initial={{ opacity: 0, y: 10 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3 }}\n      >\n        <input\n          ref={ref}\n          placeholder=\" \"\n          className={cn(\n            \"peer w-full h-16 px-5 pt-5 rounded-2xl glass-input text-foreground placeholder-transparent focus:outline-none focus:ring-2 focus:ring-primary/30 transition-all duration-200\",\n            error && \"border-destructive focus:ring-destructive/30\",\n            className\n          )}\n          {...props}\n        />\n        <label className=\"absolute left-5 top-2 text-xs font-medium text-muted-foreground transition-all duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary\">\n          {label}\n        </label>\n        <AnimatePresence>\n          {error && (\n            <motion.p\n              initial={{ opacity: 0, y: -5 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -5 }}\n              className=\"mt-2 text-xs text-destructive\"\n            >\n              {error}\n            </motion.p>\n          )}\n        </AnimatePresence>\n      </motion.div>\n    );\n  }\n));\n\ninterface SkeletonProps {\n  className?: string;\n}\n\nexport const Skeleton = memo(function Skeleton({ className }: SkeletonProps) {\n  return (\n    <div className={cn(\"rounded-2xl shimmer\", className)} />\n  );\n});\n\ninterface TaskCardSkeletonProps {\n  count?: number;\n}\n\nexport const TaskCardSkeleton = memo(function TaskCardSkeleton({ count = 3 }: TaskCardSkeletonProps) {\n  return (\n    <div className=\"space-y-4\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"glass rounded-3xl p-5 space-y-4\">\n          <div className=\"flex items-center gap-3\">\n            <Skeleton className=\"w-12 h-12 rounded-2xl\" />\n            <div className=\"flex-1 space-y-2\">\n              <Skeleton className=\"h-4 w-3/4\" />\n              <Skeleton className=\"h-3 w-1/2\" />\n            </div>\n          </div>\n          <Skeleton className=\"h-16 w-full\" />\n          <div className=\"flex justify-between\">\n            <Skeleton className=\"h-8 w-20\" />\n            <Skeleton className=\"h-8 w-24\" />\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n});\n\ninterface EmptyStateProps {\n  icon: ReactNode;\n  title: string;\n  description: string;\n  action?: ReactNode;\n}\n\nexport const EmptyState = memo(function EmptyState({ \n  icon, \n  title, \n  description, \n  action \n}: EmptyStateProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      transition={{ duration: 0.4, ease: [0.25, 0.46, 0.45, 0.94] }}\n      className=\"flex flex-col items-center justify-center py-16 px-6 text-center\"\n    >\n      <motion.div\n        initial={{ scale: 0 }}\n        animate={{ scale: 1 }}\n        transition={{ delay: 0.1, type: \"spring\", stiffness: 200 }}\n        className=\"w-20 h-20 rounded-3xl gradient-primary flex items-center justify-center mb-6 shadow-lg shadow-primary/25\"\n      >\n        <div className=\"text-white\">{icon}</div>\n      </motion.div>\n      <h3 className=\"text-xl font-bold text-foreground mb-2\">{title}</h3>\n      <p className=\"text-muted-foreground max-w-xs mb-6\">{description}</p>\n      {action}\n    </motion.div>\n  );\n});\n\ninterface LoadingSpinnerProps {\n  size?: \"sm\" | \"default\" | \"lg\";\n  className?: string;\n}\n\nexport const LoadingSpinner = memo(function LoadingSpinner({ \n  size = \"default\",\n  className \n}: LoadingSpinnerProps) {\n  const sizeClasses = {\n    sm: \"w-4 h-4 border-2\",\n    default: \"w-6 h-6 border-2\",\n    lg: \"w-10 h-10 border-3\"\n  };\n\n  return (\n    <motion.div\n      animate={{ rotate: 360 }}\n      transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n      className={cn(\n        sizeClasses[size],\n        \"border-primary border-t-transparent rounded-full\",\n        className\n      )}\n    />\n  );\n});\n\ninterface FullPageLoaderProps {\n  message?: string;\n}\n\nexport const FullPageLoader = memo(function FullPageLoader({ \n  message = \"Loading...\" \n}: FullPageLoaderProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 flex flex-col items-center justify-center bg-background/80 backdrop-blur-sm z-50\"\n    >\n      <LoadingSpinner size=\"lg\" />\n      <motion.p\n        initial={{ opacity: 0, y: 10 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.2 }}\n        className=\"mt-4 text-muted-foreground\"\n      >\n        {message}\n      </motion.p>\n    </motion.div>\n  );\n});\n\ninterface PullToRefreshProps {\n  onRefresh: () => Promise<void>;\n  children: ReactNode;\n}\n\nexport const PullToRefresh = memo(function PullToRefresh({\n  onRefresh,\n  children\n}: PullToRefreshProps) {\n  return (\n    <div className=\"relative\">\n      {children}\n    </div>\n  );\n});\n\nexport { AnimatePresence };\n","path":null,"size_bytes":11438,"size_tokens":null},"client/src/pages/HomeScreen.tsx":{"content":"import { memo, useMemo } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { useTranslation } from 'react-i18next';\nimport { TaskCard } from '@/components/TaskCard';\nimport { CountUp } from '@/components/CountUp';\nimport { useQuery } from '@tanstack/react-query';\nimport { TaskCardSkeleton, EmptyState } from '@/components/ui/animated';\nimport { Bell, Settings, Wallet, Plus, ArrowRight, TrendingUp, CheckCircle, Search, Sparkles, GraduationCap, HardHat, Inbox, Clock, CheckCircle2, XCircle, Send } from 'lucide-react';\nimport type { TaskWithDetails, User, DirectServiceRequest } from '@shared/schema';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { TASK_CATEGORIES_WITH_SUBS } from '@shared/schema';\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: {\n      staggerChildren: 0.08,\n      delayChildren: 0.1\n    }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 20 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: {\n      type: \"spring\",\n      stiffness: 300,\n      damping: 24\n    }\n  }\n};\n\nconst promoCategoryIds = ['beauty_fashion', 'teaching_education', 'construction'] as const;\n\nconst categoryIcons: Record<string, typeof Sparkles> = {\n  beauty_fashion: Sparkles,\n  teaching_education: GraduationCap,\n  construction: HardHat,\n};\n\nconst HomeScreen = memo(function HomeScreen() {\n  const [, setLocation] = useLocation();\n  const { userRole, user } = useApp();\n  const { t, i18n } = useTranslation();\n\n  const { data: currentUser } = useQuery<User>({\n    queryKey: ['/api/users/me'],\n    enabled: !!localStorage.getItem('userId'),\n  });\n\n  const isAuthenticated = !!localStorage.getItem('userId');\n\n  const { data: tasks, isLoading: tasksLoading } = useQuery<TaskWithDetails[]>({\n    queryKey: ['/api/tasks', userRole === 'tasker' ? 'available' : 'my'],\n    enabled: isAuthenticated,\n  });\n\n  const { data: stats } = useQuery<{ earnings: number; jobsDone: number }>({\n    queryKey: ['/api/stats'],\n    enabled: isAuthenticated && userRole === 'tasker',\n  });\n\n  type DirectRequestWithUsers = DirectServiceRequest & {\n    client: Omit<User, 'password'> | null;\n    tasker: Omit<User, 'password'> | null;\n  };\n\n  const { data: directRequests } = useQuery<DirectRequestWithUsers[]>({\n    queryKey: ['/api/direct-requests'],\n    enabled: isAuthenticated,\n  });\n  \n  const pendingRequestsCount = useMemo(() => \n    directRequests?.filter(r => r.status === 'pending')?.length || 0,\n    [directRequests]\n  );\n\n  const clientDirectRequests = useMemo(() => \n    userRole === 'client' ? (directRequests || []).slice(0, 3) : [],\n    [directRequests, userRole]\n  );\n\n  const displayUser = currentUser || user;\n  const balance = useMemo(() => \n    displayUser?.balance ? parseFloat(String(displayUser.balance)) : 0,\n    [displayUser?.balance]\n  );\n  const recentTasks = useMemo(() => tasks?.slice(0, 3) || [], [tasks]);\n\n  const greeting = useMemo(() => {\n    const hour = new Date().getHours();\n    if (hour < 12) return t('home.greeting.morning');\n    if (hour < 17) return t('home.greeting.afternoon');\n    return t('home.greeting.evening');\n  }, [t]);\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.5, scale: 1 }}\n          transition={{ duration: 1, ease: \"easeOut\" }}\n          className=\"absolute -top-32 -right-32 w-80 h-80 bg-gradient-to-br from-primary/20 to-primary/5 rounded-full blur-3xl rtl:-left-32 rtl:right-auto\"\n        />\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.35, scale: 1 }}\n          transition={{ duration: 1.2, delay: 0.2, ease: \"easeOut\" }}\n          className=\"absolute top-60 -left-24 w-56 h-56 bg-gradient-to-tr from-accent/25 to-accent/5 rounded-full blur-3xl rtl:-right-24 rtl:left-auto\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.2 }}\n          transition={{ duration: 1.5, delay: 0.4 }}\n          className=\"absolute bottom-40 right-10 w-40 h-40 bg-gradient-to-tl from-primary/15 to-transparent rounded-full blur-2xl rtl:left-10 rtl:right-auto\"\n        />\n      </div>\n\n      <motion.div \n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"relative z-10 px-5 py-5\"\n      >\n        <motion.div \n          variants={itemVariants}\n          className=\"flex items-center justify-between mb-8\"\n        >\n          <div>\n            <motion.p \n              initial={{ opacity: 0, x: -10 }}\n              animate={{ opacity: 1, x: 0 }}\n              className=\"text-sm text-muted-foreground font-medium mb-0.5\"\n            >\n              {greeting}\n            </motion.p>\n            <motion.h1 \n              initial={{ opacity: 0, x: -10 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.1 }}\n              className=\"text-2xl font-extrabold text-foreground tracking-tight\"\n            >\n              {displayUser?.name || t('common.guest')}\n            </motion.h1>\n          </div>\n          <div className=\"flex items-center gap-2.5\">\n            {userRole === 'client' && (\n              <motion.button\n                whileHover={{ scale: 1.05 }}\n                whileTap={{ scale: 0.92 }}\n                onClick={() => setLocation('/wallet')}\n                className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass transition-all duration-200\"\n                data-testid=\"button-wallet\"\n              >\n                <Wallet className=\"w-5 h-5 text-foreground/80\" />\n              </motion.button>\n            )}\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.92 }}\n              onClick={() => setLocation('/notifications')}\n              className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass transition-all duration-200\"\n              data-testid=\"button-notifications\"\n            >\n              <Bell className=\"w-5 h-5 text-foreground/80\" />\n            </motion.button>\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.92 }}\n              onClick={() => setLocation('/settings')}\n              className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass transition-all duration-200\"\n              data-testid=\"button-settings\"\n            >\n              <Settings className=\"w-5 h-5 text-foreground/80\" />\n            </motion.button>\n          </div>\n        </motion.div>\n\n        {userRole === 'tasker' ? (\n          <motion.div variants={itemVariants}>\n            <Link href=\"/wallet\">\n              <motion.div \n                whileHover={{ scale: 1.01, y: -2 }}\n                whileTap={{ scale: 0.98 }}\n                className=\"relative overflow-hidden rounded-[28px] mb-6 cursor-pointer\"\n                data-testid=\"card-wallet-balance\"\n              >\n                <div className=\"absolute inset-0 bg-gradient-to-br from-primary via-primary-dark to-primary/90\" />\n                \n                <div className=\"absolute inset-0 opacity-30\">\n                  <div className=\"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/4 blur-2xl rtl:left-0 rtl:right-auto rtl:-translate-x-1/4\" />\n                  <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-accent/20 rounded-full translate-y-1/2 -translate-x-1/4 blur-2xl rtl:right-0 rtl:left-auto rtl:translate-x-1/4\" />\n                </div>\n                \n                <div className=\"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIxIiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9IjAuMDUiLz48L2c+PC9zdmc+')] opacity-60\" />\n                \n                <div className=\"relative p-6\">\n                  <div className=\"flex items-start justify-between mb-5\">\n                    <div>\n                      <p className=\"text-sm text-white/70 font-medium mb-1.5\">{t('home.availableBalance')}</p>\n                      <p className=\"text-[40px] font-extrabold text-white tracking-tight leading-none\">\n                        $<CountUp end={balance} decimals={2} />\n                      </p>\n                    </div>\n                    <motion.div \n                      whileHover={{ rotate: 10 }}\n                      className=\"w-14 h-14 bg-white/15 backdrop-blur-xl rounded-2xl flex items-center justify-center border border-white/20\"\n                    >\n                      <Wallet className=\"w-7 h-7 text-white\" />\n                    </motion.div>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-2 text-sm text-white/80 font-medium\">\n                    <span>{t('home.tapToManageWallet')}</span>\n                    <motion.div\n                      animate={{ x: [0, 4, 0] }}\n                      transition={{ repeat: Infinity, duration: 1.5, ease: \"easeInOut\" }}\n                      className=\"rtl:rotate-180\"\n                    >\n                      <ArrowRight className=\"w-4 h-4\" />\n                    </motion.div>\n                  </div>\n                </div>\n              </motion.div>\n            </Link>\n          </motion.div>\n        ) : (\n          <motion.div variants={itemVariants} className=\"mb-6\">\n            <div className=\"flex overflow-x-auto gap-3 pb-2 -mx-5 px-5 scrollbar-hide\" data-testid=\"carousel-promo-cards\">\n              {promoCategoryIds.map((categoryId, index) => {\n                const category = TASK_CATEGORIES_WITH_SUBS[categoryId];\n                const IconComponent = categoryIcons[categoryId];\n                \n                return (\n                  <Link href=\"/post-task/1\" key={categoryId}>\n                    <motion.div\n                      initial={{ opacity: 0, scale: 0.9 }}\n                      animate={{ opacity: 1, scale: 1 }}\n                      transition={{ delay: index * 0.1, type: \"spring\", stiffness: 300 }}\n                      whileHover={{ scale: 1.05, y: -4 }}\n                      whileTap={{ scale: 0.95 }}\n                      className=\"relative min-w-[140px] h-[160px] rounded-[24px] overflow-hidden cursor-pointer flex-shrink-0\"\n                      style={{\n                        background: `linear-gradient(135deg, ${category.colorHex}20, ${category.colorHex}10)`,\n                      }}\n                      data-testid={`card-promo-${categoryId}`}\n                    >\n                      <div \n                        className=\"absolute inset-0 backdrop-blur-xl\"\n                        style={{\n                          background: `linear-gradient(135deg, ${category.colorHex}30, transparent)`,\n                        }}\n                      />\n                      <div \n                        className=\"absolute inset-0 border rounded-[24px]\"\n                        style={{\n                          borderColor: `${category.colorHex}40`,\n                        }}\n                      />\n                      \n                      <div className=\"absolute top-0 right-0 w-20 h-20 rounded-full blur-2xl opacity-40 rtl:left-0 rtl:right-auto\"\n                        style={{ backgroundColor: category.colorHex }}\n                      />\n                      \n                      <div className=\"relative h-full p-4 flex flex-col justify-between\">\n                        <motion.div \n                          className=\"w-12 h-12 rounded-xl flex items-center justify-center\"\n                          style={{ backgroundColor: `${category.colorHex}30` }}\n                          whileHover={{ rotate: 10 }}\n                        >\n                          <IconComponent \n                            className=\"w-6 h-6\" \n                            style={{ color: category.colorHex }} \n                          />\n                        </motion.div>\n                        \n                        <div>\n                          <p className=\"text-sm font-bold text-foreground leading-tight mb-1\">\n                            {t(`tasks.categories.${categoryId}`)}\n                          </p>\n                          <p className=\"text-[10px] text-muted-foreground font-medium\">\n                            {t('home.promoCards.findExpert')}\n                          </p>\n                        </div>\n                      </div>\n                    </motion.div>\n                  </Link>\n                );\n              })}\n            </div>\n          </motion.div>\n        )}\n\n        {userRole === 'tasker' && (\n          <motion.div \n            variants={itemVariants}\n            className=\"grid grid-cols-2 gap-3 mb-5\"\n          >\n            <motion.div \n              whileHover={{ scale: 1.02, y: -2 }}\n              whileTap={{ scale: 0.98 }}\n              className=\"stat-card\"\n            >\n              <div className=\"w-11 h-11 rounded-xl bg-gradient-to-br from-success/20 to-success/5 flex items-center justify-center mb-3.5\">\n                <TrendingUp className=\"w-5 h-5 text-success\" />\n              </div>\n              <p className=\"text-[28px] font-extrabold text-foreground mb-0.5 tracking-tight\">\n                $<CountUp end={stats?.earnings || 0} decimals={0} />\n              </p>\n              <p className=\"text-xs text-muted-foreground font-medium\">{t('home.totalEarnings')}</p>\n            </motion.div>\n            \n            <motion.div \n              whileHover={{ scale: 1.02, y: -2 }}\n              whileTap={{ scale: 0.98 }}\n              className=\"stat-card\"\n            >\n              <div className=\"w-11 h-11 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center mb-3.5\">\n                <CheckCircle className=\"w-5 h-5 text-primary\" />\n              </div>\n              <p className=\"text-[28px] font-extrabold text-foreground mb-0.5 tracking-tight\">\n                <CountUp end={stats?.jobsDone || 0} decimals={0} />\n              </p>\n              <p className=\"text-xs text-muted-foreground font-medium\">{t('home.jobsCompleted')}</p>\n            </motion.div>\n          </motion.div>\n        )}\n\n        {userRole === 'tasker' && (\n          <motion.div variants={itemVariants}>\n            <Link href=\"/direct-requests\">\n              <motion.div \n                whileHover={{ scale: 1.01, y: -2 }}\n                whileTap={{ scale: 0.98 }}\n                className=\"glass rounded-[20px] p-4 mb-7 cursor-pointer\"\n                data-testid=\"card-direct-requests\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-11 h-11 rounded-xl bg-gradient-to-br from-accent/20 to-accent/5 flex items-center justify-center\">\n                      <Inbox className=\"w-5 h-5 text-accent\" />\n                    </div>\n                    <div>\n                      <p className=\"font-semibold text-foreground\">\n                        {i18n.language === 'ar' ? 'طلبات الخدمة المباشرة' : 'Direct Service Requests'}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {pendingRequestsCount > 0 \n                          ? (i18n.language === 'ar' \n                              ? `${pendingRequestsCount} طلب جديد` \n                              : `${pendingRequestsCount} new request${pendingRequestsCount > 1 ? 's' : ''}`)\n                          : (i18n.language === 'ar' ? 'لا توجد طلبات جديدة' : 'No new requests')}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {pendingRequestsCount > 0 && (\n                      <span className=\"w-6 h-6 rounded-full bg-accent text-white text-xs font-bold flex items-center justify-center\">\n                        {pendingRequestsCount}\n                      </span>\n                    )}\n                    <ArrowRight className=\"w-5 h-5 text-muted-foreground rtl:rotate-180\" />\n                  </div>\n                </div>\n              </motion.div>\n            </Link>\n          </motion.div>\n        )}\n\n        {userRole === 'client' && (\n          <motion.div variants={itemVariants}>\n            <Link href=\"/post-task/1\">\n              <motion.button \n                whileHover={{ scale: 1.02, y: -2 }}\n                whileTap={{ scale: 0.97 }}\n                className=\"w-full relative overflow-hidden rounded-[24px] mb-7\"\n                data-testid=\"button-post-task\"\n              >\n                <div className=\"absolute inset-0 glass-premium\" />\n                <div className=\"absolute inset-0 gradient-border\" />\n                \n                <div className=\"relative flex items-center justify-center gap-3.5 py-4 px-6\">\n                  <motion.div \n                    animate={{ rotate: [0, 10, -10, 0] }}\n                    transition={{ repeat: Infinity, duration: 3, ease: \"easeInOut\" }}\n                    className=\"w-10 h-10 rounded-xl gradient-primary flex items-center justify-center shadow-lg shadow-primary/30\"\n                  >\n                    <Plus className=\"w-5 h-5 text-white\" strokeWidth={2.5} />\n                  </motion.div>\n                  <span className=\"text-base font-bold text-foreground\">{t('home.postNewTask')}</span>\n                  <Sparkles className=\"w-4 h-4 text-primary ms-auto\" />\n                </div>\n              </motion.button>\n            </Link>\n          </motion.div>\n        )}\n\n        {userRole === 'client' && clientDirectRequests.length > 0 && (\n          <>\n            <motion.div \n              variants={itemVariants}\n              className=\"flex items-center justify-between mb-4\"\n            >\n              <h2 className=\"text-lg font-bold text-foreground\">\n                {i18n.language === 'ar' ? 'طلباتي المباشرة' : 'My Direct Requests'}\n              </h2>\n              <Link \n                href=\"/my-direct-requests\"\n                className=\"text-sm text-primary font-semibold flex items-center gap-1.5 hover:gap-2.5 transition-all duration-300\"\n                data-testid=\"link-see-all-direct-requests\"\n              >\n                {t('common.seeAll')}\n                <ArrowRight className=\"w-4 h-4 rtl:rotate-180\" />\n              </Link>\n            </motion.div>\n\n            <motion.div variants={containerVariants} className=\"space-y-3 mb-7\">\n              {clientDirectRequests.map((request, index) => {\n                const statusConfig = {\n                  pending: { \n                    icon: Clock, \n                    color: 'text-warning', \n                    bgColor: 'bg-warning/10',\n                    label: i18n.language === 'ar' ? 'قيد الانتظار' : 'Pending'\n                  },\n                  accepted: { \n                    icon: CheckCircle2, \n                    color: 'text-success', \n                    bgColor: 'bg-success/10',\n                    label: i18n.language === 'ar' ? 'مقبول' : 'Accepted'\n                  },\n                  rejected: { \n                    icon: XCircle, \n                    color: 'text-destructive', \n                    bgColor: 'bg-destructive/10',\n                    label: i18n.language === 'ar' ? 'مرفوض' : 'Rejected'\n                  },\n                  cancelled: { \n                    icon: XCircle, \n                    color: 'text-muted-foreground', \n                    bgColor: 'bg-muted/10',\n                    label: i18n.language === 'ar' ? 'ملغي' : 'Cancelled'\n                  },\n                };\n                const config = statusConfig[request.status as keyof typeof statusConfig] || statusConfig.pending;\n                const StatusIcon = config.icon;\n                const category = TASK_CATEGORIES_WITH_SUBS[request.category as keyof typeof TASK_CATEGORIES_WITH_SUBS];\n\n                const linkHref = request.status === 'accepted' && request.linkedTaskId \n                  ? `/task/${request.linkedTaskId}` \n                  : '/my-direct-requests';\n\n                return (\n                  <motion.div\n                    key={request.id}\n                    variants={itemVariants}\n                    custom={index}\n                  >\n                    <Link href={linkHref}>\n                      <motion.div\n                        whileHover={{ scale: 1.01, y: -2 }}\n                        whileTap={{ scale: 0.98 }}\n                        className=\"glass rounded-[20px] p-4 cursor-pointer\"\n                        data-testid={`card-direct-request-${request.id}`}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          <Avatar className=\"w-12 h-12 border-2 border-white/10\">\n                            <AvatarImage src={request.tasker?.avatar || undefined} />\n                            <AvatarFallback className=\"bg-primary/10 text-primary font-bold\">\n                              {request.tasker?.name?.charAt(0) || 'T'}\n                            </AvatarFallback>\n                          </Avatar>\n                          \n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center justify-between gap-2 mb-1\">\n                              <p className=\"font-bold text-foreground truncate\">\n                                {request.tasker?.name || (i18n.language === 'ar' ? 'منفذ' : 'Tasker')}\n                              </p>\n                              <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${config.bgColor} ${config.color}`}>\n                                <StatusIcon className=\"w-3 h-3\" />\n                                {config.label}\n                              </span>\n                            </div>\n                            \n                            <p className=\"text-sm text-muted-foreground truncate mb-2\">\n                              {request.title}\n                            </p>\n                            \n                            <div className=\"flex items-center gap-3 text-xs text-muted-foreground\">\n                              {category && (\n                                <span \n                                  className=\"px-2 py-0.5 rounded-full\"\n                                  style={{ backgroundColor: `${category.colorHex}20`, color: category.colorHex }}\n                                >\n                                  {i18n.language === 'ar' ? category.nameAr : category.nameEn}\n                                </span>\n                              )}\n                              <span className=\"font-semibold text-primary\">\n                                {request.budget} {i18n.language === 'ar' ? 'ر.س' : 'SAR'}\n                              </span>\n                            </div>\n                          </div>\n                          \n                          <ArrowRight className=\"w-5 h-5 text-muted-foreground flex-shrink-0 rtl:rotate-180\" />\n                        </div>\n                      </motion.div>\n                    </Link>\n                  </motion.div>\n                );\n              })}\n            </motion.div>\n          </>\n        )}\n\n        <motion.div \n          variants={itemVariants}\n          className=\"flex items-center justify-between mb-5\"\n        >\n          <h2 className=\"text-lg font-bold text-foreground\">\n            {userRole === 'tasker' ? t('home.availableTasks') : t('home.yourTasks')}\n          </h2>\n          <Link \n            href={userRole === 'tasker' ? '/tasks-feed' : '/my-tasks'}\n            className=\"text-sm text-primary font-semibold flex items-center gap-1.5 hover:gap-2.5 transition-all duration-300\"\n            data-testid=\"link-see-all-tasks\"\n          >\n            {t('common.seeAll')}\n            <ArrowRight className=\"w-4 h-4 rtl:rotate-180\" />\n          </Link>\n        </motion.div>\n\n        <motion.div \n          variants={containerVariants}\n          className=\"space-y-3\"\n        >\n          <AnimatePresence mode=\"wait\">\n            {tasksLoading ? (\n              <TaskCardSkeleton count={3} />\n            ) : recentTasks.length > 0 ? (\n              recentTasks.map((task, index) => (\n                <motion.div\n                  key={task.id}\n                  variants={itemVariants}\n                  custom={index}\n                >\n                  <TaskCard task={task} index={index} />\n                </motion.div>\n              ))\n            ) : (\n              <motion.div variants={itemVariants}>\n                <EmptyState\n                  icon={userRole === 'tasker' ? <Search className=\"w-8 h-8\" /> : <Plus className=\"w-8 h-8\" />}\n                  title={userRole === 'tasker' ? t('home.noTasksAvailable') : t('home.noTasksYet')}\n                  description={userRole === 'tasker' \n                    ? t('home.checkBackLater') \n                    : t('home.postFirstTask')}\n                  action={\n                    userRole === 'client' && (\n                      <Link href=\"/post-task/1\">\n                        <motion.button\n                          whileHover={{ scale: 1.03 }}\n                          whileTap={{ scale: 0.97 }}\n                          className=\"gradient-primary text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-primary/30 flex items-center gap-2\"\n                        >\n                          <Plus className=\"w-4 h-4\" />\n                          {t('tasks.postTask')}\n                        </motion.button>\n                      </Link>\n                    )\n                  }\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </motion.div>\n      </motion.div>\n    </div>\n  );\n});\n\nexport default HomeScreen;\n","path":null,"size_bytes":26312,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"attached_assets/CountUp_1764551029324.tsx":{"content":"\nimport React, { useEffect, useState } from 'react';\n\ninterface CountUpProps {\n  end: number;\n  duration?: number;\n  decimals?: number;\n  suffix?: string;\n  prefix?: string;\n}\n\nexport const CountUp: React.FC<CountUpProps> = ({ \n  end, \n  duration = 1500, \n  decimals = 2, \n  suffix = '', \n  prefix = '' \n}) => {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    let startTime: number | null = null;\n    let animationFrameId: number;\n\n    const animate = (timestamp: number) => {\n      if (!startTime) startTime = timestamp;\n      const progress = timestamp - startTime;\n      const percentage = Math.min(progress / duration, 1);\n      \n      // Ease out expo\n      const ease = percentage === 1 ? 1 : 1 - Math.pow(2, -10 * percentage);\n      \n      setCount(end * ease);\n\n      if (progress < duration) {\n        animationFrameId = requestAnimationFrame(animate);\n      }\n    };\n\n    animationFrameId = requestAnimationFrame(animate);\n\n    return () => cancelAnimationFrame(animationFrameId);\n  }, [end, duration]);\n\n  const formatted = count.toLocaleString('en-US', {\n    minimumFractionDigits: decimals,\n    maximumFractionDigits: decimals,\n  });\n\n  return <span>{prefix}{formatted}{suffix}</span>;\n};\n","path":null,"size_bytes":1220,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/SplashScreen.tsx":{"content":"import { useTranslation } from 'react-i18next';\nimport appIcon from '@assets/app_icon.png';\n\nexport function SplashScreen() {\n  const { t } = useTranslation();\n  \n  return (\n    <div className=\"fixed inset-0 z-50 flex flex-col items-center justify-center bg-background transition-colors duration-500\">\n      <div className=\"relative flex flex-col items-center\">\n        <div className=\"w-32 h-32 rounded-[2rem] flex items-center justify-center mb-8 animate-pulse-slow relative overflow-hidden shadow-2xl shadow-primary/30\">\n          <img \n            src={appIcon} \n            alt=\"ذروة\" \n            className=\"w-full h-full object-cover\"\n          />\n        </div>\n        \n        <h1 className=\"text-4xl font-extrabold text-foreground tracking-tight animate-fade-in\">\n          {t('welcome.title')}\n        </h1>\n        <p \n          className=\"mt-4 text-muted-foreground font-medium animate-slide-up opacity-0\" \n          style={{ animationDelay: '0.3s', animationFillMode: 'forwards' }}\n        >\n          {t('welcome.subtitle')}\n        </p>\n      </div>\n\n      <div \n        className=\"absolute bottom-12 flex flex-col items-center gap-3 opacity-0 animate-fade-in\" \n        style={{ animationDelay: '0.8s', animationFillMode: 'forwards' }}\n      >\n        <div className=\"w-8 h-8 border-3 border-muted border-t-primary rounded-full animate-spin\"></div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1401,"size_tokens":null},"client/src/components/ProfessionalBadge.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { useTranslation } from \"react-i18next\";\nimport * as Icons from \"lucide-react\";\nimport type { ProfessionalRole } from \"@shared/schema\";\n\ninterface ProfessionalBadgeProps {\n  role: ProfessionalRole;\n  size?: \"sm\" | \"md\" | \"lg\";\n  showIcon?: boolean;\n}\n\nconst iconMap: Record<string, keyof typeof Icons> = {\n  user: \"User\",\n  sparkles: \"Sparkles\",\n  scissors: \"Scissors\",\n  shirt: \"Shirt\",\n  \"book-open\": \"BookOpen\",\n  languages: \"Languages\",\n  hand: \"Hand\",\n  pencil: \"Pencil\",\n  paintbrush: \"Paintbrush\",\n  camera: \"Camera\",\n  monitor: \"Monitor\",\n  hammer: \"Hammer\",\n  wrench: \"Wrench\",\n  zap: \"Zap\",\n  droplet: \"Droplet\",\n  package: \"Package\",\n  truck: \"Truck\",\n  car: \"Car\",\n};\n\nexport function ProfessionalBadge({ role, size = \"md\", showIcon = true }: ProfessionalBadgeProps) {\n  const { i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n  \n  const sizeClasses = {\n    sm: \"px-2 py-0.5 text-[10px]\",\n    md: \"px-3 py-1 text-xs\",\n    lg: \"px-4 py-1.5 text-sm\",\n  };\n  \n  const iconSizes = {\n    sm: 10,\n    md: 12,\n    lg: 14,\n  };\n  \n  const IconComponent = role.icon && iconMap[role.icon] \n    ? (Icons[iconMap[role.icon]] as React.ComponentType<{ size: number; className?: string }>)\n    : null;\n  \n  const name = isArabic ? role.nameAr : role.nameEn;\n  \n  return (\n    <motion.span\n      initial={{ scale: 0.9, opacity: 0 }}\n      animate={{ scale: 1, opacity: 1 }}\n      className={`\n        inline-flex items-center gap-1 font-semibold rounded-full\n        backdrop-blur-md border border-white/20\n        ${sizeClasses[size]}\n      `}\n      style={{\n        backgroundColor: `${role.colorHex}20`,\n        color: role.colorHex,\n        borderColor: `${role.colorHex}30`,\n      }}\n      data-testid={`badge-professional-${role.slug}`}\n    >\n      {showIcon && IconComponent && (\n        <IconComponent size={iconSizes[size]} className=\"shrink-0\" />\n      )}\n      <span className=\"whitespace-nowrap\">{name}</span>\n    </motion.span>\n  );\n}\n\ninterface ProfessionalBadgeListProps {\n  roles: (ProfessionalRole | { role: ProfessionalRole })[];\n  size?: \"sm\" | \"md\" | \"lg\";\n  maxDisplay?: number;\n}\n\nexport function ProfessionalBadgeList({ roles, size = \"md\", maxDisplay = 3 }: ProfessionalBadgeListProps) {\n  const displayRoles = roles.slice(0, maxDisplay);\n  const remaining = roles.length - maxDisplay;\n  \n  const getRoleData = (item: ProfessionalRole | { role: ProfessionalRole }): ProfessionalRole => {\n    if (\"role\" in item) {\n      return item.role;\n    }\n    return item;\n  };\n  \n  return (\n    <div className=\"flex flex-wrap gap-2\" data-testid=\"list-professional-badges\">\n      {displayRoles.map((item) => {\n        const role = getRoleData(item);\n        return (\n          <ProfessionalBadge key={role.id} role={role} size={size} />\n        );\n      })}\n      {remaining > 0 && (\n        <span \n          className={`\n            inline-flex items-center justify-center font-medium rounded-full\n            bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300\n            ${size === \"sm\" ? \"px-2 py-0.5 text-[10px]\" : size === \"md\" ? \"px-3 py-1 text-xs\" : \"px-4 py-1.5 text-sm\"}\n          `}\n          data-testid=\"badge-professional-more\"\n        >\n          +{remaining}\n        </span>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":3305,"size_tokens":null},"client/src/pages/HelpScreen.tsx":{"content":"import { memo, useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { \n  ArrowLeft, ChevronDown, MessageCircle, Phone, Mail, \n  HelpCircle, Wallet, Shield, Users, ClipboardList, Star\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface FAQItem {\n  question: string;\n  answer: string;\n  icon: typeof HelpCircle;\n}\n\nconst HelpScreen = memo(function HelpScreen() {\n  const { t } = useTranslation();\n  const [expandedIndex, setExpandedIndex] = useState<number | null>(null);\n\n  const faqItems: FAQItem[] = [\n    {\n      question: t('help.faq.howToPost.question'),\n      answer: t('help.faq.howToPost.answer'),\n      icon: ClipboardList\n    },\n    {\n      question: t('help.faq.howToEarn.question'),\n      answer: t('help.faq.howToEarn.answer'),\n      icon: Wallet\n    },\n    {\n      question: t('help.faq.platformFee.question'),\n      answer: t('help.faq.platformFee.answer'),\n      icon: Wallet\n    },\n    {\n      question: t('help.faq.howToSwitch.question'),\n      answer: t('help.faq.howToSwitch.answer'),\n      icon: Users\n    },\n    {\n      question: t('help.faq.verification.question'),\n      answer: t('help.faq.verification.answer'),\n      icon: Shield\n    },\n    {\n      question: t('help.faq.rating.question'),\n      answer: t('help.faq.rating.answer'),\n      icon: Star\n    },\n  ];\n\n  const contactMethods = [\n    {\n      icon: MessageCircle,\n      title: t('help.contact.whatsapp'),\n      subtitle: '+966 50 000 0000',\n      color: 'bg-success/15 text-success',\n      action: () => window.open('https://wa.me/966500000000', '_blank')\n    },\n    {\n      icon: Mail,\n      title: t('help.contact.email'),\n      subtitle: 'support@tharwa.app',\n      color: 'bg-primary/15 text-primary',\n      action: () => window.location.href = 'mailto:support@tharwa.app'\n    },\n    {\n      icon: Phone,\n      title: t('help.contact.phone'),\n      subtitle: '+966 11 000 0000',\n      color: 'bg-accent/15 text-accent',\n      action: () => window.location.href = 'tel:+966110000000'\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-40 -right-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl rtl:-left-20 rtl:right-auto\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center gap-4 mb-8\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => window.history.back()}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5 rtl:rotate-180\" />\n          </motion.button>\n          <h1 className=\"text-2xl font-extrabold text-foreground\">{t('help.title')}</h1>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n          className=\"mb-8\"\n        >\n          <h2 className=\"text-xs font-bold text-muted-foreground uppercase tracking-widest mb-4 px-1\">\n            {t('help.contactUs')}\n          </h2>\n          <div className=\"space-y-3\">\n            {contactMethods.map((method, index) => {\n              const Icon = method.icon;\n              return (\n                <motion.button\n                  key={method.title}\n                  initial={{ opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ delay: 0.1 + index * 0.05 }}\n                  onClick={method.action}\n                  className=\"w-full glass rounded-2xl p-4 flex items-center gap-4 text-start\"\n                  data-testid={`button-contact-${index}`}\n                >\n                  <div className={cn(\"w-12 h-12 rounded-2xl flex items-center justify-center\", method.color)}>\n                    <Icon className=\"w-5 h-5\" />\n                  </div>\n                  <div>\n                    <p className=\"font-bold text-foreground\">{method.title}</p>\n                    <p className=\"text-sm text-muted-foreground\">{method.subtitle}</p>\n                  </div>\n                </motion.button>\n              );\n            })}\n          </div>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n        >\n          <h2 className=\"text-xs font-bold text-muted-foreground uppercase tracking-widest mb-4 px-1\">\n            {t('help.faqTitle')}\n          </h2>\n          <div className=\"space-y-3\">\n            {faqItems.map((item, index) => {\n              const Icon = item.icon;\n              const isExpanded = expandedIndex === index;\n              \n              return (\n                <motion.div\n                  key={index}\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.2 + index * 0.05 }}\n                  className=\"glass rounded-2xl overflow-hidden\"\n                >\n                  <button\n                    onClick={() => setExpandedIndex(isExpanded ? null : index)}\n                    className=\"w-full p-4 flex items-center justify-between text-start\"\n                    data-testid={`button-faq-${index}`}\n                  >\n                    <div className=\"flex items-center gap-3 flex-1\">\n                      <div className=\"w-10 h-10 rounded-xl bg-primary/15 flex items-center justify-center flex-shrink-0\">\n                        <Icon className=\"w-4 h-4 text-primary\" />\n                      </div>\n                      <span className=\"font-semibold text-foreground text-sm\">{item.question}</span>\n                    </div>\n                    <motion.div\n                      animate={{ rotate: isExpanded ? 180 : 0 }}\n                      transition={{ duration: 0.2 }}\n                    >\n                      <ChevronDown className=\"w-5 h-5 text-muted-foreground flex-shrink-0 ms-2\" />\n                    </motion.div>\n                  </button>\n                  \n                  <AnimatePresence>\n                    {isExpanded && (\n                      <motion.div\n                        initial={{ height: 0, opacity: 0 }}\n                        animate={{ height: 'auto', opacity: 1 }}\n                        exit={{ height: 0, opacity: 0 }}\n                        transition={{ duration: 0.2 }}\n                        className=\"overflow-hidden\"\n                      >\n                        <div className=\"px-4 pb-4 pt-0\">\n                          <div className=\"p-4 bg-muted/50 rounded-xl\">\n                            <p className=\"text-sm text-muted-foreground leading-relaxed\">{item.answer}</p>\n                          </div>\n                        </div>\n                      </motion.div>\n                    )}\n                  </AnimatePresence>\n                </motion.div>\n              );\n            })}\n          </div>\n        </motion.div>\n      </div>\n    </div>\n  );\n});\n\nexport default HelpScreen;\n","path":null,"size_bytes":7493,"size_tokens":null},"client/src/components/ComingSoon.tsx":{"content":"import { memo } from 'react';\nimport { motion } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { MapPin, Bell, Clock } from 'lucide-react';\nimport Logo from './Logo';\n\ninterface ComingSoonProps {\n  onNotifyMe?: () => void;\n}\n\nconst ComingSoon = memo(function ComingSoon({ onNotifyMe }: ComingSoonProps) {\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-background via-background to-primary/5 pt-safe\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.5 }}\n          transition={{ duration: 1.5 }}\n          className=\"absolute top-20 -right-20 w-64 h-64 bg-primary/20 rounded-full blur-3xl rtl:-left-20 rtl:right-auto\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          transition={{ duration: 1.5, delay: 0.3 }}\n          className=\"absolute bottom-40 -left-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl rtl:-right-20 rtl:left-auto\"\n        />\n      </div>\n\n      <div className=\"flex-1 flex flex-col items-center justify-center px-8 relative z-10\">\n        <motion.div \n          initial={{ scale: 0, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          transition={{ \n            type: \"spring\",\n            stiffness: 200,\n            damping: 20,\n            delay: 0.1 \n          }}\n          className=\"relative mb-10\"\n        >\n          <div className=\"w-28 h-28 rounded-[2rem] glass flex items-center justify-center shadow-2xl shadow-primary/30 border border-white/20\">\n            <Logo size={64} />\n          </div>\n          <motion.div\n            animate={{ \n              scale: [1, 1.2, 1],\n              opacity: [0.5, 0.8, 0.5]\n            }}\n            transition={{ \n              duration: 2,\n              repeat: Infinity,\n              ease: \"easeInOut\"\n            }}\n            className=\"absolute inset-0 rounded-[2rem] bg-primary/20 blur-xl -z-10\"\n          />\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3, duration: 0.5 }}\n          className=\"text-center max-w-sm\"\n        >\n          <div className=\"flex items-center justify-center gap-2 mb-4\">\n            <Clock className=\"w-6 h-6 text-accent\" />\n            <span className=\"text-accent font-semibold text-lg\">{t('location.comingSoon')}</span>\n          </div>\n          \n          <h1 className=\"text-4xl font-extrabold tracking-tight mb-4 gradient-text\">\n            {t('welcome.title')}\n          </h1>\n          \n          <p className=\"text-lg text-muted-foreground leading-relaxed mb-6\">\n            {t('location.comingSoonDesc')}\n          </p>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 30 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.5, duration: 0.5 }}\n          className=\"glass rounded-2xl p-6 max-w-sm w-full\"\n        >\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"w-10 h-10 rounded-xl bg-success/20 flex items-center justify-center\">\n              <MapPin className=\"w-5 h-5 text-success\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">{t('location.currentlyAvailable')}</p>\n              <p className=\"font-bold text-foreground\">{t('location.riyadh')}</p>\n            </div>\n          </div>\n          \n          <div className=\"h-px bg-border my-4\" />\n          \n          <p className=\"text-sm text-muted-foreground text-center\">\n            {t('location.expandingSoon')}\n          </p>\n        </motion.div>\n      </div>\n\n      <motion.div\n        initial={{ opacity: 0, y: 40 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.7, duration: 0.5 }}\n        className=\"px-8 pb-12 pb-safe\"\n      >\n        <motion.button \n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n          onClick={onNotifyMe}\n          className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-lg shadow-xl shadow-primary/25 transition-all flex items-center justify-center gap-2\"\n          data-testid=\"button-notify-me\"\n        >\n          <Bell className=\"w-5 h-5\" />\n          {t('location.notifyMe')}\n        </motion.button>\n      </motion.div>\n    </div>\n  );\n});\n\nexport default ComingSoon;\n","path":null,"size_bytes":4514,"size_tokens":null},"client/src/pages/PaymentScreen.tsx":{"content":"import { useState, useEffect, useCallback, memo } from 'react';\nimport { useParams, useLocation } from 'wouter';\nimport { motion } from 'framer-motion';\nimport { loadStripe, Stripe } from '@stripe/stripe-js';\nimport { Elements, PaymentElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { useTranslation } from 'react-i18next';\nimport { Skeleton } from '@/components/ui/animated';\nimport { cn } from '@/lib/utils';\nimport { \n  ArrowLeft, CreditCard, Shield, CheckCircle, \n  AlertCircle, Loader2, DollarSign, User, Percent\n} from 'lucide-react';\nimport type { TaskWithDetails } from '@shared/schema';\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: { staggerChildren: 0.06, delayChildren: 0.1 }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 16 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 }\n  }\n};\n\ninterface PaymentIntentResponse {\n  clientSecret: string;\n  publishableKey: string;\n  amount: number;\n}\n\ninterface PaymentFormProps {\n  taskId: string;\n  task: TaskWithDetails;\n  amount: number;\n  onSuccess: () => void;\n}\n\nconst PaymentForm = memo(function PaymentForm({ taskId, task, amount, onSuccess }: PaymentFormProps) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [paymentError, setPaymentError] = useState<string | null>(null);\n\n  const platformFee = amount * 0.05;\n  const taskerPayout = amount - platformFee;\n\n  const formatCurrency = useCallback((value: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(value);\n  }, []);\n\n  const confirmPaymentMutation = useMutation({\n    mutationFn: async (paymentIntentId: string) => {\n      return apiRequest('POST', '/api/payments/confirm', {\n        taskId,\n        paymentIntentId,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: isArabic ? 'تم الدفع بنجاح!' : 'Payment successful!',\n        description: isArabic ? 'تم إتمام المهمة والدفع للمنفذ' : 'Task completed and payment sent to tasker',\n      });\n      onSuccess();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: isArabic ? 'فشل التأكيد' : 'Confirmation failed',\n        description: error.message,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsProcessing(true);\n    setPaymentError(null);\n\n    try {\n      const { error, paymentIntent } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: window.location.origin + `/task/${taskId}`,\n        },\n        redirect: 'if_required',\n      });\n\n      if (error) {\n        setPaymentError(error.message || (isArabic ? 'حدث خطأ في الدفع' : 'Payment failed'));\n        toast({\n          title: isArabic ? 'فشل الدفع' : 'Payment failed',\n          description: error.message,\n          variant: 'destructive',\n        });\n      } else if (paymentIntent && paymentIntent.status === 'succeeded') {\n        confirmPaymentMutation.mutate(paymentIntent.id);\n      }\n    } catch (err: any) {\n      setPaymentError(err.message || (isArabic ? 'حدث خطأ غير متوقع' : 'An unexpected error occurred'));\n      toast({\n        title: isArabic ? 'خطأ' : 'Error',\n        description: err.message,\n        variant: 'destructive',\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <motion.div variants={itemVariants} className=\"glass-premium rounded-[24px] p-6\">\n        <div className=\"flex items-center gap-3 mb-5\">\n          <div className=\"w-11 h-11 rounded-2xl gradient-primary flex items-center justify-center shadow-lg shadow-primary/30\">\n            <CreditCard className=\"w-5 h-5 text-white\" />\n          </div>\n          <div>\n            <h3 className=\"font-bold text-foreground\" data-testid=\"text-payment-title\">\n              {isArabic ? 'تفاصيل الدفع' : 'Payment Details'}\n            </h3>\n            <p className=\"text-xs text-muted-foreground\">\n              {isArabic ? 'أدخل بيانات البطاقة' : 'Enter your card information'}\n            </p>\n          </div>\n        </div>\n\n        <div className=\"bg-white/50 dark:bg-white/[0.06] rounded-2xl p-4\" data-testid=\"container-stripe-elements\">\n          <PaymentElement \n            options={{\n              layout: 'tabs',\n            }}\n          />\n        </div>\n\n        {paymentError && (\n          <motion.div \n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"mt-4 flex items-center gap-2 text-destructive text-sm bg-destructive/10 rounded-xl p-3\"\n            data-testid=\"text-payment-error\"\n          >\n            <AlertCircle className=\"w-4 h-4 flex-shrink-0\" />\n            <span>{paymentError}</span>\n          </motion.div>\n        )}\n      </motion.div>\n\n      <motion.div variants={itemVariants} className=\"glass rounded-[24px] p-5\">\n        <p className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-4\">\n          {isArabic ? 'ملخص الدفع' : 'Payment Summary'}\n        </p>\n        \n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-muted-foreground text-sm\">{isArabic ? 'اسم المهمة' : 'Task'}</span>\n            <span className=\"font-semibold text-foreground text-sm truncate max-w-[200px]\" data-testid=\"text-task-title\">\n              {task.title}\n            </span>\n          </div>\n          \n          <div className=\"h-px bg-border/50\" />\n          \n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <DollarSign className=\"w-4 h-4 text-muted-foreground\" />\n              <span className=\"text-muted-foreground text-sm\">{isArabic ? 'المبلغ الإجمالي' : 'Total Amount'}</span>\n            </div>\n            <span className=\"font-bold text-foreground\" data-testid=\"text-total-amount\">{formatCurrency(amount)}</span>\n          </div>\n          \n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <Percent className=\"w-4 h-4 text-muted-foreground\" />\n              <span className=\"text-muted-foreground text-sm\">{isArabic ? 'رسوم المنصة (5%)' : 'Platform Fee (5%)'}</span>\n            </div>\n            <span className=\"text-muted-foreground text-sm\" data-testid=\"text-platform-fee\">{formatCurrency(platformFee)}</span>\n          </div>\n          \n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <User className=\"w-4 h-4 text-muted-foreground\" />\n              <span className=\"text-muted-foreground text-sm\">{isArabic ? 'أرباح المنفذ' : 'Tasker Payout'}</span>\n            </div>\n            <span className=\"text-success font-semibold\" data-testid=\"text-tasker-payout\">{formatCurrency(taskerPayout)}</span>\n          </div>\n        </div>\n      </motion.div>\n\n      <motion.div variants={itemVariants} className=\"flex items-center gap-2 px-2\">\n        <Shield className=\"w-4 h-4 text-muted-foreground\" />\n        <p className=\"text-xs text-muted-foreground\">\n          {isArabic \n            ? 'جميع المعاملات مشفرة ومحمية بواسطة Stripe' \n            : 'All transactions are encrypted and secured by Stripe'}\n        </p>\n      </motion.div>\n\n      <motion.button\n        variants={itemVariants}\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n        type=\"submit\"\n        disabled={!stripe || isProcessing || confirmPaymentMutation.isPending}\n        className=\"w-full h-14 gradient-primary text-white rounded-2xl font-bold text-base shadow-xl shadow-primary/30 disabled:opacity-50 flex items-center justify-center gap-2.5\"\n        data-testid=\"button-pay\"\n      >\n        {isProcessing || confirmPaymentMutation.isPending ? (\n          <>\n            <Loader2 className=\"w-5 h-5 animate-spin\" />\n            {isArabic ? 'جاري الدفع...' : 'Processing...'}\n          </>\n        ) : (\n          <>\n            <CreditCard className=\"w-5 h-5\" />\n            {isArabic ? `ادفع ${formatCurrency(amount)}` : `Pay ${formatCurrency(amount)}`}\n          </>\n        )}\n      </motion.button>\n    </form>\n  );\n});\n\nconst PaymentScreen = memo(function PaymentScreen() {\n  const { id } = useParams<{ id: string }>();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  \n  const [stripePromise, setStripePromise] = useState<Promise<Stripe | null> | null>(null);\n\n  const { data: task, isLoading: taskLoading } = useQuery<TaskWithDetails>({\n    queryKey: ['/api/tasks', id],\n  });\n\n  const { data: paymentIntent, isLoading: paymentLoading, error: paymentError } = useQuery<PaymentIntentResponse>({\n    queryKey: ['/api/payments/create-intent', id],\n    queryFn: async () => {\n      const res = await apiRequest('POST', '/api/payments/create-intent', { taskId: id });\n      return res.json();\n    },\n    enabled: !!task && task.status === 'in_progress',\n  });\n\n  useEffect(() => {\n    if (paymentIntent?.publishableKey && !stripePromise) {\n      setStripePromise(loadStripe(paymentIntent.publishableKey));\n    }\n  }, [paymentIntent?.publishableKey, stripePromise]);\n\n  const handleBack = useCallback(() => {\n    window.history.back();\n  }, []);\n\n  const handleSuccess = useCallback(() => {\n    setLocation(`/task/${id}`);\n  }, [id, setLocation]);\n\n  if (taskLoading || paymentLoading) {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe px-5 py-5\" dir={isArabic ? 'rtl' : 'ltr'}>\n        <div className=\"flex items-center gap-3 mb-6\">\n          <Skeleton className=\"h-11 w-11 rounded-2xl\" />\n          <Skeleton className=\"h-6 w-32 rounded-lg\" />\n        </div>\n        <Skeleton className=\"h-48 w-full rounded-3xl mb-5\" />\n        <Skeleton className=\"h-32 w-full rounded-2xl mb-5\" />\n        <Skeleton className=\"h-14 w-full rounded-2xl\" />\n      </div>\n    );\n  }\n\n  if (!task) {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe flex items-center justify-center px-5\" dir={isArabic ? 'rtl' : 'ltr'}>\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"text-center glass-premium rounded-3xl p-8\"\n        >\n          <div className=\"w-16 h-16 rounded-2xl bg-destructive/15 flex items-center justify-center mx-auto mb-5\">\n            <AlertCircle className=\"w-8 h-8 text-destructive\" />\n          </div>\n          <h3 className=\"text-xl font-bold text-foreground mb-2\" data-testid=\"text-task-not-found\">\n            {isArabic ? 'المهمة غير موجودة' : 'Task not found'}\n          </h3>\n          <p className=\"text-muted-foreground mb-6 text-sm\">\n            {isArabic ? 'قد تكون هذه المهمة محذوفة' : 'This task may have been removed'}\n          </p>\n          <motion.button\n            whileHover={{ scale: 1.03 }}\n            whileTap={{ scale: 0.97 }}\n            onClick={() => setLocation('/home')}\n            className=\"gradient-primary text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-primary/25\"\n            data-testid=\"button-go-home\"\n          >\n            {isArabic ? 'العودة للرئيسية' : 'Go back home'}\n          </motion.button>\n        </motion.div>\n      </div>\n    );\n  }\n\n  if (task.status !== 'in_progress') {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe flex items-center justify-center px-5\" dir={isArabic ? 'rtl' : 'ltr'}>\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"text-center glass-premium rounded-3xl p-8\"\n        >\n          <div className=\"w-16 h-16 rounded-2xl bg-warning/15 flex items-center justify-center mx-auto mb-5\">\n            <AlertCircle className=\"w-8 h-8 text-warning\" />\n          </div>\n          <h3 className=\"text-xl font-bold text-foreground mb-2\" data-testid=\"text-payment-unavailable\">\n            {isArabic ? 'الدفع غير متاح' : 'Payment not available'}\n          </h3>\n          <p className=\"text-muted-foreground mb-6 text-sm\">\n            {isArabic \n              ? 'يجب أن يطلب المنفذ إتمام المهمة قبل الدفع' \n              : 'The tasker must mark the task as complete before payment'}\n          </p>\n          <motion.button\n            whileHover={{ scale: 1.03 }}\n            whileTap={{ scale: 0.97 }}\n            onClick={() => setLocation(`/task/${id}`)}\n            className=\"gradient-primary text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-primary/25\"\n            data-testid=\"button-back-to-task\"\n          >\n            {isArabic ? 'العودة للمهمة' : 'Back to task'}\n          </motion.button>\n        </motion.div>\n      </div>\n    );\n  }\n\n  if (paymentError) {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe flex items-center justify-center px-5\" dir={isArabic ? 'rtl' : 'ltr'}>\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"text-center glass-premium rounded-3xl p-8\"\n        >\n          <div className=\"w-16 h-16 rounded-2xl bg-destructive/15 flex items-center justify-center mx-auto mb-5\">\n            <AlertCircle className=\"w-8 h-8 text-destructive\" />\n          </div>\n          <h3 className=\"text-xl font-bold text-foreground mb-2\" data-testid=\"text-payment-error-title\">\n            {isArabic ? 'خطأ في الدفع' : 'Payment Error'}\n          </h3>\n          <p className=\"text-muted-foreground mb-6 text-sm\">\n            {isArabic ? 'تعذر إنشاء جلسة الدفع' : 'Could not create payment session'}\n          </p>\n          <motion.button\n            whileHover={{ scale: 1.03 }}\n            whileTap={{ scale: 0.97 }}\n            onClick={() => window.location.reload()}\n            className=\"gradient-primary text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-primary/25\"\n            data-testid=\"button-try-again\"\n          >\n            {isArabic ? 'حاول مرة أخرى' : 'Try again'}\n          </motion.button>\n        </motion.div>\n      </div>\n    );\n  }\n\n  if (!paymentIntent || !stripePromise) {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe px-5 py-5\" dir={isArabic ? 'rtl' : 'ltr'}>\n        <div className=\"flex items-center gap-3 mb-6\">\n          <Skeleton className=\"h-11 w-11 rounded-2xl\" />\n          <Skeleton className=\"h-6 w-32 rounded-lg\" />\n        </div>\n        <Skeleton className=\"h-48 w-full rounded-3xl mb-5\" />\n        <Skeleton className=\"h-32 w-full rounded-2xl mb-5\" />\n        <Skeleton className=\"h-14 w-full rounded-2xl\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\" dir={isArabic ? 'rtl' : 'ltr'}>\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.4, scale: 1 }}\n          transition={{ duration: 1 }}\n          className=\"absolute top-20 -right-24 w-72 h-72 bg-gradient-to-br from-primary/20 to-primary/5 rounded-full blur-3xl\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.25 }}\n          transition={{ delay: 0.3 }}\n          className=\"absolute bottom-40 -left-16 w-48 h-48 bg-gradient-to-tr from-accent/20 to-transparent rounded-full blur-3xl\"\n        />\n      </div>\n\n      <motion.div \n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"relative z-10 px-5 py-5\"\n      >\n        <motion.div \n          variants={itemVariants}\n          className=\"flex items-center justify-between mb-6\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.92 }}\n            onClick={handleBack}\n            className={cn(\n              \"w-11 h-11 flex items-center justify-center rounded-2xl glass\",\n              isArabic && \"order-last\"\n            )}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className={cn(\"w-5 h-5 text-foreground/80\", isArabic && \"rotate-180\")} />\n          </motion.button>\n          \n          <h1 className=\"text-xl font-bold text-foreground\" data-testid=\"text-page-title\">\n            {isArabic ? 'إتمام الدفع' : 'Complete Payment'}\n          </h1>\n\n          <div className=\"w-11\" />\n        </motion.div>\n\n        <motion.div variants={itemVariants} className=\"relative overflow-hidden rounded-[24px] mb-6\">\n          <div className=\"absolute inset-0 glass-ultra\" />\n          <div className=\"absolute inset-0 gradient-border\" />\n          \n          <div className=\"relative p-6 text-center\">\n            <div className=\"w-16 h-16 rounded-2xl gradient-primary flex items-center justify-center mx-auto mb-4 shadow-lg shadow-primary/30\">\n              <CheckCircle className=\"w-8 h-8 text-white\" />\n            </div>\n            <h2 className=\"text-lg font-bold text-foreground mb-2\" data-testid=\"text-completion-header\">\n              {isArabic ? 'المنفذ أتم المهمة' : 'Tasker Completed Task'}\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">\n              {isArabic \n                ? 'قم بالدفع لتأكيد إتمام المهمة وتحويل الأرباح للمنفذ'\n                : 'Complete payment to confirm task completion and release payment to tasker'}\n            </p>\n          </div>\n        </motion.div>\n\n        <Elements \n          stripe={stripePromise} \n          options={{\n            clientSecret: paymentIntent.clientSecret,\n            appearance: {\n              theme: 'stripe',\n              variables: {\n                colorPrimary: '#3b5bff',\n                colorBackground: 'rgba(255, 255, 255, 0.8)',\n                colorText: '#1a1a2e',\n                colorDanger: '#dc2626',\n                fontFamily: '\"Cairo\", -apple-system, BlinkMacSystemFont, sans-serif',\n                borderRadius: '12px',\n              },\n            },\n            locale: isArabic ? 'ar' : 'en',\n          }}\n        >\n          <PaymentForm \n            taskId={id!} \n            task={task} \n            amount={paymentIntent.amount}\n            onSuccess={handleSuccess}\n          />\n        </Elements>\n      </motion.div>\n    </div>\n  );\n});\n\nexport default PaymentScreen;\n","path":null,"size_bytes":19335,"size_tokens":null},"server/stripeClient.ts":{"content":"import Stripe from 'stripe';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? 'depl ' + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  const connectorName = 'stripe';\n  const isProduction = process.env.REPLIT_DEPLOYMENT === '1';\n  const targetEnvironment = isProduction ? 'production' : 'development';\n\n  const url = new URL(`https://${hostname}/api/v2/connection`);\n  url.searchParams.set('include_secrets', 'true');\n  url.searchParams.set('connector_names', connectorName);\n  url.searchParams.set('environment', targetEnvironment);\n\n  const response = await fetch(url.toString(), {\n    headers: {\n      'Accept': 'application/json',\n      'X_REPLIT_TOKEN': xReplitToken\n    }\n  });\n\n  const data = await response.json();\n  \n  connectionSettings = data.items?.[0];\n\n  if (!connectionSettings || (!connectionSettings.settings.publishable || !connectionSettings.settings.secret)) {\n    throw new Error(`Stripe ${targetEnvironment} connection not found`);\n  }\n\n  return {\n    publishableKey: connectionSettings.settings.publishable,\n    secretKey: connectionSettings.settings.secret,\n  };\n}\n\nexport async function getUncachableStripeClient() {\n  const { secretKey } = await getCredentials();\n\n  return new Stripe(secretKey, {\n    apiVersion: '2025-08-27.basil',\n  });\n}\n\nexport async function getStripePublishableKey() {\n  const { publishableKey } = await getCredentials();\n  return publishableKey;\n}\n\nexport async function getStripeSecretKey() {\n  const { secretKey } = await getCredentials();\n  return secretKey;\n}\n\nlet stripeSync: any = null;\n\nexport async function getStripeSync() {\n  if (!stripeSync) {\n    const { StripeSync } = await import('stripe-replit-sync');\n    const secretKey = await getStripeSecretKey();\n\n    stripeSync = new StripeSync({\n      poolConfig: {\n        connectionString: process.env.DATABASE_URL!,\n        max: 2,\n      },\n      stripeSecretKey: secretKey,\n    });\n  }\n  return stripeSync;\n}\n","path":null,"size_bytes":2220,"size_tokens":null},"client/src/pages/TaskerTypeScreen.tsx":{"content":"import { useState, memo, useCallback, useRef } from 'react';\nimport { useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useMutation } from '@tanstack/react-query';\nimport { cn } from '@/lib/utils';\nimport { useApp } from '@/context/AppContext';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { ArrowLeft, Briefcase, Award, Check, ChevronLeft, Zap, Clock, FileCheck, Shield, Upload, Loader2, X } from 'lucide-react';\n\ntype TaskerType = 'general' | 'specialized';\n\ninterface TaskerTypeOption {\n  id: TaskerType;\n  titleKey: string;\n  subtitleKey: string;\n  icon: typeof Briefcase;\n  featuresKeys: string[];\n  gradient: string;\n  badgeKey: string;\n  badgeColor: string;\n}\n\nconst taskerTypes: TaskerTypeOption[] = [\n  {\n    id: 'general',\n    titleKey: 'taskerType.general.title',\n    subtitleKey: 'taskerType.general.subtitle',\n    icon: Briefcase,\n    featuresKeys: [\n      'taskerType.general.features.anyTask',\n      'taskerType.general.features.noCertificate',\n      'taskerType.general.features.immediateActivation',\n    ],\n    gradient: 'from-emerald-500 to-teal-500',\n    badgeKey: 'taskerType.general.badge',\n    badgeColor: 'bg-emerald-500/20 text-emerald-600 dark:text-emerald-400',\n  },\n  {\n    id: 'specialized',\n    titleKey: 'taskerType.specialized.title',\n    subtitleKey: 'taskerType.specialized.subtitle',\n    icon: Award,\n    featuresKeys: [\n      'taskerType.specialized.features.professional',\n      'taskerType.specialized.features.uploadCertificate',\n      'taskerType.specialized.features.pendingReview',\n    ],\n    gradient: 'from-amber-500 to-orange-500',\n    badgeKey: 'taskerType.specialized.badge',\n    badgeColor: 'bg-amber-500/20 text-amber-600 dark:text-amber-400',\n  },\n];\n\nconst featureIcons: Record<string, typeof Zap> = {\n  'taskerType.general.features.anyTask': Briefcase,\n  'taskerType.general.features.noCertificate': Shield,\n  'taskerType.general.features.immediateActivation': Zap,\n  'taskerType.specialized.features.professional': Award,\n  'taskerType.specialized.features.uploadCertificate': FileCheck,\n  'taskerType.specialized.features.pendingReview': Clock,\n};\n\nconst TaskerTypeCard = memo(function TaskerTypeCard({\n  option,\n  isSelected,\n  onSelect,\n  t,\n}: {\n  option: TaskerTypeOption;\n  isSelected: boolean;\n  onSelect: () => void;\n  t: (key: string) => string;\n}) {\n  const Icon = option.icon;\n\n  return (\n    <motion.button\n      layout\n      onClick={onSelect}\n      whileTap={{ scale: 0.98 }}\n      className={cn(\n        \"w-full text-start p-6 rounded-3xl transition-all duration-300 relative overflow-hidden\",\n        isSelected\n          ? \"glass-premium shadow-xl border-2 border-primary\"\n          : \"glass hover:shadow-lg border-2 border-transparent\"\n      )}\n      data-testid={`button-tasker-type-${option.id}`}\n    >\n      <div className=\"flex items-start gap-4 relative z-10\">\n        <motion.div\n          animate={{\n            scale: isSelected ? 1.05 : 1,\n            rotate: isSelected ? 5 : 0,\n          }}\n          className={cn(\n            \"w-14 h-14 rounded-2xl flex items-center justify-center transition-all shadow-lg\",\n            isSelected\n              ? `bg-gradient-to-br ${option.gradient} text-white shadow-lg`\n              : \"bg-muted/50 text-muted-foreground\"\n          )}\n        >\n          <Icon className=\"w-7 h-7\" />\n        </motion.div>\n\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n            <h3 className=\"text-xl font-bold text-foreground\">{t(option.titleKey)}</h3>\n            <span className={cn(\"px-2 py-0.5 rounded-full text-xs font-semibold\", option.badgeColor)}>\n              {t(option.badgeKey)}\n            </span>\n          </div>\n          <p className=\"text-sm text-muted-foreground mb-4\">{t(option.subtitleKey)}</p>\n\n          <AnimatePresence>\n            {isSelected && (\n              <motion.div\n                initial={{ opacity: 0, height: 0 }}\n                animate={{ opacity: 1, height: \"auto\" }}\n                exit={{ opacity: 0, height: 0 }}\n                className=\"space-y-3 overflow-hidden\"\n              >\n                {option.featuresKeys.map((featureKey, idx) => {\n                  const FeatureIcon = featureIcons[featureKey] || Check;\n                  return (\n                    <motion.div\n                      key={featureKey}\n                      initial={{ opacity: 0, x: -10 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: idx * 0.1 }}\n                      className=\"flex items-center gap-3 text-sm text-foreground/80 rtl:flex-row-reverse rtl:text-right\"\n                    >\n                      <div className={cn(\n                        \"w-6 h-6 rounded-full flex items-center justify-center shrink-0\",\n                        isSelected && option.id === 'general' ? \"bg-emerald-500/20\" : \"bg-amber-500/20\"\n                      )}>\n                        <FeatureIcon className={cn(\n                          \"w-3.5 h-3.5\",\n                          isSelected && option.id === 'general' ? \"text-emerald-600 dark:text-emerald-400\" : \"text-amber-600 dark:text-amber-400\"\n                        )} />\n                      </div>\n                      <span className=\"flex-1\">{t(featureKey)}</span>\n                    </motion.div>\n                  );\n                })}\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n\n        <motion.div\n          animate={{\n            scale: isSelected ? 1 : 0.8,\n            opacity: isSelected ? 1 : 0.5,\n          }}\n          className={cn(\n            \"w-7 h-7 rounded-full flex items-center justify-center transition-all\",\n            isSelected\n              ? \"bg-primary text-white shadow-lg shadow-primary/30\"\n              : \"border-2 border-muted\"\n          )}\n        >\n          {isSelected && (\n            <motion.div\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              transition={{ type: \"spring\", stiffness: 500 }}\n            >\n              <Check className=\"w-4 h-4\" />\n            </motion.div>\n          )}\n        </motion.div>\n      </div>\n    </motion.button>\n  );\n});\n\nconst TaskerTypeScreen = memo(function TaskerTypeScreen() {\n  const [, setLocation] = useLocation();\n  const { t, i18n } = useTranslation();\n  const { user, setUser, isAuthenticated } = useApp();\n  const { toast } = useToast();\n  const isArabic = i18n.language === 'ar';\n  const [selectedType, setSelectedType] = useState<TaskerType | null>(null);\n  const [showCertificateUpload, setShowCertificateUpload] = useState(false);\n  const [certificateImage, setCertificateImage] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const applyTaskerMutation = useMutation({\n    mutationFn: async (data: { taskerType: TaskerType; certificateUrl?: string }) => {\n      const response = await apiRequest('POST', '/api/users/apply-tasker', data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setUser(data.user);\n      queryClient.invalidateQueries({ queryKey: ['/api/users/me'] });\n      \n      toast({\n        title: isArabic ? 'تم استلام طلبك' : 'Application Received',\n        description: isArabic ? 'سيتم مراجعة طلبك وإشعارك بالنتيجة' : 'Your application is under review',\n      });\n      setLocation('/settings');\n    },\n    onError: (error: Error) => {\n      toast({\n        title: isArabic ? 'حدث خطأ' : 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    \n    if (file.size > 5 * 1024 * 1024) {\n      toast({\n        title: isArabic ? 'الملف كبير جداً' : 'File too large',\n        description: isArabic ? 'يجب أن يكون حجم الملف أقل من 5 ميجابايت' : 'File must be less than 5MB',\n        variant: 'destructive',\n      });\n      return;\n    }\n    \n    const reader = new FileReader();\n    reader.onload = () => {\n      setCertificateImage(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  }, [toast, isArabic]);\n\n  const handleContinue = useCallback(() => {\n    if (!selectedType) return;\n\n    if (isAuthenticated && user) {\n      if (selectedType === 'specialized') {\n        if (!showCertificateUpload) {\n          setShowCertificateUpload(true);\n          return;\n        }\n        if (!certificateImage) {\n          toast({\n            title: isArabic ? 'مطلوب شهادة' : 'Certificate Required',\n            description: isArabic ? 'يرجى رفع شهادتك المهنية' : 'Please upload your professional certificate',\n            variant: 'destructive',\n          });\n          return;\n        }\n        applyTaskerMutation.mutate({ taskerType: selectedType, certificateUrl: certificateImage });\n      } else {\n        applyTaskerMutation.mutate({ taskerType: selectedType });\n      }\n    } else {\n      setLocation(`/register?taskerType=${selectedType}`);\n    }\n  }, [selectedType, isAuthenticated, user, showCertificateUpload, certificateImage, setLocation, applyTaskerMutation, toast, isArabic]);\n\n  const handleBack = useCallback(() => {\n    if (showCertificateUpload) {\n      setShowCertificateUpload(false);\n      setCertificateImage(null);\n    } else if (isAuthenticated) {\n      setLocation('/settings');\n    } else {\n      setLocation('/role');\n    }\n  }, [showCertificateUpload, isAuthenticated, setLocation]);\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-b from-background to-primary/5 pt-safe\">\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"flex items-center justify-between px-6 py-4\"\n      >\n        <motion.button\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={handleBack}\n          className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"w-5 h-5 rtl:rotate-180\" />\n        </motion.button>\n\n        <div className=\"flex gap-2\">\n          {[0, 1, 2].map((step) => (\n            <motion.div\n              key={step}\n              initial={{ scaleX: 0 }}\n              animate={{ scaleX: 1 }}\n              transition={{ delay: step * 0.1 }}\n              className={cn(\n                \"w-10 h-1.5 rounded-full transition-colors\",\n                step <= 1 ? \"bg-primary\" : \"bg-muted\"\n              )}\n            />\n          ))}\n        </div>\n\n        <div className=\"w-11\" />\n      </motion.div>\n\n      <div className=\"flex-1 flex flex-col px-6 py-8\">\n        <AnimatePresence mode=\"wait\">\n          {!showCertificateUpload ? (\n            <motion.div\n              key=\"type-selection\"\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: 20 }}\n              className=\"flex-1 flex flex-col\"\n            >\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.1 }}\n              >\n                <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n                  {isAuthenticated \n                    ? (isArabic ? 'انضم كمنفذ' : 'Join as Tasker')\n                    : t('taskerType.title')\n                  }\n                </h1>\n                <p className=\"text-muted-foreground text-lg\">\n                  {t('taskerType.subtitle')}\n                </p>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.2 }}\n                className=\"space-y-4 mt-8 flex-1\"\n              >\n                {taskerTypes.map((option, index) => (\n                  <motion.div\n                    key={option.id}\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    transition={{ delay: 0.3 + index * 0.1 }}\n                  >\n                    <TaskerTypeCard\n                      option={option}\n                      isSelected={selectedType === option.id}\n                      onSelect={() => setSelectedType(option.id)}\n                      t={t}\n                    />\n                  </motion.div>\n                ))}\n              </motion.div>\n            </motion.div>\n          ) : (\n            <motion.div\n              key=\"certificate-upload\"\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: -20 }}\n              className=\"flex-1 flex flex-col\"\n            >\n              <h1 className=\"text-3xl font-extrabold text-foreground tracking-tight mb-2\">\n                {isArabic ? 'رفع الشهادة' : 'Upload Certificate'}\n              </h1>\n              <p className=\"text-muted-foreground text-lg mb-8\">\n                {isArabic ? 'ارفع شهادتك المهنية للتحقق' : 'Upload your professional certificate for verification'}\n              </p>\n\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={handleFileSelect}\n                className=\"hidden\"\n              />\n\n              {certificateImage ? (\n                <div className=\"relative glass rounded-3xl p-4 mb-6\">\n                  <img\n                    src={certificateImage}\n                    alt=\"Certificate\"\n                    className=\"w-full h-64 object-cover rounded-2xl\"\n                  />\n                  <motion.button\n                    whileTap={{ scale: 0.95 }}\n                    onClick={() => {\n                      setCertificateImage(null);\n                      if (fileInputRef.current) fileInputRef.current.value = '';\n                    }}\n                    className=\"absolute top-6 right-6 w-10 h-10 rounded-full bg-destructive/90 text-white flex items-center justify-center\"\n                  >\n                    <X className=\"w-5 h-5\" />\n                  </motion.button>\n                </div>\n              ) : (\n                <motion.button\n                  whileTap={{ scale: 0.98 }}\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"glass rounded-3xl p-8 flex flex-col items-center justify-center gap-4 mb-6 border-2 border-dashed border-primary/30\"\n                >\n                  <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center\">\n                    <Upload className=\"w-8 h-8 text-primary\" />\n                  </div>\n                  <p className=\"text-muted-foreground text-center\">\n                    {isArabic ? 'اضغط لرفع الشهادة' : 'Click to upload certificate'}\n                  </p>\n                </motion.button>\n              )}\n\n              <div className=\"glass rounded-2xl p-4 mb-6\">\n                <div className=\"flex items-start gap-3\">\n                  <FileCheck className=\"w-5 h-5 text-primary flex-shrink-0 mt-0.5\" />\n                  <p className=\"text-sm text-muted-foreground text-start\">\n                    {isArabic \n                      ? 'سيتم مراجعة شهادتك من قبل فريقنا خلال 24-48 ساعة'\n                      : 'Your certificate will be reviewed by our team within 24-48 hours'}\n                  </p>\n                </div>\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.5 }}\n          className=\"mt-6 pb-safe\"\n        >\n          <motion.button\n            whileHover={{ scale: selectedType ? 1.02 : 1 }}\n            whileTap={{ scale: selectedType ? 0.98 : 1 }}\n            onClick={handleContinue}\n            disabled={!selectedType || applyTaskerMutation.isPending}\n            className={cn(\n              \"w-full h-14 rounded-2xl font-bold text-lg transition-all flex items-center justify-center gap-2\",\n              selectedType && !applyTaskerMutation.isPending\n                ? \"gradient-primary text-white shadow-xl shadow-primary/25\"\n                : \"bg-muted text-muted-foreground cursor-not-allowed\"\n            )}\n            data-testid=\"button-continue\"\n          >\n            {applyTaskerMutation.isPending ? (\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n            ) : (\n              <>\n                {showCertificateUpload \n                  ? (isArabic ? 'إرسال الطلب' : 'Submit Application')\n                  : t('common.next')\n                }\n                <ChevronLeft className=\"w-5 h-5 rtl:rotate-180\" />\n              </>\n            )}\n          </motion.button>\n        </motion.div>\n      </div>\n    </div>\n  );\n});\n\nexport default TaskerTypeScreen;\n","path":null,"size_bytes":17313,"size_tokens":null},"server/webhookHandlers.ts":{"content":"import { getStripeSync } from './stripeClient';\n\nexport class WebhookHandlers {\n  static async processWebhook(payload: Buffer, signature: string, uuid: string): Promise<void> {\n    if (!Buffer.isBuffer(payload)) {\n      throw new Error(\n        'STRIPE WEBHOOK ERROR: Payload must be a Buffer. ' +\n        'Received type: ' + typeof payload + '. ' +\n        'This usually means express.json() parsed the body before reaching this handler. ' +\n        'FIX: Ensure webhook route is registered BEFORE app.use(express.json()).'\n      );\n    }\n\n    const sync = await getStripeSync();\n    await sync.processWebhook(payload, signature, uuid);\n  }\n}\n","path":null,"size_bytes":644,"size_tokens":null},"client/src/pages/TermsScreen.tsx":{"content":"import { memo } from 'react';\nimport { motion } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { ArrowLeft, FileText } from 'lucide-react';\n\nconst TermsScreen = memo(function TermsScreen() {\n  const { t } = useTranslation();\n\n  const sections = [\n    {\n      title: t('terms.acceptance.title'),\n      content: t('terms.acceptance.content')\n    },\n    {\n      title: t('terms.eligibility.title'),\n      content: t('terms.eligibility.content')\n    },\n    {\n      title: t('terms.accounts.title'),\n      content: t('terms.accounts.content')\n    },\n    {\n      title: t('terms.services.title'),\n      content: t('terms.services.content')\n    },\n    {\n      title: t('terms.payments.title'),\n      content: t('terms.payments.content')\n    },\n    {\n      title: t('terms.conduct.title'),\n      content: t('terms.conduct.content')\n    },\n    {\n      title: t('terms.liability.title'),\n      content: t('terms.liability.content')\n    },\n    {\n      title: t('terms.termination.title'),\n      content: t('terms.termination.content')\n    },\n    {\n      title: t('terms.disputes.title'),\n      content: t('terms.disputes.content')\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-40 -left-20 w-64 h-64 bg-accent/20 rounded-full blur-3xl rtl:-right-20 rtl:left-auto\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center gap-4 mb-6\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => window.history.back()}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5 rtl:rotate-180\" />\n          </motion.button>\n          <h1 className=\"text-2xl font-extrabold text-foreground\">{t('terms.title')}</h1>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n          className=\"glass rounded-3xl p-5 mb-6\"\n        >\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"w-12 h-12 rounded-2xl bg-accent/15 flex items-center justify-center\">\n              <FileText className=\"w-6 h-6 text-accent\" />\n            </div>\n            <div>\n              <p className=\"font-bold text-foreground\">{t('terms.lastUpdated')}</p>\n              <p className=\"text-sm text-muted-foreground\">2024-12-01</p>\n            </div>\n          </div>\n          <p className=\"text-sm text-muted-foreground leading-relaxed\">\n            {t('terms.intro')}\n          </p>\n        </motion.div>\n\n        <div className=\"space-y-4\">\n          {sections.map((section, index) => (\n            <motion.div\n              key={index}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.15 + index * 0.05 }}\n              className=\"glass rounded-2xl p-5\"\n            >\n              <h2 className=\"font-bold text-foreground mb-3\">{section.title}</h2>\n              <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-line\">\n                {section.content}\n              </p>\n            </motion.div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n});\n\nexport default TermsScreen;\n","path":null,"size_bytes":3781,"size_tokens":null},"client/src/pages/SearchTaskersScreen.tsx":{"content":"import { useState, memo, useCallback, useMemo } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery } from '@tanstack/react-query';\nimport { Skeleton, EmptyState } from '@/components/ui/animated';\nimport { ProfessionalBadgeList } from '@/components/ProfessionalBadge';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Switch } from '@/components/ui/switch';\nimport { cn } from '@/lib/utils';\nimport { PROFESSIONAL_CATEGORIES, type ProfessionalCategoryId } from '@shared/schema';\nimport { \n  Search, SearchX, X, Filter, Star, CheckCircle, \n  ArrowLeft, Shield, ChevronRight, Users, Award\n} from 'lucide-react';\nimport type { User, ProfessionalRole, UserProfessionalRole } from '@shared/schema';\n\ntype TaskerWithRoles = User & {\n  professionalRoles?: (UserProfessionalRole & { role: ProfessionalRole })[];\n};\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: { staggerChildren: 0.06, delayChildren: 0.1 }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 16 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 }\n  }\n};\n\nconst TaskerCard = memo(function TaskerCard({ \n  tasker, \n  index \n}: { \n  tasker: TaskerWithRoles; \n  index: number;\n}) {\n  const { i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  \n  const getInitials = useCallback((name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n  }, []);\n\n  const isVerified = tasker.verificationStatus === 'approved';\n  const rating = tasker.rating ? parseFloat(String(tasker.rating)).toFixed(1) : '0.0';\n  const completedTasks = tasker.completedTasks || 0;\n  const bioPreview = tasker.bio \n    ? tasker.bio.length > 80 \n      ? `${tasker.bio.slice(0, 80)}...` \n      : tasker.bio \n    : null;\n\n  return (\n    <Link href={`/profile/${tasker.id}`}>\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: index * 0.05 }}\n        whileHover={{ y: -2 }}\n        whileTap={{ scale: 0.98 }}\n        className=\"glass-premium rounded-3xl p-5 cursor-pointer transition-all duration-200\"\n        data-testid={`card-tasker-${tasker.id}`}\n      >\n        <div className=\"flex items-start gap-4\">\n          <div className=\"relative shrink-0\">\n            <Avatar className=\"w-16 h-16 border-2 border-white/30 shadow-lg\">\n              <AvatarImage src={tasker.avatar || undefined} alt={tasker.name} />\n              <AvatarFallback className=\"bg-gradient-to-br from-primary/20 to-accent/20 text-foreground font-bold text-lg\">\n                {getInitials(tasker.name)}\n              </AvatarFallback>\n            </Avatar>\n            {isVerified && (\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.2 + index * 0.05 }}\n                className=\"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-success flex items-center justify-center shadow-lg shadow-success/30\"\n              >\n                <Shield className=\"w-3.5 h-3.5 text-white\" />\n              </motion.div>\n            )}\n          </div>\n          \n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <h3 className=\"font-bold text-foreground text-lg truncate\" data-testid={`text-tasker-name-${tasker.id}`}>\n                {tasker.name}\n              </h3>\n            </div>\n            \n            <div className=\"flex items-center gap-3 mb-2.5\">\n              <div className=\"flex items-center gap-1\">\n                <Star className=\"w-4 h-4 text-warning fill-warning\" />\n                <span className=\"text-sm font-semibold text-foreground\" data-testid={`text-tasker-rating-${tasker.id}`}>\n                  {rating}\n                </span>\n              </div>\n              <div className=\"flex items-center gap-1 text-muted-foreground\">\n                <CheckCircle className=\"w-3.5 h-3.5\" />\n                <span className=\"text-xs font-medium\" data-testid={`text-tasker-completed-${tasker.id}`}>\n                  {completedTasks} {isArabic ? 'مهمة' : 'tasks'}\n                </span>\n              </div>\n            </div>\n            \n            {tasker.professionalRoles && tasker.professionalRoles.length > 0 && (\n              <div className=\"mb-2.5\" data-testid={`list-tasker-badges-${tasker.id}`}>\n                <ProfessionalBadgeList \n                  roles={tasker.professionalRoles} \n                  size=\"sm\" \n                  maxDisplay={2} \n                />\n              </div>\n            )}\n            \n            {bioPreview && (\n              <p className=\"text-sm text-muted-foreground line-clamp-2\" data-testid={`text-tasker-bio-${tasker.id}`}>\n                {bioPreview}\n              </p>\n            )}\n          </div>\n          \n          <ChevronRight className=\"w-5 h-5 text-muted-foreground shrink-0 mt-1 rtl:rotate-180\" />\n        </div>\n      </motion.div>\n    </Link>\n  );\n});\n\nconst TaskerCardSkeleton = memo(function TaskerCardSkeleton({ count = 3 }: { count?: number }) {\n  return (\n    <div className=\"space-y-4\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div key={i} className=\"glass rounded-3xl p-5\">\n          <div className=\"flex items-start gap-4\">\n            <Skeleton className=\"w-16 h-16 rounded-full shrink-0\" />\n            <div className=\"flex-1 space-y-3\">\n              <Skeleton className=\"h-5 w-32 rounded-lg\" />\n              <div className=\"flex gap-3\">\n                <Skeleton className=\"h-4 w-14 rounded-lg\" />\n                <Skeleton className=\"h-4 w-20 rounded-lg\" />\n              </div>\n              <div className=\"flex gap-2\">\n                <Skeleton className=\"h-5 w-20 rounded-full\" />\n                <Skeleton className=\"h-5 w-24 rounded-full\" />\n              </div>\n              <Skeleton className=\"h-4 w-full rounded-lg\" />\n            </div>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n});\n\nconst SearchTaskersScreen = memo(function SearchTaskersScreen() {\n  const [, setLocation] = useLocation();\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  \n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n  const [verifiedOnly, setVerifiedOnly] = useState(false);\n\n  const queryParams = useMemo(() => {\n    const params = new URLSearchParams();\n    if (searchQuery) params.set('search', searchQuery);\n    if (selectedCategory) params.set('category', selectedCategory);\n    if (verifiedOnly) params.set('verified', 'true');\n    return params.toString();\n  }, [searchQuery, selectedCategory, verifiedOnly]);\n\n  const { data: taskers, isLoading } = useQuery<TaskerWithRoles[]>({\n    queryKey: ['/api/taskers/search', queryParams],\n    queryFn: async () => {\n      const response = await fetch(`/api/taskers/search?${queryParams}`);\n      if (!response.ok) throw new Error('Failed to fetch taskers');\n      return response.json();\n    },\n  });\n\n  const handleCategorySelect = useCallback((category: string | null) => {\n    setSelectedCategory(category);\n  }, []);\n\n  const handleClearSearch = useCallback(() => {\n    setSearchQuery('');\n  }, []);\n\n  const handleClearFilters = useCallback(() => {\n    setSearchQuery('');\n    setSelectedCategory(null);\n    setVerifiedOnly(false);\n  }, []);\n\n  const taskerCount = taskers?.length || 0;\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.5, scale: 1 }}\n          transition={{ duration: 1 }}\n          className=\"absolute -top-24 -right-24 w-80 h-80 bg-gradient-to-br from-primary/25 to-primary/5 rounded-full blur-3xl rtl:-left-24 rtl:right-auto\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.25 }}\n          transition={{ delay: 0.3 }}\n          className=\"absolute top-60 -left-20 w-48 h-48 bg-gradient-to-tr from-accent/25 to-transparent rounded-full blur-3xl rtl:-right-20 rtl:left-auto\"\n        />\n      </div>\n\n      <motion.div \n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"relative z-10 px-5 py-5\"\n      >\n        <motion.div\n          variants={itemVariants}\n          className=\"flex items-center gap-4 mb-6\"\n        >\n          <motion.button\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.92 }}\n            onClick={() => setLocation('/home')}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back-search\"\n          >\n            <ArrowLeft className=\"w-5 h-5 text-foreground/80 rtl:rotate-180\" />\n          </motion.button>\n          <div>\n            <h1 className=\"text-2xl font-extrabold text-foreground tracking-tight\">\n              {t('taskers.title', 'Find Taskers')}\n            </h1>\n            <p className=\"text-sm text-muted-foreground mt-0.5\">\n              {taskerCount} {t('taskers.available', 'taskers available')}\n            </p>\n          </div>\n        </motion.div>\n\n        <motion.div\n          variants={itemVariants}\n          className=\"relative mb-5\"\n        >\n          <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground rtl:right-4 rtl:left-auto\" />\n          <input\n            type=\"search\"\n            placeholder={t('taskers.searchPlaceholder', 'Search by name or skill...')}\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"w-full h-13 ps-12 pe-12 rounded-2xl glass-input text-foreground placeholder:text-muted-foreground focus:outline-none transition-all text-base\"\n            data-testid=\"input-search-taskers\"\n          />\n          <AnimatePresence>\n            {searchQuery && (\n              <motion.button\n                initial={{ opacity: 0, scale: 0.8 }}\n                animate={{ opacity: 1, scale: 1 }}\n                exit={{ opacity: 0, scale: 0.8 }}\n                onClick={handleClearSearch}\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded-full bg-muted/80 hover:bg-muted transition-colors rtl:left-4 rtl:right-auto\"\n                data-testid=\"button-clear-search\"\n              >\n                <X className=\"w-3.5 h-3.5 text-muted-foreground\" />\n              </motion.button>\n            )}\n          </AnimatePresence>\n        </motion.div>\n\n        <motion.div\n          variants={itemVariants}\n          className=\"glass rounded-2xl p-4 mb-5\"\n        >\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <Shield className=\"w-4 h-4 text-success\" />\n              <span className=\"text-sm font-semibold text-foreground\">\n                {t('taskers.verifiedOnly', 'Verified only')}\n              </span>\n            </div>\n            <Switch\n              checked={verifiedOnly}\n              onCheckedChange={setVerifiedOnly}\n              data-testid=\"toggle-verified-only\"\n            />\n          </div>\n        </motion.div>\n\n        <motion.div\n          variants={itemVariants}\n          className=\"mb-6\"\n        >\n          <div className=\"flex items-center gap-2 mb-3\">\n            <Filter className=\"w-4 h-4 text-muted-foreground\" />\n            <span className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n              {t('taskers.specialty', 'Specialty')}\n            </span>\n          </div>\n          <div className=\"flex gap-2 overflow-x-auto no-scrollbar pb-1 -mx-5 px-5\">\n            <motion.button\n              whileTap={{ scale: 0.95 }}\n              onClick={() => handleCategorySelect(null)}\n              data-testid=\"button-category-all\"\n              className={cn(\n                \"px-4 py-2.5 rounded-xl font-semibold text-sm whitespace-nowrap transition-all duration-200\",\n                selectedCategory === null\n                  ? \"gradient-primary text-white shadow-lg shadow-primary/25\"\n                  : \"glass text-muted-foreground hover:text-foreground\"\n              )}\n            >\n              {t('common.all', 'All')}\n            </motion.button>\n            {(Object.entries(PROFESSIONAL_CATEGORIES) as [ProfessionalCategoryId, typeof PROFESSIONAL_CATEGORIES[ProfessionalCategoryId]][]).map(([categoryId, category]) => {\n              const displayName = isArabic ? category.nameAr : category.nameEn;\n              const colorHex = category.colorHex || '#6B7280';\n              \n              return (\n                <motion.button\n                  key={categoryId}\n                  whileTap={{ scale: 0.95 }}\n                  onClick={() => handleCategorySelect(categoryId)}\n                  data-testid={`button-category-${categoryId}`}\n                  className={cn(\n                    \"px-4 py-2.5 rounded-xl font-semibold text-sm whitespace-nowrap transition-all duration-200\",\n                    selectedCategory === categoryId\n                      ? \"text-white shadow-lg\"\n                      : \"glass text-muted-foreground hover:text-foreground\"\n                  )}\n                  style={{\n                    background: selectedCategory === categoryId \n                      ? `linear-gradient(135deg, ${colorHex} 0%, ${colorHex}CC 100%)`\n                      : undefined,\n                    boxShadow: selectedCategory === categoryId \n                      ? `0 8px 20px -8px ${colorHex}60`\n                      : undefined,\n                  }}\n                >\n                  {displayName}\n                </motion.button>\n              );\n            })}\n          </div>\n        </motion.div>\n      </motion.div>\n\n      <div className=\"relative z-10 px-5\">\n        <AnimatePresence mode=\"wait\">\n          {isLoading ? (\n            <motion.div\n              key=\"loading\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              <TaskerCardSkeleton count={4} />\n            </motion.div>\n          ) : taskers && taskers.length > 0 ? (\n            <motion.div\n              key=\"taskers\"\n              variants={containerVariants}\n              initial=\"hidden\"\n              animate=\"visible\"\n              className=\"space-y-4\"\n            >\n              {taskers.map((tasker, index) => (\n                <motion.div key={tasker.id} variants={itemVariants}>\n                  <TaskerCard tasker={tasker} index={index} />\n                </motion.div>\n              ))}\n            </motion.div>\n          ) : (\n            <motion.div\n              key=\"empty\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -20 }}\n            >\n              <EmptyState\n                icon={<Users className=\"w-8 h-8\" />}\n                title={t('taskers.empty.title', 'No taskers found')}\n                description={t('taskers.empty.description', 'Try adjusting your filters or search terms')}\n                action={\n                  (searchQuery || selectedCategory || verifiedOnly) && (\n                    <motion.button\n                      whileHover={{ scale: 1.03 }}\n                      whileTap={{ scale: 0.97 }}\n                      onClick={handleClearFilters}\n                      className=\"glass-premium text-foreground px-6 py-3 rounded-2xl font-bold flex items-center gap-2\"\n                      data-testid=\"button-clear-filters\"\n                    >\n                      <X className=\"w-4 h-4\" />\n                      {t('taskers.clearFilters', 'Clear filters')}\n                    </motion.button>\n                  )\n                }\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n});\n\nexport default SearchTaskersScreen;\n","path":null,"size_bytes":16311,"size_tokens":null},"client/src/hooks/useLocation.ts":{"content":"import { useState, useEffect, useCallback } from 'react';\n\ninterface LocationState {\n  latitude: number | null;\n  longitude: number | null;\n  isInRiyadh: boolean | null;\n  isLoading: boolean;\n  error: string | null;\n  checkLocation: () => void;\n  isTestMode: boolean;\n}\n\nconst TESTING_KEY = 'tharwa_dev_mode';\n\nconst RIYADH_BOUNDS = {\n  minLat: 24.4,\n  maxLat: 25.1,\n  minLon: 46.3,\n  maxLon: 47.1,\n};\n\nconst isWithinRiyadh = (lat: number, lon: number): boolean => {\n  return (\n    lat >= RIYADH_BOUNDS.minLat &&\n    lat <= RIYADH_BOUNDS.maxLat &&\n    lon >= RIYADH_BOUNDS.minLon &&\n    lon <= RIYADH_BOUNDS.maxLon\n  );\n};\n\nconst checkTestMode = (): boolean => {\n  if (typeof window === 'undefined') return false;\n  \n  const urlParams = new URLSearchParams(window.location.search);\n  if (urlParams.get('dev') === 'true') {\n    localStorage.setItem(TESTING_KEY, 'true');\n    return true;\n  }\n  \n  return localStorage.getItem(TESTING_KEY) === 'true';\n};\n\nexport function useLocation(): LocationState {\n  const [latitude, setLatitude] = useState<number | null>(null);\n  const [longitude, setLongitude] = useState<number | null>(null);\n  const [isTestMode] = useState<boolean>(() => checkTestMode());\n  const [isInRiyadh, setIsInRiyadh] = useState<boolean | null>(() => {\n    if (checkTestMode()) return true;\n    \n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem('isInRiyadh');\n      if (saved !== null) return saved === 'true';\n    }\n    return null;\n  });\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const checkLocation = useCallback(() => {\n    if (!navigator.geolocation) {\n      setError('Geolocation is not supported');\n      setIsInRiyadh(true);\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    navigator.geolocation.getCurrentPosition(\n      (position) => {\n        const lat = position.coords.latitude;\n        const lon = position.coords.longitude;\n        setLatitude(lat);\n        setLongitude(lon);\n        \n        const inRiyadh = isWithinRiyadh(lat, lon);\n        setIsInRiyadh(inRiyadh);\n        localStorage.setItem('isInRiyadh', String(inRiyadh));\n        localStorage.setItem('userLatitude', String(lat));\n        localStorage.setItem('userLongitude', String(lon));\n        setIsLoading(false);\n      },\n      (err) => {\n        setError(err.message);\n        setIsInRiyadh(true);\n        setIsLoading(false);\n      },\n      {\n        enableHighAccuracy: false,\n        timeout: 10000,\n        maximumAge: 600000,\n      }\n    );\n  }, []);\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const savedLat = localStorage.getItem('userLatitude');\n      const savedLon = localStorage.getItem('userLongitude');\n      if (savedLat && savedLon) {\n        setLatitude(parseFloat(savedLat));\n        setLongitude(parseFloat(savedLon));\n      }\n    }\n  }, []);\n\n  return {\n    latitude,\n    longitude,\n    isInRiyadh: isTestMode ? true : isInRiyadh,\n    isLoading,\n    error,\n    checkLocation,\n    isTestMode,\n  };\n}\n","path":null,"size_bytes":3068,"size_tokens":null},"client/src/pages/VerifyIdentityScreen.tsx":{"content":"import { memo, useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useApp } from '@/context/AppContext';\nimport { \n  ArrowLeft, Upload, Camera, CheckCircle, AlertCircle, \n  FileText, User, Clock, Shield\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ntype VerificationStep = 'intro' | 'id-front' | 'id-back' | 'selfie' | 'pending' | 'verified';\n\nconst VerifyIdentityScreen = memo(function VerifyIdentityScreen() {\n  const [, setLocation] = useLocation();\n  const { t } = useTranslation();\n  const { userRole } = useApp();\n  const [step, setStep] = useState<VerificationStep>('intro');\n  const [idFront, setIdFront] = useState<string | null>(null);\n  const [idBack, setIdBack] = useState<string | null>(null);\n  const [selfie, setSelfie] = useState<string | null>(null);\n\n  if (userRole !== 'tasker') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-32 flex items-center justify-center px-6\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"glass rounded-3xl p-8 text-center max-w-sm\"\n        >\n          <div className=\"w-16 h-16 rounded-full bg-primary/15 flex items-center justify-center mx-auto mb-4\">\n            <Shield className=\"w-8 h-8 text-primary\" />\n          </div>\n          <h2 className=\"text-xl font-bold text-foreground mb-2\">{t('verification.taskerOnly')}</h2>\n          <p className=\"text-muted-foreground text-sm mb-6\">{t('verification.taskerOnlyDesc')}</p>\n          <motion.button\n            whileTap={{ scale: 0.98 }}\n            onClick={() => window.history.back()}\n            className=\"w-full py-3 rounded-2xl gradient-primary text-white font-bold\"\n            data-testid=\"button-go-back\"\n          >\n            {t('common.back')}\n          </motion.button>\n        </motion.div>\n      </div>\n    );\n  }\n\n  const handleFileUpload = (setter: (val: string) => void) => (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        setter(event.target?.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleSubmit = () => {\n    setStep('pending');\n  };\n\n  const steps = [\n    { id: 'id-front', label: t('verification.steps.idFront'), done: !!idFront },\n    { id: 'id-back', label: t('verification.steps.idBack'), done: !!idBack },\n    { id: 'selfie', label: t('verification.steps.selfie'), done: !!selfie },\n  ];\n\n  const renderContent = () => {\n    switch (step) {\n      case 'intro':\n        return (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"space-y-6\"\n          >\n            <div className=\"glass rounded-3xl p-6 text-center\">\n              <div className=\"w-20 h-20 rounded-full gradient-primary flex items-center justify-center mx-auto mb-5 shadow-lg shadow-primary/30\">\n                <Shield className=\"w-10 h-10 text-white\" />\n              </div>\n              <h2 className=\"text-xl font-bold text-foreground mb-2\">{t('verification.title')}</h2>\n              <p className=\"text-muted-foreground text-sm\">{t('verification.description')}</p>\n            </div>\n\n            <div className=\"glass rounded-2xl p-5\">\n              <h3 className=\"font-bold text-foreground mb-4\">{t('verification.requirements')}</h3>\n              <div className=\"space-y-3\">\n                {[\n                  { icon: FileText, text: t('verification.req.validId') },\n                  { icon: Camera, text: t('verification.req.clearPhoto') },\n                  { icon: User, text: t('verification.req.selfie') },\n                ].map((item, index) => (\n                  <div key={index} className=\"flex items-center gap-3\">\n                    <div className=\"w-8 h-8 rounded-lg bg-primary/15 flex items-center justify-center\">\n                      <item.icon className=\"w-4 h-4 text-primary\" />\n                    </div>\n                    <span className=\"text-sm text-foreground\">{item.text}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <motion.button\n              whileTap={{ scale: 0.98 }}\n              onClick={() => setStep('id-front')}\n              className=\"w-full py-4 rounded-2xl gradient-primary text-white font-bold shadow-lg shadow-primary/30\"\n              data-testid=\"button-start-verification\"\n            >\n              {t('verification.startVerification')}\n            </motion.button>\n          </motion.div>\n        );\n\n      case 'id-front':\n      case 'id-back':\n      case 'selfie':\n        const isIdFront = step === 'id-front';\n        const isIdBack = step === 'id-back';\n        const isSelfie = step === 'selfie';\n        const currentImage = isIdFront ? idFront : isIdBack ? idBack : selfie;\n        const setCurrentImage = isIdFront ? setIdFront : isIdBack ? setIdBack : setSelfie;\n        const stepTitle = isIdFront \n          ? t('verification.steps.idFront') \n          : isIdBack \n            ? t('verification.steps.idBack') \n            : t('verification.steps.selfie');\n        const stepDesc = isIdFront \n          ? t('verification.uploadIdFront') \n          : isIdBack \n            ? t('verification.uploadIdBack') \n            : t('verification.uploadSelfie');\n\n        return (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"space-y-6\"\n          >\n            <div className=\"flex justify-center gap-2 mb-4\">\n              {steps.map((s, index) => (\n                <div\n                  key={s.id}\n                  className={cn(\n                    \"h-1.5 rounded-full transition-all\",\n                    s.done || step === s.id ? \"w-10 gradient-primary\" : \"w-10 bg-muted\"\n                  )}\n                />\n              ))}\n            </div>\n\n            <div className=\"glass rounded-3xl p-6 text-center\">\n              <h2 className=\"text-lg font-bold text-foreground mb-2\">{stepTitle}</h2>\n              <p className=\"text-muted-foreground text-sm\">{stepDesc}</p>\n            </div>\n\n            <div className=\"glass rounded-3xl p-4\">\n              {currentImage ? (\n                <div className=\"relative\">\n                  <img \n                    src={currentImage} \n                    alt=\"Uploaded\" \n                    className=\"w-full h-56 object-cover rounded-2xl\"\n                  />\n                  <motion.button\n                    whileTap={{ scale: 0.95 }}\n                    onClick={() => setCurrentImage(null)}\n                    className=\"absolute top-3 right-3 w-8 h-8 bg-destructive text-white rounded-full flex items-center justify-center\"\n                  >\n                    <span className=\"text-sm\">X</span>\n                  </motion.button>\n                </div>\n              ) : (\n                <label className=\"cursor-pointer block\">\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    capture={isSelfie ? \"user\" : \"environment\"}\n                    onChange={handleFileUpload(setCurrentImage)}\n                    className=\"hidden\"\n                    data-testid={`input-upload-${step}`}\n                  />\n                  <div className=\"h-56 border-2 border-dashed border-muted-foreground/30 rounded-2xl flex flex-col items-center justify-center gap-3 transition-colors hover:border-primary/50\">\n                    <div className=\"w-14 h-14 rounded-full bg-primary/15 flex items-center justify-center\">\n                      {isSelfie ? <Camera className=\"w-7 h-7 text-primary\" /> : <Upload className=\"w-7 h-7 text-primary\" />}\n                    </div>\n                    <p className=\"text-muted-foreground text-sm\">{t('verification.tapToUpload')}</p>\n                  </div>\n                </label>\n              )}\n            </div>\n\n            <div className=\"flex gap-3\">\n              <motion.button\n                whileTap={{ scale: 0.98 }}\n                onClick={() => {\n                  if (isIdFront) setStep('intro');\n                  else if (isIdBack) setStep('id-front');\n                  else setStep('id-back');\n                }}\n                className=\"flex-1 py-4 rounded-2xl glass font-bold text-foreground\"\n                data-testid=\"button-back-step\"\n              >\n                {t('common.back')}\n              </motion.button>\n              <motion.button\n                whileTap={{ scale: 0.98 }}\n                onClick={() => {\n                  if (isIdFront && idFront) setStep('id-back');\n                  else if (isIdBack && idBack) setStep('selfie');\n                  else if (isSelfie && selfie) handleSubmit();\n                }}\n                disabled={!currentImage}\n                className={cn(\n                  \"flex-1 py-4 rounded-2xl font-bold transition-all\",\n                  currentImage \n                    ? \"gradient-primary text-white shadow-lg shadow-primary/30\" \n                    : \"bg-muted text-muted-foreground\"\n                )}\n                data-testid=\"button-next-step\"\n              >\n                {isSelfie ? t('verification.submit') : t('common.next')}\n              </motion.button>\n            </div>\n          </motion.div>\n        );\n\n      case 'pending':\n        return (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            className=\"text-center space-y-6\"\n          >\n            <div className=\"glass rounded-3xl p-8\">\n              <div className=\"w-20 h-20 rounded-full bg-warning/15 flex items-center justify-center mx-auto mb-5\">\n                <Clock className=\"w-10 h-10 text-warning\" />\n              </div>\n              <h2 className=\"text-xl font-bold text-foreground mb-2\">{t('verification.pending.title')}</h2>\n              <p className=\"text-muted-foreground text-sm\">{t('verification.pending.description')}</p>\n            </div>\n\n            <div className=\"glass rounded-2xl p-4\">\n              <div className=\"flex items-center gap-3\">\n                <AlertCircle className=\"w-5 h-5 text-warning flex-shrink-0\" />\n                <p className=\"text-sm text-muted-foreground text-start\">{t('verification.pending.note')}</p>\n              </div>\n            </div>\n\n            <motion.button\n              whileTap={{ scale: 0.98 }}\n              onClick={() => setLocation('/profile')}\n              className=\"w-full py-4 rounded-2xl gradient-primary text-white font-bold shadow-lg shadow-primary/30\"\n              data-testid=\"button-back-to-profile\"\n            >\n              {t('verification.backToProfile')}\n            </motion.button>\n          </motion.div>\n        );\n\n      case 'verified':\n        return (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            className=\"text-center space-y-6\"\n          >\n            <div className=\"glass rounded-3xl p-8\">\n              <div className=\"w-20 h-20 rounded-full bg-success/15 flex items-center justify-center mx-auto mb-5\">\n                <CheckCircle className=\"w-10 h-10 text-success\" />\n              </div>\n              <h2 className=\"text-xl font-bold text-foreground mb-2\">{t('verification.verified.title')}</h2>\n              <p className=\"text-muted-foreground text-sm\">{t('verification.verified.description')}</p>\n            </div>\n\n            <motion.button\n              whileTap={{ scale: 0.98 }}\n              onClick={() => setLocation('/profile')}\n              className=\"w-full py-4 rounded-2xl gradient-primary text-white font-bold shadow-lg shadow-primary/30\"\n              data-testid=\"button-back-to-profile\"\n            >\n              {t('verification.backToProfile')}\n            </motion.button>\n          </motion.div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-40 -right-20 w-64 h-64 bg-primary/20 rounded-full blur-3xl rtl:-left-20 rtl:right-auto\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center gap-4 mb-8\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => window.history.back()}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5 rtl:rotate-180\" />\n          </motion.button>\n          <h1 className=\"text-2xl font-extrabold text-foreground\">{t('verification.pageTitle')}</h1>\n        </motion.div>\n\n        <AnimatePresence mode=\"wait\">\n          {renderContent()}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n});\n\nexport default VerifyIdentityScreen;\n","path":null,"size_bytes":13435,"size_tokens":null},"client/src/components/PortfolioGallery.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { X, Plus, Trash2, ChevronLeft, ChevronRight, GripVertical, Image as ImageIcon, Upload } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { UserPhoto } from \"@shared/schema\";\n\ninterface PortfolioGalleryProps {\n  userId: string;\n  isEditable?: boolean;\n}\n\nexport function PortfolioGallery({ userId, isEditable = false }: PortfolioGalleryProps) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [selectedPhotoIndex, setSelectedPhotoIndex] = useState<number | null>(null);\n  const [uploadingPhoto, setUploadingPhoto] = useState(false);\n  const [showAll, setShowAll] = useState(false);\n  \n  const MAX_VISIBLE_PHOTOS = 6;\n  \n  const { data: photos = [], isLoading } = useQuery<UserPhoto[]>({\n    queryKey: [\"/api/users\", userId, \"photos\"],\n    queryFn: () => fetch(`/api/users/${userId}/photos`).then(res => res.json()),\n  });\n  \n  const addPhotoMutation = useMutation({\n    mutationFn: async (data: { url: string; caption?: string }) => {\n      return apiRequest(\"/api/photos\", \"POST\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\", userId, \"photos\"] });\n      toast({\n        title: t(\"portfolio.photoAdded\", \"Photo added\"),\n        description: t(\"portfolio.photoAddedDesc\", \"Your photo has been added to your portfolio\"),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\", \"Error\"),\n        description: t(\"portfolio.uploadError\", \"Failed to upload photo\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n  \n  const deletePhotoMutation = useMutation({\n    mutationFn: async (photoId: string) => {\n      return apiRequest(`/api/photos/${photoId}`, \"DELETE\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\", userId, \"photos\"] });\n      setSelectedPhotoIndex(null);\n      toast({\n        title: t(\"portfolio.photoDeleted\", \"Photo deleted\"),\n      });\n    },\n  });\n  \n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    \n    if (file.size > 5 * 1024 * 1024) {\n      toast({\n        title: t(\"common.error\", \"Error\"),\n        description: t(\"portfolio.fileTooLarge\", \"File size must be less than 5MB\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    setUploadingPhoto(true);\n    \n    try {\n      const reader = new FileReader();\n      reader.onloadend = async () => {\n        const base64 = reader.result as string;\n        await addPhotoMutation.mutateAsync({ url: base64 });\n        setUploadingPhoto(false);\n      };\n      reader.readAsDataURL(file);\n    } catch {\n      setUploadingPhoto(false);\n    }\n    \n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n  \n  const handlePrevPhoto = () => {\n    if (selectedPhotoIndex !== null && selectedPhotoIndex > 0) {\n      setSelectedPhotoIndex(selectedPhotoIndex - 1);\n    }\n  };\n  \n  const handleNextPhoto = () => {\n    if (selectedPhotoIndex !== null && selectedPhotoIndex < photos.length - 1) {\n      setSelectedPhotoIndex(selectedPhotoIndex + 1);\n    }\n  };\n  \n  if (isLoading) {\n    return (\n      <div className=\"grid grid-cols-3 gap-2\" data-testid=\"gallery-skeleton\">\n        {[1, 2, 3].map(i => (\n          <div key={i} className=\"aspect-square rounded-2xl bg-gray-200 dark:bg-gray-700 animate-pulse\" />\n        ))}\n      </div>\n    );\n  }\n  \n  if (photos.length === 0 && !isEditable) {\n    return null;\n  }\n  \n  const displayPhotos = showAll ? photos : photos.slice(0, MAX_VISIBLE_PHOTOS);\n  const hasMorePhotos = photos.length > MAX_VISIBLE_PHOTOS;\n  \n  return (\n    <div data-testid=\"gallery-portfolio\">\n      <div className=\"grid grid-cols-3 gap-2\">\n        {displayPhotos.map((photo, index) => (\n          <motion.button\n            key={photo.id}\n            layoutId={`photo-${photo.id}`}\n            onClick={() => setSelectedPhotoIndex(photos.indexOf(photo))}\n            className=\"aspect-square rounded-2xl overflow-hidden relative group\"\n            whileTap={{ scale: 0.98 }}\n            data-testid={`gallery-photo-${photo.id}`}\n          >\n            <img\n              src={photo.url}\n              alt={photo.caption || \"Portfolio photo\"}\n              className=\"w-full h-full object-cover\"\n            />\n            <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors\" />\n          </motion.button>\n        ))}\n        \n        {isEditable && (\n          <motion.button\n            onClick={() => fileInputRef.current?.click()}\n            disabled={uploadingPhoto}\n            className=\"aspect-square rounded-2xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex flex-col items-center justify-center gap-2 text-gray-400 hover:border-primary hover:text-primary transition-colors\"\n            whileTap={{ scale: 0.98 }}\n            data-testid=\"button-add-photo\"\n          >\n            {uploadingPhoto ? (\n              <div className=\"w-6 h-6 border-2 border-gray-400 border-t-transparent rounded-full animate-spin\" />\n            ) : (\n              <>\n                <Plus className=\"w-6 h-6\" />\n                <span className=\"text-xs font-medium\">{t(\"portfolio.addPhoto\", \"Add Photo\")}</span>\n              </>\n            )}\n          </motion.button>\n        )}\n      </div>\n      \n      {hasMorePhotos && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          className=\"mt-3 text-center\"\n        >\n          <Button\n            variant=\"ghost\"\n            onClick={() => setShowAll(!showAll)}\n            className=\"text-primary font-semibold text-sm\"\n            data-testid=\"button-view-all-photos\"\n          >\n            {showAll \n              ? t(\"portfolio.showLess\") \n              : t(\"portfolio.viewAll\", { count: photos.length })}\n          </Button>\n        </motion.div>\n      )}\n      \n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        onChange={handleFileSelect}\n        className=\"hidden\"\n        data-testid=\"input-photo-upload\"\n      />\n      \n      <AnimatePresence>\n        {selectedPhotoIndex !== null && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 z-50 bg-black/90 backdrop-blur-xl flex flex-col\"\n            onClick={() => setSelectedPhotoIndex(null)}\n            data-testid=\"lightbox-overlay\"\n          >\n            <div className=\"flex items-center justify-between p-4\">\n              <span className=\"text-white/60 text-sm\">\n                {selectedPhotoIndex + 1} / {photos.length}\n              </span>\n              <div className=\"flex items-center gap-2\">\n                {isEditable && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      deletePhotoMutation.mutate(photos[selectedPhotoIndex].id);\n                    }}\n                    className=\"text-white hover:bg-white/10 rounded-xl\"\n                    data-testid=\"button-delete-photo\"\n                  >\n                    <Trash2 className=\"w-5 h-5\" />\n                  </Button>\n                )}\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => setSelectedPhotoIndex(null)}\n                  className=\"text-white hover:bg-white/10 rounded-xl\"\n                  data-testid=\"button-close-lightbox\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </Button>\n              </div>\n            </div>\n            \n            <div className=\"flex-1 flex items-center justify-center px-4 relative\" onClick={(e) => e.stopPropagation()}>\n              {selectedPhotoIndex > 0 && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handlePrevPhoto();\n                  }}\n                  className=\"absolute left-4 text-white hover:bg-white/10 rounded-xl z-10\"\n                  data-testid=\"button-prev-photo\"\n                >\n                  <ChevronLeft className=\"w-6 h-6\" />\n                </Button>\n              )}\n              \n              <motion.img\n                key={photos[selectedPhotoIndex].id}\n                layoutId={`photo-${photos[selectedPhotoIndex].id}`}\n                src={photos[selectedPhotoIndex].url}\n                alt={photos[selectedPhotoIndex].caption || \"Portfolio photo\"}\n                className=\"max-w-full max-h-[70vh] object-contain rounded-2xl\"\n                initial={{ opacity: 0, scale: 0.9 }}\n                animate={{ opacity: 1, scale: 1 }}\n                exit={{ opacity: 0, scale: 0.9 }}\n              />\n              \n              {selectedPhotoIndex < photos.length - 1 && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleNextPhoto();\n                  }}\n                  className=\"absolute right-4 text-white hover:bg-white/10 rounded-xl z-10\"\n                  data-testid=\"button-next-photo\"\n                >\n                  <ChevronRight className=\"w-6 h-6\" />\n                </Button>\n              )}\n            </div>\n            \n            {photos[selectedPhotoIndex].caption && (\n              <div className=\"p-4 text-center text-white/80\">\n                {photos[selectedPhotoIndex].caption}\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\ninterface PortfolioPreviewProps {\n  userId: string;\n  maxPhotos?: number;\n}\n\nexport function PortfolioPreview({ userId, maxPhotos = 4 }: PortfolioPreviewProps) {\n  const { data: photos = [] } = useQuery<UserPhoto[]>({\n    queryKey: [\"/api/users\", userId, \"photos\"],\n    queryFn: () => fetch(`/api/users/${userId}/photos`).then(res => res.json()),\n  });\n  \n  if (photos.length === 0) return null;\n  \n  const displayPhotos = photos.slice(0, maxPhotos);\n  const remainingCount = photos.length - maxPhotos;\n  \n  return (\n    <div className=\"flex -space-x-2\" data-testid=\"portfolio-preview\">\n      {displayPhotos.map((photo, index) => (\n        <div\n          key={photo.id}\n          className=\"w-10 h-10 rounded-lg overflow-hidden border-2 border-white dark:border-gray-900\"\n          style={{ zIndex: maxPhotos - index }}\n        >\n          <img\n            src={photo.url}\n            alt=\"\"\n            className=\"w-full h-full object-cover\"\n          />\n        </div>\n      ))}\n      {remainingCount > 0 && (\n        <div \n          className=\"w-10 h-10 rounded-lg bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-900 flex items-center justify-center text-xs font-bold text-gray-600 dark:text-gray-300\"\n          style={{ zIndex: 0 }}\n        >\n          +{remainingCount}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":11529,"size_tokens":null},"client/src/pages/PrivacyPolicyScreen.tsx":{"content":"import { memo } from 'react';\nimport { motion } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { ArrowLeft, Shield } from 'lucide-react';\n\nconst PrivacyPolicyScreen = memo(function PrivacyPolicyScreen() {\n  const { t } = useTranslation();\n\n  const sections = [\n    {\n      title: t('privacy.dataCollection.title'),\n      content: t('privacy.dataCollection.content')\n    },\n    {\n      title: t('privacy.dataUsage.title'),\n      content: t('privacy.dataUsage.content')\n    },\n    {\n      title: t('privacy.dataSharing.title'),\n      content: t('privacy.dataSharing.content')\n    },\n    {\n      title: t('privacy.dataSecurity.title'),\n      content: t('privacy.dataSecurity.content')\n    },\n    {\n      title: t('privacy.userRights.title'),\n      content: t('privacy.userRights.content')\n    },\n    {\n      title: t('privacy.cookies.title'),\n      content: t('privacy.cookies.content')\n    },\n    {\n      title: t('privacy.changes.title'),\n      content: t('privacy.changes.content')\n    },\n    {\n      title: t('privacy.contact.title'),\n      content: t('privacy.contact.content')\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-40 -right-20 w-64 h-64 bg-primary/20 rounded-full blur-3xl rtl:-left-20 rtl:right-auto\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-6 py-6\">\n        <motion.div \n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center gap-4 mb-6\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => window.history.back()}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5 rtl:rotate-180\" />\n          </motion.button>\n          <h1 className=\"text-2xl font-extrabold text-foreground\">{t('privacy.title')}</h1>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n          className=\"glass rounded-3xl p-5 mb-6\"\n        >\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"w-12 h-12 rounded-2xl bg-primary/15 flex items-center justify-center\">\n              <Shield className=\"w-6 h-6 text-primary\" />\n            </div>\n            <div>\n              <p className=\"font-bold text-foreground\">{t('privacy.lastUpdated')}</p>\n              <p className=\"text-sm text-muted-foreground\">2024-12-01</p>\n            </div>\n          </div>\n          <p className=\"text-sm text-muted-foreground leading-relaxed\">\n            {t('privacy.intro')}\n          </p>\n        </motion.div>\n\n        <div className=\"space-y-4\">\n          {sections.map((section, index) => (\n            <motion.div\n              key={index}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.15 + index * 0.05 }}\n              className=\"glass rounded-2xl p-5\"\n            >\n              <h2 className=\"font-bold text-foreground mb-3\">{section.title}</h2>\n              <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-line\">\n                {section.content}\n              </p>\n            </motion.div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n});\n\nexport default PrivacyPolicyScreen;\n","path":null,"size_bytes":3757,"size_tokens":null},"client/src/components/AvailabilityCalendar.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { ChevronLeft, ChevronRight, Check, X, Calendar } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { format, addMonths, subMonths, startOfMonth, endOfMonth, eachDayOfInterval, isSameMonth, isToday, isSameDay, parseISO } from \"date-fns\";\nimport { ar, enUS } from \"date-fns/locale\";\nimport type { TaskerAvailability } from \"@shared/schema\";\n\ninterface AvailabilityCalendarProps {\n  userId: string;\n  isEditable?: boolean;\n  onDateSelect?: (date: string, status: \"available\" | \"busy\") => void;\n}\n\nexport function AvailabilityCalendar({ userId, isEditable = false, onDateSelect }: AvailabilityCalendarProps) {\n  const { t, i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n  const locale = isArabic ? ar : enUS;\n  \n  const [currentMonth, setCurrentMonth] = useState(new Date());\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  \n  const startDate = format(startOfMonth(currentMonth), \"yyyy-MM-dd\");\n  const endDate = format(endOfMonth(addMonths(currentMonth, 1)), \"yyyy-MM-dd\");\n  \n  const { data: availability = [], isLoading } = useQuery<TaskerAvailability[]>({\n    queryKey: [\"/api/users\", userId, \"availability\", startDate, endDate],\n    queryFn: () => \n      fetch(`/api/users/${userId}/availability?startDate=${startDate}&endDate=${endDate}`)\n        .then(res => res.json()),\n  });\n  \n  const setAvailabilityMutation = useMutation({\n    mutationFn: async (data: { date: string; status: \"available\" | \"busy\" }) => {\n      return apiRequest(\"/api/availability\", \"POST\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\", userId, \"availability\"] });\n    },\n  });\n  \n  const availabilityMap = useMemo(() => {\n    const map = new Map<string, \"available\" | \"busy\">();\n    availability.forEach(a => {\n      map.set(a.date, a.status);\n    });\n    return map;\n  }, [availability]);\n  \n  const days = useMemo(() => {\n    const monthStart = startOfMonth(currentMonth);\n    const monthEnd = endOfMonth(currentMonth);\n    const allDays = eachDayOfInterval({ start: monthStart, end: monthEnd });\n    \n    const startDayOfWeek = monthStart.getDay();\n    const paddingDays = Array(startDayOfWeek).fill(null);\n    \n    return [...paddingDays, ...allDays];\n  }, [currentMonth]);\n  \n  const weekDays = isArabic \n    ? [\"أحد\", \"اثنين\", \"ثلاثاء\", \"أربعاء\", \"خميس\", \"جمعة\", \"سبت\"]\n    : [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n  \n  const handlePrevMonth = () => setCurrentMonth(subMonths(currentMonth, 1));\n  const handleNextMonth = () => setCurrentMonth(addMonths(currentMonth, 1));\n  \n  const handleDateClick = (date: Date) => {\n    if (!isEditable) return;\n    setSelectedDate(date);\n  };\n  \n  const handleSetAvailability = (status: \"available\" | \"busy\") => {\n    if (!selectedDate) return;\n    const dateStr = format(selectedDate, \"yyyy-MM-dd\");\n    setAvailabilityMutation.mutate({ date: dateStr, status });\n    onDateSelect?.(dateStr, status);\n    setSelectedDate(null);\n  };\n  \n  const getDateStatus = (date: Date): \"available\" | \"busy\" | null => {\n    const dateStr = format(date, \"yyyy-MM-dd\");\n    return availabilityMap.get(dateStr) || null;\n  };\n  \n  return (\n    <div className=\"bg-white/60 dark:bg-white/5 backdrop-blur-2xl rounded-3xl border border-white/20 dark:border-white/10 p-4 sm:p-6\" data-testid=\"calendar-availability\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={handlePrevMonth}\n          className=\"rounded-xl\"\n          data-testid=\"button-prev-month\"\n        >\n          <ChevronLeft className={`w-5 h-5 ${isArabic ? \"rotate-180\" : \"\"}`} />\n        </Button>\n        \n        <h3 className=\"text-lg font-bold text-gray-900 dark:text-white\">\n          {format(currentMonth, \"MMMM yyyy\", { locale })}\n        </h3>\n        \n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={handleNextMonth}\n          className=\"rounded-xl\"\n          data-testid=\"button-next-month\"\n        >\n          <ChevronRight className={`w-5 h-5 ${isArabic ? \"rotate-180\" : \"\"}`} />\n        </Button>\n      </div>\n      \n      <div className=\"grid grid-cols-7 gap-1 mb-2\">\n        {weekDays.map(day => (\n          <div key={day} className=\"text-center text-xs font-medium text-gray-500 dark:text-gray-400 py-2\">\n            {day}\n          </div>\n        ))}\n      </div>\n      \n      <div className=\"grid grid-cols-7 gap-1\">\n        {days.map((day, index) => {\n          if (!day) {\n            return <div key={`empty-${index}`} className=\"aspect-square\" />;\n          }\n          \n          const status = getDateStatus(day);\n          const isPast = day < new Date(new Date().setHours(0, 0, 0, 0));\n          const isSelected = selectedDate && isSameDay(day, selectedDate);\n          \n          return (\n            <motion.button\n              key={day.toISOString()}\n              whileTap={isEditable && !isPast ? { scale: 0.95 } : undefined}\n              onClick={() => !isPast && handleDateClick(day)}\n              disabled={isPast || !isEditable}\n              className={`\n                aspect-square rounded-xl flex items-center justify-center text-sm font-medium\n                transition-all duration-200 relative\n                ${isPast ? \"opacity-40 cursor-not-allowed\" : isEditable ? \"cursor-pointer\" : \"cursor-default\"}\n                ${isSelected ? \"ring-2 ring-primary ring-offset-2\" : \"\"}\n                ${isToday(day) ? \"font-bold\" : \"\"}\n                ${status === \"available\" \n                  ? \"bg-green-500/20 text-green-700 dark:text-green-400 border border-green-500/30\" \n                  : status === \"busy\" \n                    ? \"bg-red-500/20 text-red-700 dark:text-red-400 border border-red-500/30\"\n                    : \"hover:bg-gray-100 dark:hover:bg-white/10 text-gray-700 dark:text-gray-300\"}\n              `}\n              data-testid={`calendar-day-${format(day, \"yyyy-MM-dd\")}`}\n            >\n              {format(day, \"d\")}\n              {status && (\n                <span className={`absolute bottom-1 left-1/2 -translate-x-1/2 w-1.5 h-1.5 rounded-full ${\n                  status === \"available\" ? \"bg-green-500\" : \"bg-red-500\"\n                }`} />\n              )}\n            </motion.button>\n          );\n        })}\n      </div>\n      \n      <AnimatePresence>\n        {selectedDate && isEditable && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 10 }}\n            className=\"mt-4 p-4 bg-gray-100/80 dark:bg-white/5 rounded-2xl backdrop-blur-md\"\n          >\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3 text-center\">\n              {format(selectedDate, \"EEEE, d MMMM\", { locale })}\n            </p>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={() => handleSetAvailability(\"available\")}\n                className=\"flex-1 bg-green-500 hover:bg-green-600 text-white rounded-xl\"\n                disabled={setAvailabilityMutation.isPending}\n                data-testid=\"button-set-available\"\n              >\n                <Check className=\"w-4 h-4 mr-2\" />\n                {t(\"availability.available\", \"Available\")}\n              </Button>\n              <Button\n                onClick={() => handleSetAvailability(\"busy\")}\n                className=\"flex-1 bg-red-500 hover:bg-red-600 text-white rounded-xl\"\n                disabled={setAvailabilityMutation.isPending}\n                data-testid=\"button-set-busy\"\n              >\n                <X className=\"w-4 h-4 mr-2\" />\n                {t(\"availability.busy\", \"Busy\")}\n              </Button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n      \n      <div className=\"mt-4 flex items-center justify-center gap-6 text-xs\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"w-3 h-3 rounded-full bg-green-500\" />\n          <span className=\"text-gray-600 dark:text-gray-400\">{t(\"availability.available\", \"Available\")}</span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <span className=\"w-3 h-3 rounded-full bg-red-500\" />\n          <span className=\"text-gray-600 dark:text-gray-400\">{t(\"availability.busy\", \"Busy\")}</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface AvailabilityBadgeProps {\n  userId: string;\n  date?: string;\n}\n\nexport function AvailabilityBadge({ userId, date }: AvailabilityBadgeProps) {\n  const { t } = useTranslation();\n  const targetDate = date || format(new Date(), \"yyyy-MM-dd\");\n  \n  const { data: availability = [] } = useQuery<TaskerAvailability[]>({\n    queryKey: [\"/api/users\", userId, \"availability\", targetDate, targetDate],\n    queryFn: () => \n      fetch(`/api/users/${userId}/availability?startDate=${targetDate}&endDate=${targetDate}`)\n        .then(res => res.json()),\n  });\n  \n  const status = availability.find(a => a.date === targetDate)?.status;\n  \n  if (!status) return null;\n  \n  return (\n    <span \n      className={`\n        inline-flex items-center gap-1 px-2.5 py-1 text-xs font-medium rounded-full\n        ${status === \"available\" \n          ? \"bg-green-500/20 text-green-700 dark:text-green-400\" \n          : \"bg-red-500/20 text-red-700 dark:text-red-400\"}\n      `}\n      data-testid=\"badge-availability\"\n    >\n      <Calendar className=\"w-3 h-3\" />\n      {status === \"available\" \n        ? t(\"availability.available\", \"Available\") \n        : t(\"availability.busy\", \"Busy\")}\n    </span>\n  );\n}\n","path":null,"size_bytes":9888,"size_tokens":null},"client/src/pages/DirectRequestsScreen.tsx":{"content":"import { memo, useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Skeleton } from '@/components/ui/animated';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { cn } from '@/lib/utils';\nimport { \n  ArrowLeft, Calendar, Clock, MapPin, CheckCircle, \n  XCircle, User, Phone, MessageSquare, DollarSign,\n  Inbox, AlertCircle\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { ar, enUS } from 'date-fns/locale';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { TASK_CATEGORIES_WITH_SUBS, getCategoryInfo } from '@shared/schema';\nimport type { DirectServiceRequest, User as UserType } from '@shared/schema';\n\ntype DirectRequestWithClient = DirectServiceRequest & {\n  client: UserType;\n};\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: { staggerChildren: 0.08, delayChildren: 0.1 }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 16 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 }\n  }\n};\n\nconst DirectRequestsScreen = memo(function DirectRequestsScreen() {\n  const [, setLocation] = useLocation();\n  const { user } = useApp();\n  const { t, i18n } = useTranslation();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState<'pending' | 'history'>('pending');\n  \n  const isArabic = i18n.language === 'ar';\n  \n  const { data: requests, isLoading } = useQuery<DirectRequestWithClient[]>({\n    queryKey: ['/api/direct-requests'],\n    enabled: !!user && user.role === 'tasker',\n  });\n  \n  const acceptMutation = useMutation({\n    mutationFn: async (requestId: string) => {\n      const res = await apiRequest('POST', `/api/direct-requests/${requestId}/accept`);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/direct-requests'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n      toast({\n        title: isArabic ? 'تم قبول الطلب' : 'Request Accepted',\n        description: isArabic \n          ? 'تم إنشاء المهمة بنجاح. يمكنك الآن بدء العمل.'\n          : 'Task created successfully. You can start working now.',\n      });\n      if (data.task?.id) {\n        setLocation(`/task/${data.task.id}`);\n      }\n    },\n    onError: () => {\n      toast({\n        title: isArabic ? 'خطأ' : 'Error',\n        description: isArabic \n          ? 'حدث خطأ أثناء قبول الطلب'\n          : 'An error occurred while accepting the request',\n        variant: 'destructive',\n      });\n    },\n  });\n  \n  const rejectMutation = useMutation({\n    mutationFn: async (requestId: string) => {\n      const res = await apiRequest('POST', `/api/direct-requests/${requestId}/reject`);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/direct-requests'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n      toast({\n        title: isArabic ? 'تم رفض الطلب' : 'Request Rejected',\n        description: isArabic \n          ? 'تم رفض طلب الخدمة المباشرة'\n          : 'Direct service request rejected',\n      });\n    },\n    onError: () => {\n      toast({\n        title: isArabic ? 'خطأ' : 'Error',\n        description: isArabic \n          ? 'حدث خطأ أثناء رفض الطلب'\n          : 'An error occurred while rejecting the request',\n        variant: 'destructive',\n      });\n    },\n  });\n  \n  const pendingRequests = requests?.filter(r => r.status === 'pending') || [];\n  const historyRequests = requests?.filter(r => r.status !== 'pending') || [];\n  const displayRequests = activeTab === 'pending' ? pendingRequests : historyRequests;\n  \n  const getCategoryName = (category: string) => {\n    const info = getCategoryInfo(category);\n    if (!info) return category;\n    \n    const mainCat = TASK_CATEGORIES_WITH_SUBS[info.mainCategory];\n    if (info.subcategory) {\n      return isArabic ? info.subcategory.nameAr : info.subcategory.nameEn;\n    }\n    return isArabic ? mainCat.nameAr : mainCat.nameEn;\n  };\n  \n  const getCategoryColor = (category: string) => {\n    const info = getCategoryInfo(category);\n    if (!info) return '#6B7280';\n    return TASK_CATEGORIES_WITH_SUBS[info.mainCategory].colorHex;\n  };\n  \n  const formatDate = (date: Date | string) => {\n    const d = new Date(date);\n    return format(d, 'EEEE, d MMMM yyyy', { \n      locale: isArabic ? ar : enUS \n    });\n  };\n  \n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'accepted':\n        return {\n          text: isArabic ? 'تم القبول' : 'Accepted',\n          color: 'bg-success/15 text-success',\n          icon: CheckCircle,\n        };\n      case 'rejected':\n        return {\n          text: isArabic ? 'تم الرفض' : 'Rejected',\n          color: 'bg-destructive/15 text-destructive',\n          icon: XCircle,\n        };\n      case 'cancelled':\n        return {\n          text: isArabic ? 'ملغى' : 'Cancelled',\n          color: 'bg-muted text-muted-foreground',\n          icon: AlertCircle,\n        };\n      default:\n        return {\n          text: isArabic ? 'قيد الانتظار' : 'Pending',\n          color: 'bg-warning/15 text-warning',\n          icon: Clock,\n        };\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen gradient-mesh pt-safe px-5 py-5\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <Skeleton className=\"w-11 h-11 rounded-2xl\" />\n          <Skeleton className=\"h-8 w-40 rounded-lg\" />\n          <div className=\"w-11\" />\n        </div>\n        {[1, 2, 3].map((i) => (\n          <Skeleton key={i} className=\"h-52 mb-4 rounded-3xl\" />\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.4, scale: 1 }}\n          transition={{ duration: 1 }}\n          className=\"absolute top-20 -right-24 w-72 h-72 bg-gradient-to-br from-accent/25 to-accent/5 rounded-full blur-3xl rtl:-left-24 rtl:right-auto\"\n        />\n      </div>\n\n      <motion.div \n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n        className=\"relative z-10 px-5 py-5\"\n      >\n        <motion.div \n          variants={itemVariants}\n          className=\"flex items-center justify-between mb-6\"\n        >\n          <motion.button \n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.92 }}\n            onClick={() => window.history.back()}\n            className=\"w-11 h-11 flex items-center justify-center rounded-2xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5 text-foreground/80 rtl:rotate-180\" />\n          </motion.button>\n          \n          <h1 className=\"text-xl font-bold text-foreground\">\n            {isArabic ? 'طلبات الخدمة المباشرة' : 'Direct Service Requests'}\n          </h1>\n          \n          <div className=\"w-11\" />\n        </motion.div>\n        \n        <motion.div \n          variants={itemVariants}\n          className=\"flex gap-2 mb-6\"\n        >\n          <motion.button\n            whileTap={{ scale: 0.96 }}\n            onClick={() => setActiveTab('pending')}\n            className={cn(\n              \"flex-1 h-12 rounded-2xl font-semibold text-sm transition-all duration-200\",\n              activeTab === 'pending'\n                ? \"gradient-primary text-white shadow-lg shadow-primary/25\"\n                : \"glass text-muted-foreground\"\n            )}\n            data-testid=\"tab-pending\"\n          >\n            {isArabic ? 'قيد الانتظار' : 'Pending'} ({pendingRequests.length})\n          </motion.button>\n          <motion.button\n            whileTap={{ scale: 0.96 }}\n            onClick={() => setActiveTab('history')}\n            className={cn(\n              \"flex-1 h-12 rounded-2xl font-semibold text-sm transition-all duration-200\",\n              activeTab === 'history'\n                ? \"gradient-primary text-white shadow-lg shadow-primary/25\"\n                : \"glass text-muted-foreground\"\n            )}\n            data-testid=\"tab-history\"\n          >\n            {isArabic ? 'السجل' : 'History'} ({historyRequests.length})\n          </motion.button>\n        </motion.div>\n        \n        <AnimatePresence mode=\"wait\">\n          {displayRequests.length === 0 ? (\n            <motion.div\n              key=\"empty\"\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, scale: 0.95 }}\n              className=\"glass rounded-3xl p-8 text-center\"\n            >\n              <div className=\"w-20 h-20 mx-auto mb-4 rounded-full bg-muted/30 flex items-center justify-center\">\n                <Inbox className=\"w-10 h-10 text-muted-foreground\" />\n              </div>\n              <h3 className=\"text-lg font-bold text-foreground mb-2\">\n                {activeTab === 'pending'\n                  ? (isArabic ? 'لا توجد طلبات جديدة' : 'No Pending Requests')\n                  : (isArabic ? 'لا توجد سجلات' : 'No History')}\n              </h3>\n              <p className=\"text-muted-foreground text-sm\">\n                {activeTab === 'pending'\n                  ? (isArabic \n                      ? 'عندما يطلب العملاء خدماتك مباشرة، ستظهر هنا'\n                      : \"When clients request your services directly, they'll appear here\")\n                  : (isArabic \n                      ? 'الطلبات المقبولة والمرفوضة ستظهر هنا'\n                      : 'Accepted and rejected requests will appear here')}\n              </p>\n            </motion.div>\n          ) : (\n            <motion.div\n              key={activeTab}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -20 }}\n              className=\"space-y-4\"\n            >\n              {displayRequests.map((request, index) => {\n                const status = getStatusBadge(request.status);\n                const StatusIcon = status.icon;\n                \n                return (\n                  <motion.div\n                    key={request.id}\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ delay: index * 0.05 }}\n                    className=\"glass rounded-3xl overflow-hidden\"\n                    data-testid={`direct-request-card-${request.id}`}\n                  >\n                    <div className=\"p-5\">\n                      <div className=\"flex items-start justify-between mb-4\">\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar className=\"w-12 h-12 border-2 border-white/20\">\n                            <AvatarImage src={request.client?.avatar || undefined} />\n                            <AvatarFallback className=\"gradient-primary text-white font-bold\">\n                              {request.client?.name?.[0] || 'U'}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <h3 className=\"font-bold text-foreground\">\n                              {request.client?.name || 'Client'}\n                            </h3>\n                            <p className=\"text-xs text-muted-foreground\">\n                              @{request.client?.username}\n                            </p>\n                          </div>\n                        </div>\n                        \n                        <div className={cn(\n                          \"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold\",\n                          status.color\n                        )}>\n                          <StatusIcon className=\"w-3.5 h-3.5\" />\n                          {status.text}\n                        </div>\n                      </div>\n                      \n                      <div \n                        className=\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold mb-4\"\n                        style={{ \n                          backgroundColor: `${getCategoryColor(request.category)}20`,\n                          color: getCategoryColor(request.category)\n                        }}\n                      >\n                        {getCategoryName(request.category)}\n                      </div>\n                      \n                      <p className=\"text-foreground mb-4 text-sm leading-relaxed\">\n                        {request.description}\n                      </p>\n                      \n                      <div className=\"space-y-2.5\">\n                        <div className=\"flex items-center gap-2.5 text-sm\">\n                          <div className=\"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center\">\n                            <Calendar className=\"w-4 h-4 text-primary\" />\n                          </div>\n                          <span className=\"text-foreground\">{formatDate(request.scheduledDate)}</span>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2.5 text-sm\">\n                          <div className=\"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center\">\n                            <Clock className=\"w-4 h-4 text-primary\" />\n                          </div>\n                          <span className=\"text-foreground\">{request.scheduledTime}</span>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2.5 text-sm\">\n                          <div className=\"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center\">\n                            <MapPin className=\"w-4 h-4 text-primary\" />\n                          </div>\n                          <span className=\"text-foreground\">{request.location}</span>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2.5 text-sm\">\n                          <div className=\"w-8 h-8 rounded-lg bg-success/10 flex items-center justify-center\">\n                            <DollarSign className=\"w-4 h-4 text-success\" />\n                          </div>\n                          <span className=\"text-foreground font-semibold\">\n                            {request.budget} {isArabic ? 'ر.س' : 'SAR'}\n                          </span>\n                        </div>\n                      </div>\n                      \n                      {request.status === 'pending' && (\n                        <div className=\"flex gap-3 mt-5 pt-5 border-t border-border/30\">\n                          <motion.button\n                            whileHover={{ scale: 1.02 }}\n                            whileTap={{ scale: 0.98 }}\n                            onClick={() => rejectMutation.mutate(request.id)}\n                            disabled={rejectMutation.isPending || acceptMutation.isPending}\n                            className=\"flex-1 h-12 rounded-2xl font-semibold flex items-center justify-center gap-2 bg-destructive/10 text-destructive disabled:opacity-50\"\n                            data-testid={`button-reject-${request.id}`}\n                          >\n                            <XCircle className=\"w-5 h-5\" />\n                            {isArabic ? 'رفض' : 'Reject'}\n                          </motion.button>\n                          \n                          <motion.button\n                            whileHover={{ scale: 1.02 }}\n                            whileTap={{ scale: 0.98 }}\n                            onClick={() => acceptMutation.mutate(request.id)}\n                            disabled={rejectMutation.isPending || acceptMutation.isPending}\n                            className=\"flex-1 h-12 rounded-2xl font-semibold flex items-center justify-center gap-2 gradient-primary text-white shadow-lg shadow-primary/25 disabled:opacity-50\"\n                            data-testid={`button-accept-${request.id}`}\n                          >\n                            <CheckCircle className=\"w-5 h-5\" />\n                            {isArabic ? 'قبول' : 'Accept'}\n                          </motion.button>\n                        </div>\n                      )}\n                      \n                      {request.status !== 'pending' && (\n                        <div className=\"flex gap-3 mt-5 pt-5 border-t border-border/30\">\n                          <motion.button\n                            whileHover={{ scale: 1.02 }}\n                            whileTap={{ scale: 0.98 }}\n                            onClick={() => setLocation(`/profile/${request.clientId}`)}\n                            className=\"flex-1 h-11 rounded-xl font-semibold text-sm flex items-center justify-center gap-2 glass text-foreground\"\n                            data-testid={`button-view-client-${request.id}`}\n                          >\n                            <User className=\"w-4 h-4\" />\n                            {isArabic ? 'عرض الملف الشخصي' : 'View Profile'}\n                          </motion.button>\n                        </div>\n                      )}\n                    </div>\n                  </motion.div>\n                );\n              })}\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </motion.div>\n    </div>\n  );\n});\n\nexport default DirectRequestsScreen;\n","path":null,"size_bytes":18184,"size_tokens":null},"client/src/pages/MyDirectRequestsScreen.tsx":{"content":"import { memo, useMemo } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useApp } from '@/context/AppContext';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { ChevronLeft, Clock, CheckCircle2, XCircle, MapPin, Calendar, DollarSign, Send, X } from 'lucide-react';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport type { DirectServiceRequest, User } from '@shared/schema';\nimport { TASK_CATEGORIES_WITH_SUBS } from '@shared/schema';\n\ntype DirectRequestWithUsers = DirectServiceRequest & {\n  client: Omit<User, 'password'> | null;\n  tasker: Omit<User, 'password'> | null;\n};\n\nconst containerVariants = {\n  hidden: { opacity: 0 },\n  visible: {\n    opacity: 1,\n    transition: { staggerChildren: 0.08, delayChildren: 0.1 }\n  }\n};\n\nconst itemVariants = {\n  hidden: { opacity: 0, y: 20 },\n  visible: { \n    opacity: 1, \n    y: 0,\n    transition: { type: \"spring\", stiffness: 300, damping: 24 }\n  }\n};\n\nconst MyDirectRequestsScreen = memo(function MyDirectRequestsScreen() {\n  const [, setLocation] = useLocation();\n  const { t, i18n } = useTranslation();\n  const { toast } = useToast();\n  const isArabic = i18n.language === 'ar';\n  const isAuthenticated = !!localStorage.getItem('userId');\n\n  const { data: requests, isLoading } = useQuery<DirectRequestWithUsers[]>({\n    queryKey: ['/api/direct-requests'],\n    enabled: isAuthenticated,\n  });\n\n  const cancelMutation = useMutation({\n    mutationFn: async (requestId: string) => {\n      return apiRequest('POST', `/api/direct-requests/${requestId}/cancel`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/direct-requests'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n      toast({\n        title: isArabic ? 'تم إلغاء الطلب' : 'Request Cancelled',\n        description: isArabic ? 'تم إلغاء طلب الخدمة بنجاح' : 'Your service request has been cancelled',\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: isArabic ? 'فشل الإلغاء' : 'Failed to cancel',\n        description: error.message,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const statusConfig = {\n    pending: { \n      icon: Clock, \n      color: 'text-warning', \n      bgColor: 'bg-warning/10',\n      borderColor: 'border-warning/30',\n      label: isArabic ? 'قيد الانتظار' : 'Pending'\n    },\n    accepted: { \n      icon: CheckCircle2, \n      color: 'text-success', \n      bgColor: 'bg-success/10',\n      borderColor: 'border-success/30',\n      label: isArabic ? 'مقبول' : 'Accepted'\n    },\n    rejected: { \n      icon: XCircle, \n      color: 'text-destructive', \n      bgColor: 'bg-destructive/10',\n      borderColor: 'border-destructive/30',\n      label: isArabic ? 'مرفوض' : 'Rejected'\n    },\n    cancelled: { \n      icon: XCircle, \n      color: 'text-muted-foreground', \n      bgColor: 'bg-muted/10',\n      borderColor: 'border-muted/30',\n      label: isArabic ? 'ملغي' : 'Cancelled'\n    },\n  };\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr);\n    return date.toLocaleDateString(isArabic ? 'ar-SA' : 'en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen gradient-mesh pt-safe pb-32\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 0.5, scale: 1 }}\n          transition={{ duration: 1, ease: \"easeOut\" }}\n          className=\"absolute -top-32 -right-32 w-80 h-80 bg-gradient-to-br from-primary/20 to-primary/5 rounded-full blur-3xl rtl:-left-32 rtl:right-auto\"\n        />\n      </div>\n\n      <div className=\"relative z-10 px-5 py-5\">\n        <motion.div \n          initial={{ opacity: 0, y: -10 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex items-center gap-4 mb-6\"\n        >\n          <motion.button\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => setLocation('/')}\n            className=\"w-10 h-10 flex items-center justify-center rounded-xl glass\"\n            data-testid=\"button-back\"\n          >\n            <ChevronLeft className=\"w-5 h-5 text-foreground rtl:rotate-180\" />\n          </motion.button>\n          <div>\n            <h1 className=\"text-xl font-bold text-foreground\">\n              {isArabic ? 'طلباتي المباشرة' : 'My Direct Requests'}\n            </h1>\n            <p className=\"text-sm text-muted-foreground\">\n              {isArabic ? 'الطلبات المرسلة للمنفذين' : 'Requests sent to taskers'}\n            </p>\n          </div>\n        </motion.div>\n\n        <motion.div\n          variants={containerVariants}\n          initial=\"hidden\"\n          animate=\"visible\"\n          className=\"space-y-4\"\n        >\n          {isLoading ? (\n            Array.from({ length: 3 }).map((_, i) => (\n              <motion.div \n                key={i}\n                variants={itemVariants}\n                className=\"glass rounded-[20px] p-4 animate-pulse\"\n              >\n                <div className=\"flex gap-3\">\n                  <div className=\"w-14 h-14 rounded-full bg-muted/30\" />\n                  <div className=\"flex-1 space-y-2\">\n                    <div className=\"h-5 bg-muted/30 rounded w-1/2\" />\n                    <div className=\"h-4 bg-muted/30 rounded w-3/4\" />\n                    <div className=\"h-4 bg-muted/30 rounded w-1/3\" />\n                  </div>\n                </div>\n              </motion.div>\n            ))\n          ) : requests && requests.length > 0 ? (\n            requests.map((request, index) => {\n              const config = statusConfig[request.status as keyof typeof statusConfig] || statusConfig.pending;\n              const StatusIcon = config.icon;\n              const category = TASK_CATEGORIES_WITH_SUBS[request.category as keyof typeof TASK_CATEGORIES_WITH_SUBS];\n\n              return (\n                <motion.div\n                  key={request.id}\n                  variants={itemVariants}\n                  custom={index}\n                  className={`glass rounded-[20px] p-4 border ${config.borderColor}`}\n                  data-testid={`card-my-request-${request.id}`}\n                >\n                  <div className=\"flex items-start gap-3 mb-4\">\n                    <Link href={`/profile/${request.taskerId}`}>\n                      <Avatar className=\"w-14 h-14 border-2 border-white/10 cursor-pointer\">\n                        <AvatarImage src={request.tasker?.avatar || undefined} />\n                        <AvatarFallback className=\"bg-primary/10 text-primary font-bold text-lg\">\n                          {request.tasker?.name?.charAt(0) || 'T'}\n                        </AvatarFallback>\n                      </Avatar>\n                    </Link>\n                    \n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center justify-between gap-2 mb-1\">\n                        <Link href={`/profile/${request.taskerId}`}>\n                          <p className=\"font-bold text-foreground hover:text-primary transition-colors cursor-pointer\">\n                            {request.tasker?.name || (isArabic ? 'منفذ' : 'Tasker')}\n                          </p>\n                        </Link>\n                        <span className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold ${config.bgColor} ${config.color}`}>\n                          <StatusIcon className=\"w-3.5 h-3.5\" />\n                          {config.label}\n                        </span>\n                      </div>\n                      \n                      <p className=\"font-semibold text-foreground mb-1\">{request.title}</p>\n                      <p className=\"text-sm text-muted-foreground line-clamp-2\">{request.description}</p>\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-3 mb-4\">\n                    {category && (\n                      <div className=\"flex items-center gap-2\">\n                        <span \n                          className=\"w-3 h-3 rounded-full\"\n                          style={{ backgroundColor: category.colorHex }}\n                        />\n                        <span className=\"text-sm text-muted-foreground\">\n                          {isArabic ? category.nameAr : category.nameEn}\n                        </span>\n                      </div>\n                    )}\n                    \n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <DollarSign className=\"w-4 h-4\" />\n                      <span className=\"font-semibold text-primary\">\n                        {request.budget} {isArabic ? 'ر.س' : 'SAR'}\n                      </span>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <Calendar className=\"w-4 h-4\" />\n                      <span>{formatDate(request.scheduledDate)} - {request.scheduledTime}</span>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <MapPin className=\"w-4 h-4\" />\n                      <span className=\"truncate\">{request.location}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-2\">\n                    {request.status === 'accepted' && request.linkedTaskId && (\n                      <Link href={`/task/${request.linkedTaskId}`} className=\"flex-1\">\n                        <Button \n                          className=\"w-full gradient-primary text-white rounded-xl\"\n                          data-testid={`button-view-task-${request.id}`}\n                        >\n                          <Send className=\"w-4 h-4 me-2\" />\n                          {isArabic ? 'عرض المهمة' : 'View Task'}\n                        </Button>\n                      </Link>\n                    )}\n                    \n                    {request.status === 'pending' && (\n                      <Button\n                        variant=\"outline\"\n                        className=\"flex-1 rounded-xl border-destructive/30 text-destructive hover:bg-destructive/10\"\n                        onClick={() => cancelMutation.mutate(request.id)}\n                        disabled={cancelMutation.isPending}\n                        data-testid={`button-cancel-request-${request.id}`}\n                      >\n                        <X className=\"w-4 h-4 me-2\" />\n                        {isArabic ? 'إلغاء الطلب' : 'Cancel Request'}\n                      </Button>\n                    )}\n                  </div>\n                </motion.div>\n              );\n            })\n          ) : (\n            <motion.div \n              variants={itemVariants}\n              className=\"glass rounded-[24px] p-8 text-center\"\n            >\n              <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-muted/20 flex items-center justify-center\">\n                <Send className=\"w-8 h-8 text-muted-foreground\" />\n              </div>\n              <h3 className=\"font-bold text-lg text-foreground mb-2\">\n                {isArabic ? 'لا توجد طلبات' : 'No Requests'}\n              </h3>\n              <p className=\"text-sm text-muted-foreground mb-4\">\n                {isArabic \n                  ? 'يمكنك طلب خدمة مباشرة من صفحة أي منفذ' \n                  : 'You can request a service directly from any tasker profile'}\n              </p>\n              <Link href=\"/search-taskers\">\n                <Button className=\"gradient-primary text-white rounded-xl\" data-testid=\"button-find-taskers\">\n                  {isArabic ? 'البحث عن منفذين' : 'Find Taskers'}\n                </Button>\n              </Link>\n            </motion.div>\n          )}\n        </motion.div>\n      </div>\n    </div>\n  );\n});\n\nexport default MyDirectRequestsScreen;\n","path":null,"size_bytes":12491,"size_tokens":null},"client/public/sw.js":{"content":"const CACHE_NAME = 'tharwa-v1';\nconst STATIC_ASSETS = [\n  '/',\n  '/manifest.json',\n  '/favicon.png'\n];\n\nself.addEventListener('install', (event) => {\n  event.waitUntil(\n    caches.open(CACHE_NAME).then((cache) => {\n      return cache.addAll(STATIC_ASSETS);\n    })\n  );\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames\n          .filter((name) => name !== CACHE_NAME)\n          .map((name) => caches.delete(name))\n      );\n    })\n  );\n  self.clients.claim();\n});\n\n// Push notification event handlers\nself.addEventListener('push', (event) => {\n  if (!event.data) return;\n  \n  try {\n    const payload = event.data.json();\n    \n    const options = {\n      body: payload.body || '',\n      icon: payload.icon || '/favicon.png',\n      badge: payload.badge || '/favicon.png',\n      data: payload.data || {},\n      actions: payload.actions || [],\n      tag: payload.tag || 'tharwa-notification',\n      renotify: true,\n      requireInteraction: payload.requireInteraction || false,\n    };\n    \n    event.waitUntil(\n      self.registration.showNotification(payload.title || 'ذروة', options)\n    );\n  } catch (e) {\n    console.error('[SW] Push parse error:', e);\n  }\n});\n\nself.addEventListener('notificationclick', (event) => {\n  event.notification.close();\n  \n  const data = event.notification.data || {};\n  const url = data.url || data.actionUrl || '/';\n  \n  event.waitUntil(\n    clients.matchAll({ type: 'window', includeUncontrolled: true }).then((clientList) => {\n      for (const client of clientList) {\n        if (client.url.includes(self.location.origin) && 'focus' in client) {\n          client.focus();\n          if (url !== '/') {\n            client.navigate(url);\n          }\n          return;\n        }\n      }\n      if (clients.openWindow) {\n        return clients.openWindow(url);\n      }\n    })\n  );\n});\n\nself.addEventListener('fetch', (event) => {\n  if (event.request.method !== 'GET') return;\n  \n  const url = new URL(event.request.url);\n  \n  if (url.pathname.startsWith('/api/')) {\n    event.respondWith(\n      fetch(event.request)\n        .catch(() => {\n          return new Response(JSON.stringify({ error: 'Offline' }), {\n            status: 503,\n            headers: { 'Content-Type': 'application/json' }\n          });\n        })\n    );\n    return;\n  }\n  \n  event.respondWith(\n    caches.match(event.request).then((cached) => {\n      const fetched = fetch(event.request).then((response) => {\n        if (response.ok) {\n          const clone = response.clone();\n          caches.open(CACHE_NAME).then((cache) => {\n            cache.put(event.request, clone);\n          });\n        }\n        return response;\n      }).catch(() => cached);\n      \n      return cached || fetched;\n    })\n  );\n});\n","path":null,"size_bytes":2839,"size_tokens":null},"client/src/components/DirectServiceRequestModal.tsx":{"content":"import { useState, useCallback, memo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { createPortal } from 'react-dom';\nimport { useTranslation } from 'react-i18next';\nimport { useMutation } from '@tanstack/react-query';\nimport { FloatingInput } from './FloatingInput';\nimport { DateTimePicker } from './DateTimePicker';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { cn } from '@/lib/utils';\nimport { TASK_CATEGORIES_WITH_SUBS } from '@shared/schema';\nimport { \n  X, Calendar, Clock, MapPin, User, DollarSign, \n  FileText, Tag, Send, Loader2, CheckCircle\n} from 'lucide-react';\nimport type { User as UserType } from '@shared/schema';\n\ninterface DirectServiceRequestModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  tasker: UserType;\n}\n\ninterface RequestFormData {\n  category: string;\n  title: string;\n  description: string;\n  scheduledDate: string;\n  scheduledTime: string;\n  location: string;\n  latitude: number | null;\n  longitude: number | null;\n  budget: string;\n}\n\nconst reverseGeocode = async (lat: number, lng: number): Promise<string> => {\n  try {\n    const response = await fetch(\n      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1`\n    );\n    const data = await response.json();\n    if (data.address) {\n      const { road, suburb, city, town, village, state, country } = data.address;\n      const parts = [road, suburb || village || town, city, state].filter(Boolean);\n      return parts.slice(0, 3).join(', ') || country || 'Unknown Location';\n    }\n    return 'Unknown Location';\n  } catch {\n    return 'Unknown Location';\n  }\n};\n\nexport const DirectServiceRequestModal = memo(function DirectServiceRequestModal({\n  isOpen,\n  onClose,\n  tasker,\n}: DirectServiceRequestModalProps) {\n  const { i18n } = useTranslation();\n  const isArabic = i18n.language === 'ar';\n  const { toast } = useToast();\n  \n  const [step, setStep] = useState(1);\n  const [showDatePicker, setShowDatePicker] = useState(false);\n  const [showTimePicker, setShowTimePicker] = useState(false);\n  const [locationStatus, setLocationStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  \n  const [formData, setFormData] = useState<RequestFormData>({\n    category: '',\n    title: '',\n    description: '',\n    scheduledDate: '',\n    scheduledTime: '',\n    location: '',\n    latitude: null,\n    longitude: null,\n    budget: '',\n  });\n\n  const createRequestMutation = useMutation({\n    mutationFn: async (data: RequestFormData) => {\n      return apiRequest('POST', '/api/direct-requests', {\n        taskerId: tasker.id,\n        ...data,\n        budget: parseFloat(data.budget),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/direct-requests'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n      toast({\n        title: isArabic ? 'تم إرسال الطلب!' : 'Request Sent!',\n        description: isArabic \n          ? 'سيتم إخطارك عندما يرد المنفذ' \n          : 'You will be notified when the tasker responds',\n      });\n      resetAndClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: isArabic ? 'فشل الإرسال' : 'Failed to send',\n        description: error.message,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const resetAndClose = useCallback(() => {\n    setStep(1);\n    setFormData({\n      category: '',\n      title: '',\n      description: '',\n      scheduledDate: '',\n      scheduledTime: '',\n      location: '',\n      latitude: null,\n      longitude: null,\n      budget: '',\n    });\n    setErrors({});\n    onClose();\n  }, [onClose]);\n\n  const updateField = useCallback((field: keyof RequestFormData, value: string | number | null) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: '' }));\n    }\n  }, [errors]);\n\n  const getCurrentLocation = useCallback(() => {\n    if (!navigator.geolocation) {\n      setLocationStatus('error');\n      return;\n    }\n\n    setLocationStatus('loading');\n\n    navigator.geolocation.getCurrentPosition(\n      async (position) => {\n        const { latitude, longitude } = position.coords;\n        const locationName = await reverseGeocode(latitude, longitude);\n        \n        updateField('location', locationName);\n        updateField('latitude', latitude);\n        updateField('longitude', longitude);\n        setLocationStatus('success');\n      },\n      () => {\n        setLocationStatus('error');\n      },\n      { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }\n    );\n  }, [updateField]);\n\n  const validateStep = useCallback((stepNum: number): boolean => {\n    const newErrors: Record<string, string> = {};\n    \n    if (stepNum === 1) {\n      if (!formData.category) {\n        newErrors.category = isArabic ? 'اختر التصنيف' : 'Select a category';\n      }\n    } else if (stepNum === 2) {\n      if (!formData.title.trim()) {\n        newErrors.title = isArabic ? 'العنوان مطلوب' : 'Title is required';\n      }\n      if (!formData.description.trim()) {\n        newErrors.description = isArabic ? 'الوصف مطلوب' : 'Description is required';\n      }\n    } else if (stepNum === 3) {\n      if (!formData.budget) {\n        newErrors.budget = isArabic ? 'الميزانية مطلوبة' : 'Budget is required';\n      }\n      if (!formData.location.trim()) {\n        newErrors.location = isArabic ? 'الموقع مطلوب' : 'Location is required';\n      }\n      if (!formData.scheduledDate) {\n        newErrors.scheduledDate = isArabic ? 'التاريخ مطلوب' : 'Date is required';\n      }\n      if (!formData.scheduledTime) {\n        newErrors.scheduledTime = isArabic ? 'الوقت مطلوب' : 'Time is required';\n      }\n    }\n    \n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  }, [formData, isArabic]);\n\n  const handleNext = useCallback(() => {\n    if (validateStep(step)) {\n      setStep(s => s + 1);\n    }\n  }, [step, validateStep]);\n\n  const handleSubmit = useCallback(() => {\n    if (validateStep(3)) {\n      createRequestMutation.mutate(formData);\n    }\n  }, [formData, validateStep, createRequestMutation]);\n\n  const categoryOptions = Object.entries(TASK_CATEGORIES_WITH_SUBS).map(([key, cat]) => ({\n    id: key,\n    name: isArabic ? cat.nameAr : cat.nameEn,\n    color: cat.colorHex,\n    icon: cat.icon,\n  }));\n\n  const renderStep1 = () => (\n    <motion.div\n      key=\"step1\"\n      initial={{ opacity: 0, x: 20 }}\n      animate={{ opacity: 1, x: 0 }}\n      exit={{ opacity: 0, x: -20 }}\n      className=\"space-y-4\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Tag className=\"w-5 h-5 text-primary\" />\n        <h3 className=\"font-bold text-lg\">\n          {isArabic ? 'اختر التصنيف' : 'Choose Category'}\n        </h3>\n      </div>\n      \n      <div className=\"grid grid-cols-2 gap-3 max-h-[40vh] overflow-y-auto no-scrollbar py-2\">\n        {categoryOptions.map((cat) => (\n          <motion.button\n            key={cat.id}\n            whileTap={{ scale: 0.95 }}\n            onClick={() => updateField('category', cat.id)}\n            data-testid={`button-category-${cat.id}`}\n            className={cn(\n              \"p-4 rounded-2xl border-2 text-left transition-all\",\n              formData.category === cat.id\n                ? \"border-primary bg-primary/10\"\n                : \"border-transparent bg-muted hover:bg-muted/80\"\n            )}\n          >\n            <div \n              className=\"w-10 h-10 rounded-full flex items-center justify-center mb-2\"\n              style={{ backgroundColor: `${cat.color}20` }}\n            >\n              <span className=\"text-xl\" style={{ color: cat.color }}>\n                {cat.icon === 'sparkles' ? '✨' : \n                 cat.icon === 'graduation-cap' ? '🎓' : \n                 cat.icon === 'palette' ? '🎨' : \n                 cat.icon === 'hard-hat' ? '🔨' : \n                 cat.icon === 'star' ? '⭐' : '📦'}\n              </span>\n            </div>\n            <span className=\"font-semibold text-sm block truncate\">\n              {cat.name}\n            </span>\n          </motion.button>\n        ))}\n      </div>\n      \n      {errors.category && (\n        <p className=\"text-destructive text-sm font-medium\">{errors.category}</p>\n      )}\n    </motion.div>\n  );\n\n  const renderStep2 = () => (\n    <motion.div\n      key=\"step2\"\n      initial={{ opacity: 0, x: 20 }}\n      animate={{ opacity: 1, x: 0 }}\n      exit={{ opacity: 0, x: -20 }}\n      className=\"space-y-4\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <FileText className=\"w-5 h-5 text-primary\" />\n        <h3 className=\"font-bold text-lg\">\n          {isArabic ? 'تفاصيل الخدمة' : 'Service Details'}\n        </h3>\n      </div>\n      \n      <FloatingInput\n        label={isArabic ? 'عنوان الخدمة' : 'Service Title'}\n        value={formData.title}\n        onChange={(e) => updateField('title', e.target.value)}\n        error={errors.title}\n        data-testid=\"input-service-title\"\n      />\n      \n      <div className=\"relative\">\n        <textarea\n          value={formData.description}\n          onChange={(e) => updateField('description', e.target.value)}\n          placeholder={isArabic ? 'صف ما تحتاجه بالتفصيل...' : 'Describe what you need in detail...'}\n          className={cn(\n            \"w-full h-32 px-4 py-4 rounded-2xl border-2 bg-card shadow-sm outline-none transition-all resize-none font-medium\",\n            errors.description \n              ? \"border-destructive/50 focus:border-destructive\" \n              : \"border-transparent focus:border-primary/50\"\n          )}\n          data-testid=\"input-service-description\"\n        />\n        {errors.description && (\n          <p className=\"text-destructive text-sm font-medium mt-1\">{errors.description}</p>\n        )}\n      </div>\n    </motion.div>\n  );\n\n  const renderStep3 = () => (\n    <motion.div\n      key=\"step3\"\n      initial={{ opacity: 0, x: 20 }}\n      animate={{ opacity: 1, x: 0 }}\n      exit={{ opacity: 0, x: -20 }}\n      className=\"space-y-4\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Calendar className=\"w-5 h-5 text-primary\" />\n        <h3 className=\"font-bold text-lg\">\n          {isArabic ? 'الموعد والموقع' : 'Schedule & Location'}\n        </h3>\n      </div>\n      \n      <FloatingInput\n        label={isArabic ? 'الميزانية (ريال)' : 'Budget (SAR)'}\n        type=\"number\"\n        value={formData.budget}\n        onChange={(e) => updateField('budget', e.target.value)}\n        error={errors.budget}\n        data-testid=\"input-budget\"\n      />\n      \n      <div className=\"grid grid-cols-2 gap-3\">\n        <button\n          onClick={() => setShowDatePicker(true)}\n          data-testid=\"button-select-date\"\n          className={cn(\n            \"h-16 px-4 rounded-2xl border-2 bg-card flex items-center gap-3 transition-all text-left\",\n            formData.scheduledDate ? \"border-primary/50\" : \"border-transparent\",\n            errors.scheduledDate && \"border-destructive/50\"\n          )}\n        >\n          <Calendar className=\"w-5 h-5 text-muted-foreground\" />\n          <span className={cn(\n            \"text-sm font-medium truncate\",\n            formData.scheduledDate ? \"text-foreground\" : \"text-muted-foreground\"\n          )}>\n            {formData.scheduledDate || (isArabic ? 'التاريخ' : 'Date')}\n          </span>\n        </button>\n        \n        <button\n          onClick={() => setShowTimePicker(true)}\n          data-testid=\"button-select-time\"\n          className={cn(\n            \"h-16 px-4 rounded-2xl border-2 bg-card flex items-center gap-3 transition-all text-left\",\n            formData.scheduledTime ? \"border-primary/50\" : \"border-transparent\",\n            errors.scheduledTime && \"border-destructive/50\"\n          )}\n        >\n          <Clock className=\"w-5 h-5 text-muted-foreground\" />\n          <span className={cn(\n            \"text-sm font-medium truncate\",\n            formData.scheduledTime ? \"text-foreground\" : \"text-muted-foreground\"\n          )}>\n            {formData.scheduledTime || (isArabic ? 'الوقت' : 'Time')}\n          </span>\n        </button>\n      </div>\n      \n      <div className=\"relative\">\n        <FloatingInput\n          label={isArabic ? 'الموقع' : 'Location'}\n          value={formData.location}\n          onChange={(e) => updateField('location', e.target.value)}\n          error={errors.location}\n          data-testid=\"input-location\"\n        />\n        <button\n          onClick={getCurrentLocation}\n          className=\"absolute right-3 top-4 p-2 rounded-xl bg-primary/10 hover:bg-primary/20 transition-colors\"\n          data-testid=\"button-get-location\"\n        >\n          {locationStatus === 'loading' ? (\n            <Loader2 className=\"w-5 h-5 animate-spin text-primary\" />\n          ) : locationStatus === 'success' ? (\n            <CheckCircle className=\"w-5 h-5 text-success\" />\n          ) : (\n            <MapPin className=\"w-5 h-5 text-primary\" />\n          )}\n        </button>\n      </div>\n    </motion.div>\n  );\n\n  if (!isOpen) return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-50 flex items-end justify-center sm:items-center\">\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"absolute inset-0 bg-black/50 backdrop-blur-md\"\n        onClick={resetAndClose}\n        data-testid=\"modal-backdrop\"\n      />\n      \n      <motion.div\n        initial={{ opacity: 0, y: 100 }}\n        animate={{ opacity: 1, y: 0 }}\n        exit={{ opacity: 0, y: 100 }}\n        className=\"glass-premium w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] p-6 pb-safe shadow-2xl relative z-10\"\n        data-testid=\"modal-direct-request\"\n      >\n        <div className=\"w-12 h-1.5 bg-white/20 rounded-full mx-auto mb-4 sm:hidden\" />\n        \n        <div className=\"flex items-center justify-between mb-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center\">\n              <User className=\"w-6 h-6 text-primary\" />\n            </div>\n            <div>\n              <h2 className=\"font-bold text-lg\">\n                {isArabic ? 'طلب خدمة من' : 'Request Service from'}\n              </h2>\n              <p className=\"text-sm text-muted-foreground font-medium\">\n                {tasker.name}\n              </p>\n            </div>\n          </div>\n          <button\n            onClick={resetAndClose}\n            className=\"p-2 rounded-full hover:bg-muted transition-colors\"\n            data-testid=\"button-close-modal\"\n          >\n            <X className=\"w-6 h-6\" />\n          </button>\n        </div>\n        \n        <div className=\"flex items-center gap-2 mb-6\">\n          {[1, 2, 3].map((s) => (\n            <div\n              key={s}\n              className={cn(\n                \"h-1.5 flex-1 rounded-full transition-all\",\n                s <= step ? \"bg-primary\" : \"bg-muted\"\n              )}\n            />\n          ))}\n        </div>\n        \n        <div className=\"min-h-[280px]\">\n          <AnimatePresence mode=\"wait\">\n            {step === 1 && renderStep1()}\n            {step === 2 && renderStep2()}\n            {step === 3 && renderStep3()}\n          </AnimatePresence>\n        </div>\n        \n        <div className=\"flex gap-3 mt-6\">\n          {step > 1 && (\n            <button\n              onClick={() => setStep(s => s - 1)}\n              className=\"flex-1 h-14 bg-muted text-foreground rounded-2xl font-bold text-lg hover:bg-muted/80 transition-all\"\n              data-testid=\"button-back\"\n            >\n              {isArabic ? 'رجوع' : 'Back'}\n            </button>\n          )}\n          \n          {step < 3 ? (\n            <button\n              onClick={handleNext}\n              className=\"flex-1 h-14 bg-primary text-primary-foreground rounded-2xl font-bold text-lg hover:bg-primary/90 shadow-lg shadow-primary/25 transition-all\"\n              data-testid=\"button-next\"\n            >\n              {isArabic ? 'التالي' : 'Next'}\n            </button>\n          ) : (\n            <button\n              onClick={handleSubmit}\n              disabled={createRequestMutation.isPending}\n              className=\"flex-1 h-14 bg-primary text-primary-foreground rounded-2xl font-bold text-lg hover:bg-primary/90 shadow-lg shadow-primary/25 transition-all disabled:opacity-50 flex items-center justify-center gap-2\"\n              data-testid=\"button-submit-request\"\n            >\n              {createRequestMutation.isPending ? (\n                <Loader2 className=\"w-5 h-5 animate-spin\" />\n              ) : (\n                <>\n                  <Send className=\"w-5 h-5\" />\n                  {isArabic ? 'إرسال الطلب' : 'Send Request'}\n                </>\n              )}\n            </button>\n          )}\n        </div>\n      </motion.div>\n      \n      <DateTimePicker\n        isOpen={showDatePicker}\n        onClose={() => setShowDatePicker(false)}\n        onSelect={(value) => updateField('scheduledDate', value)}\n        mode=\"date\"\n        title={isArabic ? 'اختر التاريخ' : 'Select Date'}\n      />\n      \n      <DateTimePicker\n        isOpen={showTimePicker}\n        onClose={() => setShowTimePicker(false)}\n        onSelect={(value) => updateField('scheduledTime', value)}\n        mode=\"time\"\n        title={isArabic ? 'اختر الوقت' : 'Select Time'}\n      />\n    </div>,\n    document.body\n  );\n});\n","path":null,"size_bytes":17797,"size_tokens":null},"client/src/pages/CategoryBrowserScreen.tsx":{"content":"import { memo, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { useLocation } from 'wouter';\nimport { useTranslation } from 'react-i18next';\nimport { cn } from '@/lib/utils';\nimport { TASK_CATEGORIES_WITH_SUBS, type TaskCategoryId } from '@shared/schema';\nimport { \n  Sparkles, GraduationCap, Palette, HardHat, Star, MoreHorizontal,\n  ArrowRight, ArrowLeft\n} from 'lucide-react';\n\nconst categoryIcons: Record<TaskCategoryId, typeof Sparkles> = {\n  beauty_fashion: Sparkles,\n  teaching_education: GraduationCap,\n  art: Palette,\n  construction: HardHat,\n  special: Star,\n  other: MoreHorizontal,\n};\n\nconst CategoryBrowserScreen = memo(function CategoryBrowserScreen() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const isArabic = i18n.language === 'ar';\n\n  const handleCategorySelect = useCallback((categoryId: TaskCategoryId) => {\n    setLocation(`/post-task/1?category=${categoryId}`);\n  }, [setLocation]);\n\n  const categories = Object.entries(TASK_CATEGORIES_WITH_SUBS) as [TaskCategoryId, typeof TASK_CATEGORIES_WITH_SUBS[TaskCategoryId]][];\n\n  return (\n    <div className={cn(\n      \"min-h-screen bg-background pb-32\",\n      isArabic && \"rtl\"\n    )}>\n      <div className=\"relative overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-b from-primary/5 via-transparent to-transparent\" />\n        <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-96 h-96 bg-primary/10 rounded-full blur-3xl\" />\n        \n        <div className=\"relative pt-safe\">\n          <div className=\"px-6 pt-8 pb-6\">\n            <motion.h1 \n              initial={{ opacity: 0, y: -20 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"text-3xl font-bold text-foreground mb-2\"\n            >\n              {isArabic ? 'اختر الفئة' : 'Choose Category'}\n            </motion.h1>\n            <motion.p \n              initial={{ opacity: 0, y: -10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.1 }}\n              className=\"text-muted-foreground\"\n            >\n              {isArabic ? 'حدد نوع الخدمة التي تحتاجها' : 'Select the type of service you need'}\n            </motion.p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"px-4\">\n        <div className=\"grid grid-cols-2 gap-3\">\n          {categories.map(([categoryId, category], index) => {\n            const Icon = categoryIcons[categoryId];\n            const name = isArabic ? category.nameAr : category.nameEn;\n            const subcategoryCount = category.subcategories.length;\n            const ArrowIcon = isArabic ? ArrowLeft : ArrowRight;\n\n            return (\n              <motion.button\n                key={categoryId}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: index * 0.05 }}\n                onClick={() => handleCategorySelect(categoryId)}\n                className={cn(\n                  \"relative overflow-hidden rounded-3xl p-5 text-start transition-all\",\n                  \"backdrop-blur-xl border border-white/10\",\n                  \"bg-gradient-to-br from-white/10 to-white/5\",\n                  \"hover:from-white/15 hover:to-white/8\",\n                  \"active:scale-[0.98]\"\n                )}\n                style={{\n                  boxShadow: `0 8px 32px -8px ${category.colorHex}20`,\n                }}\n                whileTap={{ scale: 0.98 }}\n                data-testid={`button-browse-category-${categoryId}`}\n              >\n                <div \n                  className=\"absolute inset-0 opacity-20\"\n                  style={{\n                    background: `linear-gradient(135deg, ${category.colorHex}30 0%, transparent 70%)`,\n                  }}\n                />\n                \n                <div className=\"relative\">\n                  <div \n                    className=\"w-14 h-14 rounded-2xl flex items-center justify-center mb-4\"\n                    style={{\n                      background: `linear-gradient(135deg, ${category.colorHex}30 0%, ${category.colorHex}10 100%)`,\n                      boxShadow: `0 8px 24px -8px ${category.colorHex}40`,\n                    }}\n                  >\n                    <Icon \n                      className=\"w-7 h-7\"\n                      style={{ color: category.colorHex }}\n                    />\n                  </div>\n                  \n                  <h3 className=\"text-base font-bold text-foreground mb-1 line-clamp-2\">\n                    {name}\n                  </h3>\n                  \n                  {subcategoryCount > 0 && (\n                    <p className=\"text-xs text-muted-foreground mb-3\">\n                      {subcategoryCount} {isArabic ? 'تخصصات' : 'specialties'}\n                    </p>\n                  )}\n\n                  <div \n                    className=\"flex items-center gap-1.5 text-xs font-medium\"\n                    style={{ color: category.colorHex }}\n                  >\n                    <span>{isArabic ? 'اطلب الآن' : 'Request now'}</span>\n                    <ArrowIcon className=\"w-3.5 h-3.5\" />\n                  </div>\n                </div>\n              </motion.button>\n            );\n          })}\n        </div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.4 }}\n          className=\"mt-6 p-5 rounded-3xl bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl border border-white/10\"\n        >\n          <div className=\"flex items-start gap-4\">\n            <div className=\"w-12 h-12 rounded-2xl bg-primary/20 flex items-center justify-center shrink-0\">\n              <Sparkles className=\"w-6 h-6 text-primary\" />\n            </div>\n            <div>\n              <h3 className=\"text-base font-bold text-foreground mb-1\">\n                {isArabic ? 'هل تحتاج مساعدة؟' : 'Need help?'}\n              </h3>\n              <p className=\"text-sm text-muted-foreground\">\n                {isArabic \n                  ? 'اختر الفئة الأقرب لاحتياجك، ويمكنك وصف طلبك بالتفصيل في الخطوة التالية'\n                  : 'Choose the closest category to your need, and you can describe your request in detail in the next step'\n                }\n              </p>\n            </div>\n          </div>\n        </motion.div>\n      </div>\n    </div>\n  );\n});\n\nexport default CategoryBrowserScreen;\n","path":null,"size_bytes":6555,"size_tokens":null},"capacitor.config.ts":{"content":"import type { CapacitorConfig } from '@capacitor/cli';\n\n// Set your Replit URL here for iOS development\n// To find your URL: it's shown in the Webview panel, like: https://your-project.your-username.replit.app\nconst REPLIT_URL = process.env.REPLIT_URL || '';\n\nconst config: CapacitorConfig = {\n  appId: 'com.tharwa.app',\n  appName: 'THARWA',\n  webDir: 'dist/public',\n  server: {\n    androidScheme: 'https',\n    iosScheme: 'https',\n    // For development: uncomment the next line and set your Replit URL\n    // url: 'https://your-project.your-username.replit.app',\n    cleartext: true,\n  },\n  ios: {\n    contentInset: 'automatic',\n    preferredContentMode: 'mobile',\n    backgroundColor: '#0a0d1a',\n    scheme: 'TaskField',\n  },\n  plugins: {\n    SplashScreen: {\n      launchShowDuration: 2000,\n      launchAutoHide: true,\n      backgroundColor: '#0a0d1a',\n      androidSplashResourceName: 'splash',\n      androidScaleType: 'CENTER_CROP',\n      showSpinner: false,\n      iosSpinnerStyle: 'small',\n      spinnerColor: '#3b5bff',\n    },\n    StatusBar: {\n      style: 'Light',\n      backgroundColor: '#0a0d1a',\n    },\n    Keyboard: {\n      resize: 'body',\n      style: 'dark',\n      resizeOnFullScreen: true,\n    },\n  },\n};\n\nexport default config;\n","path":null,"size_bytes":1243,"size_tokens":null},"client/src/pages/AdminDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useTranslation } from \"react-i18next\";\nimport { useLocation } from \"wouter\";\nimport { \n  Users, UserCheck, UserX, Briefcase, CheckCircle, Clock, \n  AlertCircle, Shield, ChevronLeft, Eye, X, Check, Search,\n  BarChart3, TrendingUp, Award\n} from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { User } from \"@shared/schema\";\n\ntype AdminStats = {\n  totalUsers: number;\n  totalClients: number;\n  totalTaskers: number;\n  verifiedTaskers: number;\n  pendingVerifications: number;\n  totalTasks: number;\n  openTasks: number;\n  completedTasks: number;\n  assignedTasks: number;\n};\n\nexport default function AdminDashboard() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const isRTL = i18n.language === \"ar\";\n  \n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [showCertificate, setShowCertificate] = useState(false);\n  const [showRejectDialog, setShowRejectDialog] = useState(false);\n  const [rejectReason, setRejectReason] = useState(\"\");\n\n  const { data: stats, isLoading: statsLoading } = useQuery<AdminStats>({\n    queryKey: [\"/api/admin/stats\"],\n  });\n\n  const { data: users = [], isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  const { data: pendingVerifications = [], isLoading: pendingLoading } = useQuery<User[]>({\n    queryKey: [\"/api/admin/pending-verifications\"],\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: (userId: string) => apiRequest(\"POST\", `/api/admin/users/${userId}/approve`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/pending-verifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({ title: isRTL ? \"تم اعتماد المنفذ بنجاح\" : \"Tasker approved successfully\" });\n      setSelectedUser(null);\n      setShowCertificate(false);\n    },\n    onError: () => {\n      toast({ title: isRTL ? \"حدث خطأ\" : \"Error occurred\", variant: \"destructive\" });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: ({ userId, reason }: { userId: string; reason: string }) => \n      apiRequest(\"POST\", `/api/admin/users/${userId}/reject`, { reason }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/pending-verifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({ title: isRTL ? \"تم رفض الطلب\" : \"Request rejected\" });\n      setSelectedUser(null);\n      setShowCertificate(false);\n      setShowRejectDialog(false);\n      setRejectReason(\"\");\n    },\n    onError: () => {\n      toast({ title: isRTL ? \"حدث خطأ\" : \"Error occurred\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredUsers = users.filter(user => \n    user.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    user.username.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    user.email.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const StatCard = ({ icon: Icon, label, value, color, subValue }: { \n    icon: any; label: string; value: number; color: string; subValue?: string \n  }) => (\n    <Card className=\"p-4 bg-white/60 dark:bg-white/5 backdrop-blur-2xl border border-white/20\">\n      <div className=\"flex items-center gap-3\">\n        <div className={`p-3 rounded-2xl ${color}`}>\n          <Icon className=\"w-5 h-5 text-white\" />\n        </div>\n        <div className=\"flex-1\">\n          <p className=\"text-xs text-muted-foreground uppercase tracking-wider\">{label}</p>\n          <p className=\"text-2xl font-bold\">{value}</p>\n          {subValue && <p className=\"text-xs text-muted-foreground\">{subValue}</p>}\n        </div>\n      </div>\n    </Card>\n  );\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-gray-50 to-white dark:from-gray-950 dark:to-black\" dir={isRTL ? \"rtl\" : \"ltr\"}>\n      {/* Header */}\n      <div className=\"sticky top-0 z-50 bg-white/80 dark:bg-black/80 backdrop-blur-2xl border-b border-white/20\">\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center gap-3\">\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              onClick={() => setLocation(\"/\")}\n              data-testid=\"button-back\"\n            >\n              <ChevronLeft className={`w-5 h-5 ${isRTL ? \"rotate-180\" : \"\"}`} />\n            </Button>\n            <div className=\"flex items-center gap-2\">\n              <Shield className=\"w-6 h-6 text-primary\" />\n              <h1 className=\"text-xl font-bold\">{isRTL ? \"لوحة الأدمن\" : \"Admin Panel\"}</h1>\n            </div>\n          </div>\n          {stats?.pendingVerifications > 0 && (\n            <Badge variant=\"destructive\" className=\"animate-pulse\">\n              {stats.pendingVerifications} {isRTL ? \"بانتظار المراجعة\" : \"pending\"}\n            </Badge>\n          )}\n        </div>\n      </div>\n\n      <div className=\"p-4 pb-24 space-y-6\">\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"w-full bg-white/60 dark:bg-white/5 backdrop-blur-xl\">\n            <TabsTrigger value=\"overview\" className=\"flex-1\" data-testid=\"tab-overview\">\n              <BarChart3 className=\"w-4 h-4 mr-2\" />\n              {isRTL ? \"نظرة عامة\" : \"Overview\"}\n            </TabsTrigger>\n            <TabsTrigger value=\"verifications\" className=\"flex-1\" data-testid=\"tab-verifications\">\n              <Award className=\"w-4 h-4 mr-2\" />\n              {isRTL ? \"التحقق\" : \"Verify\"}\n              {pendingVerifications.length > 0 && (\n                <Badge variant=\"destructive\" className=\"ml-2 h-5 w-5 p-0 justify-center\">\n                  {pendingVerifications.length}\n                </Badge>\n              )}\n            </TabsTrigger>\n            <TabsTrigger value=\"users\" className=\"flex-1\" data-testid=\"tab-users\">\n              <Users className=\"w-4 h-4 mr-2\" />\n              {isRTL ? \"المستخدمين\" : \"Users\"}\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Overview Tab */}\n          <TabsContent value=\"overview\" className=\"mt-6 space-y-4\">\n            {statsLoading ? (\n              <div className=\"grid grid-cols-2 gap-4\">\n                {[...Array(6)].map((_, i) => (\n                  <Card key={i} className=\"p-4 h-24 animate-pulse bg-white/40\" />\n                ))}\n              </div>\n            ) : stats && (\n              <>\n                <h2 className=\"text-lg font-bold flex items-center gap-2\">\n                  <TrendingUp className=\"w-5 h-5 text-primary\" />\n                  {isRTL ? \"إحصائيات المنصة\" : \"Platform Stats\"}\n                </h2>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <StatCard \n                    icon={Users} \n                    label={isRTL ? \"إجمالي المستخدمين\" : \"Total Users\"} \n                    value={stats.totalUsers} \n                    color=\"bg-gradient-to-br from-blue-500 to-blue-600\" \n                  />\n                  <StatCard \n                    icon={UserCheck} \n                    label={isRTL ? \"العملاء\" : \"Clients\"} \n                    value={stats.totalClients} \n                    color=\"bg-gradient-to-br from-green-500 to-green-600\" \n                  />\n                  <StatCard \n                    icon={Briefcase} \n                    label={isRTL ? \"المنفذين\" : \"Taskers\"} \n                    value={stats.totalTaskers} \n                    color=\"bg-gradient-to-br from-purple-500 to-purple-600\"\n                    subValue={`${stats.verifiedTaskers} ${isRTL ? \"معتمد\" : \"verified\"}`}\n                  />\n                  <StatCard \n                    icon={AlertCircle} \n                    label={isRTL ? \"بانتظار التحقق\" : \"Pending\"} \n                    value={stats.pendingVerifications} \n                    color=\"bg-gradient-to-br from-orange-500 to-orange-600\" \n                  />\n                  <StatCard \n                    icon={Clock} \n                    label={isRTL ? \"المهام المفتوحة\" : \"Open Tasks\"} \n                    value={stats.openTasks} \n                    color=\"bg-gradient-to-br from-cyan-500 to-cyan-600\" \n                  />\n                  <StatCard \n                    icon={CheckCircle} \n                    label={isRTL ? \"المهام المكتملة\" : \"Completed\"} \n                    value={stats.completedTasks} \n                    color=\"bg-gradient-to-br from-emerald-500 to-emerald-600\" \n                  />\n                </div>\n              </>\n            )}\n          </TabsContent>\n\n          {/* Verifications Tab */}\n          <TabsContent value=\"verifications\" className=\"mt-6 space-y-4\">\n            <h2 className=\"text-lg font-bold flex items-center gap-2\">\n              <Award className=\"w-5 h-5 text-primary\" />\n              {isRTL ? \"طلبات التحقق المعلقة\" : \"Pending Verifications\"}\n            </h2>\n            \n            {pendingLoading ? (\n              <div className=\"space-y-4\">\n                {[...Array(3)].map((_, i) => (\n                  <Card key={i} className=\"p-4 h-32 animate-pulse bg-white/40\" />\n                ))}\n              </div>\n            ) : pendingVerifications.length === 0 ? (\n              <Card className=\"p-8 text-center bg-white/60 dark:bg-white/5 backdrop-blur-xl\">\n                <CheckCircle className=\"w-12 h-12 mx-auto text-green-500 mb-4\" />\n                <p className=\"text-muted-foreground\">\n                  {isRTL ? \"لا توجد طلبات معلقة\" : \"No pending verifications\"}\n                </p>\n              </Card>\n            ) : (\n              <div className=\"space-y-4\">\n                <AnimatePresence>\n                  {pendingVerifications.map((user, index) => (\n                    <motion.div\n                      key={user.id}\n                      initial={{ opacity: 0, y: 20 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, x: -100 }}\n                      transition={{ delay: index * 0.1 }}\n                    >\n                      <Card className=\"p-4 bg-white/60 dark:bg-white/5 backdrop-blur-xl border border-orange-500/30\">\n                        <div className=\"flex items-start gap-4\">\n                          <div className=\"w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center text-white font-bold text-xl\">\n                            {user.name.charAt(0)}\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <h3 className=\"font-bold truncate\">{user.name}</h3>\n                            <p className=\"text-sm text-muted-foreground truncate\">@{user.username}</p>\n                            <p className=\"text-xs text-muted-foreground\">{user.email}</p>\n                            <Badge variant=\"outline\" className=\"mt-2\">\n                              {user.taskerType === 'specialized' ? (isRTL ? 'متخصص' : 'Specialized') : (isRTL ? 'عام' : 'General')}\n                            </Badge>\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex gap-2 mt-4\">\n                          <Button \n                            className=\"flex-1\" \n                            variant=\"outline\"\n                            onClick={() => {\n                              setSelectedUser(user);\n                              setShowCertificate(true);\n                            }}\n                            data-testid={`button-view-certificate-${user.id}`}\n                          >\n                            <Eye className=\"w-4 h-4 mr-2\" />\n                            {isRTL ? \"عرض الشهادة\" : \"View Certificate\"}\n                          </Button>\n                          <Button \n                            className=\"flex-1 bg-gradient-to-r from-green-500 to-green-600\"\n                            onClick={() => approveMutation.mutate(user.id)}\n                            disabled={approveMutation.isPending}\n                            data-testid={`button-approve-${user.id}`}\n                          >\n                            <Check className=\"w-4 h-4 mr-2\" />\n                            {isRTL ? \"اعتماد\" : \"Approve\"}\n                          </Button>\n                          <Button \n                            variant=\"destructive\"\n                            size=\"icon\"\n                            onClick={() => {\n                              setSelectedUser(user);\n                              setShowRejectDialog(true);\n                            }}\n                            data-testid={`button-reject-${user.id}`}\n                          >\n                            <X className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </Card>\n                    </motion.div>\n                  ))}\n                </AnimatePresence>\n              </div>\n            )}\n          </TabsContent>\n\n          {/* Users Tab */}\n          <TabsContent value=\"users\" className=\"mt-6 space-y-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground\" />\n              <Input \n                placeholder={isRTL ? \"بحث عن مستخدم...\" : \"Search users...\"}\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10 bg-white/60 dark:bg-white/5 backdrop-blur-xl\"\n                data-testid=\"input-search-users\"\n              />\n            </div>\n\n            {usersLoading ? (\n              <div className=\"space-y-2\">\n                {[...Array(5)].map((_, i) => (\n                  <Card key={i} className=\"p-4 h-20 animate-pulse bg-white/40\" />\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {filteredUsers.map((user) => (\n                  <Card \n                    key={user.id} \n                    className=\"p-4 bg-white/60 dark:bg-white/5 backdrop-blur-xl\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold ${\n                        user.role === 'tasker' \n                          ? 'bg-gradient-to-br from-purple-500 to-purple-600' \n                          : 'bg-gradient-to-br from-blue-500 to-blue-600'\n                      }`}>\n                        {user.name.charAt(0)}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2\">\n                          <h3 className=\"font-semibold truncate\">{user.name}</h3>\n                          {user.isAdmin && (\n                            <Badge variant=\"secondary\" className=\"text-xs\">Admin</Badge>\n                          )}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground truncate\">@{user.username}</p>\n                      </div>\n                      <div className=\"flex flex-col items-end gap-1\">\n                        <Badge variant={user.role === 'tasker' ? 'default' : 'outline'}>\n                          {user.role === 'tasker' ? (isRTL ? 'منفذ' : 'Tasker') : (isRTL ? 'عميل' : 'Client')}\n                        </Badge>\n                        {user.role === 'tasker' && (\n                          <Badge \n                            variant=\"outline\" \n                            className={\n                              user.verificationStatus === 'approved' ? 'border-green-500 text-green-500' :\n                              user.verificationStatus === 'pending' ? 'border-orange-500 text-orange-500' :\n                              'border-red-500 text-red-500'\n                            }\n                          >\n                            {user.verificationStatus === 'approved' ? (isRTL ? 'معتمد' : 'Verified') :\n                             user.verificationStatus === 'pending' ? (isRTL ? 'معلق' : 'Pending') :\n                             (isRTL ? 'مرفوض' : 'Rejected')}\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      {/* Certificate View Dialog */}\n      <Dialog open={showCertificate} onOpenChange={setShowCertificate}>\n        <DialogContent className=\"max-w-lg bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl\">\n          <DialogHeader>\n            <DialogTitle>{isRTL ? \"شهادة المنفذ\" : \"Tasker Certificate\"}</DialogTitle>\n            <DialogDescription>\n              {selectedUser?.name} - @{selectedUser?.username}\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedUser?.certificateUrl ? (\n            <div className=\"space-y-4\">\n              <div className=\"rounded-xl overflow-hidden border\">\n                <img \n                  src={selectedUser.certificateUrl} \n                  alt=\"Certificate\" \n                  className=\"w-full h-auto\"\n                />\n              </div>\n              <div className=\"flex gap-2\">\n                <Button \n                  className=\"flex-1 bg-gradient-to-r from-green-500 to-green-600\"\n                  onClick={() => approveMutation.mutate(selectedUser.id)}\n                  disabled={approveMutation.isPending}\n                  data-testid=\"button-approve-dialog\"\n                >\n                  <Check className=\"w-4 h-4 mr-2\" />\n                  {isRTL ? \"اعتماد الشهادة\" : \"Approve Certificate\"}\n                </Button>\n                <Button \n                  variant=\"destructive\"\n                  onClick={() => {\n                    setShowCertificate(false);\n                    setShowRejectDialog(true);\n                  }}\n                  data-testid=\"button-reject-dialog\"\n                >\n                  <X className=\"w-4 h-4 mr-2\" />\n                  {isRTL ? \"رفض\" : \"Reject\"}\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <AlertCircle className=\"w-12 h-12 mx-auto text-orange-500 mb-4\" />\n              <p className=\"text-muted-foreground\">\n                {isRTL ? \"لم يتم رفع شهادة\" : \"No certificate uploaded\"}\n              </p>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Reject Dialog */}\n      <Dialog open={showRejectDialog} onOpenChange={setShowRejectDialog}>\n        <DialogContent className=\"max-w-md bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl\">\n          <DialogHeader>\n            <DialogTitle>{isRTL ? \"رفض طلب التحقق\" : \"Reject Verification\"}</DialogTitle>\n            <DialogDescription>\n              {isRTL ? \"أدخل سبب الرفض (اختياري)\" : \"Enter rejection reason (optional)\"}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Textarea \n            placeholder={isRTL ? \"سبب الرفض...\" : \"Rejection reason...\"}\n            value={rejectReason}\n            onChange={(e) => setRejectReason(e.target.value)}\n            className=\"min-h-[100px]\"\n            data-testid=\"input-reject-reason\"\n          />\n          \n          <div className=\"flex gap-2\">\n            <Button \n              variant=\"outline\" \n              className=\"flex-1\"\n              onClick={() => setShowRejectDialog(false)}\n            >\n              {isRTL ? \"إلغاء\" : \"Cancel\"}\n            </Button>\n            <Button \n              variant=\"destructive\"\n              className=\"flex-1\"\n              onClick={() => selectedUser && rejectMutation.mutate({ \n                userId: selectedUser.id, \n                reason: rejectReason \n              })}\n              disabled={rejectMutation.isPending}\n              data-testid=\"button-confirm-reject\"\n            >\n              {isRTL ? \"تأكيد الرفض\" : \"Confirm Reject\"}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":21417,"size_tokens":null},"server/email.ts":{"content":"import { Resend } from 'resend';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=resend',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  if (!connectionSettings || (!connectionSettings.settings.api_key)) {\n    throw new Error('Resend not connected');\n  }\n  return { apiKey: connectionSettings.settings.api_key, fromEmail: connectionSettings.settings.from_email };\n}\n\nasync function getResendClient() {\n  const { apiKey, fromEmail } = await getCredentials();\n  return {\n    client: new Resend(apiKey),\n    fromEmail\n  };\n}\n\nexport async function sendOtpEmail(to: string, code: string, type: 'registration' | 'login' | 'password_reset' | 'email_verification') {\n  try {\n    const { client, fromEmail } = await getResendClient();\n    \n    const subjects = {\n      registration: 'THARWA - رمز التحقق للتسجيل | Verification Code',\n      login: 'THARWA - رمز الدخول | Login Code',\n      password_reset: 'THARWA - إعادة تعيين كلمة المرور | Password Reset',\n      email_verification: 'THARWA - تأكيد البريد الإلكتروني | Email Verification'\n    };\n\n    const htmlContent = `\n<!DOCTYPE html>\n<html dir=\"rtl\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <style>\n    body { font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); margin: 0; padding: 40px 20px; }\n    .container { max-width: 480px; margin: 0 auto; background: rgba(255,255,255,0.95); border-radius: 24px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }\n    .logo { text-align: center; margin-bottom: 30px; }\n    .logo h1 { background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 32px; margin: 0; }\n    .code-box { background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); border-radius: 16px; padding: 24px; text-align: center; margin: 30px 0; }\n    .code { font-size: 36px; font-weight: 800; letter-spacing: 8px; color: white; margin: 0; }\n    .message { color: #4a5568; font-size: 16px; line-height: 1.6; text-align: center; }\n    .message-ar { font-size: 18px; margin-bottom: 20px; }\n    .message-en { font-size: 14px; color: #718096; }\n    .footer { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0; color: #a0aec0; font-size: 12px; }\n    .warning { background: #fff5f5; border-radius: 12px; padding: 16px; margin-top: 20px; color: #c53030; font-size: 13px; text-align: center; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"logo\">\n      <h1>ذروة THARWA</h1>\n    </div>\n    \n    <div class=\"message message-ar\">\n      ${type === 'registration' ? 'مرحباً بك في ذروة! استخدم هذا الرمز لإكمال تسجيلك:' :\n        type === 'login' ? 'استخدم هذا الرمز لتسجيل الدخول إلى حسابك:' :\n        type === 'password_reset' ? 'استخدم هذا الرمز لإعادة تعيين كلمة المرور:' :\n        'استخدم هذا الرمز لتأكيد بريدك الإلكتروني:'}\n    </div>\n    \n    <div class=\"code-box\">\n      <p class=\"code\">${code}</p>\n    </div>\n    \n    <div class=\"message message-en\">\n      ${type === 'registration' ? 'Welcome to THARWA! Use this code to complete your registration.' :\n        type === 'login' ? 'Use this code to sign in to your account.' :\n        type === 'password_reset' ? 'Use this code to reset your password.' :\n        'Use this code to verify your email address.'}\n    </div>\n    \n    <div class=\"warning\">\n      ⚠️ هذا الرمز صالح لمدة 10 دقائق فقط. لا تشاركه مع أحد.<br/>\n      This code expires in 10 minutes. Never share it with anyone.\n    </div>\n    \n    <div class=\"footer\">\n      <p>© ${new Date().getFullYear()} THARWA - ذروة</p>\n      <p>Riyadh, Saudi Arabia</p>\n    </div>\n  </div>\n</body>\n</html>\n    `;\n\n    const result = await client.emails.send({\n      from: fromEmail || 'THARWA <noreply@resend.dev>',\n      to: [to],\n      subject: subjects[type],\n      html: htmlContent,\n    });\n\n    console.log(`[Email] OTP sent to ${to} for ${type}:`, result);\n    return { success: true, id: result.data?.id };\n  } catch (error: any) {\n    console.error('[Email] Failed to send OTP:', error);\n    return { success: false, error: error.message };\n  }\n}\n","path":null,"size_bytes":5098,"size_tokens":null},"server/sms.ts":{"content":"// Authentica SMS Service for OTP verification (Saudi Arabia)\n// API Documentation: https://authenticasa.docs.apiary.io\n\nconst AUTHENTICA_API_KEY = process.env.AUTHENTICA_API_KEY;\n\ninterface SmsResponse {\n  success: boolean;\n  messageId?: string;\n  error?: string;\n}\n\nexport async function sendOtpSms(phoneNumber: string, code: string, type: 'registration' | 'login' | 'password_reset'): Promise<SmsResponse> {\n  if (!AUTHENTICA_API_KEY) {\n    console.error('[SMS] Authentica API key not configured');\n    return { success: false, error: 'SMS service not configured' };\n  }\n\n  // Format phone number to international format (+966...)\n  const formattedPhone = formatPhoneNumber(phoneNumber);\n  \n  try {\n    // Use Authentica's send-otp endpoint\n    // Template 1 is the default Arabic template\n    const response = await fetch('https://api.authentica.sa/api/v2/send-otp', {\n      method: 'POST',\n      headers: {\n        'X-Authorization': AUTHENTICA_API_KEY,\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      body: JSON.stringify({\n        method: 'sms',\n        phone: formattedPhone,\n        otp: code,\n        template_id: 1 // Default Arabic template\n      })\n    });\n\n    const data = await response.json();\n    \n    if (!response.ok) {\n      console.error('[SMS] Authentica error:', data);\n      return { success: false, error: data.message || data.error || 'Failed to send SMS' };\n    }\n\n    // Check if OTP was sent successfully\n    if (data.success || data.status === 'success' || response.status === 200) {\n      console.log(`[SMS] OTP sent via Authentica to ${formattedPhone} for ${type}`);\n      return { success: true, messageId: data.transaction_id || data.id };\n    }\n\n    console.error('[SMS] Unexpected Authentica response:', data);\n    return { success: false, error: data.message || 'Unknown error' };\n  } catch (error: any) {\n    console.error('[SMS] Failed to send OTP via Authentica:', error);\n    return { success: false, error: error.message };\n  }\n}\n\nexport async function verifyOtpWithAuthentica(phoneNumber: string, code: string): Promise<{ success: boolean; error?: string }> {\n  if (!AUTHENTICA_API_KEY) {\n    return { success: false, error: 'SMS service not configured' };\n  }\n\n  const formattedPhone = formatPhoneNumber(phoneNumber);\n\n  try {\n    const response = await fetch('https://api.authentica.sa/api/v2/verify-otp', {\n      method: 'POST',\n      headers: {\n        'X-Authorization': AUTHENTICA_API_KEY,\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      body: JSON.stringify({\n        phone: formattedPhone,\n        otp: code\n      })\n    });\n\n    const data = await response.json();\n\n    if (response.ok && (data.success || data.verified || data.status === 'success')) {\n      return { success: true };\n    }\n\n    return { success: false, error: data.message || 'Invalid OTP' };\n  } catch (error: any) {\n    console.error('[SMS] Failed to verify OTP via Authentica:', error);\n    return { success: false, error: error.message };\n  }\n}\n\nfunction formatPhoneNumber(phone: string): string {\n  // Remove any spaces, dashes, or special characters\n  let cleaned = phone.replace(/[\\s\\-\\(\\)\\.]/g, '');\n  \n  // If it starts with 0, assume Saudi Arabia and replace with +966\n  if (cleaned.startsWith('0')) {\n    cleaned = '+966' + cleaned.substring(1);\n  }\n  \n  // If it doesn't start with +, add it\n  if (!cleaned.startsWith('+')) {\n    // If it starts with 966, add +\n    if (cleaned.startsWith('966')) {\n      cleaned = '+' + cleaned;\n    } else {\n      // Assume Saudi Arabia\n      cleaned = '+966' + cleaned;\n    }\n  }\n  \n  return cleaned;\n}\n\nexport function isValidSaudiPhone(phone: string): boolean {\n  const cleaned = phone.replace(/[\\s\\-\\(\\)\\.]/g, '');\n  \n  // Saudi mobile numbers start with 05 or +9665\n  // Valid formats: 05XXXXXXXX, 5XXXXXXXX, 9665XXXXXXXX, +9665XXXXXXXX\n  const patterns = [\n    /^05\\d{8}$/,           // 05XXXXXXXX\n    /^5\\d{8}$/,            // 5XXXXXXXX\n    /^9665\\d{8}$/,         // 9665XXXXXXXX\n    /^\\+9665\\d{8}$/        // +9665XXXXXXXX\n  ];\n  \n  return patterns.some(pattern => pattern.test(cleaned));\n}\n","path":null,"size_bytes":4163,"size_tokens":null},"client/src/lib/config.ts":{"content":"// API Configuration for Capacitor iOS app\n// \n// When running in Xcode simulator, the app needs to connect to your Replit backend.\n// Replace the URL below with your actual Replit URL.\n// \n// To find your URL:\n// 1. Open your Replit project\n// 2. Look at the Webview panel URL or click \"Open in new tab\"\n// 3. Copy the URL (e.g., https://your-project.your-username.replit.app)\n\n// Set this to your Replit URL when testing in Xcode\n// Leave empty ('') to use relative URLs (for web/PWA mode)\nexport const REPLIT_API_URL = 'https://758b6ce0-8b1f-4d3b-91fc-8a652cb0679b-00-1f8q924g3ablw.worf.replit.dev';\n\n// Detect if running in Capacitor native app\nexport const isCapacitor = typeof window !== 'undefined' && \n  (window as any).Capacitor !== undefined;\n\n// Get the base URL for API calls\nexport function getApiBaseUrl(): string {\n  // If a Replit URL is configured, use it\n  if (REPLIT_API_URL) {\n    return REPLIT_API_URL;\n  }\n  \n  // In Capacitor, we need an absolute URL\n  if (isCapacitor) {\n    // Default to empty - user must set REPLIT_API_URL\n    console.warn('Running in Capacitor but no REPLIT_API_URL configured. API calls may fail.');\n    return '';\n  }\n  \n  // In browser/PWA, use relative URLs\n  return '';\n}\n\n// Build full API URL\nexport function buildApiUrl(path: string): string {\n  const baseUrl = getApiBaseUrl();\n  if (baseUrl) {\n    return `${baseUrl}${path}`;\n  }\n  return path;\n}\n","path":null,"size_bytes":1402,"size_tokens":null},"server/levels.ts":{"content":"// Tasker Level System\n// Levels: bronze → silver → gold → platinum → diamond\n\nexport type TaskerLevel = 'bronze' | 'silver' | 'gold' | 'platinum' | 'diamond';\n\nexport interface LevelInfo {\n  level: TaskerLevel;\n  nameAr: string;\n  nameEn: string;\n  minPoints: number;\n  maxPoints: number;\n  color: string;\n  icon: string;\n  benefits: string[];\n}\n\nexport const LEVELS: LevelInfo[] = [\n  {\n    level: 'bronze',\n    nameAr: 'برونزي',\n    nameEn: 'Bronze',\n    minPoints: 0,\n    maxPoints: 99,\n    color: 'amber-700',\n    icon: 'award',\n    benefits: ['الوصول للمهام الأساسية'],\n  },\n  {\n    level: 'silver',\n    nameAr: 'فضي',\n    nameEn: 'Silver',\n    minPoints: 100,\n    maxPoints: 299,\n    color: 'gray-400',\n    icon: 'star',\n    benefits: ['أولوية في العروض', 'شارة مميزة'],\n  },\n  {\n    level: 'gold',\n    nameAr: 'ذهبي',\n    nameEn: 'Gold',\n    minPoints: 300,\n    maxPoints: 599,\n    color: 'yellow-500',\n    icon: 'trophy',\n    benefits: ['ظهور في أعلى نتائج البحش', 'عمولة مخفضة 4%'],\n  },\n  {\n    level: 'platinum',\n    nameAr: 'بلاتيني',\n    nameEn: 'Platinum',\n    minPoints: 600,\n    maxPoints: 999,\n    color: 'purple-500',\n    icon: 'crown',\n    benefits: ['شارة بلاتينية', 'عمولة مخفضة 3%', 'دعم أولوية'],\n  },\n  {\n    level: 'diamond',\n    nameAr: 'ماسي',\n    nameEn: 'Diamond',\n    minPoints: 1000,\n    maxPoints: Infinity,\n    color: 'cyan-500',\n    icon: 'diamond',\n    benefits: ['شارة ماسية', 'عمولة مخفضة 2%', 'دعم VIP', 'مكافآت حصرية'],\n  },\n];\n\n// Points earned for different actions\nexport const POINT_VALUES = {\n  taskCompleted: 10,\n  fiveStarRating: 5,\n  fourStarRating: 3,\n  threeStarRating: 1,\n  repeatClient: 5,\n  fastCompletion: 3, // Completed before scheduled time\n  directRequest: 2,\n};\n\n// Calculate level from experience points\nexport function calculateLevel(experiencePoints: number): TaskerLevel {\n  for (let i = LEVELS.length - 1; i >= 0; i--) {\n    if (experiencePoints >= LEVELS[i].minPoints) {\n      return LEVELS[i].level;\n    }\n  }\n  return 'bronze';\n}\n\n// Get level info\nexport function getLevelInfo(level: TaskerLevel): LevelInfo {\n  return LEVELS.find(l => l.level === level) || LEVELS[0];\n}\n\n// Calculate progress to next level\nexport function calculateProgress(experiencePoints: number): {\n  currentLevel: LevelInfo;\n  nextLevel: LevelInfo | null;\n  progressPercent: number;\n  pointsToNext: number;\n} {\n  const currentLevel = getLevelInfo(calculateLevel(experiencePoints));\n  const currentIndex = LEVELS.findIndex(l => l.level === currentLevel.level);\n  const nextLevel = currentIndex < LEVELS.length - 1 ? LEVELS[currentIndex + 1] : null;\n  \n  if (!nextLevel) {\n    return {\n      currentLevel,\n      nextLevel: null,\n      progressPercent: 100,\n      pointsToNext: 0,\n    };\n  }\n  \n  const levelRange = nextLevel.minPoints - currentLevel.minPoints;\n  const pointsInLevel = experiencePoints - currentLevel.minPoints;\n  const progressPercent = Math.min(100, Math.round((pointsInLevel / levelRange) * 100));\n  const pointsToNext = nextLevel.minPoints - experiencePoints;\n  \n  return {\n    currentLevel,\n    nextLevel,\n    progressPercent,\n    pointsToNext,\n  };\n}\n\n// Get commission rate based on level\nexport function getCommissionRate(level: TaskerLevel): number {\n  switch (level) {\n    case 'diamond': return 0.02;\n    case 'platinum': return 0.03;\n    case 'gold': return 0.04;\n    default: return 0.05; // 5% default\n  }\n}\n","path":null,"size_bytes":3546,"size_tokens":null},"client/src/hooks/useBiometricAuth.ts":{"content":"// Biometric Authentication Hook for iOS Face ID / Touch ID\nimport { useState, useCallback } from 'react';\nimport { Capacitor } from '@capacitor/core';\nimport { useApp } from '@/context/AppContext';\nimport { useToast } from '@/hooks/use-toast';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\n\n// Note: For full biometric support, @capacitor-community/biometric-auth plugin is needed\n// This implementation provides a fallback for web and basic structure for native\n\ninterface BiometricResult {\n  success: boolean;\n  error?: string;\n}\n\nexport function useBiometricAuth() {\n  const [isSupported, setIsSupported] = useState(false);\n  const [isEnabled, setIsEnabled] = useState(false);\n  const { user } = useApp();\n  const { toast } = useToast();\n\n  // Update biometric preference on server\n  const updateBiometricMutation = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      const response = await apiRequest('PATCH', '/api/users/me', {\n        biometricEnabled: enabled,\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setIsEnabled(data.biometricEnabled);\n    },\n  });\n\n  // Check if biometric auth is available\n  const checkAvailability = useCallback(async (): Promise<boolean> => {\n    if (Capacitor.isNativePlatform()) {\n      // On iOS, biometrics are available\n      // Full implementation would use @capacitor-community/biometric-auth\n      setIsSupported(true);\n      return true;\n    } else if (window.PublicKeyCredential) {\n      // Web Authentication API for passkeys/biometrics\n      try {\n        const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();\n        setIsSupported(available);\n        return available;\n      } catch {\n        return false;\n      }\n    }\n    return false;\n  }, []);\n\n  // Authenticate with biometrics\n  const authenticate = useCallback(async (): Promise<BiometricResult> => {\n    if (Capacitor.isNativePlatform()) {\n      // Native iOS/Android biometric auth\n      // Full implementation would use:\n      // import { BiometricAuth } from '@capacitor-community/biometric-auth';\n      // const result = await BiometricAuth.authenticate({\n      //   reason: 'تسجيل الدخول إلى ذروة',\n      //   title: 'التحقق من الهوية',\n      // });\n      \n      toast({\n        title: 'Face ID / Touch ID',\n        description: 'سيتم تفعيل هذه الميزة قريباً',\n      });\n      \n      return { success: false, error: 'Native biometrics require additional plugin' };\n    } else if (window.PublicKeyCredential) {\n      // Web Authentication API\n      try {\n        // This is a simplified version - full implementation needs proper WebAuthn setup\n        toast({\n          title: 'البصمة / Face ID',\n          description: 'متاحة على التطبيق الأصلي فقط',\n        });\n        return { success: false, error: 'Web biometrics not fully implemented' };\n      } catch (error: any) {\n        return { success: false, error: error.message };\n      }\n    }\n    \n    return { success: false, error: 'Biometrics not supported' };\n  }, [toast]);\n\n  // Enable biometric auth\n  const enable = useCallback(async (): Promise<boolean> => {\n    const result = await authenticate();\n    if (result.success) {\n      updateBiometricMutation.mutate(true);\n      toast({\n        title: 'تم تفعيل البصمة',\n        description: 'يمكنك الآن تسجيل الدخول بالبصمة',\n      });\n      return true;\n    }\n    return false;\n  }, [authenticate, updateBiometricMutation, toast]);\n\n  // Disable biometric auth\n  const disable = useCallback(async (): Promise<void> => {\n    updateBiometricMutation.mutate(false);\n    toast({\n      title: 'تم إلغاء البصمة',\n      description: 'لن يتم استخدام البصمة لتسجيل الدخول',\n    });\n  }, [updateBiometricMutation, toast]);\n\n  return {\n    isSupported,\n    isEnabled: user?.biometricEnabled || isEnabled,\n    checkAvailability,\n    authenticate,\n    enable,\n    disable,\n    isLoading: updateBiometricMutation.isPending,\n  };\n}\n","path":null,"size_bytes":4154,"size_tokens":null},"client/src/pages/PendingApprovalScreen.tsx":{"content":"import { memo, useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { motion } from 'framer-motion';\nimport { useTranslation } from 'react-i18next';\nimport { useApp } from '@/context/AppContext';\nimport { Clock, RefreshCw, LogOut, CheckCircle } from 'lucide-react';\nimport { useQuery } from '@tanstack/react-query';\nimport type { User } from '@shared/schema';\n\nconst PendingApprovalScreen = memo(function PendingApprovalScreen() {\n  const [, setLocation] = useLocation();\n  const { t, i18n } = useTranslation();\n  const { user, setUser, logout } = useApp();\n  const isArabic = i18n.language === 'ar';\n\n  const { data: currentUser, refetch } = useQuery<User>({\n    queryKey: ['/api/users/me'],\n    refetchInterval: 10000,\n  });\n\n  useEffect(() => {\n    if (currentUser) {\n      setUser(currentUser);\n      if (currentUser.verificationStatus === 'approved') {\n        setLocation('/home');\n      }\n    }\n  }, [currentUser, setUser, setLocation]);\n\n  const handleLogout = () => {\n    logout();\n    setLocation('/');\n  };\n\n  const handleRefresh = () => {\n    refetch();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-background to-primary/5 flex items-center justify-center p-6\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.3 }}\n          className=\"absolute top-20 -left-20 w-64 h-64 bg-primary/20 rounded-full blur-3xl\"\n        />\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 0.2 }}\n          className=\"absolute bottom-40 -right-20 w-80 h-80 bg-accent/20 rounded-full blur-3xl\"\n        />\n      </div>\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"relative z-10 w-full max-w-md space-y-6\"\n      >\n        <div className=\"glass rounded-3xl p-8 text-center\">\n          <motion.div\n            animate={{ \n              scale: [1, 1.05, 1],\n            }}\n            transition={{\n              duration: 2,\n              repeat: Infinity,\n              ease: \"easeInOut\"\n            }}\n            className=\"w-24 h-24 rounded-full bg-warning/15 flex items-center justify-center mx-auto mb-6\"\n          >\n            <Clock className=\"w-12 h-12 text-warning\" />\n          </motion.div>\n          \n          <h1 className=\"text-2xl font-bold text-foreground mb-3\">\n            {isArabic ? 'جاري مراجعة حسابك' : 'Account Under Review'}\n          </h1>\n          \n          <p className=\"text-muted-foreground leading-relaxed\">\n            {isArabic \n              ? 'شكراً لتسجيلك كمنفذ. فريقنا يراجع طلبك حالياً وسيتم إشعارك فور الموافقة على حسابك.'\n              : 'Thank you for registering as a tasker. Our team is currently reviewing your application and you will be notified once your account is approved.'}\n          </p>\n        </div>\n\n        <div className=\"glass rounded-2xl p-4\">\n          <div className=\"flex items-start gap-3\">\n            <CheckCircle className=\"w-5 h-5 text-primary flex-shrink-0 mt-0.5\" />\n            <div className=\"text-sm text-muted-foreground text-start\">\n              <p className=\"font-medium text-foreground mb-1\">\n                {isArabic ? 'ماذا يحدث الآن؟' : 'What happens now?'}\n              </p>\n              <ul className=\"space-y-1\">\n                <li>{isArabic ? '• مراجعة بياناتك وشهادتك' : '• Your information and certificate are being reviewed'}</li>\n                <li>{isArabic ? '• ستتلقى إشعاراً عند الموافقة' : '• You will receive a notification upon approval'}</li>\n                <li>{isArabic ? '• عادةً ما يستغرق 24-48 ساعة' : '• Usually takes 24-48 hours'}</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3\">\n          <motion.button\n            whileTap={{ scale: 0.98 }}\n            onClick={handleRefresh}\n            className=\"flex-1 py-4 px-6 rounded-2xl glass flex items-center justify-center gap-2 font-medium\"\n            data-testid=\"button-refresh-status\"\n          >\n            <RefreshCw className=\"w-5 h-5\" />\n            <span>{isArabic ? 'تحديث الحالة' : 'Refresh Status'}</span>\n          </motion.button>\n          \n          <motion.button\n            whileTap={{ scale: 0.98 }}\n            onClick={handleLogout}\n            className=\"py-4 px-6 rounded-2xl glass flex items-center justify-center gap-2 text-muted-foreground\"\n            data-testid=\"button-logout\"\n          >\n            <LogOut className=\"w-5 h-5\" />\n          </motion.button>\n        </div>\n\n        <p className=\"text-center text-xs text-muted-foreground\">\n          {isArabic \n            ? 'هل لديك أسئلة؟ تواصل معنا عبر صفحة المساعدة'\n            : 'Have questions? Contact us through the help page'}\n        </p>\n      </motion.div>\n    </div>\n  );\n});\n\nexport default PendingApprovalScreen;\n","path":null,"size_bytes":5126,"size_tokens":null},"client/src/components/DetailedRating.tsx":{"content":"// Enhanced Rating Component with detailed subcategories\nimport { Star, Wrench, Clock, MessageCircle } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface StarRatingProps {\n  rating: number;\n  onChange?: (rating: number) => void;\n  readonly?: boolean;\n  size?: 'sm' | 'md' | 'lg';\n  showValue?: boolean;\n}\n\nexport function StarRating({ \n  rating, \n  onChange, \n  readonly = false, \n  size = 'md',\n  showValue = false \n}: StarRatingProps) {\n  const sizeClasses = {\n    sm: 'w-4 h-4',\n    md: 'w-5 h-5',\n    lg: 'w-6 h-6',\n  };\n  \n  const handleClick = (star: number) => {\n    if (!readonly && onChange) {\n      onChange(star);\n    }\n  };\n  \n  return (\n    <div className=\"flex items-center gap-1\">\n      {[1, 2, 3, 4, 5].map((star) => (\n        <button\n          key={star}\n          type=\"button\"\n          onClick={() => handleClick(star)}\n          disabled={readonly}\n          className={cn(\n            \"transition-transform\",\n            !readonly && \"hover:scale-110 cursor-pointer\",\n            readonly && \"cursor-default\"\n          )}\n          data-testid={`star-${star}`}\n        >\n          <Star\n            className={cn(\n              sizeClasses[size],\n              star <= rating\n                ? \"fill-yellow-400 text-yellow-400\"\n                : \"fill-transparent text-muted-foreground\"\n            )}\n          />\n        </button>\n      ))}\n      {showValue && (\n        <span className=\"text-sm text-muted-foreground mr-1\">\n          ({rating.toFixed(1)})\n        </span>\n      )}\n    </div>\n  );\n}\n\ninterface DetailedRatingCategory {\n  key: 'quality' | 'speed' | 'communication';\n  label: string;\n  icon: typeof Wrench;\n  rating: number;\n}\n\ninterface DetailedRatingInputProps {\n  overallRating: number;\n  qualityRating: number;\n  speedRating: number;\n  communicationRating: number;\n  onOverallChange: (rating: number) => void;\n  onQualityChange: (rating: number) => void;\n  onSpeedChange: (rating: number) => void;\n  onCommunicationChange: (rating: number) => void;\n}\n\nexport function DetailedRatingInput({\n  overallRating,\n  qualityRating,\n  speedRating,\n  communicationRating,\n  onOverallChange,\n  onQualityChange,\n  onSpeedChange,\n  onCommunicationChange,\n}: DetailedRatingInputProps) {\n  const categories: DetailedRatingCategory[] = [\n    { key: 'quality', label: 'جودة العمل', icon: Wrench, rating: qualityRating },\n    { key: 'speed', label: 'سرعة الإنجاز', icon: Clock, rating: speedRating },\n    { key: 'communication', label: 'التواصل', icon: MessageCircle, rating: communicationRating },\n  ];\n  \n  const handleCategoryChange = (key: string, value: number) => {\n    switch (key) {\n      case 'quality': onQualityChange(value); break;\n      case 'speed': onSpeedChange(value); break;\n      case 'communication': onCommunicationChange(value); break;\n    }\n  };\n  \n  return (\n    <div className=\"space-y-4\" data-testid=\"detailed-rating-input\">\n      <div className=\"text-center space-y-2\">\n        <p className=\"text-sm text-muted-foreground\">التقييم العام</p>\n        <div className=\"flex justify-center\">\n          <StarRating \n            rating={overallRating} \n            onChange={onOverallChange} \n            size=\"lg\"\n          />\n        </div>\n      </div>\n      \n      <div className=\"border-t pt-4 space-y-3\">\n        <p className=\"text-sm text-muted-foreground text-center\">تقييم تفصيلي (اختياري)</p>\n        \n        {categories.map(({ key, label, icon: Icon, rating }) => (\n          <div \n            key={key} \n            className=\"flex items-center justify-between\"\n            data-testid={`rating-category-${key}`}\n          >\n            <div className=\"flex items-center gap-2 text-sm\">\n              <Icon className=\"w-4 h-4 text-muted-foreground\" />\n              <span>{label}</span>\n            </div>\n            <StarRating \n              rating={rating} \n              onChange={(value) => handleCategoryChange(key, value)} \n              size=\"sm\"\n            />\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\ninterface DetailedRatingDisplayProps {\n  overallRating: number;\n  qualityRating?: number | null;\n  speedRating?: number | null;\n  communicationRating?: number | null;\n  totalReviews?: number;\n  compact?: boolean;\n}\n\nexport function DetailedRatingDisplay({\n  overallRating,\n  qualityRating,\n  speedRating,\n  communicationRating,\n  totalReviews,\n  compact = false,\n}: DetailedRatingDisplayProps) {\n  const hasDetails = qualityRating || speedRating || communicationRating;\n  \n  if (compact) {\n    return (\n      <div className=\"flex items-center gap-1\" data-testid=\"rating-display-compact\">\n        <Star className=\"w-4 h-4 fill-yellow-400 text-yellow-400\" />\n        <span className=\"font-medium\">{Number(overallRating).toFixed(1)}</span>\n        {totalReviews !== undefined && (\n          <span className=\"text-muted-foreground text-sm\">({totalReviews})</span>\n        )}\n      </div>\n    );\n  }\n  \n  return (\n    <div className=\"space-y-3\" data-testid=\"rating-display-full\">\n      <div className=\"flex items-center gap-2\">\n        <StarRating rating={Number(overallRating)} readonly size=\"md\" />\n        <span className=\"font-semibold text-lg\">{Number(overallRating).toFixed(1)}</span>\n        {totalReviews !== undefined && (\n          <span className=\"text-muted-foreground\">({totalReviews} تقييم)</span>\n        )}\n      </div>\n      \n      {hasDetails && (\n        <div className=\"grid grid-cols-3 gap-2 text-sm\">\n          {qualityRating && (\n            <div className=\"flex flex-col items-center\" data-testid=\"detail-quality\">\n              <Wrench className=\"w-4 h-4 text-muted-foreground mb-1\" />\n              <span className=\"text-xs text-muted-foreground\">الجودة</span>\n              <span className=\"font-medium\">{qualityRating}</span>\n            </div>\n          )}\n          {speedRating && (\n            <div className=\"flex flex-col items-center\" data-testid=\"detail-speed\">\n              <Clock className=\"w-4 h-4 text-muted-foreground mb-1\" />\n              <span className=\"text-xs text-muted-foreground\">السرعة</span>\n              <span className=\"font-medium\">{speedRating}</span>\n            </div>\n          )}\n          {communicationRating && (\n            <div className=\"flex flex-col items-center\" data-testid=\"detail-communication\">\n              <MessageCircle className=\"w-4 h-4 text-muted-foreground mb-1\" />\n              <span className=\"text-xs text-muted-foreground\">التواصل</span>\n              <span className=\"font-medium\">{communicationRating}</span>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":6654,"size_tokens":null},"server/push.ts":{"content":"// Push Notification Service using web-push\nimport webpush from 'web-push';\n\n// Generate VAPID keys once and store them as environment variables\n// If not set, generate temporary ones for development\nconst vapidPublicKey = process.env.VAPID_PUBLIC_KEY || 'BEl62iUYgUivxIkv69yViEuiBIa-Ib9-SkvMeAtA3LFgDzkrxZJjSgSnfckjBJuBkr3qBUYIHBQFLXYp5Nksh8U';\nconst vapidPrivateKey = process.env.VAPID_PRIVATE_KEY || 'UUxI4O8-FbRouADVXc-hK3ltw1rMesmH_4dR1tG6rqc';\n\nwebpush.setVapidDetails(\n  'mailto:support@tharwa.app',\n  vapidPublicKey,\n  vapidPrivateKey\n);\n\nexport interface PushPayload {\n  title: string;\n  body: string;\n  icon?: string;\n  badge?: string;\n  data?: Record<string, any>;\n  actions?: Array<{ action: string; title: string; icon?: string }>;\n}\n\nexport async function sendPushNotification(\n  subscription: { endpoint: string; p256dh: string; auth: string },\n  payload: PushPayload\n): Promise<boolean> {\n  try {\n    const pushSubscription = {\n      endpoint: subscription.endpoint,\n      keys: {\n        p256dh: subscription.p256dh,\n        auth: subscription.auth,\n      },\n    };\n\n    await webpush.sendNotification(\n      pushSubscription,\n      JSON.stringify(payload)\n    );\n    \n    console.log('[Push] Notification sent successfully');\n    return true;\n  } catch (error: any) {\n    console.error('[Push] Failed to send notification:', error.message);\n    \n    // If subscription is expired or invalid, return false\n    if (error.statusCode === 410 || error.statusCode === 404) {\n      console.log('[Push] Subscription expired or invalid');\n      return false;\n    }\n    \n    return false;\n  }\n}\n\nexport function getVapidPublicKey(): string {\n  return vapidPublicKey;\n}\n\n// Notification types with Arabic translations\nexport const notificationTemplates = {\n  newTask: {\n    title: 'مهمة جديدة',\n    titleEn: 'New Task',\n  },\n  bidReceived: {\n    title: 'عرض جديد',\n    titleEn: 'New Bid Received',\n  },\n  taskCompleted: {\n    title: 'تم إنجاز المهمة',\n    titleEn: 'Task Completed',\n  },\n  paymentReceived: {\n    title: 'تم استلام الدفع',\n    titleEn: 'Payment Received',\n  },\n  newMessage: {\n    title: 'رسالة جديدة',\n    titleEn: 'New Message',\n  },\n  directRequest: {\n    title: 'طلب خدمة مباشر',\n    titleEn: 'Direct Service Request',\n  },\n  levelUp: {\n    title: 'ترقية المستوى',\n    titleEn: 'Level Up!',\n  },\n};\n","path":null,"size_bytes":2402,"size_tokens":null},"client/src/hooks/usePushNotifications.ts":{"content":"// Push Notifications Hook for PWA and Capacitor iOS\nimport { useState, useEffect, useCallback } from 'react';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport { Capacitor } from '@capacitor/core';\n\ninterface PushSubscriptionData {\n  endpoint: string;\n  p256dh: string;\n  auth: string;\n  deviceType: string;\n}\n\nexport function usePushNotifications() {\n  const [isSupported, setIsSupported] = useState(false);\n  const [isSubscribed, setIsSubscribed] = useState(false);\n  const [permission, setPermission] = useState<NotificationPermission | 'default'>('default');\n  const { toast } = useToast();\n\n  // Subscribe mutation to save subscription on server\n  const subscribeMutation = useMutation({\n    mutationFn: async (subscription: PushSubscriptionData) => {\n      const response = await apiRequest('POST', '/api/push/subscribe', subscription);\n      return response.json();\n    },\n    onSuccess: () => {\n      setIsSubscribed(true);\n      toast({\n        title: 'تم تفعيل الإشعارات',\n        description: 'ستتلقى إشعارات فورية',\n      });\n    },\n    onError: (error: Error) => {\n      console.error('[Push] Subscribe error:', error);\n      toast({\n        title: 'خطأ',\n        description: 'فشل في تفعيل الإشعارات',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Unsubscribe mutation\n  const unsubscribeMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', '/api/push/unsubscribe');\n      return response.json();\n    },\n    onSuccess: () => {\n      setIsSubscribed(false);\n      toast({\n        title: 'تم إلغاء الإشعارات',\n        description: 'لن تتلقى إشعارات فورية بعد الآن',\n      });\n    },\n  });\n\n  // Initialize push notifications\n  useEffect(() => {\n    const init = async () => {\n      if (Capacitor.isNativePlatform()) {\n        // iOS/Android native - use Capacitor Push Notifications\n        try {\n          const { PushNotifications } = await import('@capacitor/push-notifications');\n          setIsSupported(true);\n          \n          const permStatus = await PushNotifications.checkPermissions();\n          setPermission(permStatus.receive === 'granted' ? 'granted' : 'default');\n          \n          // Listen for registration\n          await PushNotifications.addListener('registration', (token) => {\n            console.log('[Push] Native token:', token.value);\n            // Native tokens are sent differently - just the token string\n            subscribeMutation.mutate({\n              endpoint: `native:${Capacitor.getPlatform()}:${token.value}`,\n              p256dh: 'native',\n              auth: 'native',\n              deviceType: Capacitor.getPlatform(),\n            });\n          });\n          \n          // Listen for push notifications\n          await PushNotifications.addListener('pushNotificationReceived', (notification) => {\n            console.log('[Push] Notification received:', notification);\n          });\n          \n          // Listen for notification action\n          await PushNotifications.addListener('pushNotificationActionPerformed', (action) => {\n            console.log('[Push] Action performed:', action);\n            if (action.notification.data?.url) {\n              window.location.href = action.notification.data.url;\n            }\n          });\n        } catch (e) {\n          console.error('[Push] Native init error:', e);\n          setIsSupported(false);\n        }\n      } else if ('Notification' in window && 'serviceWorker' in navigator && 'PushManager' in window) {\n        // Web PWA\n        setIsSupported(true);\n        setPermission(Notification.permission);\n        \n        // Check if already subscribed\n        try {\n          const registration = await navigator.serviceWorker.ready;\n          const subscription = await registration.pushManager.getSubscription();\n          setIsSubscribed(!!subscription);\n        } catch (e) {\n          console.error('[Push] Failed to check subscription:', e);\n        }\n      }\n    };\n    \n    init();\n  }, []);\n\n  // Register service worker for web push\n  const registerServiceWorker = useCallback(async (): Promise<ServiceWorkerRegistration | null> => {\n    try {\n      // Check if service worker is already registered\n      let registration = await navigator.serviceWorker.getRegistration('/sw.js');\n      \n      if (!registration) {\n        // Register the service worker\n        registration = await navigator.serviceWorker.register('/sw.js', { scope: '/' });\n        console.log('[Push] Service worker registered');\n      }\n      \n      // Wait for the service worker to be ready\n      await navigator.serviceWorker.ready;\n      return registration;\n    } catch (error) {\n      console.error('[Push] Service worker registration failed:', error);\n      return null;\n    }\n  }, []);\n\n  // Request permission and subscribe (Web)\n  const subscribeWeb = useCallback(async () => {\n    try {\n      // First, register service worker\n      const registration = await registerServiceWorker();\n      if (!registration) {\n        throw new Error('Failed to register service worker');\n      }\n      \n      // Request notification permission\n      const result = await Notification.requestPermission();\n      setPermission(result);\n      \n      if (result !== 'granted') {\n        toast({\n          title: 'تم رفض الإذن',\n          description: 'يرجى السماح بالإشعارات من إعدادات المتصفح',\n          variant: 'destructive',\n        });\n        return;\n      }\n      \n      // Get VAPID public key from server\n      const vapidResponse = await fetch('/api/push/vapid-key');\n      if (!vapidResponse.ok) {\n        throw new Error('Failed to fetch VAPID key');\n      }\n      const { publicKey } = await vapidResponse.json();\n      \n      if (!publicKey) {\n        throw new Error('No VAPID public key returned');\n      }\n      \n      // Wait for service worker to be fully ready\n      const swRegistration = await navigator.serviceWorker.ready;\n      \n      // Subscribe to push\n      const subscription = await swRegistration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: urlBase64ToUint8Array(publicKey),\n      });\n      \n      const json = subscription.toJSON();\n      \n      if (!json.endpoint || !json.keys?.p256dh || !json.keys?.auth) {\n        throw new Error('Invalid subscription: missing required fields');\n      }\n      \n      console.log('[Push] Web subscription created, keys present:', !!json.keys?.p256dh, !!json.keys?.auth);\n      \n      subscribeMutation.mutate({\n        endpoint: json.endpoint,\n        p256dh: json.keys.p256dh,\n        auth: json.keys.auth,\n        deviceType: 'web',\n      });\n    } catch (e: any) {\n      console.error('[Push] Subscribe error:', e);\n      toast({\n        title: 'خطأ',\n        description: e.message || 'فشل في تفعيل الإشعارات',\n        variant: 'destructive',\n      });\n    }\n  }, [registerServiceWorker, subscribeMutation, toast]);\n\n  // Request permission and subscribe (Native)\n  const subscribeNative = useCallback(async () => {\n    try {\n      const { PushNotifications } = await import('@capacitor/push-notifications');\n      \n      const permStatus = await PushNotifications.requestPermissions();\n      if (permStatus.receive === 'granted') {\n        await PushNotifications.register();\n        setPermission('granted');\n      } else {\n        toast({\n          title: 'تم رفض الإذن',\n          description: 'يرجى السماح بالإشعارات من الإعدادات',\n          variant: 'destructive',\n        });\n      }\n    } catch (e: any) {\n      console.error('[Push] Native permission error:', e);\n      toast({\n        title: 'خطأ',\n        description: 'فشل في تفعيل الإشعارات',\n        variant: 'destructive',\n      });\n    }\n  }, [toast]);\n\n  // Subscribe based on platform\n  const subscribe = useCallback(async () => {\n    if (Capacitor.isNativePlatform()) {\n      await subscribeNative();\n    } else {\n      await subscribeWeb();\n    }\n  }, [subscribeNative, subscribeWeb]);\n\n  // Unsubscribe\n  const unsubscribe = useCallback(async () => {\n    try {\n      if (!Capacitor.isNativePlatform()) {\n        const registration = await navigator.serviceWorker.ready;\n        const subscription = await registration.pushManager.getSubscription();\n        if (subscription) {\n          await subscription.unsubscribe();\n        }\n      }\n      unsubscribeMutation.mutate();\n    } catch (e) {\n      console.error('[Push] Unsubscribe error:', e);\n    }\n  }, [unsubscribeMutation]);\n\n  return {\n    isSupported,\n    isSubscribed,\n    permission,\n    subscribe,\n    unsubscribe,\n    isLoading: subscribeMutation.isPending || unsubscribeMutation.isPending,\n  };\n}\n\n// Helper function to convert VAPID key\nfunction urlBase64ToUint8Array(base64String: string): Uint8Array {\n  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\n  const base64 = (base64String + padding)\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n  \n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n  \n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  \n  return outputArray;\n}\n","path":null,"size_bytes":9425,"size_tokens":null},"client/src/components/LevelBadge.tsx":{"content":"// Tasker Level Badge Component\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\nimport { Trophy, Star, Award, Crown, Diamond } from \"lucide-react\";\n\ntype TaskerLevel = 'bronze' | 'silver' | 'gold' | 'platinum' | 'diamond';\n\ninterface LevelInfo {\n  level: TaskerLevel;\n  nameAr: string;\n  nameEn: string;\n  color: string;\n  bgClass: string;\n  textClass: string;\n}\n\nconst LEVELS: LevelInfo[] = [\n  {\n    level: 'bronze',\n    nameAr: 'برونزي',\n    nameEn: 'Bronze',\n    color: '#CD7F32',\n    bgClass: 'bg-amber-700/20 dark:bg-amber-800/30',\n    textClass: 'text-amber-700 dark:text-amber-500',\n  },\n  {\n    level: 'silver',\n    nameAr: 'فضي',\n    nameEn: 'Silver',\n    color: '#C0C0C0',\n    bgClass: 'bg-gray-400/20 dark:bg-gray-500/30',\n    textClass: 'text-gray-600 dark:text-gray-300',\n  },\n  {\n    level: 'gold',\n    nameAr: 'ذهبي',\n    nameEn: 'Gold',\n    color: '#FFD700',\n    bgClass: 'bg-yellow-500/20 dark:bg-yellow-600/30',\n    textClass: 'text-yellow-600 dark:text-yellow-400',\n  },\n  {\n    level: 'platinum',\n    nameAr: 'بلاتيني',\n    nameEn: 'Platinum',\n    color: '#E5E4E2',\n    bgClass: 'bg-purple-500/20 dark:bg-purple-600/30',\n    textClass: 'text-purple-600 dark:text-purple-400',\n  },\n  {\n    level: 'diamond',\n    nameAr: 'ماسي',\n    nameEn: 'Diamond',\n    color: '#B9F2FF',\n    bgClass: 'bg-cyan-500/20 dark:bg-cyan-600/30',\n    textClass: 'text-cyan-600 dark:text-cyan-400',\n  },\n];\n\nconst LevelIcon = ({ level, className }: { level: TaskerLevel; className?: string }) => {\n  const iconProps = { className: cn(\"w-4 h-4\", className) };\n  \n  switch (level) {\n    case 'bronze': return <Award {...iconProps} />;\n    case 'silver': return <Star {...iconProps} />;\n    case 'gold': return <Trophy {...iconProps} />;\n    case 'platinum': return <Crown {...iconProps} />;\n    case 'diamond': return <Diamond {...iconProps} />;\n    default: return <Award {...iconProps} />;\n  }\n};\n\ninterface LevelBadgeProps {\n  level: TaskerLevel;\n  showLabel?: boolean;\n  size?: 'sm' | 'md' | 'lg';\n  className?: string;\n}\n\nexport function LevelBadge({ level, showLabel = true, size = 'md', className }: LevelBadgeProps) {\n  const levelInfo = LEVELS.find(l => l.level === level) || LEVELS[0];\n  \n  const sizeClasses = {\n    sm: 'text-xs px-1.5 py-0.5',\n    md: 'text-sm px-2 py-0.5',\n    lg: 'text-base px-3 py-1',\n  };\n  \n  return (\n    <Badge \n      variant=\"outline\"\n      className={cn(\n        \"inline-flex items-center gap-1 border-0\",\n        levelInfo.bgClass,\n        levelInfo.textClass,\n        sizeClasses[size],\n        className\n      )}\n      data-testid={`badge-level-${level}`}\n    >\n      <LevelIcon level={level} />\n      {showLabel && <span>{levelInfo.nameAr}</span>}\n    </Badge>\n  );\n}\n\ninterface LevelProgressProps {\n  experiencePoints: number;\n  className?: string;\n}\n\nexport function LevelProgress({ experiencePoints, className }: LevelProgressProps) {\n  const getCurrentLevel = (points: number): LevelInfo => {\n    if (points >= 1000) return LEVELS[4]; // diamond\n    if (points >= 600) return LEVELS[3]; // platinum\n    if (points >= 300) return LEVELS[2]; // gold\n    if (points >= 100) return LEVELS[1]; // silver\n    return LEVELS[0]; // bronze\n  };\n  \n  const getNextLevel = (current: TaskerLevel): LevelInfo | null => {\n    const idx = LEVELS.findIndex(l => l.level === current);\n    return idx < LEVELS.length - 1 ? LEVELS[idx + 1] : null;\n  };\n  \n  const getProgress = (points: number): { percent: number; toNext: number } => {\n    if (points >= 1000) return { percent: 100, toNext: 0 };\n    \n    const thresholds = [0, 100, 300, 600, 1000];\n    let currentIdx = 0;\n    for (let i = thresholds.length - 1; i >= 0; i--) {\n      if (points >= thresholds[i]) {\n        currentIdx = i;\n        break;\n      }\n    }\n    \n    const currentMin = thresholds[currentIdx];\n    const nextMin = thresholds[currentIdx + 1] || 1000;\n    const range = nextMin - currentMin;\n    const pointsInLevel = points - currentMin;\n    \n    return {\n      percent: Math.round((pointsInLevel / range) * 100),\n      toNext: nextMin - points,\n    };\n  };\n  \n  const currentLevel = getCurrentLevel(experiencePoints);\n  const nextLevel = getNextLevel(currentLevel.level);\n  const { percent, toNext } = getProgress(experiencePoints);\n  \n  return (\n    <div className={cn(\"space-y-2\", className)} data-testid=\"level-progress\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <LevelBadge level={currentLevel.level} size=\"sm\" />\n          <span className=\"text-sm text-muted-foreground\">\n            {experiencePoints} نقطة\n          </span>\n        </div>\n        {nextLevel && (\n          <span className=\"text-xs text-muted-foreground\">\n            {toNext} نقطة للـ{nextLevel.nameAr}\n          </span>\n        )}\n      </div>\n      \n      <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\n        <div\n          className={cn(\"h-full transition-all duration-500\", currentLevel.bgClass)}\n          style={{ width: `${percent}%`, backgroundColor: currentLevel.color }}\n          data-testid=\"progress-bar\"\n        />\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5194,"size_tokens":null},"client/src/hooks/useGeolocation.ts":{"content":"// Geolocation Hook for automatic location detection with Riyadh validation\nimport { useState, useCallback } from 'react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface Coordinates {\n  latitude: number;\n  longitude: number;\n  accuracy?: number;\n}\n\ninterface GeolocationState {\n  coordinates: Coordinates | null;\n  address: string | null;\n  isLoading: boolean;\n  error: string | null;\n  isInRiyadh: boolean;\n}\n\n// Riyadh city boundaries (approximate)\nconst RIYADH_BOUNDS = {\n  north: 25.1,\n  south: 24.3,\n  east: 47.1,\n  west: 46.4,\n};\n\nexport function useGeolocation() {\n  const [state, setState] = useState<GeolocationState>({\n    coordinates: null,\n    address: null,\n    isLoading: false,\n    error: null,\n    isInRiyadh: false,\n  });\n  const { toast } = useToast();\n\n  // Validate if coordinates are within Riyadh boundaries\n  const validateRiyadhLocation = useCallback((lat: number, lng: number): boolean => {\n    return (\n      lat >= RIYADH_BOUNDS.south &&\n      lat <= RIYADH_BOUNDS.north &&\n      lng >= RIYADH_BOUNDS.west &&\n      lng <= RIYADH_BOUNDS.east\n    );\n  }, []);\n\n  // Get current position\n  const getCurrentPosition = useCallback((): Promise<Coordinates> => {\n    return new Promise((resolve, reject) => {\n      if (!navigator.geolocation) {\n        reject(new Error('الموقع الجغرافي غير مدعوم'));\n        return;\n      }\n\n      setState(prev => ({ ...prev, isLoading: true, error: null }));\n\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          const coords: Coordinates = {\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude,\n            accuracy: position.coords.accuracy,\n          };\n          \n          const isInRiyadh = validateRiyadhLocation(coords.latitude, coords.longitude);\n          \n          setState(prev => ({ \n            ...prev, \n            coordinates: coords, \n            isLoading: false,\n            isInRiyadh,\n          }));\n          resolve(coords);\n        },\n        (error) => {\n          let errorMessage = 'فشل في تحديد الموقع';\n          \n          switch (error.code) {\n            case error.PERMISSION_DENIED:\n              errorMessage = 'تم رفض إذن الموقع';\n              break;\n            case error.POSITION_UNAVAILABLE:\n              errorMessage = 'الموقع غير متاح';\n              break;\n            case error.TIMEOUT:\n              errorMessage = 'انتهت مهلة تحديد الموقع';\n              break;\n          }\n          \n          setState(prev => ({ ...prev, isLoading: false, error: errorMessage }));\n          reject(new Error(errorMessage));\n        },\n        {\n          enableHighAccuracy: true,\n          timeout: 10000,\n          maximumAge: 60000, // Cache for 1 minute\n        }\n      );\n    });\n  }, [validateRiyadhLocation]);\n\n  // Reverse geocode to get address\n  const getAddress = useCallback(async (lat: number, lng: number): Promise<string> => {\n    try {\n      // Using Nominatim OpenStreetMap for reverse geocoding (free, no API key needed)\n      const response = await fetch(\n        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`\n      );\n      \n      if (!response.ok) throw new Error('Failed to get address');\n      \n      const data = await response.json();\n      \n      // Build a readable address\n      const parts = [];\n      if (data.address?.neighbourhood) parts.push(data.address.neighbourhood);\n      if (data.address?.suburb) parts.push(data.address.suburb);\n      if (data.address?.city || data.address?.town) parts.push(data.address.city || data.address.town);\n      \n      const address = parts.length > 0 ? parts.join('، ') : data.display_name?.split(',').slice(0, 3).join('، ');\n      \n      setState(prev => ({ ...prev, address }));\n      return address || 'الرياض';\n    } catch (error) {\n      console.error('[Geo] Reverse geocode error:', error);\n      return 'الرياض';\n    }\n  }, []);\n\n  // Get current location with address and Riyadh validation\n  const getLocationWithAddress = useCallback(async () => {\n    try {\n      const coords = await getCurrentPosition();\n      const address = await getAddress(coords.latitude, coords.longitude);\n      \n      const isInRiyadh = validateRiyadhLocation(coords.latitude, coords.longitude);\n      \n      setState(prev => ({ ...prev, isInRiyadh }));\n      \n      if (!isInRiyadh) {\n        toast({\n          title: 'موقع خارج الرياض',\n          description: 'الخدمة متاحة حالياً في الرياض فقط',\n          variant: 'destructive',\n        });\n      }\n      \n      return { ...coords, address, isInRiyadh };\n    } catch (error: any) {\n      toast({\n        title: 'خطأ في تحديد الموقع',\n        description: error.message,\n        variant: 'destructive',\n      });\n      throw error;\n    }\n  }, [getCurrentPosition, getAddress, validateRiyadhLocation, toast]);\n\n  // Check if geolocation is supported\n  const isSupported = 'geolocation' in navigator;\n\n  return {\n    ...state,\n    isSupported,\n    getCurrentPosition,\n    getAddress,\n    getLocationWithAddress,\n    validateRiyadhLocation,\n  };\n}\n","path":null,"size_bytes":5239,"size_tokens":null}},"version":2}