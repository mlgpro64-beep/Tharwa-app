# حل مشكلة عدم وصول رمز OTP عبر SMS

## المشكلة
لم يصل رمز OTP عبر SMS من Authentica عند محاولة تسجيل الدخول.

## الخطوات السريعة

### 1. تحقق من وجود مفتاح API

افتح ملف `.env` وتحقق من وجود:
```env
AUTHENTICA_API_KEY=your_api_key_here
```

إذا لم يكن موجوداً:
1. سجّل في [Authentica](https://authentica.sa)
2. احصل على مفتاح API من لوحة التحكم
3. أضفه إلى ملف `.env`
4. أعد تشغيل السيرفر

### 2. اختبر الإعداد

شغّل سكريبت الاختبار:
```bash
npx tsx script/test-sms.ts 0501234567
```

استبدل `0501234567` برقم هاتفك الحقيقي.

### 3. تحقق من السجلات

عند محاولة إرسال OTP، افتح سجلات السيرفر وابحث عن:

**إذا نجح الإرسال:**
```
✅ [SMS] OTP sent successfully via Authentica to +9665XXXXXXXX
```

**إذا فشل الإرسال:**
```
❌ [OTP] SMS sending failed!
[OTP] Error: [سبب الخطأ]
```

## الأخطاء الشائعة وحلولها

### ❌ `SMS service not configured`
**السبب:** مفتاح API غير موجود

**الحل:**
1. أضف `AUTHENTICA_API_KEY` إلى ملف `.env`
2. أعد تشغيل السيرفر

### ❌ `401 Unauthorized`
**السبب:** مفتاح API غير صحيح أو منتهي الصلاحية

**الحل:**
1. تحقق من المفتاح في لوحة تحكم Authentica
2. احصل على مفتاح جديد إذا لزم الأمر
3. حدّث ملف `.env`

### ❌ `Invalid phone number`
**السبب:** رقم الهاتف غير صحيح

**الحل:**
- استخدم الصيغة: `05XXXXXXXX` (10 أرقام)
- مثال: `0501234567`

### ❌ `Insufficient balance`
**السبب:** رصيد الرسائل في Authentica منتهي

**الحل:**
1. سجّل الدخول إلى [لوحة تحكم Authentica](https://authentica.sa)
2. اشترِ رصيد إضافي

## وضع التطوير (Development Mode)

في وضع التطوير، إذا فشل إرسال SMS:
- سيتم إرجاع رمز OTP في الاستجابة تحت مفتاح `devCode`
- يمكنك استخدام هذا الرمز للاختبار
- لن يتم إرسال SMS فعلياً

## الحصول على المساعدة

1. راجع ملف `SMS_SETUP.md` للتفاصيل الكاملة
2. استخدم سكريبت الاختبار: `npx tsx script/test-sms.ts`
3. راجع سجلات السيرفر للأخطاء التفصيلية
4. تواصل مع دعم Authentica إذا استمرت المشكلة













